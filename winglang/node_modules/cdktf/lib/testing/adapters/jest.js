"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.setupJest = void 0;
// Copyright (c) HashiCorp, Inc
// SPDX-License-Identifier: MPL-2.0
const errors_1 = require("../../errors");
const matchers_1 = require("../matchers");
const matchers_2 = require("../matchers");
// Jest supports asymetric matchers (https://github.com/facebook/jest/blob/main/packages/expect/src/asymmetricMatchers.ts)
// These matchers are great in expressing partial equality in a deeply nested way
// As we want to support more than one testing framework we can not use them everywhere
function jestPassEvaluation(items, assertedProperties) {
    if (Object.entries(assertedProperties).length === 0) {
        return items.length > 0;
    }
    else {
        if (global.expect) {
            const expect = global.expect;
            return expect
                .arrayContaining([expect.objectContaining(assertedProperties)])
                .asymmetricMatch(items);
        }
        else {
            throw (0, errors_1.jestNotInstantiated)();
        }
    }
}
function setupJest() {
    if (!("expect" in global)) {
        throw (0, errors_1.expectNotGloballyAccessible)();
    }
    const expect = global.expect;
    expect.extend({
        toHaveResource(received, resourceConstructor) {
            return (0, matchers_2.returnMatcherToJest)((0, matchers_2.getToHaveResourceWithProperties)(jestPassEvaluation)(received, resourceConstructor, {}));
        },
        toHaveResourceWithProperties(received, resourceConstructor, properties) {
            return (0, matchers_2.returnMatcherToJest)((0, matchers_2.getToHaveResourceWithProperties)(jestPassEvaluation)(received, resourceConstructor, properties));
        },
        toHaveDataSource(received, dataSourceConstructor) {
            return (0, matchers_2.returnMatcherToJest)((0, matchers_1.getToHaveDataSourceWithProperties)(jestPassEvaluation)(received, dataSourceConstructor, {}));
        },
        toHaveDataSourceWithProperties(received, dataSourceConstructor, properties) {
            return (0, matchers_2.returnMatcherToJest)((0, matchers_1.getToHaveDataSourceWithProperties)(jestPassEvaluation)(received, dataSourceConstructor, properties));
        },
        toHaveProvider(received, providerConstructor) {
            return (0, matchers_2.returnMatcherToJest)((0, matchers_2.getToHaveProviderWithProperties)(jestPassEvaluation)(received, providerConstructor, {}));
        },
        toHaveProviderWithProperties(received, providerConstructor, properties) {
            return (0, matchers_2.returnMatcherToJest)((0, matchers_2.getToHaveProviderWithProperties)(jestPassEvaluation)(received, providerConstructor, properties));
        },
        toBeValidTerraform(received) {
            return (0, matchers_2.returnMatcherToJest)((0, matchers_1.toBeValidTerraform)(received));
        },
        toPlanSuccessfully(received) {
            return (0, matchers_2.returnMatcherToJest)((0, matchers_1.toPlanSuccessfully)(received));
        },
    });
}
exports.setupJest = setupJest;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiamVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImplc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsK0JBQStCO0FBQy9CLG1DQUFtQztBQUNuQyx5Q0FBZ0Y7QUFDaEYsMENBSXFCO0FBQ3JCLDBDQU1xQjtBQW9DckIsMEhBQTBIO0FBQzFILGlGQUFpRjtBQUNqRix1RkFBdUY7QUFDdkYsU0FBUyxrQkFBa0IsQ0FDekIsS0FBWSxFQUNaLGtCQUF1QztJQUV2QyxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDcEQsT0FBTyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztJQUMxQixDQUFDO1NBQU0sQ0FBQztRQUNOLElBQUssTUFBYyxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQzNCLE1BQU0sTUFBTSxHQUFJLE1BQWMsQ0FBQyxNQUFNLENBQUM7WUFDdEMsT0FBTyxNQUFNO2lCQUNWLGVBQWUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUM7aUJBQzlELGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM1QixDQUFDO2FBQU0sQ0FBQztZQUNOLE1BQU0sSUFBQSw0QkFBbUIsR0FBRSxDQUFDO1FBQzlCLENBQUM7SUFDSCxDQUFDO0FBQ0gsQ0FBQztBQUVELFNBQWdCLFNBQVM7SUFDdkIsSUFBSSxDQUFDLENBQUMsUUFBUSxJQUFJLE1BQU0sQ0FBQyxFQUFFLENBQUM7UUFDMUIsTUFBTSxJQUFBLG9DQUEyQixHQUFFLENBQUM7SUFDdEMsQ0FBQztJQUVELE1BQU0sTUFBTSxHQUFJLE1BQWMsQ0FBQyxNQUFvQixDQUFDO0lBRXBELE1BQU0sQ0FBQyxNQUFNLENBQUM7UUFDWixjQUFjLENBQ1osUUFBZ0IsRUFDaEIsbUJBQXlDO1lBRXpDLE9BQU8sSUFBQSw4QkFBbUIsRUFDeEIsSUFBQSwwQ0FBK0IsRUFBQyxrQkFBa0IsQ0FBQyxDQUNqRCxRQUFRLEVBQ1IsbUJBQW1CLEVBQ25CLEVBQUUsQ0FDSCxDQUNGLENBQUM7UUFDSixDQUFDO1FBQ0QsNEJBQTRCLENBQzFCLFFBQWdCLEVBQ2hCLG1CQUF5QyxFQUN6QyxVQUErQjtZQUUvQixPQUFPLElBQUEsOEJBQW1CLEVBQ3hCLElBQUEsMENBQStCLEVBQUMsa0JBQWtCLENBQUMsQ0FDakQsUUFBUSxFQUNSLG1CQUFtQixFQUNuQixVQUFVLENBQ1gsQ0FDRixDQUFDO1FBQ0osQ0FBQztRQUVELGdCQUFnQixDQUNkLFFBQWdCLEVBQ2hCLHFCQUEyQztZQUUzQyxPQUFPLElBQUEsOEJBQW1CLEVBQ3hCLElBQUEsNENBQWlDLEVBQUMsa0JBQWtCLENBQUMsQ0FDbkQsUUFBUSxFQUNSLHFCQUFxQixFQUNyQixFQUFFLENBQ0gsQ0FDRixDQUFDO1FBQ0osQ0FBQztRQUNELDhCQUE4QixDQUM1QixRQUFnQixFQUNoQixxQkFBMkMsRUFDM0MsVUFBK0I7WUFFL0IsT0FBTyxJQUFBLDhCQUFtQixFQUN4QixJQUFBLDRDQUFpQyxFQUFDLGtCQUFrQixDQUFDLENBQ25ELFFBQVEsRUFDUixxQkFBcUIsRUFDckIsVUFBVSxDQUNYLENBQ0YsQ0FBQztRQUNKLENBQUM7UUFFRCxjQUFjLENBQ1osUUFBZ0IsRUFDaEIsbUJBQXlDO1lBRXpDLE9BQU8sSUFBQSw4QkFBbUIsRUFDeEIsSUFBQSwwQ0FBK0IsRUFBQyxrQkFBa0IsQ0FBQyxDQUNqRCxRQUFRLEVBQ1IsbUJBQW1CLEVBQ25CLEVBQUUsQ0FDSCxDQUNGLENBQUM7UUFDSixDQUFDO1FBQ0QsNEJBQTRCLENBQzFCLFFBQWdCLEVBQ2hCLG1CQUF5QyxFQUN6QyxVQUErQjtZQUUvQixPQUFPLElBQUEsOEJBQW1CLEVBQ3hCLElBQUEsMENBQStCLEVBQUMsa0JBQWtCLENBQUMsQ0FDakQsUUFBUSxFQUNSLG1CQUFtQixFQUNuQixVQUFVLENBQ1gsQ0FDRixDQUFDO1FBQ0osQ0FBQztRQUVELGtCQUFrQixDQUFDLFFBQWdCO1lBQ2pDLE9BQU8sSUFBQSw4QkFBbUIsRUFBQyxJQUFBLDZCQUFrQixFQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDM0QsQ0FBQztRQUNELGtCQUFrQixDQUFDLFFBQWdCO1lBQ2pDLE9BQU8sSUFBQSw4QkFBbUIsRUFBQyxJQUFBLDZCQUFrQixFQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDM0QsQ0FBQztLQUNGLENBQUMsQ0FBQztBQUNMLENBQUM7QUE3RkQsOEJBNkZDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSBIYXNoaUNvcnAsIEluY1xuLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1QTC0yLjBcbmltcG9ydCB7IGV4cGVjdE5vdEdsb2JhbGx5QWNjZXNzaWJsZSwgamVzdE5vdEluc3RhbnRpYXRlZCB9IGZyb20gXCIuLi8uLi9lcnJvcnNcIjtcbmltcG9ydCB7XG4gIGdldFRvSGF2ZURhdGFTb3VyY2VXaXRoUHJvcGVydGllcyxcbiAgdG9CZVZhbGlkVGVycmFmb3JtLFxuICB0b1BsYW5TdWNjZXNzZnVsbHksXG59IGZyb20gXCIuLi9tYXRjaGVyc1wiO1xuaW1wb3J0IHtcbiAgZ2V0VG9IYXZlUmVzb3VyY2VXaXRoUHJvcGVydGllcyxcbiAgZ2V0VG9IYXZlUHJvdmlkZXJXaXRoUHJvcGVydGllcyxcbiAgVGVycmFmb3JtQ29uc3RydWN0b3IsXG4gIE1hdGNoZXJSZXR1cm5KZXN0LFxuICByZXR1cm5NYXRjaGVyVG9KZXN0LFxufSBmcm9tIFwiLi4vbWF0Y2hlcnNcIjtcblxuLyogZXNsaW50LWRpc2FibGUgKi9cbmRlY2xhcmUgZ2xvYmFsIHtcbiAgbmFtZXNwYWNlIGplc3Qge1xuICAgIGludGVyZmFjZSBNYXRjaGVyczxSPiB7XG4gICAgICB0b0hhdmVSZXNvdXJjZShyZXNvdXJjZUNvbnN0cnVjdG9yOiBUZXJyYWZvcm1Db25zdHJ1Y3Rvcik6IFI7XG4gICAgICB0b0hhdmVSZXNvdXJjZVdpdGhQcm9wZXJ0aWVzKFxuICAgICAgICByZXNvdXJjZUNvbnN0cnVjdG9yOiBUZXJyYWZvcm1Db25zdHJ1Y3RvcixcbiAgICAgICAgcHJvcGVydGllczogUmVjb3JkPHN0cmluZywgYW55PlxuICAgICAgKTogUjtcblxuICAgICAgdG9IYXZlRGF0YVNvdXJjZShkYXRhU291cmNlQ29uc3RydWN0b3I6IFRlcnJhZm9ybUNvbnN0cnVjdG9yKTogUjtcbiAgICAgIHRvSGF2ZURhdGFTb3VyY2VXaXRoUHJvcGVydGllcyhcbiAgICAgICAgZGF0YVNvdXJjZUNvbnN0cnVjdG9yOiBUZXJyYWZvcm1Db25zdHJ1Y3RvcixcbiAgICAgICAgcHJvcGVydGllczogUmVjb3JkPHN0cmluZywgYW55PlxuICAgICAgKTogUjtcblxuICAgICAgdG9IYXZlUHJvdmlkZXIocHJvdmlkZXJDb25zdHJ1Y3RvcjogVGVycmFmb3JtQ29uc3RydWN0b3IpOiBSO1xuICAgICAgdG9IYXZlUHJvdmlkZXJXaXRoUHJvcGVydGllcyhcbiAgICAgICAgcHJvdmlkZXJDb25zdHJ1Y3RvcjogVGVycmFmb3JtQ29uc3RydWN0b3IsXG4gICAgICAgIHByb3BlcnRpZXM6IFJlY29yZDxzdHJpbmcsIGFueT5cbiAgICAgICk6IFI7XG5cbiAgICAgIHRvQmVWYWxpZFRlcnJhZm9ybSgpOiBSO1xuICAgICAgdG9QbGFuU3VjY2Vzc2Z1bGx5KCk6IFI7XG4gICAgfVxuICB9XG59XG5cbnR5cGUgSmVzdEV4cGVjdCA9IHtcbiAgZXh0ZW5kOiAoXG4gICAgbWF0Y2hlcnM6IFJlY29yZDxzdHJpbmcsICguLi5hcmdzOiBhbnlbXSkgPT4gTWF0Y2hlclJldHVybkplc3Q+XG4gICkgPT4gdm9pZDtcbn07XG5cbi8vIEplc3Qgc3VwcG9ydHMgYXN5bWV0cmljIG1hdGNoZXJzIChodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svamVzdC9ibG9iL21haW4vcGFja2FnZXMvZXhwZWN0L3NyYy9hc3ltbWV0cmljTWF0Y2hlcnMudHMpXG4vLyBUaGVzZSBtYXRjaGVycyBhcmUgZ3JlYXQgaW4gZXhwcmVzc2luZyBwYXJ0aWFsIGVxdWFsaXR5IGluIGEgZGVlcGx5IG5lc3RlZCB3YXlcbi8vIEFzIHdlIHdhbnQgdG8gc3VwcG9ydCBtb3JlIHRoYW4gb25lIHRlc3RpbmcgZnJhbWV3b3JrIHdlIGNhbiBub3QgdXNlIHRoZW0gZXZlcnl3aGVyZVxuZnVuY3Rpb24gamVzdFBhc3NFdmFsdWF0aW9uKFxuICBpdGVtczogYW55W10sXG4gIGFzc2VydGVkUHJvcGVydGllczogUmVjb3JkPHN0cmluZywgYW55PlxuKTogYm9vbGVhbiB7XG4gIGlmIChPYmplY3QuZW50cmllcyhhc3NlcnRlZFByb3BlcnRpZXMpLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBpdGVtcy5sZW5ndGggPiAwO1xuICB9IGVsc2Uge1xuICAgIGlmICgoZ2xvYmFsIGFzIGFueSkuZXhwZWN0KSB7XG4gICAgICBjb25zdCBleHBlY3QgPSAoZ2xvYmFsIGFzIGFueSkuZXhwZWN0O1xuICAgICAgcmV0dXJuIGV4cGVjdFxuICAgICAgICAuYXJyYXlDb250YWluaW5nKFtleHBlY3Qub2JqZWN0Q29udGFpbmluZyhhc3NlcnRlZFByb3BlcnRpZXMpXSlcbiAgICAgICAgLmFzeW1tZXRyaWNNYXRjaChpdGVtcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IGplc3ROb3RJbnN0YW50aWF0ZWQoKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldHVwSmVzdCgpIHtcbiAgaWYgKCEoXCJleHBlY3RcIiBpbiBnbG9iYWwpKSB7XG4gICAgdGhyb3cgZXhwZWN0Tm90R2xvYmFsbHlBY2Nlc3NpYmxlKCk7XG4gIH1cblxuICBjb25zdCBleHBlY3QgPSAoZ2xvYmFsIGFzIGFueSkuZXhwZWN0IGFzIEplc3RFeHBlY3Q7XG5cbiAgZXhwZWN0LmV4dGVuZCh7XG4gICAgdG9IYXZlUmVzb3VyY2UoXG4gICAgICByZWNlaXZlZDogc3RyaW5nLFxuICAgICAgcmVzb3VyY2VDb25zdHJ1Y3RvcjogVGVycmFmb3JtQ29uc3RydWN0b3JcbiAgICApIHtcbiAgICAgIHJldHVybiByZXR1cm5NYXRjaGVyVG9KZXN0KFxuICAgICAgICBnZXRUb0hhdmVSZXNvdXJjZVdpdGhQcm9wZXJ0aWVzKGplc3RQYXNzRXZhbHVhdGlvbikoXG4gICAgICAgICAgcmVjZWl2ZWQsXG4gICAgICAgICAgcmVzb3VyY2VDb25zdHJ1Y3RvcixcbiAgICAgICAgICB7fVxuICAgICAgICApXG4gICAgICApO1xuICAgIH0sXG4gICAgdG9IYXZlUmVzb3VyY2VXaXRoUHJvcGVydGllcyhcbiAgICAgIHJlY2VpdmVkOiBzdHJpbmcsXG4gICAgICByZXNvdXJjZUNvbnN0cnVjdG9yOiBUZXJyYWZvcm1Db25zdHJ1Y3RvcixcbiAgICAgIHByb3BlcnRpZXM6IFJlY29yZDxzdHJpbmcsIGFueT5cbiAgICApIHtcbiAgICAgIHJldHVybiByZXR1cm5NYXRjaGVyVG9KZXN0KFxuICAgICAgICBnZXRUb0hhdmVSZXNvdXJjZVdpdGhQcm9wZXJ0aWVzKGplc3RQYXNzRXZhbHVhdGlvbikoXG4gICAgICAgICAgcmVjZWl2ZWQsXG4gICAgICAgICAgcmVzb3VyY2VDb25zdHJ1Y3RvcixcbiAgICAgICAgICBwcm9wZXJ0aWVzXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfSxcblxuICAgIHRvSGF2ZURhdGFTb3VyY2UoXG4gICAgICByZWNlaXZlZDogc3RyaW5nLFxuICAgICAgZGF0YVNvdXJjZUNvbnN0cnVjdG9yOiBUZXJyYWZvcm1Db25zdHJ1Y3RvclxuICAgICkge1xuICAgICAgcmV0dXJuIHJldHVybk1hdGNoZXJUb0plc3QoXG4gICAgICAgIGdldFRvSGF2ZURhdGFTb3VyY2VXaXRoUHJvcGVydGllcyhqZXN0UGFzc0V2YWx1YXRpb24pKFxuICAgICAgICAgIHJlY2VpdmVkLFxuICAgICAgICAgIGRhdGFTb3VyY2VDb25zdHJ1Y3RvcixcbiAgICAgICAgICB7fVxuICAgICAgICApXG4gICAgICApO1xuICAgIH0sXG4gICAgdG9IYXZlRGF0YVNvdXJjZVdpdGhQcm9wZXJ0aWVzKFxuICAgICAgcmVjZWl2ZWQ6IHN0cmluZyxcbiAgICAgIGRhdGFTb3VyY2VDb25zdHJ1Y3RvcjogVGVycmFmb3JtQ29uc3RydWN0b3IsXG4gICAgICBwcm9wZXJ0aWVzOiBSZWNvcmQ8c3RyaW5nLCBhbnk+XG4gICAgKSB7XG4gICAgICByZXR1cm4gcmV0dXJuTWF0Y2hlclRvSmVzdChcbiAgICAgICAgZ2V0VG9IYXZlRGF0YVNvdXJjZVdpdGhQcm9wZXJ0aWVzKGplc3RQYXNzRXZhbHVhdGlvbikoXG4gICAgICAgICAgcmVjZWl2ZWQsXG4gICAgICAgICAgZGF0YVNvdXJjZUNvbnN0cnVjdG9yLFxuICAgICAgICAgIHByb3BlcnRpZXNcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9LFxuXG4gICAgdG9IYXZlUHJvdmlkZXIoXG4gICAgICByZWNlaXZlZDogc3RyaW5nLFxuICAgICAgcHJvdmlkZXJDb25zdHJ1Y3RvcjogVGVycmFmb3JtQ29uc3RydWN0b3JcbiAgICApIHtcbiAgICAgIHJldHVybiByZXR1cm5NYXRjaGVyVG9KZXN0KFxuICAgICAgICBnZXRUb0hhdmVQcm92aWRlcldpdGhQcm9wZXJ0aWVzKGplc3RQYXNzRXZhbHVhdGlvbikoXG4gICAgICAgICAgcmVjZWl2ZWQsXG4gICAgICAgICAgcHJvdmlkZXJDb25zdHJ1Y3RvcixcbiAgICAgICAgICB7fVxuICAgICAgICApXG4gICAgICApO1xuICAgIH0sXG4gICAgdG9IYXZlUHJvdmlkZXJXaXRoUHJvcGVydGllcyhcbiAgICAgIHJlY2VpdmVkOiBzdHJpbmcsXG4gICAgICBwcm92aWRlckNvbnN0cnVjdG9yOiBUZXJyYWZvcm1Db25zdHJ1Y3RvcixcbiAgICAgIHByb3BlcnRpZXM6IFJlY29yZDxzdHJpbmcsIGFueT5cbiAgICApIHtcbiAgICAgIHJldHVybiByZXR1cm5NYXRjaGVyVG9KZXN0KFxuICAgICAgICBnZXRUb0hhdmVQcm92aWRlcldpdGhQcm9wZXJ0aWVzKGplc3RQYXNzRXZhbHVhdGlvbikoXG4gICAgICAgICAgcmVjZWl2ZWQsXG4gICAgICAgICAgcHJvdmlkZXJDb25zdHJ1Y3RvcixcbiAgICAgICAgICBwcm9wZXJ0aWVzXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfSxcblxuICAgIHRvQmVWYWxpZFRlcnJhZm9ybShyZWNlaXZlZDogc3RyaW5nKSB7XG4gICAgICByZXR1cm4gcmV0dXJuTWF0Y2hlclRvSmVzdCh0b0JlVmFsaWRUZXJyYWZvcm0ocmVjZWl2ZWQpKTtcbiAgICB9LFxuICAgIHRvUGxhblN1Y2Nlc3NmdWxseShyZWNlaXZlZDogc3RyaW5nKSB7XG4gICAgICByZXR1cm4gcmV0dXJuTWF0Y2hlclRvSmVzdCh0b1BsYW5TdWNjZXNzZnVsbHkocmVjZWl2ZWQpKTtcbiAgICB9LFxuICB9KTtcbn1cbiJdfQ==