"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.TestRunnerInflightMethods = exports.TraceType = exports.LogLevel = exports.TestRunner = exports.TEST_RUNNER_FQN = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const resource_1 = require("./resource");
const test_1 = require("./test");
const cloud_1 = require("../cloud");
const constants_1 = require("../constants");
const std_1 = require("../std");
/**
 * Global identifier for `TestRunner`.
 */
exports.TEST_RUNNER_FQN = (0, constants_1.fqnForType)("std.TestRunner");
/**
 * A test engine.
 *
 * @inflight `@winglang/sdk.std.ITestRunnerClient`
 * @skipDocs
 * @abstract
 */
class TestRunner extends resource_1.Resource {
    /**
     * Instantiate one or more copies of a tree inside of an app based
     * on how many isolated environments are needed for testing.
     * @internal
     */
    static _createTree(app, Root) {
        if (app.isTestEnvironment) {
            app._testRunner = new TestRunner(app, "cloud.TestRunner");
        }
        if (Root) {
            // mark the root type so that we can find it later through
            // Node.of(root).root
            std_1.Node._markRoot(Root);
            if (app.isTestEnvironment) {
                new Root(app, "env0");
                const tests = app._testRunner.findTests();
                for (let i = 1; i < tests.length; i++) {
                    new Root(app, "env" + i);
                }
            }
            else {
                new Root(app, "Default");
            }
        }
    }
    constructor(scope, id, props = {}) {
        if (new.target === TestRunner) {
            return resource_1.Resource._newFromFactory(exports.TEST_RUNNER_FQN, scope, id, props);
        }
        super(scope, id);
        /**
         * List of isolated environment names where we've already created a cloud.Function
         * for a unit test. We keep track of these so that we don't synthesize
         * multiple test functions into the same isolated environment.
         */
        this._synthedEnvs = new Set();
        /**
         * List of test paths that we have already created a cloud.Function for.
         * We keep track of these so that we don't create identical test functions in multiple
         * isolated environments.
         */
        this._synthedTests = new Set();
        std_1.Node.of(this).hidden = true;
        std_1.Node.of(this).title = "TestRunner";
        std_1.Node.of(this).description =
            "A suite of APIs for running tests and collecting results.";
        props;
    }
    /** @internal */
    _addTestFunction(scope, id, inflight, props) {
        // searching exactly for `env${number}`
        const testEnv = scope.node.path.match(/env[0-9]+/)?.at(0);
        // searching for the rest of the path that appears after `env${number}`- this would be the test path
        const testPath = scope.node.path
            .match(/env[\d]+\/.+/)
            ?.at(0)
            .replace(`${testEnv}/`, "") +
            "/" +
            id;
        if (!this._synthedEnvs.has(testEnv) && !this._synthedTests.has(testPath)) {
            this._synthedEnvs.add(testEnv);
            this._synthedTests.add(testPath);
            return new cloud_1.Function(scope, id, inflight, props);
        }
        return undefined;
    }
    /** @internal */
    get _liftMap() {
        return {
            [TestRunnerInflightMethods.LIST_TESTS]: [],
            [TestRunnerInflightMethods.RUN_TEST]: [],
        };
    }
    /**
     * Find all tests in the construct tree.
     * @returns A list of tests.
     */
    findTests() {
        const isTest = (fn) => {
            return fn instanceof test_1.Test;
        };
        return this.node.root.node.findAll().filter(isTest);
    }
}
exports.TestRunner = TestRunner;
_a = JSII_RTTI_SYMBOL_1;
TestRunner[_a] = { fqn: "@winglang/sdk.std.TestRunner", version: "0.0.0" };
/**
 * Log level
 */
var LogLevel;
(function (LogLevel) {
    /**
     * Mostly used for debugging
     */
    LogLevel["VERBOSE"] = "verbose";
    /**
     * Information that is useful to developers
     */
    LogLevel["INFO"] = "info";
    /**
     * Warnings that are not errors, but may require attention
     */
    LogLevel["WARNING"] = "warning";
    /**
     * Errors that should be addressed
     */
    LogLevel["ERROR"] = "error";
})(LogLevel || (exports.LogLevel = LogLevel = {}));
/**
 * The type of a trace.
 * @skipDocs
 */
var TraceType;
(function (TraceType) {
    /**
     * A trace representing simulator activity.
     */
    TraceType["SIMULATOR"] = "simulator";
    /**
     * A trace representing a resource activity.
     */
    TraceType["RESOURCE"] = "resource";
    /**
     * A trace representing a message emitted by the logger.
     */
    TraceType["LOG"] = "log";
})(TraceType || (exports.TraceType = TraceType = {}));
/**
 * List of inflight operations available for `TestRunner`.
 * @internal
 */
var TestRunnerInflightMethods;
(function (TestRunnerInflightMethods) {
    /** `TestRunner.runTest` */
    TestRunnerInflightMethods["RUN_TEST"] = "runTest";
    /** `TestRunner.listTests` */
    TestRunnerInflightMethods["LIST_TESTS"] = "listTests";
})(TestRunnerInflightMethods || (exports.TestRunnerInflightMethods = TestRunnerInflightMethods = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC1ydW5uZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc3RkL3Rlc3QtcnVubmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EseUNBQXNDO0FBQ3RDLGlDQUE4QjtBQUM5QixvQ0FBcUU7QUFDckUsNENBQTBDO0FBRTFDLGdDQUE4QjtBQUU5Qjs7R0FFRztBQUNVLFFBQUEsZUFBZSxHQUFHLElBQUEsc0JBQVUsRUFBQyxnQkFBZ0IsQ0FBQyxDQUFDO0FBUTVEOzs7Ozs7R0FNRztBQUNILE1BQWEsVUFBVyxTQUFRLG1CQUFRO0lBQ3RDOzs7O09BSUc7SUFDSSxNQUFNLENBQUMsV0FBVyxDQUFDLEdBQVEsRUFBRSxJQUFTO1FBQzNDLElBQUksR0FBRyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDMUIsR0FBRyxDQUFDLFdBQVcsR0FBRyxJQUFJLFVBQVUsQ0FBQyxHQUFHLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztRQUM1RCxDQUFDO1FBRUQsSUFBSSxJQUFJLEVBQUUsQ0FBQztZQUNULDBEQUEwRDtZQUMxRCxxQkFBcUI7WUFDckIsVUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUVyQixJQUFJLEdBQUcsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO2dCQUMxQixJQUFJLElBQUksQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUM7Z0JBQ3RCLE1BQU0sS0FBSyxHQUFHLEdBQUcsQ0FBQyxXQUFZLENBQUMsU0FBUyxFQUFFLENBQUM7Z0JBQzNDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7b0JBQ3RDLElBQUksSUFBSSxDQUFDLEdBQUcsRUFBRSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQzNCLENBQUM7WUFDSCxDQUFDO2lCQUFNLENBQUM7Z0JBQ04sSUFBSSxJQUFJLENBQUMsR0FB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QUNILDJCQUFlLENBQUE7QUFDakIsQ0FBQyxFQXBCVyxRQUFRLHdCQUFSLFFBQVEsUUFvQm5CO0FBRUQ7OztHQUdHO0FBQ0gsSUFBWSxTQWFYO0FBYkQsV0FBWSxTQUFTO0lBQ25COztPQUVHO0lBQ0gsb0NBQXVCLENBQUE7SUFDdkI7O09BRUc7SUFDSCxrQ0FBcUIsQ0FBQTtJQUNyQjs7T0FFRztJQUNILHdCQUFXLENBQUE7QUFDYixDQUFDLEVBYlcsU0FBUyx5QkFBVCxTQUFTLFFBYXBCO0FBRUQ7OztHQUdHO0FBQ0gsSUFBWSx5QkFLWDtBQUxELFdBQVkseUJBQXlCO0lBQ25DLDJCQUEyQjtJQUMzQixpREFBb0IsQ0FBQTtJQUNwQiw2QkFBNkI7SUFDN0IscURBQXdCLENBQUE7QUFDMUIsQ0FBQyxFQUxXLHlCQUF5Qix5Q0FBekIseUJBQXlCLFFBS3BDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSBcImNvbnN0cnVjdHNcIjtcbmltcG9ydCB7IFJlc291cmNlIH0gZnJvbSBcIi4vcmVzb3VyY2VcIjtcbmltcG9ydCB7IFRlc3QgfSBmcm9tIFwiLi90ZXN0XCI7XG5pbXBvcnQgeyBGdW5jdGlvbiwgRnVuY3Rpb25Qcm9wcywgSUZ1bmN0aW9uSGFuZGxlciB9IGZyb20gXCIuLi9jbG91ZFwiO1xuaW1wb3J0IHsgZnFuRm9yVHlwZSB9IGZyb20gXCIuLi9jb25zdGFudHNcIjtcbmltcG9ydCB7IEFwcCwgTGlmdE1hcCB9IGZyb20gXCIuLi9jb3JlXCI7XG5pbXBvcnQgeyBOb2RlIH0gZnJvbSBcIi4uL3N0ZFwiO1xuXG4vKipcbiAqIEdsb2JhbCBpZGVudGlmaWVyIGZvciBgVGVzdFJ1bm5lcmAuXG4gKi9cbmV4cG9ydCBjb25zdCBURVNUX1JVTk5FUl9GUU4gPSBmcW5Gb3JUeXBlKFwic3RkLlRlc3RSdW5uZXJcIik7XG5cbi8qKlxuICogUHJvcGVydGllcyBmb3IgYFRlc3RSdW5uZXJgLlxuICogQHNraXBEb2NzXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVGVzdFJ1bm5lclByb3BzIHt9XG5cbi8qKlxuICogQSB0ZXN0IGVuZ2luZS5cbiAqXG4gKiBAaW5mbGlnaHQgYEB3aW5nbGFuZy9zZGsuc3RkLklUZXN0UnVubmVyQ2xpZW50YFxuICogQHNraXBEb2NzXG4gKiBAYWJzdHJhY3RcbiAqL1xuZXhwb3J0IGNsYXNzIFRlc3RSdW5uZXIgZXh0ZW5kcyBSZXNvdXJjZSB7XG4gIC8qKlxuICAgKiBJbnN0YW50aWF0ZSBvbmUgb3IgbW9yZSBjb3BpZXMgb2YgYSB0cmVlIGluc2lkZSBvZiBhbiBhcHAgYmFzZWRcbiAgICogb24gaG93IG1hbnkgaXNvbGF0ZWQgZW52aXJvbm1lbnRzIGFyZSBuZWVkZWQgZm9yIHRlc3RpbmcuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBfY3JlYXRlVHJlZShhcHA6IEFwcCwgUm9vdDogYW55KSB7XG4gICAgaWYgKGFwcC5pc1Rlc3RFbnZpcm9ubWVudCkge1xuICAgICAgYXBwLl90ZXN0UnVubmVyID0gbmV3IFRlc3RSdW5uZXIoYXBwLCBcImNsb3VkLlRlc3RSdW5uZXJcIik7XG4gICAgfVxuXG4gICAgaWYgKFJvb3QpIHtcbiAgICAgIC8vIG1hcmsgdGhlIHJvb3QgdHlwZSBzbyB0aGF0IHdlIGNhbiBmaW5kIGl0IGxhdGVyIHRocm91Z2hcbiAgICAgIC8vIE5vZGUub2Yocm9vdCkucm9vdFxuICAgICAgTm9kZS5fbWFya1Jvb3QoUm9vdCk7XG5cbiAgICAgIGlmIChhcHAuaXNUZXN0RW52aXJvbm1lbnQpIHtcbiAgICAgICAgbmV3IFJvb3QoYXBwLCBcImVudjBcIik7XG4gICAgICAgIGNvbnN0IHRlc3RzID0gYXBwLl90ZXN0UnVubmVyIS5maW5kVGVzdHMoKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCB0ZXN0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIG5ldyBSb290KGFwcCwgXCJlbnZcIiArIGkpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXcgUm9vdChhcHAsIFwiRGVmYXVsdFwiKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTGlzdCBvZiBpc29sYXRlZCBlbnZpcm9ubWVudCBuYW1lcyB3aGVyZSB3ZSd2ZSBhbHJlYWR5IGNyZWF0ZWQgYSBjbG91ZC5GdW5jdGlvblxuICAgKiBmb3IgYSB1bml0IHRlc3QuIFdlIGtlZXAgdHJhY2sgb2YgdGhlc2Ugc28gdGhhdCB3ZSBkb24ndCBzeW50aGVzaXplXG4gICAqIG11bHRpcGxlIHRlc3QgZnVuY3Rpb25zIGludG8gdGhlIHNhbWUgaXNvbGF0ZWQgZW52aXJvbm1lbnQuXG4gICAqL1xuICBwcml2YXRlIF9zeW50aGVkRW52czogU2V0PHN0cmluZz4gPSBuZXcgU2V0KCk7XG5cbiAgLyoqXG4gICAqIExpc3Qgb2YgdGVzdCBwYXRocyB0aGF0IHdlIGhhdmUgYWxyZWFkeSBjcmVhdGVkIGEgY2xvdWQuRnVuY3Rpb24gZm9yLlxuICAgKiBXZSBrZWVwIHRyYWNrIG9mIHRoZXNlIHNvIHRoYXQgd2UgZG9uJ3QgY3JlYXRlIGlkZW50aWNhbCB0ZXN0IGZ1bmN0aW9ucyBpbiBtdWx0aXBsZVxuICAgKiBpc29sYXRlZCBlbnZpcm9ubWVudHMuXG4gICAqL1xuICBwcml2YXRlIF9zeW50aGVkVGVzdHM6IFNldDxzdHJpbmc+ID0gbmV3IFNldCgpO1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBUZXN0UnVubmVyUHJvcHMgPSB7fSkge1xuICAgIGlmIChuZXcudGFyZ2V0ID09PSBUZXN0UnVubmVyKSB7XG4gICAgICByZXR1cm4gUmVzb3VyY2UuX25ld0Zyb21GYWN0b3J5KFRFU1RfUlVOTkVSX0ZRTiwgc2NvcGUsIGlkLCBwcm9wcyk7XG4gICAgfVxuXG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcblxuICAgIE5vZGUub2YodGhpcykuaGlkZGVuID0gdHJ1ZTtcbiAgICBOb2RlLm9mKHRoaXMpLnRpdGxlID0gXCJUZXN0UnVubmVyXCI7XG4gICAgTm9kZS5vZih0aGlzKS5kZXNjcmlwdGlvbiA9XG4gICAgICBcIkEgc3VpdGUgb2YgQVBJcyBmb3IgcnVubmluZyB0ZXN0cyBhbmQgY29sbGVjdGluZyByZXN1bHRzLlwiO1xuXG4gICAgcHJvcHM7XG4gIH1cblxuICAvKiogQGludGVybmFsICovXG4gIHB1YmxpYyBfYWRkVGVzdEZ1bmN0aW9uKFxuICAgIHNjb3BlOiBDb25zdHJ1Y3QsXG4gICAgaWQ6IHN0cmluZyxcbiAgICBpbmZsaWdodDogSUZ1bmN0aW9uSGFuZGxlcixcbiAgICBwcm9wczogRnVuY3Rpb25Qcm9wc1xuICApOiBGdW5jdGlvbiB8IHVuZGVmaW5lZCB7XG4gICAgLy8gc2VhcmNoaW5nIGV4YWN0bHkgZm9yIGBlbnYke251bWJlcn1gXG4gICAgY29uc3QgdGVzdEVudiA9IHNjb3BlLm5vZGUucGF0aC5tYXRjaCgvZW52WzAtOV0rLyk/LmF0KDApITtcbiAgICAvLyBzZWFyY2hpbmcgZm9yIHRoZSByZXN0IG9mIHRoZSBwYXRoIHRoYXQgYXBwZWFycyBhZnRlciBgZW52JHtudW1iZXJ9YC0gdGhpcyB3b3VsZCBiZSB0aGUgdGVzdCBwYXRoXG4gICAgY29uc3QgdGVzdFBhdGggPVxuICAgICAgc2NvcGUubm9kZS5wYXRoXG4gICAgICAgIC5tYXRjaCgvZW52W1xcZF0rXFwvLisvKVxuICAgICAgICA/LmF0KDApIVxuICAgICAgICAucmVwbGFjZShgJHt0ZXN0RW52fS9gLCBcIlwiKSArXG4gICAgICBcIi9cIiArXG4gICAgICBpZDtcblxuICAgIGlmICghdGhpcy5fc3ludGhlZEVudnMuaGFzKHRlc3RFbnYpICYmICF0aGlzLl9zeW50aGVkVGVzdHMuaGFzKHRlc3RQYXRoKSkge1xuICAgICAgdGhpcy5fc3ludGhlZEVudnMuYWRkKHRlc3RFbnYpO1xuICAgICAgdGhpcy5fc3ludGhlZFRlc3RzLmFkZCh0ZXN0UGF0aCk7XG4gICAgICByZXR1cm4gbmV3IEZ1bmN0aW9uKHNjb3BlLCBpZCwgaW5mbGlnaHQsIHByb3BzKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBwdWJsaWMgZ2V0IF9saWZ0TWFwKCk6IExpZnRNYXAge1xuICAgIHJldHVybiB7XG4gICAgICBbVGVzdFJ1bm5lckluZmxpZ2h0TWV0aG9kcy5MSVNUX1RFU1RTXTogW10sXG4gICAgICBbVGVzdFJ1bm5lckluZmxpZ2h0TWV0aG9kcy5SVU5fVEVTVF06IFtdLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogRmluZCBhbGwgdGVzdHMgaW4gdGhlIGNvbnN0cnVjdCB0cmVlLlxuICAgKiBAcmV0dXJucyBBIGxpc3Qgb2YgdGVzdHMuXG4gICAqL1xuICBwdWJsaWMgZmluZFRlc3RzKCk6IFRlc3RbXSB7XG4gICAgY29uc3QgaXNUZXN0ID0gKGZuOiBhbnkpOiBmbiBpcyBUZXN0ID0+IHtcbiAgICAgIHJldHVybiBmbiBpbnN0YW5jZW9mIFRlc3Q7XG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5ub2RlLnJvb3Qubm9kZS5maW5kQWxsKCkuZmlsdGVyKGlzVGVzdCk7XG4gIH1cbn1cblxuLyoqXG4gKiBJbmZsaWdodCBpbnRlcmZhY2UgZm9yIGBUZXN0UnVubmVyYC5cbiAqIEBza2lwRG9jc1xuICovXG5leHBvcnQgaW50ZXJmYWNlIElUZXN0UnVubmVyQ2xpZW50IHtcbiAgLyoqXG4gICAqIExpc3QgYWxsIHRlc3RzIGF2YWlsYWJsZSBmb3IgdGhpcyB0ZXN0IGVuZ2luZS5cbiAgICogQGluZmxpZ2h0XG4gICAqIEByZXR1cm5zIEEgbGlzdCBvZiB0ZXN0IG5hbWVzLlxuICAgKi9cbiAgbGlzdFRlc3RzKCk6IFByb21pc2U8c3RyaW5nW10+O1xuXG4gIC8qKlxuICAgKiBSdW4gYSB0ZXN0IHdpdGggYSBnaXZlbiBwYXRoIGFuZCByZXR1cm4gdGhlIHJlc3VsdC5cbiAgICogQGluZmxpZ2h0XG4gICAqL1xuICBydW5UZXN0KHBhdGg6IHN0cmluZyk6IFByb21pc2U8VGVzdFJlc3VsdD47XG59XG5cbi8vIFRPRE86IGluY2x1ZGUgdGVzdCBkdXJhdGlvbj9cblxuLyoqXG4gKiBBIHJlc3VsdCBvZiBhIHNpbmdsZSB0ZXN0LlxuICogQHNraXBEb2NzXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVGVzdFJlc3VsdCB7XG4gIC8qKlxuICAgKiBUaGUgcGF0aCBvZiB0aGUgdGVzdC5cbiAgICovXG4gIHJlYWRvbmx5IHBhdGg6IHN0cmluZztcblxuICAvKipcbiAgICogV2hldGhlciB0aGUgdGVzdCBwYXNzZWQuXG4gICAqL1xuICByZWFkb25seSBwYXNzOiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSB0ZXN0IGNvbnRhaW5zIGNvZGUgdGhhdCBpcyB1bnN1cHBvcnRlZCBieSB0aGUgdGFyZ2V0LlxuICAgKi9cbiAgcmVhZG9ubHkgdW5zdXBwb3J0ZWQ/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBVbnN1cHBvcnRlZCByZXNvdXJjZSB0ZXN0ZWRcbiAgICovXG4gIHJlYWRvbmx5IHVuc3VwcG9ydGVkUmVzb3VyY2U/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFVuc3VwcG9ydGVkIG1ldGhvZCB1c2VkIGluIHRlc3RcbiAgICovXG4gIHJlYWRvbmx5IHVuc3VwcG9ydGVkT3BlcmF0aW9uPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBQbGFjZSBmb3IgZXh0cmEgdGVzdCBydW5uZXIgYXJndW1lbnRzIHRoYXQgY2FuIGJlIGFkZGVkIHRocm91Z2ggcGxhdGZvcm1zXG4gICAqL1xuICByZWFkb25seSBhcmdzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG5cbiAgLyoqXG4gICAqIFRoZSBlcnJvciBtZXNzYWdlIGlmIHRoZSB0ZXN0IGZhaWxlZC5cbiAgICovXG4gIHJlYWRvbmx5IGVycm9yPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBMaXN0IG9mIHRyYWNlcyBlbWl0dGVkIGR1cmluZyB0aGUgdGVzdC5cbiAgICovXG4gIHJlYWRvbmx5IHRyYWNlczogVHJhY2VbXTtcbn1cblxuLyoqXG4gKiBBIHRyYWNlIGVtaXR0ZWQgZHVyaW5nIHNpbXVsYXRpb24uXG4gKiBAc2tpcERvY3NcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBUcmFjZSB7XG4gIC8qKlxuICAgKiBBIEpTT04gYmxvYiB3aXRoIHN0cnVjdHVyZWQgZGF0YS5cbiAgICovXG4gIHJlYWRvbmx5IGRhdGE6IGFueTtcblxuICAvKipcbiAgICogVGhlIHR5cGUgb2YgdGhlIHNvdXJjZSB0aGF0IGVtaXR0ZWQgdGhlIHRyYWNlLlxuICAgKi9cbiAgcmVhZG9ubHkgc291cmNlVHlwZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgcGF0aCBvZiB0aGUgcmVzb3VyY2UgdGhhdCBlbWl0dGVkIHRoZSB0cmFjZS5cbiAgICovXG4gIHJlYWRvbmx5IHNvdXJjZVBhdGg6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIHR5cGUgb2YgYSB0cmFjZS5cbiAgICovXG4gIHJlYWRvbmx5IHR5cGU6IFRyYWNlVHlwZTtcblxuICAvKipcbiAgICogVGhlIGxvZyBsZXZlbCBvZiB0aGUgZXZlbnQuXG4gICAqL1xuICByZWFkb25seSBsZXZlbDogTG9nTGV2ZWw7XG5cbiAgLyoqXG4gICAqIFRoZSB0aW1lc3RhbXAgb2YgdGhlIGV2ZW50LCBpbiBJU08gODYwMSBmb3JtYXQuXG4gICAqIEBleGFtcGxlIDIwMjAtMDEtMDFUMDA6MDA6MDAuMDAwWlxuICAgKi9cbiAgcmVhZG9ubHkgdGltZXN0YW1wOiBzdHJpbmc7XG59XG5cbi8qKlxuICogTG9nIGxldmVsXG4gKi9cbmV4cG9ydCBlbnVtIExvZ0xldmVsIHtcbiAgLyoqXG4gICAqIE1vc3RseSB1c2VkIGZvciBkZWJ1Z2dpbmdcbiAgICovXG4gIFZFUkJPU0UgPSBcInZlcmJvc2VcIixcblxuICAvKipcbiAgICogSW5mb3JtYXRpb24gdGhhdCBpcyB1c2VmdWwgdG8gZGV2ZWxvcGVyc1xuICAgKi9cbiAgSU5GTyA9IFwiaW5mb1wiLFxuXG4gIC8qKlxuICAgKiBXYXJuaW5ncyB0aGF0IGFyZSBub3QgZXJyb3JzLCBidXQgbWF5IHJlcXVpcmUgYXR0ZW50aW9uXG4gICAqL1xuICBXQVJOSU5HID0gXCJ3YXJuaW5nXCIsXG5cbiAgLyoqXG4gICAqIEVycm9ycyB0aGF0IHNob3VsZCBiZSBhZGRyZXNzZWRcbiAgICovXG4gIEVSUk9SID0gXCJlcnJvclwiLFxufVxuXG4vKipcbiAqIFRoZSB0eXBlIG9mIGEgdHJhY2UuXG4gKiBAc2tpcERvY3NcbiAqL1xuZXhwb3J0IGVudW0gVHJhY2VUeXBlIHtcbiAgLyoqXG4gICAqIEEgdHJhY2UgcmVwcmVzZW50aW5nIHNpbXVsYXRvciBhY3Rpdml0eS5cbiAgICovXG4gIFNJTVVMQVRPUiA9IFwic2ltdWxhdG9yXCIsXG4gIC8qKlxuICAgKiBBIHRyYWNlIHJlcHJlc2VudGluZyBhIHJlc291cmNlIGFjdGl2aXR5LlxuICAgKi9cbiAgUkVTT1VSQ0UgPSBcInJlc291cmNlXCIsXG4gIC8qKlxuICAgKiBBIHRyYWNlIHJlcHJlc2VudGluZyBhIG1lc3NhZ2UgZW1pdHRlZCBieSB0aGUgbG9nZ2VyLlxuICAgKi9cbiAgTE9HID0gXCJsb2dcIixcbn1cblxuLyoqXG4gKiBMaXN0IG9mIGluZmxpZ2h0IG9wZXJhdGlvbnMgYXZhaWxhYmxlIGZvciBgVGVzdFJ1bm5lcmAuXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGVudW0gVGVzdFJ1bm5lckluZmxpZ2h0TWV0aG9kcyB7XG4gIC8qKiBgVGVzdFJ1bm5lci5ydW5UZXN0YCAqL1xuICBSVU5fVEVTVCA9IFwicnVuVGVzdFwiLFxuICAvKiogYFRlc3RSdW5uZXIubGlzdFRlc3RzYCAqL1xuICBMSVNUX1RFU1RTID0gXCJsaXN0VGVzdHNcIixcbn1cbiJdfQ==