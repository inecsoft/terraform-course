"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.ServiceInflightMethods = exports.Service = exports.SERVICE_FQN = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const fs_1 = require("fs");
const path_1 = require("path");
const constants_1 = require("../constants");
const core_1 = require("../core");
const types_1 = require("../core/types");
const resource_names_1 = require("../shared/resource-names");
const std_1 = require("../std");
/**
 * Global identifier for `Service`.
 */
exports.SERVICE_FQN = (0, constants_1.fqnForType)("cloud.Service");
/**
 * A long-running service.
 *
 * @inflight `@winglang/sdk.cloud.IServiceClient`
 * @abstract
 */
class Service extends std_1.Resource {
    constructor(scope, id, handler, props = {}) {
        if (new.target === Service) {
            return std_1.Resource._newFromFactory(exports.SERVICE_FQN, scope, id, handler, props);
        }
        super(scope, id);
        this._env = {};
        for (const [key, value] of Object.entries(props.env ?? {})) {
            this.addEnvironment(key, value);
        }
        std_1.Node.of(this).title = "Service";
        std_1.Node.of(this).description = "A cloud service";
        const assetName = resource_names_1.ResourceNames.generateName(this, {
            disallowedRegex: /[><:"/\\|?*\s]/g, // avoid characters that may cause path issues
            case: resource_names_1.CaseConventions.LOWERCASE,
            sep: "_",
        });
        const workdir = core_1.App.of(this).workdir;
        (0, fs_1.mkdirSync)(workdir, { recursive: true });
        const entrypoint = (0, path_1.join)(workdir, `${assetName}.cjs`);
        this.entrypoint = entrypoint;
        if (process.env.WING_TARGET) {
            this.addEnvironment("WING_TARGET", process.env.WING_TARGET);
        }
        this.handler = handler;
    }
    /** @internal */
    _preSynthesize() {
        super._preSynthesize();
        const inflightClient = this.handler._toInflight();
        const code = `\
      "use strict";
      let $stop;
      exports.start = async function() {
        if ($stop) {
          throw Error('service already started');
        }
        const client = await ${inflightClient};
        const noop = () => {};
        $stop = (await client.handle()) ?? noop;
      };

      exports.stop = async function() {
        if (!$stop) {
          throw Error('service not started');
        }
        await $stop();
        $stop = undefined;
      };
      `;
        (0, fs_1.writeFileSync)(this.entrypoint, code);
        // indicates that we are calling the inflight constructor and the
        // inflight "handle" method on the handler resource.
        core_1.Lifting.lift(this.handler, this, ["handle"]);
    }
    /**
     * Add an environment variable to the function.
     */
    addEnvironment(name, value) {
        if (this._env[name] !== undefined && this._env[name] !== value) {
            throw new Error(`Environment variable "${name}" already set with a different value.`);
        }
        this._env[name] = value;
    }
    /**
     * Returns the set of environment variables for this function.
     */
    get env() {
        return { ...this._env };
    }
}
exports.Service = Service;
_a = JSII_RTTI_SYMBOL_1;
Service[_a] = { fqn: "@winglang/sdk.cloud.Service", version: "0.0.0" };
/**
 * List of inflight operations for `Service`.
 * @internal
 */
var ServiceInflightMethods;
(function (ServiceInflightMethods) {
    ServiceInflightMethods["START"] = "start";
    ServiceInflightMethods["STOP"] = "stop";
    ServiceInflightMethods["STARTED"] = "started";
})(ServiceInflightMethods || (exports.ServiceInflightMethods = ServiceInflightMethods = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jbG91ZC9zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsMkJBQThDO0FBQzlDLCtCQUE0QjtBQUc1Qiw0Q0FBMEM7QUFDMUMsa0NBQXVDO0FBQ3ZDLHlDQUFnRDtBQUNoRCw2REFBMEU7QUFDMUUsZ0NBQWtFO0FBRWxFOztHQUVHO0FBQ1UsUUFBQSxXQUFXLEdBQUcsSUFBQSxzQkFBVSxFQUFDLGVBQWUsQ0FBQyxDQUFDO0FBcUJ2RDs7Ozs7R0FLRztBQUNILE1BQWEsT0FBUSxTQUFRLGNBQVE7SUFnQm5DLFlBQ0UsS0FBZ0IsRUFDaEIsRUFBVSxFQUNWLE9BQXdCLEVBQ3hCLFFBQXNCLEVBQUU7UUFFeEIsSUFBSSxHQUFHLENBQUMsTUFBTSxLQUFLLE9BQU8sRUFBRSxDQUFDO1lBQzNCLE9BQU8sY0FBUSxDQUFDLGVBQWUsQ0FBQyxtQkFBVyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQzFFLENBQUM7UUFFRCxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBWkYsU0FBSSxHQUEyQixFQUFFLENBQUM7UUFjakQsS0FBSyxNQUFNLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsSUFBSSxFQUFFLENBQUMsRUFBRSxDQUFDO1lBQzNELElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ2xDLENBQUM7UUFFRCxVQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssR0FBRyxTQUFTLENBQUM7UUFDaEMsVUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxXQUFXLEdBQUcsaUJBQWlCLENBQUM7UUFFOUMsTUFBTSxTQUFTLEdBQUcsOEJBQWEsQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFO1lBQ2pELGVBQWUsRUFBRSxpQkFBaUIsRUFBRSw4Q0FBOEM7WUFDbEYsSUFBSSxFQUFFLGdDQUFlLENBQUMsU0FBUztZQUMvQixHQUFHLEVBQUUsR0FBRztTQUNULENBQUMsQ0FBQztRQUVILE1BQU0sT0FBTyxHQUFHLFVBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDO1FBQ3JDLElBQUEsY0FBUyxFQUFDLE9BQU8sRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ3hDLE1BQU0sVUFBVSxHQUFHLElBQUEsV0FBSSxFQUFDLE9BQU8sRUFBRSxHQUFHLFNBQVMsTUFBTSxDQUFDLENBQUM7UUFDckQsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7UUFFN0IsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzVCLElBQUksQ0FBQyxjQUFjLENBQUMsYUFBYSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDOUQsQ0FBQztRQUVELElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO0lBQ3pCLENBQUM7SUFFRCxnQkFBZ0I7SUFDVCxjQUFjO1FBQ25CLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUV2QixNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ2xELE1BQU0sSUFBSSxHQUFHOzs7Ozs7OytCQU9jLGNBQWM7Ozs7Ozs7Ozs7OztPQVl0QyxDQUFDO1FBRUosSUFBQSxrQkFBYSxFQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFFckMsaUVBQWlFO1FBQ2pFLG9EQUFvRDtRQUNwRCxjQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztJQUMvQyxDQUFDO0lBRUQ7O09BRUc7SUFDSSxjQUFjLENBQUMsSUFBWSxFQUFFLEtBQWE7UUFDL0MsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLFNBQVMsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssRUFBRSxDQUFDO1lBQy9ELE1BQU0sSUFBSSxLQUFLLENBQ2IseUJBQXlCLElBQUksdUNBQXVDLENBQ3JFLENBQUM7UUFDSixDQUFDO1FBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLENBQUM7SUFDMUIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsSUFBVyxHQUFHO1FBQ1osT0FBTyxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQzFCLENBQUM7O0FBdkdILDBCQXdHQzs7O0FBNEZEOzs7R0FHRztBQUNILElBQVksc0JBSVg7QUFKRCxXQUFZLHNCQUFzQjtJQUNoQyx5Q0FBZSxDQUFBO0lBQ2YsdUNBQWEsQ0FBQTtJQUNiLDZDQUFtQixDQUFBO0FBQ3JCLENBQUMsRUFKVyxzQkFBc0Isc0NBQXRCLHNCQUFzQixRQUlqQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IG1rZGlyU3luYywgd3JpdGVGaWxlU3luYyB9IGZyb20gXCJmc1wiO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gXCJwYXRoXCI7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tIFwiY29uc3RydWN0c1wiO1xuaW1wb3J0IHsgRnVuY3Rpb25Qcm9wcyB9IGZyb20gXCIuL2Z1bmN0aW9uXCI7XG5pbXBvcnQgeyBmcW5Gb3JUeXBlIH0gZnJvbSBcIi4uL2NvbnN0YW50c1wiO1xuaW1wb3J0IHsgQXBwLCBMaWZ0aW5nIH0gZnJvbSBcIi4uL2NvcmVcIjtcbmltcG9ydCB7IElORkxJR0hUX1NZTUJPTCB9IGZyb20gXCIuLi9jb3JlL3R5cGVzXCI7XG5pbXBvcnQgeyBDYXNlQ29udmVudGlvbnMsIFJlc291cmNlTmFtZXMgfSBmcm9tIFwiLi4vc2hhcmVkL3Jlc291cmNlLW5hbWVzXCI7XG5pbXBvcnQgeyBJSW5mbGlnaHQsIElJbmZsaWdodEhvc3QsIE5vZGUsIFJlc291cmNlIH0gZnJvbSBcIi4uL3N0ZFwiO1xuXG4vKipcbiAqIEdsb2JhbCBpZGVudGlmaWVyIGZvciBgU2VydmljZWAuXG4gKi9cbmV4cG9ydCBjb25zdCBTRVJWSUNFX0ZRTiA9IGZxbkZvclR5cGUoXCJjbG91ZC5TZXJ2aWNlXCIpO1xuXG4vKipcbiAqIE9wdGlvbnMgZm9yIGBTZXJ2aWNlYC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTZXJ2aWNlUHJvcHMge1xuICAvKipcbiAgICogRW52aXJvbm1lbnQgdmFyaWFibGVzIHRvIHBhc3MgdG8gdGhlIGZ1bmN0aW9uLlxuICAgKiBAZGVmYXVsdCAtIE5vIGVudmlyb25tZW50IHZhcmlhYmxlcy5cbiAgICovXG4gIHJlYWRvbmx5IGVudj86IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH07XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIHNlcnZpY2Ugc2hvdWxkIHN0YXJ0IGF1dG9tYXRpY2FsbHkuIElmIGBmYWxzZWAsIHRoZSBzZXJ2aWNlIHdpbGwgbmVlZCB0byBiZSBzdGFydGVkXG4gICAqIG1hbnVhbGx5IGJ5IGNhbGxpbmcgdGhlIGluZmxpZ2h0IGBzdGFydCgpYCBtZXRob2QuXG4gICAqXG4gICAqIEBkZWZhdWx0IHRydWVcbiAgICovXG4gIHJlYWRvbmx5IGF1dG9TdGFydD86IGJvb2xlYW47XG59XG5cbi8qKlxuICogQSBsb25nLXJ1bm5pbmcgc2VydmljZS5cbiAqXG4gKiBAaW5mbGlnaHQgYEB3aW5nbGFuZy9zZGsuY2xvdWQuSVNlcnZpY2VDbGllbnRgXG4gKiBAYWJzdHJhY3RcbiAqL1xuZXhwb3J0IGNsYXNzIFNlcnZpY2UgZXh0ZW5kcyBSZXNvdXJjZSBpbXBsZW1lbnRzIElJbmZsaWdodEhvc3Qge1xuICAvKiogQGludGVybmFsICovXG4gIHB1YmxpYyBbSU5GTElHSFRfU1lNQk9MXT86IElTZXJ2aWNlQ2xpZW50O1xuXG4gIC8qKlxuICAgKiBUaGUgcGF0aCB3aGVyZSB0aGUgZW50cnlwb2ludCBvZiB0aGUgc2VydmljZSBzb3VyY2UgY29kZSB3aWxsIGJlIGV2ZW50dWFsbHkgd3JpdHRlbiB0by5cbiAgICovXG4gIHByb3RlY3RlZCByZWFkb25seSBlbnRyeXBvaW50ITogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBSZWZlcmVuY2UgdG8gdGhlIHNlcnZpY2UncyBoYW5kbGVyIC0gYW4gaW5mbGlnaHQgY2xvc3VyZS5cbiAgICovXG4gIHByb3RlY3RlZCByZWFkb25seSBoYW5kbGVyITogSVNlcnZpY2VIYW5kbGVyO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgX2VudjogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHNjb3BlOiBDb25zdHJ1Y3QsXG4gICAgaWQ6IHN0cmluZyxcbiAgICBoYW5kbGVyOiBJU2VydmljZUhhbmRsZXIsXG4gICAgcHJvcHM6IFNlcnZpY2VQcm9wcyA9IHt9XG4gICkge1xuICAgIGlmIChuZXcudGFyZ2V0ID09PSBTZXJ2aWNlKSB7XG4gICAgICByZXR1cm4gUmVzb3VyY2UuX25ld0Zyb21GYWN0b3J5KFNFUlZJQ0VfRlFOLCBzY29wZSwgaWQsIGhhbmRsZXIsIHByb3BzKTtcbiAgICB9XG5cbiAgICBzdXBlcihzY29wZSwgaWQpO1xuXG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMocHJvcHMuZW52ID8/IHt9KSkge1xuICAgICAgdGhpcy5hZGRFbnZpcm9ubWVudChrZXksIHZhbHVlKTtcbiAgICB9XG5cbiAgICBOb2RlLm9mKHRoaXMpLnRpdGxlID0gXCJTZXJ2aWNlXCI7XG4gICAgTm9kZS5vZih0aGlzKS5kZXNjcmlwdGlvbiA9IFwiQSBjbG91ZCBzZXJ2aWNlXCI7XG5cbiAgICBjb25zdCBhc3NldE5hbWUgPSBSZXNvdXJjZU5hbWVzLmdlbmVyYXRlTmFtZSh0aGlzLCB7XG4gICAgICBkaXNhbGxvd2VkUmVnZXg6IC9bPjw6XCIvXFxcXHw/Klxcc10vZywgLy8gYXZvaWQgY2hhcmFjdGVycyB0aGF0IG1heSBjYXVzZSBwYXRoIGlzc3Vlc1xuICAgICAgY2FzZTogQ2FzZUNvbnZlbnRpb25zLkxPV0VSQ0FTRSxcbiAgICAgIHNlcDogXCJfXCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCB3b3JrZGlyID0gQXBwLm9mKHRoaXMpLndvcmtkaXI7XG4gICAgbWtkaXJTeW5jKHdvcmtkaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgIGNvbnN0IGVudHJ5cG9pbnQgPSBqb2luKHdvcmtkaXIsIGAke2Fzc2V0TmFtZX0uY2pzYCk7XG4gICAgdGhpcy5lbnRyeXBvaW50ID0gZW50cnlwb2ludDtcblxuICAgIGlmIChwcm9jZXNzLmVudi5XSU5HX1RBUkdFVCkge1xuICAgICAgdGhpcy5hZGRFbnZpcm9ubWVudChcIldJTkdfVEFSR0VUXCIsIHByb2Nlc3MuZW52LldJTkdfVEFSR0VUKTtcbiAgICB9XG5cbiAgICB0aGlzLmhhbmRsZXIgPSBoYW5kbGVyO1xuICB9XG5cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBwdWJsaWMgX3ByZVN5bnRoZXNpemUoKTogdm9pZCB7XG4gICAgc3VwZXIuX3ByZVN5bnRoZXNpemUoKTtcblxuICAgIGNvbnN0IGluZmxpZ2h0Q2xpZW50ID0gdGhpcy5oYW5kbGVyLl90b0luZmxpZ2h0KCk7XG4gICAgY29uc3QgY29kZSA9IGBcXFxuICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICBsZXQgJHN0b3A7XG4gICAgICBleHBvcnRzLnN0YXJ0ID0gYXN5bmMgZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICgkc3RvcCkge1xuICAgICAgICAgIHRocm93IEVycm9yKCdzZXJ2aWNlIGFscmVhZHkgc3RhcnRlZCcpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNsaWVudCA9IGF3YWl0ICR7aW5mbGlnaHRDbGllbnR9O1xuICAgICAgICBjb25zdCBub29wID0gKCkgPT4ge307XG4gICAgICAgICRzdG9wID0gKGF3YWl0IGNsaWVudC5oYW5kbGUoKSkgPz8gbm9vcDtcbiAgICAgIH07XG5cbiAgICAgIGV4cG9ydHMuc3RvcCA9IGFzeW5jIGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoISRzdG9wKSB7XG4gICAgICAgICAgdGhyb3cgRXJyb3IoJ3NlcnZpY2Ugbm90IHN0YXJ0ZWQnKTtcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCAkc3RvcCgpO1xuICAgICAgICAkc3RvcCA9IHVuZGVmaW5lZDtcbiAgICAgIH07XG4gICAgICBgO1xuXG4gICAgd3JpdGVGaWxlU3luYyh0aGlzLmVudHJ5cG9pbnQsIGNvZGUpO1xuXG4gICAgLy8gaW5kaWNhdGVzIHRoYXQgd2UgYXJlIGNhbGxpbmcgdGhlIGluZmxpZ2h0IGNvbnN0cnVjdG9yIGFuZCB0aGVcbiAgICAvLyBpbmZsaWdodCBcImhhbmRsZVwiIG1ldGhvZCBvbiB0aGUgaGFuZGxlciByZXNvdXJjZS5cbiAgICBMaWZ0aW5nLmxpZnQodGhpcy5oYW5kbGVyLCB0aGlzLCBbXCJoYW5kbGVcIl0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhbiBlbnZpcm9ubWVudCB2YXJpYWJsZSB0byB0aGUgZnVuY3Rpb24uXG4gICAqL1xuICBwdWJsaWMgYWRkRW52aXJvbm1lbnQobmFtZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKSB7XG4gICAgaWYgKHRoaXMuX2VudltuYW1lXSAhPT0gdW5kZWZpbmVkICYmIHRoaXMuX2VudltuYW1lXSAhPT0gdmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEVudmlyb25tZW50IHZhcmlhYmxlIFwiJHtuYW1lfVwiIGFscmVhZHkgc2V0IHdpdGggYSBkaWZmZXJlbnQgdmFsdWUuYFxuICAgICAgKTtcbiAgICB9XG4gICAgdGhpcy5fZW52W25hbWVdID0gdmFsdWU7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgc2V0IG9mIGVudmlyb25tZW50IHZhcmlhYmxlcyBmb3IgdGhpcyBmdW5jdGlvbi5cbiAgICovXG4gIHB1YmxpYyBnZXQgZW52KCk6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4ge1xuICAgIHJldHVybiB7IC4uLnRoaXMuX2VudiB9O1xuICB9XG59XG5cbi8qKlxuICogT3B0aW9ucyBmb3IgU2VydmljZS5vblN0YXJ0LlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFNlcnZpY2VPblN0YXJ0T3B0aW9ucyBleHRlbmRzIEZ1bmN0aW9uUHJvcHMge31cblxuLyoqXG4gKiBJbmZsaWdodCBpbnRlcmZhY2UgZm9yIGBTZXJ2aWNlYC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJU2VydmljZUNsaWVudCB7XG4gIC8qKlxuICAgKiBTdGFydCB0aGUgc2VydmljZS5cbiAgICogQGluZmxpZ2h0XG4gICAqL1xuICBzdGFydCgpOiBQcm9taXNlPHZvaWQ+O1xuXG4gIC8qKlxuICAgKiBTdG9wIHRoZSBzZXJ2aWNlXG4gICAqIEBpbmZsaWdodFxuICAgKi9cbiAgc3RvcCgpOiBQcm9taXNlPHZvaWQ+O1xuXG4gIC8qKlxuICAgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGUgc2VydmljZSBpcyBzdGFydGVkLlxuICAgKiBAaW5mbGlnaHRcbiAgICovXG4gIHN0YXJ0ZWQoKTogUHJvbWlzZTxib29sZWFuPjtcbn1cblxuLyoqXG4gKiBFeGVjdXRlZCB3aGVuIGEgYGNsb3VkLlNlcnZpY2VgIGlzIHN0YXJ0ZWQuXG4gKlxuICogQGluZmxpZ2h0IGBAd2luZ2xhbmcvc2RrLmNsb3VkLklTZXJ2aWNlSGFuZGxlckNsaWVudGBcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJU2VydmljZUhhbmRsZXIgZXh0ZW5kcyBJSW5mbGlnaHQge1xuICAvKiogQGludGVybmFsICovXG4gIFtJTkZMSUdIVF9TWU1CT0xdPzogSVNlcnZpY2VIYW5kbGVyQ2xpZW50W1wiaGFuZGxlXCJdO1xufVxuXG4vKipcbiAqIEluZmxpZ2h0IGNsaWVudCBmb3IgYElTZXJ2aWNlSGFuZGxlcmAuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSVNlcnZpY2VIYW5kbGVyQ2xpZW50IHtcbiAgLyoqXG4gICAqIEhhbmRsZXIgdG8gcnVuIHdoZW4gdGhlIHNlcnZpY2Ugc3RhcnRzLiBUaGlzIGlzIHdoZXJlIHlvdSBpbXBsZW1lbnQgdGhlIGluaXRpYWxpemF0aW9uIGxvZ2ljIG9mXG4gICAqIHRoZSBzZXJ2aWNlLCBzdGFydCBhbnkgYWN0aXZpdGllcyBhc3luY2hyb25vdXNseS5cbiAgICpcbiAgICogRE8gTk9UIEJMT0NLISBUaGlzIGhhbmRsZXIgc2hvdWxkIHJldHVybiBhcyBxdWlja2x5IGFzIHBvc3NpYmxlLiBJZiB5b3UgbmVlZCB0byBydW4gYSBsb25nXG4gICAqIHJ1bm5pbmcgcHJvY2Vzcywgc3RhcnQgaXQgYXN5bmNocm9ub3VzbHkuXG4gICAqXG4gICAqIEBpbmZsaWdodFxuICAgKiBAcmV0dXJucyBhbiBvcHRpb25hbCBmdW5jdGlvbiB0aGF0IGNhbiBiZSB1c2VkIHRvIGNsZWFudXAgYW55IHJlc291cmNlcyB3aGVuIHRoZSBzZXJ2aWNlIGlzXG4gICAqIHN0b3BwZWQuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIGJyaW5nIGNsb3VkO1xuICAgKlxuICAgKiBuZXcgY2xvdWQuU2VydmljZShpbmZsaWdodCAoKSA9PiB7XG4gICAqICAgbG9nKFwic3RhcnRpbmcgc2VydmljZS4uLlwiKTtcbiAgICogICByZXR1cm4gKCkgPT4ge1xuICAgKiAgICAgbG9nKFwic3RvcGluZyBzZXJ2aWNlLi4uXCIpO1xuICAgKiAgIH07XG4gICAqIH0pO1xuICAgKi9cbiAgaGFuZGxlKCk6IFByb21pc2U8SVNlcnZpY2VTdG9wSGFuZGxlciB8IHVuZGVmaW5lZD47XG59XG5cbi8qKlxuICogRXhlY3V0ZWQgd2hlbiBhIGBjbG91ZC5TZXJ2aWNlYCBpcyBzdG9wcGVkLlxuICpcbiAqIEBpbmZsaWdodCBgQHdpbmdsYW5nL3Nkay5jbG91ZC5JU2VydmljZVN0b3BIYW5kbGVyQ2xpZW50YFxuICovXG5leHBvcnQgaW50ZXJmYWNlIElTZXJ2aWNlU3RvcEhhbmRsZXIgZXh0ZW5kcyBJSW5mbGlnaHQge1xuICAvKiogQGludGVybmFsICovXG4gIFtJTkZMSUdIVF9TWU1CT0xdPzogSVNlcnZpY2VTdG9wSGFuZGxlckNsaWVudFtcImhhbmRsZVwiXTtcbn1cblxuLyoqXG4gKiBJbmZsaWdodCBjbGllbnQgZm9yIGBJU2VydmljZVN0b3BIYW5kbGVyYC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJU2VydmljZVN0b3BIYW5kbGVyQ2xpZW50IHtcbiAgLyoqXG4gICAqIEhhbmRsZXIgdG8gcnVuIHdoZW4gdGhlIHNlcnZpY2Ugc3RvcHMuIFRoaXMgaXMgd2hlcmUgeW91IGltcGxlbWVudCB0aGUgY2xlYW51cCBsb2dpYyBvZlxuICAgKiB0aGUgc2VydmljZSwgc3RvcCBhbnkgYWN0aXZpdGllcyBhc3ljaHJvbm91c2x5LlxuICAgKlxuICAgKiBAaW5mbGlnaHRcbiAgICovXG4gIGhhbmRsZSgpOiBQcm9taXNlPHZvaWQ+O1xufVxuXG4vKipcbiAqIExpc3Qgb2YgaW5mbGlnaHQgb3BlcmF0aW9ucyBmb3IgYFNlcnZpY2VgLlxuICogQGludGVybmFsXG4gKi9cbmV4cG9ydCBlbnVtIFNlcnZpY2VJbmZsaWdodE1ldGhvZHMge1xuICBTVEFSVCA9IFwic3RhcnRcIixcbiAgU1RPUCA9IFwic3RvcFwiLFxuICBTVEFSVEVEID0gXCJzdGFydGVkXCIsXG59XG4iXX0=