"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.ContainerInflightMethods = exports.Container = exports.HOST_PORT_ATTR = exports.SIM_CONTAINER_FQN = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const tokens_1 = require("./tokens");
const util_1 = require("./util");
const constants_1 = require("../constants");
const core_1 = require("../core");
const types_1 = require("../core/types");
const fs_1 = require("../fs");
const misc_1 = require("../shared/misc");
const std_1 = require("../std");
exports.SIM_CONTAINER_FQN = (0, constants_1.fqnForType)("sim.Container");
exports.HOST_PORT_ATTR = "host_port";
/**
 * Represents a container running in the Wing Simulator.
 *
 * @inflight `@winglang/sdk.sim.IContainerClient`
 */
class Container extends std_1.Resource {
    constructor(scope, id, props) {
        super(scope, id);
        this.props = props;
        // determine image tag - if the image is a path, we use a source hash (either explicitly
        // provided or calculated based on the source files). if the image is a name, we use the name
        if ((0, misc_1.isPath)(props.image)) {
            const hash = props.sourceHash ?? fs_1.Util.md5(props.image, props.sourcePattern);
            this.imageTag = `${props.name}:${hash}`;
        }
        else {
            this.imageTag = props.image;
        }
        if (props.containerPort) {
            this.hostPort = (0, tokens_1.simulatorAttrToken)(this, exports.HOST_PORT_ATTR);
        }
    }
    toSimulator() {
        const props = {
            image: this.props.image,
            imageTag: this.imageTag,
            containerPort: this.props.containerPort,
            env: this.props.env,
            volumes: this.props.volumes,
            args: this.props.args,
            cwd: core_1.App.of(this).entrypointDir,
            network: this.props.network,
            entrypoint: this.props.entrypoint,
        };
        return {
            type: exports.SIM_CONTAINER_FQN,
            props,
        };
    }
    onLift(host, ops) {
        (0, util_1.bindSimulatorResource)(__filename, this, host, ops);
        super.onLift(host, ops);
    }
    /** @internal */
    get _liftMap() {
        return {};
    }
    /** @internal */
    _toInflight() {
        return (0, util_1.makeSimulatorJsClient)(__filename, this);
    }
}
exports.Container = Container;
_a = JSII_RTTI_SYMBOL_1;
Container[_a] = { fqn: "@winglang/sdk.sim.Container", version: "0.0.0" };
/**
 * List of inflight operations available for `sim.Container`.
 * @internal
 */
var ContainerInflightMethods;
(function (ContainerInflightMethods) {
})(ContainerInflightMethods || (exports.ContainerInflightMethods = ContainerInflightMethods = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGFpbmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3RhcmdldC1zaW0vY29udGFpbmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBR0EscUNBQThDO0FBQzlDLGlDQUFzRTtBQUN0RSw0Q0FBMEM7QUFDMUMsa0NBQXVDO0FBQ3ZDLHlDQUFnRDtBQUNoRCw4QkFBbUM7QUFDbkMseUNBQXdDO0FBRXhDLGdDQUFpRDtBQUVwQyxRQUFBLGlCQUFpQixHQUFHLElBQUEsc0JBQVUsRUFBQyxlQUFlLENBQUMsQ0FBQztBQUNoRCxRQUFBLGNBQWMsR0FBRyxXQUFXLENBQUM7QUF1RTFDOzs7O0dBSUc7QUFDSCxNQUFhLFNBQVUsU0FBUSxjQUFRO0lBV3JDLFlBQ0UsS0FBZ0IsRUFDaEIsRUFBVSxFQUNPLEtBQXFCO1FBRXRDLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFGQSxVQUFLLEdBQUwsS0FBSyxDQUFnQjtRQUl0Qyx3RkFBd0Y7UUFDeEYsNkZBQTZGO1FBQzdGLElBQUksSUFBQSxhQUFNLEVBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFDeEIsTUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLFVBQVUsSUFBSSxTQUFFLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQzFFLElBQUksQ0FBQyxRQUFRLEdBQUcsR0FBRyxLQUFLLENBQUMsSUFBSSxJQUFJLElBQUksRUFBRSxDQUFDO1FBQzFDLENBQUM7YUFBTSxDQUFDO1lBQ04sSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDO1FBQzlCLENBQUM7UUFFRCxJQUFJLEtBQUssQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUN4QixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUEsMkJBQWtCLEVBQUMsSUFBSSxFQUFFLHNCQUFjLENBQUMsQ0FBQztRQUMzRCxDQUFDO0lBQ0gsQ0FBQztJQUVNLFdBQVc7UUFDaEIsTUFBTSxLQUFLLEdBQW9CO1lBQzdCLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUs7WUFDdkIsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRO1lBQ3ZCLGFBQWEsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWE7WUFDdkMsR0FBRyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRztZQUNuQixPQUFPLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPO1lBQzNCLElBQUksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUk7WUFDckIsR0FBRyxFQUFFLFVBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsYUFBYTtZQUMvQixPQUFPLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPO1lBQzNCLFVBQVUsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVU7U0FDbEMsQ0FBQztRQUNGLE9BQU87WUFDTCxJQUFJLEVBQUUseUJBQWlCO1lBQ3ZCLEtBQUs7U0FDTixDQUFDO0lBQ0osQ0FBQztJQUVNLE1BQU0sQ0FBQyxJQUFtQixFQUFFLEdBQWE7UUFDOUMsSUFBQSw0QkFBcUIsRUFBQyxVQUFVLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNuRCxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztJQUMxQixDQUFDO0lBRUQsZ0JBQWdCO0lBQ2hCLElBQVcsUUFBUTtRQUNqQixPQUFPLEVBQUUsQ0FBQztJQUNaLENBQUM7SUFFRCxnQkFBZ0I7SUFDVCxXQUFXO1FBQ2hCLE9BQU8sSUFBQSw0QkFBcUIsRUFBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDakQsQ0FBQzs7QUEvREgsOEJBZ0VDOzs7QUFFRDs7O0dBR0c7QUFDSCxJQUFZLHdCQUEyQjtBQUF2QyxXQUFZLHdCQUF3QjtBQUFFLENBQUMsRUFBM0Isd0JBQXdCLHdDQUF4Qix3QkFBd0IsUUFBRyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gXCJjb25zdHJ1Y3RzXCI7XG5pbXBvcnQgeyBJU2ltdWxhdG9yUmVzb3VyY2UgfSBmcm9tIFwiLi9yZXNvdXJjZVwiO1xuaW1wb3J0IHsgQ29udGFpbmVyU2NoZW1hIH0gZnJvbSBcIi4vc2NoZW1hLXJlc291cmNlc1wiO1xuaW1wb3J0IHsgc2ltdWxhdG9yQXR0clRva2VuIH0gZnJvbSBcIi4vdG9rZW5zXCI7XG5pbXBvcnQgeyBiaW5kU2ltdWxhdG9yUmVzb3VyY2UsIG1ha2VTaW11bGF0b3JKc0NsaWVudCB9IGZyb20gXCIuL3V0aWxcIjtcbmltcG9ydCB7IGZxbkZvclR5cGUgfSBmcm9tIFwiLi4vY29uc3RhbnRzXCI7XG5pbXBvcnQgeyBBcHAsIExpZnRNYXAgfSBmcm9tIFwiLi4vY29yZVwiO1xuaW1wb3J0IHsgSU5GTElHSFRfU1lNQk9MIH0gZnJvbSBcIi4uL2NvcmUvdHlwZXNcIjtcbmltcG9ydCB7IFV0aWwgYXMgZnMgfSBmcm9tIFwiLi4vZnNcIjtcbmltcG9ydCB7IGlzUGF0aCB9IGZyb20gXCIuLi9zaGFyZWQvbWlzY1wiO1xuaW1wb3J0IHsgVG9TaW11bGF0b3JPdXRwdXQgfSBmcm9tIFwiLi4vc2ltdWxhdG9yXCI7XG5pbXBvcnQgeyBJSW5mbGlnaHRIb3N0LCBSZXNvdXJjZSB9IGZyb20gXCIuLi9zdGRcIjtcblxuZXhwb3J0IGNvbnN0IFNJTV9DT05UQUlORVJfRlFOID0gZnFuRm9yVHlwZShcInNpbS5Db250YWluZXJcIik7XG5leHBvcnQgY29uc3QgSE9TVF9QT1JUX0FUVFIgPSBcImhvc3RfcG9ydFwiO1xuXG4vKipcbiAqIEluaXRpYWxpemF0aW9uIHByb3BlcnRpZXMgZm9yIGBzaW0uQ29udGFpbmVyYC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBDb250YWluZXJQcm9wcyB7XG4gIC8qKlxuICAgKiBBIG5hbWUgZm9yIHRoZSBjb250YWluZXIuXG4gICAqL1xuICByZWFkb25seSBuYW1lOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEEgbmFtZSBvZiBhIHB1YmxpYyBEb2NrZXIgaW1hZ2UgdG8gcHVsbCBhbmQgcnVuIG9yIGEgcGF0aCB0byBhIGxvY2FsIGRpcmVjdG9yeSB3aXRoIGEgYERvY2tlcmZpbGVgLlxuICAgKi9cbiAgcmVhZG9ubHkgaW1hZ2U6IHN0cmluZztcblxuICAvKipcbiAgICogSW50ZXJuYWwgY29udGFpbmVyIHBvcnQgdG8gZXhwb3NlLlxuICAgKiBAZGVmYXVsdCAtIG5vIHBvcnQgZXhwb3NlZFxuICAgKi9cbiAgcmVhZG9ubHkgY29udGFpbmVyUG9ydD86IG51bWJlcjtcblxuICAvKipcbiAgICogRW52aXJvbm1lbnQgdmFyaWFibGVzIHRvIHNldCBpbiB0aGUgY29udGFpbmVyLlxuICAgKiBAZGVmYXVsdCB7fVxuICAgKi9cbiAgcmVhZG9ubHkgZW52PzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcblxuICAvKipcbiAgICogVm9sdW1lIG1vdW50IHBvaW50cy5cbiAgICogQGRlZmF1bHQgW11cbiAgICogQGV4YW1wbGUgWycvaG9zdDovY29udGFpbmVyJ11cbiAgICovXG4gIHJlYWRvbmx5IHZvbHVtZXM/OiBzdHJpbmdbXTtcblxuICAvKipcbiAgICogQ29udGFpbmVyIGFyZ3VtZW50c1xuICAgKiBAZGVmYXVsdCBbXVxuICAgKi9cbiAgcmVhZG9ubHkgYXJncz86IHN0cmluZ1tdO1xuXG4gIC8qKlxuICAgKiBEb2NrZXIgbmV0d29yayB0byB1c2UgZm9yIHRoZSBjb250YWluZXIgLSBzdWNoIGFzICdob3N0JywgJ2JyaWRnZScsIGV0Yy5cbiAgICogQGxpbmsgaHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vbmV0d29yay5cbiAgICogQGRlZmF1bHQgLSBkZWZhdWx0IGRvY2tlciBuZXR3b3JrXG4gICAqIEBleGFtcGxlICdob3N0J1xuICAgKi9cbiAgcmVhZG9ubHkgbmV0d29yaz86IHN0cmluZztcblxuICAvKipcbiAgICogQ29udGFpbmVyIGVudHJ5cG9pbnRcbiAgICogQGRlZmF1bHQgLSBkZWZhdWx0IGltYWdlIGVudHJ5cG9pbnRcbiAgICovXG4gIHJlYWRvbmx5IGVudHJ5cG9pbnQ/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEEgZ2xvYiBvZiBsb2NhbCBmaWxlcyB0byBjb25zaWRlciBhcyBpbnB1dCBzb3VyY2VzIGZvciB0aGUgY29udGFpbmVyLCByZWxhdGl2ZSB0byB0aGUgYnVpbGRcbiAgICogY29udGV4dCBkaXJlY3RvcnkuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gYWxsIGZpbGVzXG4gICAqL1xuICByZWFkb25seSBzb3VyY2VQYXR0ZXJuPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBBbiBleHBsaWNpdCBzb3VyY2UgaGFzaCB0aGF0IHJlcHJlc2VudHMgdGhlIGNvbnRhaW5lciBzb3VyY2UuIGlmIG5vdCBzZXQsIGFuZCBgc291cmNlUGF0dGVybmBcbiAgICogaXMgc2V0LCB0aGUgaGFzaCB3aWxsIGJlIGNhbGN1bGF0ZWQgYmFzZWQgb24gdGhlIGNvbnRlbnQgb2YgdGhlIHNvdXJjZSBmaWxlcy5cbiAgICogQGRlZmF1bHQgLSBjYWxjdWxhdGVkIGJhc2VkIG9uIHRoZSBzb3VyY2UgZmlsZXNcbiAgICovXG4gIHJlYWRvbmx5IHNvdXJjZUhhc2g/OiBzdHJpbmc7XG59XG5cbi8qKlxuICogUmVwcmVzZW50cyBhIGNvbnRhaW5lciBydW5uaW5nIGluIHRoZSBXaW5nIFNpbXVsYXRvci5cbiAqXG4gKiBAaW5mbGlnaHQgYEB3aW5nbGFuZy9zZGsuc2ltLklDb250YWluZXJDbGllbnRgXG4gKi9cbmV4cG9ydCBjbGFzcyBDb250YWluZXIgZXh0ZW5kcyBSZXNvdXJjZSBpbXBsZW1lbnRzIElTaW11bGF0b3JSZXNvdXJjZSB7XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgcHVibGljIFtJTkZMSUdIVF9TWU1CT0xdPzogSUNvbnRhaW5lckNsaWVudDtcblxuICBwcml2YXRlIHJlYWRvbmx5IGltYWdlVGFnOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEEgdG9rZW4gdGhhdCByZXNvbHZlcyB0byB0aGUgaG9zdCBwb3J0IG9mIHRoaXMgY29udGFpbmVyLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGhvc3RQb3J0Pzogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHNjb3BlOiBDb25zdHJ1Y3QsXG4gICAgaWQ6IHN0cmluZyxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHByb3BzOiBDb250YWluZXJQcm9wc1xuICApIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuXG4gICAgLy8gZGV0ZXJtaW5lIGltYWdlIHRhZyAtIGlmIHRoZSBpbWFnZSBpcyBhIHBhdGgsIHdlIHVzZSBhIHNvdXJjZSBoYXNoIChlaXRoZXIgZXhwbGljaXRseVxuICAgIC8vIHByb3ZpZGVkIG9yIGNhbGN1bGF0ZWQgYmFzZWQgb24gdGhlIHNvdXJjZSBmaWxlcykuIGlmIHRoZSBpbWFnZSBpcyBhIG5hbWUsIHdlIHVzZSB0aGUgbmFtZVxuICAgIGlmIChpc1BhdGgocHJvcHMuaW1hZ2UpKSB7XG4gICAgICBjb25zdCBoYXNoID0gcHJvcHMuc291cmNlSGFzaCA/PyBmcy5tZDUocHJvcHMuaW1hZ2UsIHByb3BzLnNvdXJjZVBhdHRlcm4pO1xuICAgICAgdGhpcy5pbWFnZVRhZyA9IGAke3Byb3BzLm5hbWV9OiR7aGFzaH1gO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmltYWdlVGFnID0gcHJvcHMuaW1hZ2U7XG4gICAgfVxuXG4gICAgaWYgKHByb3BzLmNvbnRhaW5lclBvcnQpIHtcbiAgICAgIHRoaXMuaG9zdFBvcnQgPSBzaW11bGF0b3JBdHRyVG9rZW4odGhpcywgSE9TVF9QT1JUX0FUVFIpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyB0b1NpbXVsYXRvcigpOiBUb1NpbXVsYXRvck91dHB1dCB7XG4gICAgY29uc3QgcHJvcHM6IENvbnRhaW5lclNjaGVtYSA9IHtcbiAgICAgIGltYWdlOiB0aGlzLnByb3BzLmltYWdlLFxuICAgICAgaW1hZ2VUYWc6IHRoaXMuaW1hZ2VUYWcsXG4gICAgICBjb250YWluZXJQb3J0OiB0aGlzLnByb3BzLmNvbnRhaW5lclBvcnQsXG4gICAgICBlbnY6IHRoaXMucHJvcHMuZW52LFxuICAgICAgdm9sdW1lczogdGhpcy5wcm9wcy52b2x1bWVzLFxuICAgICAgYXJnczogdGhpcy5wcm9wcy5hcmdzLFxuICAgICAgY3dkOiBBcHAub2YodGhpcykuZW50cnlwb2ludERpcixcbiAgICAgIG5ldHdvcms6IHRoaXMucHJvcHMubmV0d29yayxcbiAgICAgIGVudHJ5cG9pbnQ6IHRoaXMucHJvcHMuZW50cnlwb2ludCxcbiAgICB9O1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBTSU1fQ09OVEFJTkVSX0ZRTixcbiAgICAgIHByb3BzLFxuICAgIH07XG4gIH1cblxuICBwdWJsaWMgb25MaWZ0KGhvc3Q6IElJbmZsaWdodEhvc3QsIG9wczogc3RyaW5nW10pOiB2b2lkIHtcbiAgICBiaW5kU2ltdWxhdG9yUmVzb3VyY2UoX19maWxlbmFtZSwgdGhpcywgaG9zdCwgb3BzKTtcbiAgICBzdXBlci5vbkxpZnQoaG9zdCwgb3BzKTtcbiAgfVxuXG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgcHVibGljIGdldCBfbGlmdE1hcCgpOiBMaWZ0TWFwIHtcbiAgICByZXR1cm4ge307XG4gIH1cblxuICAvKiogQGludGVybmFsICovXG4gIHB1YmxpYyBfdG9JbmZsaWdodCgpOiBzdHJpbmcge1xuICAgIHJldHVybiBtYWtlU2ltdWxhdG9ySnNDbGllbnQoX19maWxlbmFtZSwgdGhpcyk7XG4gIH1cbn1cblxuLyoqXG4gKiBMaXN0IG9mIGluZmxpZ2h0IG9wZXJhdGlvbnMgYXZhaWxhYmxlIGZvciBgc2ltLkNvbnRhaW5lcmAuXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGVudW0gQ29udGFpbmVySW5mbGlnaHRNZXRob2RzIHt9XG5cbi8qKlxuICogSW5mbGlnaHQgaW50ZXJmYWNlIGZvciBgUmVkaXNgLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIElDb250YWluZXJDbGllbnQge31cbiJdfQ==