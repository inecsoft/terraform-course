"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.convertDurationToCronExpression = exports.makeSimulatorJsClientV2 = exports.makeSimulatorJsClient = exports.bindSimulatorResource = exports.exists = void 0;
const fs_1 = require("fs");
const path_1 = require("path");
const util_1 = require("util");
const resource_1 = require("./resource");
const tokens_1 = require("./tokens");
/**
 * Check if a file exists for an specific path
 * @param filePath
 * @Returns Return `true` if the file exists, `false` otherwise.
 */
async function exists(filePath) {
    try {
        await (0, util_1.promisify)(fs_1.access)(filePath, fs_1.constants.F_OK | fs_1.constants.R_OK | fs_1.constants.W_OK //eslint-disable-line no-bitwise
        );
        return true;
    }
    catch (er) {
        return false;
    }
}
exports.exists = exists;
function makeEnvVarName(type, resource) {
    return `${type
        .toUpperCase()
        .replace(/[^A-Z]+/g, "_")}_HANDLE_${resource.node.addr.slice(-8)}`;
}
function bindSimulatorResource(filename, resource, host, ops) {
    // Check if host implements ISimulatorInflightHost
    if (!(0, resource_1.isSimulatorInflightHost)(host)) {
        throw new Error("Host resource must implement sim.ISimulatorInflightHost to bind simulator resources");
    }
    const type = (0, path_1.basename)(filename).split(".")[0];
    const env = makeEnvVarName(type, resource);
    const handle = (0, tokens_1.simulatorHandleToken)(resource);
    host.addEnvironment(env, handle);
    host.node.addDependency(resource);
    for (const op of ops) {
        host.addPermission(resource, op);
    }
}
exports.bindSimulatorResource = bindSimulatorResource;
function makeSimulatorJsClient(filename, resource) {
    const type = (0, path_1.basename)(filename).split(".")[0];
    const env = makeEnvVarName(type, resource);
    return `(function() {
  let handle = process.env.${env};
  if (!handle) {
    throw new Error("Missing environment variable: ${env}");
  }
  const simulatorUrl = process.env.WING_SIMULATOR_URL;
  if (!simulatorUrl) {
    throw new Error("Missing environment variable: WING_SIMULATOR_URL");
  }
  const caller = process.env.WING_SIMULATOR_CALLER;
  if (!caller) {
    throw new Error("Missing environment variable: WING_SIMULATOR_CALLER");
  }
  return require("@winglang/sdk/lib/simulator/client").makeSimulatorClient(simulatorUrl, handle, caller);
})()`;
}
exports.makeSimulatorJsClient = makeSimulatorJsClient;
function makeSimulatorJsClientV2(filename, resource) {
    const type = (0, path_1.basename)(filename).split(".")[0];
    const env = makeEnvVarName(type, resource);
    return `(function() {
  let handle = process.env.${env};
  if (!handle) {
    throw new Error("Missing environment variable: ${env}");
  }
  const simulatorUrl = process.env.WING_SIMULATOR_URL;
  if (!simulatorUrl) {
    throw new Error("Missing environment variable: WING_SIMULATOR_URL");
  }
  const caller = process.env.WING_SIMULATOR_CALLER;
  if (!caller) {
    throw new Error("Missing environment variable: WING_SIMULATOR_CALLER");
  }
  const backend = require("@winglang/sdk/lib/simulator/client").makeSimulatorClient(simulatorUrl, handle, caller);
  const client = new Proxy(backend, {
    get: function(target, prop, receiver) {
      return async function(...args) {
        return backend.call(prop, args);
      };
    },
  });
  return client;
})()`;
}
exports.makeSimulatorJsClientV2 = makeSimulatorJsClientV2;
// helper function to convert duration to a cron string
// maybe this belongs in a util library but for now it's here
function convertDurationToCronExpression(dur) {
    if (dur.minutes % 1 !== 0) {
        // our cron expression format is [minute] [hour] [day] [month] [year]
        throw new Error("Cron expressions with second precision are not supported");
    }
    const totalInMinutes = Math.floor(dur.minutes);
    const h = Math.floor(totalInMinutes / 60);
    const m = totalInMinutes % 60;
    // [minute] [hour] [day of month] [month] [day of week]
    const minute = m != 0 ? `*/${m}` : "*";
    const hour = h != 0 ? `*/${h}` : "*";
    // TODO: Support longer durations once we implement https://github.com/winglang/wing/issues/2243
    // for now we just use * for day, month, and year
    const dayInMonth = "*";
    const month = "*";
    const dayOfWeek = "*";
    // Generate cron string based on the duration
    const cronString = `${minute} ${hour} ${dayInMonth} ${month} ${dayOfWeek}`;
    return cronString;
}
exports.convertDurationToCronExpression = convertDurationToCronExpression;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90YXJnZXQtc2ltL3V0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsMkJBQXVDO0FBQ3ZDLCtCQUFnQztBQUNoQywrQkFBaUM7QUFFakMseUNBQXFEO0FBQ3JELHFDQUFnRDtBQUdoRDs7OztHQUlHO0FBQ0ksS0FBSyxVQUFVLE1BQU0sQ0FBQyxRQUFnQjtJQUMzQyxJQUFJLENBQUM7UUFDSCxNQUFNLElBQUEsZ0JBQVMsRUFBQyxXQUFNLENBQUMsQ0FDckIsUUFBUSxFQUNSLGNBQVMsQ0FBQyxJQUFJLEdBQUcsY0FBUyxDQUFDLElBQUksR0FBRyxjQUFTLENBQUMsSUFBSSxDQUFDLGdDQUFnQztTQUNsRixDQUFDO1FBQ0YsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQztRQUNaLE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQztBQUNILENBQUM7QUFWRCx3QkFVQztBQUVELFNBQVMsY0FBYyxDQUFDLElBQVksRUFBRSxRQUFvQjtJQUN4RCxPQUFPLEdBQUcsSUFBSTtTQUNYLFdBQVcsRUFBRTtTQUNiLE9BQU8sQ0FBQyxVQUFVLEVBQUUsR0FBRyxDQUFDLFdBQVcsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztBQUN2RSxDQUFDO0FBRUQsU0FBZ0IscUJBQXFCLENBQ25DLFFBQWdCLEVBQ2hCLFFBQWtCLEVBQ2xCLElBQW1CLEVBQ25CLEdBQWE7SUFFYixrREFBa0Q7SUFDbEQsSUFBSSxDQUFDLElBQUEsa0NBQXVCLEVBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUNuQyxNQUFNLElBQUksS0FBSyxDQUNiLHFGQUFxRixDQUN0RixDQUFDO0lBQ0osQ0FBQztJQUNELE1BQU0sSUFBSSxHQUFHLElBQUEsZUFBUSxFQUFDLFFBQVEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM5QyxNQUFNLEdBQUcsR0FBRyxjQUFjLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQzNDLE1BQU0sTUFBTSxHQUFHLElBQUEsNkJBQW9CLEVBQUMsUUFBUSxDQUFDLENBQUM7SUFDOUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDakMsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDbEMsS0FBSyxNQUFNLEVBQUUsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUNyQixJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNuQyxDQUFDO0FBQ0gsQ0FBQztBQXBCRCxzREFvQkM7QUFFRCxTQUFnQixxQkFBcUIsQ0FBQyxRQUFnQixFQUFFLFFBQWtCO0lBQ3hFLE1BQU0sSUFBSSxHQUFHLElBQUEsZUFBUSxFQUFDLFFBQVEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM5QyxNQUFNLEdBQUcsR0FBRyxjQUFjLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQzNDLE9BQU87NkJBQ29CLEdBQUc7O3FEQUVxQixHQUFHOzs7Ozs7Ozs7OztLQVduRCxDQUFDO0FBQ04sQ0FBQztBQWxCRCxzREFrQkM7QUFFRCxTQUFnQix1QkFBdUIsQ0FBQyxRQUFnQixFQUFFLFFBQWtCO0lBQzFFLE1BQU0sSUFBSSxHQUFHLElBQUEsZUFBUSxFQUFDLFFBQVEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM5QyxNQUFNLEdBQUcsR0FBRyxjQUFjLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQzNDLE9BQU87NkJBQ29CLEdBQUc7O3FEQUVxQixHQUFHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0tBbUJuRCxDQUFDO0FBQ04sQ0FBQztBQTFCRCwwREEwQkM7QUFFRCx1REFBdUQ7QUFDdkQsNkRBQTZEO0FBQzdELFNBQWdCLCtCQUErQixDQUFDLEdBQWE7SUFDM0QsSUFBSSxHQUFHLENBQUMsT0FBTyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUMxQixxRUFBcUU7UUFDckUsTUFBTSxJQUFJLEtBQUssQ0FBQywwREFBMEQsQ0FBQyxDQUFDO0lBQzlFLENBQUM7SUFFRCxNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUUvQyxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUMxQyxNQUFNLENBQUMsR0FBRyxjQUFjLEdBQUcsRUFBRSxDQUFDO0lBQzlCLHVEQUF1RDtJQUN2RCxNQUFNLE1BQU0sR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUM7SUFDdkMsTUFBTSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDO0lBQ3JDLGdHQUFnRztJQUNoRyxpREFBaUQ7SUFDakQsTUFBTSxVQUFVLEdBQUcsR0FBRyxDQUFDO0lBQ3ZCLE1BQU0sS0FBSyxHQUFHLEdBQUcsQ0FBQztJQUNsQixNQUFNLFNBQVMsR0FBRyxHQUFHLENBQUM7SUFFdEIsNkNBQTZDO0lBQzdDLE1BQU0sVUFBVSxHQUFHLEdBQUcsTUFBTSxJQUFJLElBQUksSUFBSSxVQUFVLElBQUksS0FBSyxJQUFJLFNBQVMsRUFBRSxDQUFDO0lBQzNFLE9BQU8sVUFBVSxDQUFDO0FBQ3BCLENBQUM7QUF0QkQsMEVBc0JDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYWNjZXNzLCBjb25zdGFudHMgfSBmcm9tIFwiZnNcIjtcbmltcG9ydCB7IGJhc2VuYW1lIH0gZnJvbSBcInBhdGhcIjtcbmltcG9ydCB7IHByb21pc2lmeSB9IGZyb20gXCJ1dGlsXCI7XG5pbXBvcnQgeyBJQ29uc3RydWN0IH0gZnJvbSBcImNvbnN0cnVjdHNcIjtcbmltcG9ydCB7IGlzU2ltdWxhdG9ySW5mbGlnaHRIb3N0IH0gZnJvbSBcIi4vcmVzb3VyY2VcIjtcbmltcG9ydCB7IHNpbXVsYXRvckhhbmRsZVRva2VuIH0gZnJvbSBcIi4vdG9rZW5zXCI7XG5pbXBvcnQgeyBEdXJhdGlvbiwgSUluZmxpZ2h0SG9zdCwgUmVzb3VyY2UgfSBmcm9tIFwiLi4vc3RkXCI7XG5cbi8qKlxuICogQ2hlY2sgaWYgYSBmaWxlIGV4aXN0cyBmb3IgYW4gc3BlY2lmaWMgcGF0aFxuICogQHBhcmFtIGZpbGVQYXRoXG4gKiBAUmV0dXJucyBSZXR1cm4gYHRydWVgIGlmIHRoZSBmaWxlIGV4aXN0cywgYGZhbHNlYCBvdGhlcndpc2UuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleGlzdHMoZmlsZVBhdGg6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICB0cnkge1xuICAgIGF3YWl0IHByb21pc2lmeShhY2Nlc3MpKFxuICAgICAgZmlsZVBhdGgsXG4gICAgICBjb25zdGFudHMuRl9PSyB8IGNvbnN0YW50cy5SX09LIHwgY29uc3RhbnRzLldfT0sgLy9lc2xpbnQtZGlzYWJsZS1saW5lIG5vLWJpdHdpc2VcbiAgICApO1xuICAgIHJldHVybiB0cnVlO1xuICB9IGNhdGNoIChlcikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBtYWtlRW52VmFyTmFtZSh0eXBlOiBzdHJpbmcsIHJlc291cmNlOiBJQ29uc3RydWN0KTogc3RyaW5nIHtcbiAgcmV0dXJuIGAke3R5cGVcbiAgICAudG9VcHBlckNhc2UoKVxuICAgIC5yZXBsYWNlKC9bXkEtWl0rL2csIFwiX1wiKX1fSEFORExFXyR7cmVzb3VyY2Uubm9kZS5hZGRyLnNsaWNlKC04KX1gO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYmluZFNpbXVsYXRvclJlc291cmNlKFxuICBmaWxlbmFtZTogc3RyaW5nLFxuICByZXNvdXJjZTogUmVzb3VyY2UsXG4gIGhvc3Q6IElJbmZsaWdodEhvc3QsXG4gIG9wczogc3RyaW5nW11cbikge1xuICAvLyBDaGVjayBpZiBob3N0IGltcGxlbWVudHMgSVNpbXVsYXRvckluZmxpZ2h0SG9zdFxuICBpZiAoIWlzU2ltdWxhdG9ySW5mbGlnaHRIb3N0KGhvc3QpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgXCJIb3N0IHJlc291cmNlIG11c3QgaW1wbGVtZW50IHNpbS5JU2ltdWxhdG9ySW5mbGlnaHRIb3N0IHRvIGJpbmQgc2ltdWxhdG9yIHJlc291cmNlc1wiXG4gICAgKTtcbiAgfVxuICBjb25zdCB0eXBlID0gYmFzZW5hbWUoZmlsZW5hbWUpLnNwbGl0KFwiLlwiKVswXTtcbiAgY29uc3QgZW52ID0gbWFrZUVudlZhck5hbWUodHlwZSwgcmVzb3VyY2UpO1xuICBjb25zdCBoYW5kbGUgPSBzaW11bGF0b3JIYW5kbGVUb2tlbihyZXNvdXJjZSk7XG4gIGhvc3QuYWRkRW52aXJvbm1lbnQoZW52LCBoYW5kbGUpO1xuICBob3N0Lm5vZGUuYWRkRGVwZW5kZW5jeShyZXNvdXJjZSk7XG4gIGZvciAoY29uc3Qgb3Agb2Ygb3BzKSB7XG4gICAgaG9zdC5hZGRQZXJtaXNzaW9uKHJlc291cmNlLCBvcCk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1ha2VTaW11bGF0b3JKc0NsaWVudChmaWxlbmFtZTogc3RyaW5nLCByZXNvdXJjZTogUmVzb3VyY2UpIHtcbiAgY29uc3QgdHlwZSA9IGJhc2VuYW1lKGZpbGVuYW1lKS5zcGxpdChcIi5cIilbMF07XG4gIGNvbnN0IGVudiA9IG1ha2VFbnZWYXJOYW1lKHR5cGUsIHJlc291cmNlKTtcbiAgcmV0dXJuIGAoZnVuY3Rpb24oKSB7XG4gIGxldCBoYW5kbGUgPSBwcm9jZXNzLmVudi4ke2Vudn07XG4gIGlmICghaGFuZGxlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiTWlzc2luZyBlbnZpcm9ubWVudCB2YXJpYWJsZTogJHtlbnZ9XCIpO1xuICB9XG4gIGNvbnN0IHNpbXVsYXRvclVybCA9IHByb2Nlc3MuZW52LldJTkdfU0lNVUxBVE9SX1VSTDtcbiAgaWYgKCFzaW11bGF0b3JVcmwpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaXNzaW5nIGVudmlyb25tZW50IHZhcmlhYmxlOiBXSU5HX1NJTVVMQVRPUl9VUkxcIik7XG4gIH1cbiAgY29uc3QgY2FsbGVyID0gcHJvY2Vzcy5lbnYuV0lOR19TSU1VTEFUT1JfQ0FMTEVSO1xuICBpZiAoIWNhbGxlcikge1xuICAgIHRocm93IG5ldyBFcnJvcihcIk1pc3NpbmcgZW52aXJvbm1lbnQgdmFyaWFibGU6IFdJTkdfU0lNVUxBVE9SX0NBTExFUlwiKTtcbiAgfVxuICByZXR1cm4gcmVxdWlyZShcIkB3aW5nbGFuZy9zZGsvbGliL3NpbXVsYXRvci9jbGllbnRcIikubWFrZVNpbXVsYXRvckNsaWVudChzaW11bGF0b3JVcmwsIGhhbmRsZSwgY2FsbGVyKTtcbn0pKClgO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbWFrZVNpbXVsYXRvckpzQ2xpZW50VjIoZmlsZW5hbWU6IHN0cmluZywgcmVzb3VyY2U6IFJlc291cmNlKSB7XG4gIGNvbnN0IHR5cGUgPSBiYXNlbmFtZShmaWxlbmFtZSkuc3BsaXQoXCIuXCIpWzBdO1xuICBjb25zdCBlbnYgPSBtYWtlRW52VmFyTmFtZSh0eXBlLCByZXNvdXJjZSk7XG4gIHJldHVybiBgKGZ1bmN0aW9uKCkge1xuICBsZXQgaGFuZGxlID0gcHJvY2Vzcy5lbnYuJHtlbnZ9O1xuICBpZiAoIWhhbmRsZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIk1pc3NpbmcgZW52aXJvbm1lbnQgdmFyaWFibGU6ICR7ZW52fVwiKTtcbiAgfVxuICBjb25zdCBzaW11bGF0b3JVcmwgPSBwcm9jZXNzLmVudi5XSU5HX1NJTVVMQVRPUl9VUkw7XG4gIGlmICghc2ltdWxhdG9yVXJsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiTWlzc2luZyBlbnZpcm9ubWVudCB2YXJpYWJsZTogV0lOR19TSU1VTEFUT1JfVVJMXCIpO1xuICB9XG4gIGNvbnN0IGNhbGxlciA9IHByb2Nlc3MuZW52LldJTkdfU0lNVUxBVE9SX0NBTExFUjtcbiAgaWYgKCFjYWxsZXIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaXNzaW5nIGVudmlyb25tZW50IHZhcmlhYmxlOiBXSU5HX1NJTVVMQVRPUl9DQUxMRVJcIik7XG4gIH1cbiAgY29uc3QgYmFja2VuZCA9IHJlcXVpcmUoXCJAd2luZ2xhbmcvc2RrL2xpYi9zaW11bGF0b3IvY2xpZW50XCIpLm1ha2VTaW11bGF0b3JDbGllbnQoc2ltdWxhdG9yVXJsLCBoYW5kbGUsIGNhbGxlcik7XG4gIGNvbnN0IGNsaWVudCA9IG5ldyBQcm94eShiYWNrZW5kLCB7XG4gICAgZ2V0OiBmdW5jdGlvbih0YXJnZXQsIHByb3AsIHJlY2VpdmVyKSB7XG4gICAgICByZXR1cm4gYXN5bmMgZnVuY3Rpb24oLi4uYXJncykge1xuICAgICAgICByZXR1cm4gYmFja2VuZC5jYWxsKHByb3AsIGFyZ3MpO1xuICAgICAgfTtcbiAgICB9LFxuICB9KTtcbiAgcmV0dXJuIGNsaWVudDtcbn0pKClgO1xufVxuXG4vLyBoZWxwZXIgZnVuY3Rpb24gdG8gY29udmVydCBkdXJhdGlvbiB0byBhIGNyb24gc3RyaW5nXG4vLyBtYXliZSB0aGlzIGJlbG9uZ3MgaW4gYSB1dGlsIGxpYnJhcnkgYnV0IGZvciBub3cgaXQncyBoZXJlXG5leHBvcnQgZnVuY3Rpb24gY29udmVydER1cmF0aW9uVG9Dcm9uRXhwcmVzc2lvbihkdXI6IER1cmF0aW9uKTogc3RyaW5nIHtcbiAgaWYgKGR1ci5taW51dGVzICUgMSAhPT0gMCkge1xuICAgIC8vIG91ciBjcm9uIGV4cHJlc3Npb24gZm9ybWF0IGlzIFttaW51dGVdIFtob3VyXSBbZGF5XSBbbW9udGhdIFt5ZWFyXVxuICAgIHRocm93IG5ldyBFcnJvcihcIkNyb24gZXhwcmVzc2lvbnMgd2l0aCBzZWNvbmQgcHJlY2lzaW9uIGFyZSBub3Qgc3VwcG9ydGVkXCIpO1xuICB9XG5cbiAgY29uc3QgdG90YWxJbk1pbnV0ZXMgPSBNYXRoLmZsb29yKGR1ci5taW51dGVzKTtcblxuICBjb25zdCBoID0gTWF0aC5mbG9vcih0b3RhbEluTWludXRlcyAvIDYwKTtcbiAgY29uc3QgbSA9IHRvdGFsSW5NaW51dGVzICUgNjA7XG4gIC8vIFttaW51dGVdIFtob3VyXSBbZGF5IG9mIG1vbnRoXSBbbW9udGhdIFtkYXkgb2Ygd2Vla11cbiAgY29uc3QgbWludXRlID0gbSAhPSAwID8gYCovJHttfWAgOiBcIipcIjtcbiAgY29uc3QgaG91ciA9IGggIT0gMCA/IGAqLyR7aH1gIDogXCIqXCI7XG4gIC8vIFRPRE86IFN1cHBvcnQgbG9uZ2VyIGR1cmF0aW9ucyBvbmNlIHdlIGltcGxlbWVudCBodHRwczovL2dpdGh1Yi5jb20vd2luZ2xhbmcvd2luZy9pc3N1ZXMvMjI0M1xuICAvLyBmb3Igbm93IHdlIGp1c3QgdXNlICogZm9yIGRheSwgbW9udGgsIGFuZCB5ZWFyXG4gIGNvbnN0IGRheUluTW9udGggPSBcIipcIjtcbiAgY29uc3QgbW9udGggPSBcIipcIjtcbiAgY29uc3QgZGF5T2ZXZWVrID0gXCIqXCI7XG5cbiAgLy8gR2VuZXJhdGUgY3JvbiBzdHJpbmcgYmFzZWQgb24gdGhlIGR1cmF0aW9uXG4gIGNvbnN0IGNyb25TdHJpbmcgPSBgJHttaW51dGV9ICR7aG91cn0gJHtkYXlJbk1vbnRofSAke21vbnRofSAke2RheU9mV2Vla31gO1xuICByZXR1cm4gY3JvblN0cmluZztcbn1cbiJdfQ==