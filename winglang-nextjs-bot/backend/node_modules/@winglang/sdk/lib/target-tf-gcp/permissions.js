"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.calculateCounterPermissions = exports.calculateBucketPermissions = void 0;
const cloud = __importStar(require("../cloud"));
function calculateBucketPermissions(ops) {
    const permissions = [];
    if (ops.includes(cloud.BucketInflightMethods.GET) ||
        ops.includes(cloud.BucketInflightMethods.GET_JSON) ||
        ops.includes(cloud.BucketInflightMethods.TRY_GET) ||
        ops.includes(cloud.BucketInflightMethods.TRY_GET_JSON) ||
        ops.includes(cloud.BucketInflightMethods.TRY_DELETE) ||
        ops.includes(cloud.BucketInflightMethods.EXISTS) ||
        ops.includes(cloud.BucketInflightMethods.METADATA) ||
        ops.includes(cloud.BucketInflightMethods.PUBLIC_URL) ||
        ops.includes(cloud.BucketInflightMethods.COPY) ||
        ops.includes(cloud.BucketInflightMethods.RENAME) ||
        ops.includes(cloud.BucketInflightMethods.SIGNED_URL)) {
        permissions.push("storage.objects.get");
    }
    if (ops.includes(cloud.BucketInflightMethods.PUT) ||
        ops.includes(cloud.BucketInflightMethods.PUT_JSON) ||
        ops.includes(cloud.BucketInflightMethods.COPY) ||
        ops.includes(cloud.BucketInflightMethods.RENAME) ||
        ops.includes(cloud.BucketInflightMethods.SIGNED_URL)) {
        permissions.push("storage.objects.create");
    }
    if (ops.includes(cloud.BucketInflightMethods.DELETE) ||
        ops.includes(cloud.BucketInflightMethods.TRY_DELETE) ||
        ops.includes(cloud.BucketInflightMethods.PUT) ||
        ops.includes(cloud.BucketInflightMethods.PUT_JSON) ||
        ops.includes(cloud.BucketInflightMethods.COPY) ||
        ops.includes(cloud.BucketInflightMethods.RENAME) ||
        ops.includes(cloud.BucketInflightMethods.SIGNED_URL)) {
        permissions.push("storage.objects.delete");
    }
    if (ops.includes(cloud.BucketInflightMethods.LIST) ||
        ops.includes(cloud.BucketInflightMethods.SIGNED_URL)) {
        permissions.push("storage.objects.list");
    }
    if (ops.includes(cloud.BucketInflightMethods.PUBLIC_URL)) {
        permissions.push("storage.buckets.get");
    }
    if (ops.includes(cloud.BucketInflightMethods.SIGNED_URL)) {
        permissions.push("iam.serviceAccounts.signBlob");
    }
    return permissions;
}
exports.calculateBucketPermissions = calculateBucketPermissions;
function calculateCounterPermissions(ops) {
    const permissions = [];
    if (ops.includes(cloud.CounterInflightMethods.PEEK) ||
        ops.includes(cloud.CounterInflightMethods.INC) ||
        ops.includes(cloud.CounterInflightMethods.DEC)) {
        permissions.push("datastore.entities.get");
    }
    if (ops.includes(cloud.CounterInflightMethods.PEEK) ||
        ops.includes(cloud.CounterInflightMethods.INC) ||
        ops.includes(cloud.CounterInflightMethods.DEC) ||
        ops.includes(cloud.CounterInflightMethods.SET)) {
        permissions.push("datastore.entities.create");
    }
    if (ops.includes(cloud.CounterInflightMethods.INC) ||
        ops.includes(cloud.CounterInflightMethods.DEC) ||
        ops.includes(cloud.CounterInflightMethods.SET)) {
        permissions.push("datastore.entities.update");
    }
    return permissions;
}
exports.calculateCounterPermissions = calculateCounterPermissions;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGVybWlzc2lvbnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdGFyZ2V0LXRmLWdjcC9wZXJtaXNzaW9ucy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLGdEQUFrQztBQUVsQyxTQUFnQiwwQkFBMEIsQ0FBQyxHQUFhO0lBQ3RELE1BQU0sV0FBVyxHQUFhLEVBQUUsQ0FBQztJQUVqQyxJQUNFLEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLEdBQUcsQ0FBQztRQUM3QyxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxRQUFRLENBQUM7UUFDbEQsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsT0FBTyxDQUFDO1FBQ2pELEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLFlBQVksQ0FBQztRQUN0RCxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxVQUFVLENBQUM7UUFDcEQsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsTUFBTSxDQUFDO1FBQ2hELEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLFFBQVEsQ0FBQztRQUNsRCxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxVQUFVLENBQUM7UUFDcEQsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDO1FBQzlDLEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLE1BQU0sQ0FBQztRQUNoRCxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxVQUFVLENBQUMsRUFDcEQsQ0FBQztRQUNELFdBQVcsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRUQsSUFDRSxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxHQUFHLENBQUM7UUFDN0MsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsUUFBUSxDQUFDO1FBQ2xELEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQztRQUM5QyxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxNQUFNLENBQUM7UUFDaEQsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsVUFBVSxDQUFDLEVBQ3BELENBQUM7UUFDRCxXQUFXLENBQUMsSUFBSSxDQUFDLHdCQUF3QixDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUVELElBQ0UsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsTUFBTSxDQUFDO1FBQ2hELEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLFVBQVUsQ0FBQztRQUNwRCxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxHQUFHLENBQUM7UUFDN0MsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsUUFBUSxDQUFDO1FBQ2xELEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQztRQUM5QyxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxNQUFNLENBQUM7UUFDaEQsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsVUFBVSxDQUFDLEVBQ3BELENBQUM7UUFDRCxXQUFXLENBQUMsSUFBSSxDQUFDLHdCQUF3QixDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUVELElBQ0UsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDO1FBQzlDLEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLFVBQVUsQ0FBQyxFQUNwRCxDQUFDO1FBQ0QsV0FBVyxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0lBQzNDLENBQUM7SUFFRCxJQUFJLEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUM7UUFDekQsV0FBVyxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0lBQzFDLENBQUM7SUFFRCxJQUFJLEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUM7UUFDekQsV0FBVyxDQUFDLElBQUksQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0lBQ25ELENBQUM7SUFFRCxPQUFPLFdBQVcsQ0FBQztBQUNyQixDQUFDO0FBekRELGdFQXlEQztBQUVELFNBQWdCLDJCQUEyQixDQUFDLEdBQWE7SUFDdkQsTUFBTSxXQUFXLEdBQWEsRUFBRSxDQUFDO0lBRWpDLElBQ0UsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsc0JBQXNCLENBQUMsSUFBSSxDQUFDO1FBQy9DLEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLHNCQUFzQixDQUFDLEdBQUcsQ0FBQztRQUM5QyxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxHQUFHLENBQUMsRUFDOUMsQ0FBQztRQUNELFdBQVcsQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBRUQsSUFDRSxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxJQUFJLENBQUM7UUFDL0MsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsc0JBQXNCLENBQUMsR0FBRyxDQUFDO1FBQzlDLEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLHNCQUFzQixDQUFDLEdBQUcsQ0FBQztRQUM5QyxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxHQUFHLENBQUMsRUFDOUMsQ0FBQztRQUNELFdBQVcsQ0FBQyxJQUFJLENBQUMsMkJBQTJCLENBQUMsQ0FBQztJQUNoRCxDQUFDO0lBRUQsSUFDRSxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxHQUFHLENBQUM7UUFDOUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsc0JBQXNCLENBQUMsR0FBRyxDQUFDO1FBQzlDLEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLHNCQUFzQixDQUFDLEdBQUcsQ0FBQyxFQUM5QyxDQUFDO1FBQ0QsV0FBVyxDQUFDLElBQUksQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFFRCxPQUFPLFdBQVcsQ0FBQztBQUNyQixDQUFDO0FBN0JELGtFQTZCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGNsb3VkIGZyb20gXCIuLi9jbG91ZFwiO1xuXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlQnVja2V0UGVybWlzc2lvbnMob3BzOiBzdHJpbmdbXSk6IHN0cmluZ1tdIHtcbiAgY29uc3QgcGVybWlzc2lvbnM6IHN0cmluZ1tdID0gW107XG5cbiAgaWYgKFxuICAgIG9wcy5pbmNsdWRlcyhjbG91ZC5CdWNrZXRJbmZsaWdodE1ldGhvZHMuR0VUKSB8fFxuICAgIG9wcy5pbmNsdWRlcyhjbG91ZC5CdWNrZXRJbmZsaWdodE1ldGhvZHMuR0VUX0pTT04pIHx8XG4gICAgb3BzLmluY2x1ZGVzKGNsb3VkLkJ1Y2tldEluZmxpZ2h0TWV0aG9kcy5UUllfR0VUKSB8fFxuICAgIG9wcy5pbmNsdWRlcyhjbG91ZC5CdWNrZXRJbmZsaWdodE1ldGhvZHMuVFJZX0dFVF9KU09OKSB8fFxuICAgIG9wcy5pbmNsdWRlcyhjbG91ZC5CdWNrZXRJbmZsaWdodE1ldGhvZHMuVFJZX0RFTEVURSkgfHxcbiAgICBvcHMuaW5jbHVkZXMoY2xvdWQuQnVja2V0SW5mbGlnaHRNZXRob2RzLkVYSVNUUykgfHxcbiAgICBvcHMuaW5jbHVkZXMoY2xvdWQuQnVja2V0SW5mbGlnaHRNZXRob2RzLk1FVEFEQVRBKSB8fFxuICAgIG9wcy5pbmNsdWRlcyhjbG91ZC5CdWNrZXRJbmZsaWdodE1ldGhvZHMuUFVCTElDX1VSTCkgfHxcbiAgICBvcHMuaW5jbHVkZXMoY2xvdWQuQnVja2V0SW5mbGlnaHRNZXRob2RzLkNPUFkpIHx8XG4gICAgb3BzLmluY2x1ZGVzKGNsb3VkLkJ1Y2tldEluZmxpZ2h0TWV0aG9kcy5SRU5BTUUpIHx8XG4gICAgb3BzLmluY2x1ZGVzKGNsb3VkLkJ1Y2tldEluZmxpZ2h0TWV0aG9kcy5TSUdORURfVVJMKVxuICApIHtcbiAgICBwZXJtaXNzaW9ucy5wdXNoKFwic3RvcmFnZS5vYmplY3RzLmdldFwiKTtcbiAgfVxuXG4gIGlmIChcbiAgICBvcHMuaW5jbHVkZXMoY2xvdWQuQnVja2V0SW5mbGlnaHRNZXRob2RzLlBVVCkgfHxcbiAgICBvcHMuaW5jbHVkZXMoY2xvdWQuQnVja2V0SW5mbGlnaHRNZXRob2RzLlBVVF9KU09OKSB8fFxuICAgIG9wcy5pbmNsdWRlcyhjbG91ZC5CdWNrZXRJbmZsaWdodE1ldGhvZHMuQ09QWSkgfHxcbiAgICBvcHMuaW5jbHVkZXMoY2xvdWQuQnVja2V0SW5mbGlnaHRNZXRob2RzLlJFTkFNRSkgfHxcbiAgICBvcHMuaW5jbHVkZXMoY2xvdWQuQnVja2V0SW5mbGlnaHRNZXRob2RzLlNJR05FRF9VUkwpXG4gICkge1xuICAgIHBlcm1pc3Npb25zLnB1c2goXCJzdG9yYWdlLm9iamVjdHMuY3JlYXRlXCIpO1xuICB9XG5cbiAgaWYgKFxuICAgIG9wcy5pbmNsdWRlcyhjbG91ZC5CdWNrZXRJbmZsaWdodE1ldGhvZHMuREVMRVRFKSB8fFxuICAgIG9wcy5pbmNsdWRlcyhjbG91ZC5CdWNrZXRJbmZsaWdodE1ldGhvZHMuVFJZX0RFTEVURSkgfHxcbiAgICBvcHMuaW5jbHVkZXMoY2xvdWQuQnVja2V0SW5mbGlnaHRNZXRob2RzLlBVVCkgfHxcbiAgICBvcHMuaW5jbHVkZXMoY2xvdWQuQnVja2V0SW5mbGlnaHRNZXRob2RzLlBVVF9KU09OKSB8fFxuICAgIG9wcy5pbmNsdWRlcyhjbG91ZC5CdWNrZXRJbmZsaWdodE1ldGhvZHMuQ09QWSkgfHxcbiAgICBvcHMuaW5jbHVkZXMoY2xvdWQuQnVja2V0SW5mbGlnaHRNZXRob2RzLlJFTkFNRSkgfHxcbiAgICBvcHMuaW5jbHVkZXMoY2xvdWQuQnVja2V0SW5mbGlnaHRNZXRob2RzLlNJR05FRF9VUkwpXG4gICkge1xuICAgIHBlcm1pc3Npb25zLnB1c2goXCJzdG9yYWdlLm9iamVjdHMuZGVsZXRlXCIpO1xuICB9XG5cbiAgaWYgKFxuICAgIG9wcy5pbmNsdWRlcyhjbG91ZC5CdWNrZXRJbmZsaWdodE1ldGhvZHMuTElTVCkgfHxcbiAgICBvcHMuaW5jbHVkZXMoY2xvdWQuQnVja2V0SW5mbGlnaHRNZXRob2RzLlNJR05FRF9VUkwpXG4gICkge1xuICAgIHBlcm1pc3Npb25zLnB1c2goXCJzdG9yYWdlLm9iamVjdHMubGlzdFwiKTtcbiAgfVxuXG4gIGlmIChvcHMuaW5jbHVkZXMoY2xvdWQuQnVja2V0SW5mbGlnaHRNZXRob2RzLlBVQkxJQ19VUkwpKSB7XG4gICAgcGVybWlzc2lvbnMucHVzaChcInN0b3JhZ2UuYnVja2V0cy5nZXRcIik7XG4gIH1cblxuICBpZiAob3BzLmluY2x1ZGVzKGNsb3VkLkJ1Y2tldEluZmxpZ2h0TWV0aG9kcy5TSUdORURfVVJMKSkge1xuICAgIHBlcm1pc3Npb25zLnB1c2goXCJpYW0uc2VydmljZUFjY291bnRzLnNpZ25CbG9iXCIpO1xuICB9XG5cbiAgcmV0dXJuIHBlcm1pc3Npb25zO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlQ291bnRlclBlcm1pc3Npb25zKG9wczogc3RyaW5nW10pOiBzdHJpbmdbXSB7XG4gIGNvbnN0IHBlcm1pc3Npb25zOiBzdHJpbmdbXSA9IFtdO1xuXG4gIGlmIChcbiAgICBvcHMuaW5jbHVkZXMoY2xvdWQuQ291bnRlckluZmxpZ2h0TWV0aG9kcy5QRUVLKSB8fFxuICAgIG9wcy5pbmNsdWRlcyhjbG91ZC5Db3VudGVySW5mbGlnaHRNZXRob2RzLklOQykgfHxcbiAgICBvcHMuaW5jbHVkZXMoY2xvdWQuQ291bnRlckluZmxpZ2h0TWV0aG9kcy5ERUMpXG4gICkge1xuICAgIHBlcm1pc3Npb25zLnB1c2goXCJkYXRhc3RvcmUuZW50aXRpZXMuZ2V0XCIpO1xuICB9XG5cbiAgaWYgKFxuICAgIG9wcy5pbmNsdWRlcyhjbG91ZC5Db3VudGVySW5mbGlnaHRNZXRob2RzLlBFRUspIHx8XG4gICAgb3BzLmluY2x1ZGVzKGNsb3VkLkNvdW50ZXJJbmZsaWdodE1ldGhvZHMuSU5DKSB8fFxuICAgIG9wcy5pbmNsdWRlcyhjbG91ZC5Db3VudGVySW5mbGlnaHRNZXRob2RzLkRFQykgfHxcbiAgICBvcHMuaW5jbHVkZXMoY2xvdWQuQ291bnRlckluZmxpZ2h0TWV0aG9kcy5TRVQpXG4gICkge1xuICAgIHBlcm1pc3Npb25zLnB1c2goXCJkYXRhc3RvcmUuZW50aXRpZXMuY3JlYXRlXCIpO1xuICB9XG5cbiAgaWYgKFxuICAgIG9wcy5pbmNsdWRlcyhjbG91ZC5Db3VudGVySW5mbGlnaHRNZXRob2RzLklOQykgfHxcbiAgICBvcHMuaW5jbHVkZXMoY2xvdWQuQ291bnRlckluZmxpZ2h0TWV0aG9kcy5ERUMpIHx8XG4gICAgb3BzLmluY2x1ZGVzKGNsb3VkLkNvdW50ZXJJbmZsaWdodE1ldGhvZHMuU0VUKVxuICApIHtcbiAgICBwZXJtaXNzaW9ucy5wdXNoKFwiZGF0YXN0b3JlLmVudGl0aWVzLnVwZGF0ZVwiKTtcbiAgfVxuXG4gIHJldHVybiBwZXJtaXNzaW9ucztcbn1cbiJdfQ==