"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Api = void 0;
const crypto_1 = require("crypto");
const cdktf_1 = require("cdktf");
const constructs_1 = require("constructs");
const app_1 = require("./app");
const function_1 = require("./function");
const __1 = require("..");
const api_gateway_deployment_1 = require("../.gen/providers/aws/api-gateway-deployment");
const api_gateway_rest_api_1 = require("../.gen/providers/aws/api-gateway-rest-api");
const api_gateway_stage_1 = require("../.gen/providers/aws/api-gateway-stage");
const data_aws_vpc_endpoint_service_1 = require("../.gen/providers/aws/data-aws-vpc-endpoint-service");
const lambda_permission_1 = require("../.gen/providers/aws/lambda-permission");
const security_group_1 = require("../.gen/providers/aws/security-group");
const vpc_endpoint_1 = require("../.gen/providers/aws/vpc-endpoint");
const cloud = __importStar(require("../cloud"));
const resource_names_1 = require("../shared/resource-names");
const shared_aws_1 = require("../shared-aws");
const api_default_1 = require("../shared-aws/api.default");
const std_1 = require("../std");
/**
 * RestApi names are alphanumeric characters, hyphens (-) and underscores (_).
 */
const NAME_OPTS = {
    disallowedRegex: /[^a-zA-Z0-9\_\-]+/g,
};
/**
 * AWS Implementation of `cloud.Api`.
 */
class Api extends cloud.Api {
    constructor(scope, id, props = {}) {
        super(scope, id, props);
        this.handlers = {};
        this.api = new WingRestApi(this, "api", {
            getApiSpec: this._getOpenApiSpec.bind(this),
            cors: this.corsOptions,
        });
        this.endpoint = new cloud.Endpoint(this, "Endpoint", this.api.url, {
            label: `Api ${this.node.path}`,
        });
        std_1.Node.of(this.endpoint).hidden = true;
    }
    get _endpoint() {
        return this.endpoint;
    }
    /**
     * Build the http requests
     *
     * @param method http method
     * @param path path to add
     * @param inflight Inflight to handle request
     * @param props Additional props
     */
    httpRequests(method, path, inflight, props) {
        const lowerMethod = method.toLowerCase();
        const upperMethod = method.toUpperCase();
        this._validatePath(path);
        const fn = this.addHandler(inflight, method, path, props);
        const apiSpecEndpoint = this.api.addEndpoint(path, upperMethod, fn);
        this._addToSpec(path, upperMethod, apiSpecEndpoint, this.corsOptions);
        std_1.Node.of(this).addConnection({
            source: this,
            sourceOp: cloud.ApiInflightMethods.REQUEST,
            target: fn,
            targetOp: cloud.FunctionInflightMethods.INVOKE,
            name: `${lowerMethod}()`,
        });
    }
    /**
     * Add a inflight to handle GET requests to a path.
     * @param path path to add
     * @param inflight Inflight to handle request
     * @param props Additional props
     */
    get(path, inflight, props) {
        this.httpRequests("GET", path, inflight, props);
    }
    /**
     * Add a inflight to handle POST requests to a path.
     * @param path path to add
     * @param inflight Inflight to handle request
     * @param props Additional props
     */
    post(path, inflight, props) {
        this.httpRequests("POST", path, inflight, props);
    }
    /**
     * Add a inflight to handle PUT requests to a path.
     * @param path path to add
     * @param inflight Inflight to handle request
     * @param props Additional props
     */
    put(path, inflight, props) {
        this.httpRequests("PUT", path, inflight, props);
    }
    /**
     * Add a inflight to handle DELETE requests to a path.
     * @param path path to add
     * @param inflight Inflight to handle request
     * @param props Additional props
     */
    delete(path, inflight, props) {
        this.httpRequests("DELETE", path, inflight, props);
    }
    /**
     * Add a inflight to handle PATCH requests to a path.
     * @param path path to add
     * @param inflight Inflight to handle request
     * @param props Additional props
     */
    patch(path, inflight, props) {
        this.httpRequests("PATCH", path, inflight, props);
    }
    /**
     * Add a inflight to handle OPTIONS requests to a path.
     * @param path path to add
     * @param inflight Inflight to handle request
     * @param props Additional props
     */
    options(path, inflight, props) {
        this.httpRequests("OPTIONS", path, inflight, props);
    }
    /**
     * Add a inflight to handle HEAD requests to a path.
     * @param path path to add
     * @param inflight Inflight to handle request
     * @param props Additional props
     */
    head(path, inflight, props) {
        this.httpRequests("HEAD", path, inflight, props);
    }
    /**
     * Add a inflight to handle CONNECT requests to a path.
     * @param path path to add
     * @param inflight Inflight to handle request
     * @param props Additional props
     */
    connect(path, inflight, props) {
        this.httpRequests("CONNECT", path, inflight, props);
    }
    /**
     * Add a inflight handler to the stack
     * @param inflight Inflight to add to the API
     * @param props Endpoint props
     * @returns AWS Lambda Function
     */
    addHandler(inflight, method, path, props) {
        let fn = this.addInflightHandler(inflight, method, path, props);
        if (!(fn instanceof function_1.Function)) {
            throw new Error("Api only supports creating tfaws.Function right now");
        }
        return fn;
    }
    /**
     * Add an inflight handler to the stack
     * Ensures that we don't create duplicate inflight handlers.
     * @param inflight Inflight to add to the API
     * @returns Inflight handler as a AWS Lambda Function
     */
    addInflightHandler(inflight, method, path, props) {
        let handler = this.handlers[inflight._id];
        if (!handler) {
            const newInflight = shared_aws_1.ApiEndpointHandler.toFunctionHandler(inflight, cloud.Api.renderCorsHeaders(this.corsOptions)?.defaultResponse);
            const prefix = `${method.toLowerCase()}${path.replace(/\//g, "_")}`;
            handler = new function_1.Function(this, app_1.App.of(this).makeId(this, prefix), newInflight, props);
            std_1.Node.of(handler).hidden = true;
            this.handlers[inflight._id] = handler;
        }
        return handler;
    }
    /** @internal */
    onLift(host, ops) {
        host.addEnvironment(this.urlEnvName(), this.url);
        super.onLift(host, ops);
    }
    /** @internal */
    _toInflight() {
        return __1.core.InflightClient.for(__dirname.replace("target-tf-aws", "shared-aws"), __filename, "ApiClient", [`process.env["${this.urlEnvName()}"]`]);
    }
    urlEnvName() {
        return resource_names_1.ResourceNames.generateName(this, {
            disallowedRegex: /[^a-zA-Z0-9_]/,
            sep: "_",
            case: resource_names_1.CaseConventions.UPPERCASE,
        });
    }
    get restApiArn() {
        return this.api.api.executionArn;
    }
    get restApiId() {
        return this.api.api.id;
    }
    get restApiName() {
        return this.api.api.name;
    }
    get stageName() {
        return this.api.stage.stageName;
    }
    get invokeUrl() {
        return this.api.stage.invokeUrl;
    }
    get deploymentId() {
        return this.api.deployment.id;
    }
}
exports.Api = Api;
/**
 * Encapsulates the API Gateway REST API as an abstraction for Terraform.
 */
class WingRestApi extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        this.privateVpc = false;
        /**
         * Add permissions to the handler to allow it to be called by the API
         * @param path Path of the endpoint
         * @param method Method of the endpoint
         * @param handler Lambda function to handle the endpoint
         */
        this._addHandlerPermissions = (path, method, handler) => {
            const pathHash = (0, crypto_1.createHash)("sha1").update(path).digest("hex").slice(-8);
            const permissionId = `${method}-${pathHash}`;
            new lambda_permission_1.LambdaPermission(this, `permission-${permissionId}`, {
                statementId: `AllowExecutionFromAPIGateway-${permissionId}`,
                action: "lambda:InvokeFunction",
                functionName: handler.functionName,
                principal: "apigateway.amazonaws.com",
                sourceArn: `${this.api.executionArn}/*/${method}${Api.renderOpenApiPath(path)}`,
            });
        };
        const app = app_1.App.of(this);
        this.id = id;
        this.region = app.region;
        this.accountId = app.accountId;
        // Check for PRIVATE API Gateway configuration
        let privateApiGateway = app.parameters.value("tf-aws/vpc_api_gateway");
        if (privateApiGateway === true) {
            this.privateVpc = true;
            const vpcResources = this._initVpcResources(app);
            this.securityGroup = vpcResources.securityGroup;
            this.vpcEndpoint = vpcResources.vpcEndpoint;
        }
        // Create the API Gateway and configure it
        this.api = this._initApiGatewayRestApi(id, props);
        this.deployment = this._initApiGatewayDeployment();
        this.stage = this._initApiGatewayStage();
        // Construct the URL for the deployed API Gateway stage
        this.url = this._constructInvokeUrl();
    }
    _initVpcResources(app) {
        const vpcId = app.vpc.id;
        const subnetIds = [...app.subnets.private.map((s) => s.id)];
        const securityGroup = new security_group_1.SecurityGroup(this, `${this.id}SecurityGroup`, {
            vpcId: vpcId,
            ingress: [
                {
                    cidrBlocks: ["0.0.0.0/0"],
                    fromPort: 0,
                    toPort: 0,
                    protocol: "-1",
                },
            ],
        });
        const service = new data_aws_vpc_endpoint_service_1.DataAwsVpcEndpointService(this, `${this.id}ServiceLookup`, {
            service: "execute-api",
        });
        const vpcEndpoint = new vpc_endpoint_1.VpcEndpoint(this, `${this.id}-vpc-endpoint`, {
            vpcId: vpcId,
            serviceName: service.serviceName,
            privateDnsEnabled: true,
            vpcEndpointType: "Interface",
            subnetIds: subnetIds,
            securityGroupIds: [securityGroup.id],
        });
        return { securityGroup, vpcEndpoint };
    }
    _initApiGatewayRestApi(id, props) {
        /**
         * Configures the default response for requests to undefined routes (`/{proxy+}`).
         * - If CORS options are defined, `defaultResponse` sets up CORS-compliant mock responses:
         *   - 204 (No Content) for OPTIONS requests.
         *   - 404 (Not Found) for other HTTP methods.
         * - If CORS options are undefined, `defaultResponse` set up a mock 404 response for any HTTP method.
         */
        /**
         * BASIC API Gateway properties
         */
        let apiProps = {
            name: resource_names_1.ResourceNames.generateName(this, NAME_OPTS),
            lifecycle: { createBeforeDestroy: true },
            // Lazy generation of the api spec because routes can be added after the API is created
            body: cdktf_1.Lazy.stringValue({
                produce: () => {
                    // Retrieves the API specification.
                    const apiSpec = props.getApiSpec();
                    const defaultResponse = (0, api_default_1.createApiDefaultResponse)(Object.keys(apiSpec.paths), props.cors);
                    // Merges the specification with `defaultResponse` to handle requests to undefined routes (`/{proxy+}`).
                    // This integration ensures comprehensive route handling:
                    // - Predefined paths are maintained as specified.
                    // - Requests to paths not explicitly defined are managed by `defaultResponse`.
                    return JSON.stringify({
                        ...apiSpec,
                        paths: { ...apiSpec.paths, ...defaultResponse },
                    });
                },
            }),
        };
        /**
         * PRIVATE API Gateway properties
         */
        if (this.privateVpc && this.vpcEndpoint) {
            apiProps.endpointConfiguration = {
                types: ["PRIVATE"],
                vpcEndpointIds: [this.vpcEndpoint.id],
            };
            // This policy will explicitly deny all requests that don't come from the VPC endpoint
            // which means only requests that come from the same vpc on the same private subnet and security group
            // will be allowed to access the API Gateway
            apiProps.policy = JSON.stringify({
                Version: "2012-10-17",
                Statement: [
                    {
                        Effect: "Allow",
                        Principal: "*",
                        Action: "execute-api:Invoke",
                        Resource: ["*"],
                    },
                    {
                        Effect: "Deny",
                        Principal: "*",
                        Action: "execute-api:Invoke",
                        Resource: ["*"],
                        Condition: {
                            StringNotEquals: {
                                "aws:sourceVpce": this.vpcEndpoint.id,
                            },
                        },
                    },
                ],
            });
        }
        return new api_gateway_rest_api_1.ApiGatewayRestApi(this, id, apiProps);
    }
    _initApiGatewayDeployment() {
        return new api_gateway_deployment_1.ApiGatewayDeployment(this, "deployment", {
            restApiId: this.api.id,
            lifecycle: { createBeforeDestroy: true },
            // Trigger redeployment when the api spec changes
            triggers: { redeployment: cdktf_1.Fn.sha256(this.api.body) },
        });
    }
    _initApiGatewayStage() {
        return new api_gateway_stage_1.ApiGatewayStage(this, "stage", {
            restApiId: this.api.id,
            stageName: shared_aws_1.STAGE_NAME,
            deploymentId: this.deployment.id,
        });
    }
    // Intentionally not using `this.stage.invokeUrl`, it looks like it's shared with
    // the `invokeUrl` from the api deployment, which gets recreated on every deployment.
    // When this `invokeUrl` is referenced somewhere else in the stack, it can cause cyclic dependencies
    // in Terraform. Hence, we're creating our own url here.
    _constructInvokeUrl() {
        return `https://${this.api.id}.execute-api.${this.region}.amazonaws.com/${this.stage.stageName}`;
    }
    /**
     * Add an endpoint to the API
     * @param path Path of the endpoint
     * @param method Method of the endpoint
     * @param handler Lambda function to handle the endpoint
     * @returns OpenApi spec extension for the endpoint
     */
    addEndpoint(path, method, handler) {
        const endpointExtension = this._createApiSpecExtension(handler);
        this._addHandlerPermissions(path, method, handler);
        return endpointExtension;
    }
    /**
     * Creates a OpenApi extension object for the endpoint and handler
     * @param handler Lambda function to handle the endpoint
     * @returns OpenApi extension object for the endpoint and handler
     */
    _createApiSpecExtension(handler) {
        // The ARN of the Lambda function is constructed by hand so that it can be calculated
        // during preflight, instead of being resolved at deploy time.
        //
        // By doing this, the API Gateway does not need to take a dependency on its Lambda functions,
        // making it possible to write Lambda functions that reference the
        // API Gateway's URL in their inflight code.
        const functionArn = `arn:aws:lambda:${this.region}:${this.accountId}:function:${handler.name}`;
        const extension = {
            "x-amazon-apigateway-integration": {
                uri: `arn:aws:apigateway:${this.region}:lambda:path/2015-03-31/functions/${functionArn}/invocations`,
                type: "aws_proxy",
                httpMethod: "POST",
                responses: {
                    default: {
                        statusCode: "200",
                    },
                },
                passthroughBehavior: "when_no_match",
                contentHandling: "CONVERT_TO_TEXT",
            },
        };
        return extension;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3RhcmdldC10Zi1hd3MvYXBpLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsbUNBQW9DO0FBQ3BDLGlDQUFpQztBQUNqQywyQ0FBdUM7QUFDdkMsK0JBQTRCO0FBQzVCLHlDQUFzQztBQUN0QywwQkFBMEI7QUFDMUIseUZBQW9GO0FBQ3BGLHFGQUErRTtBQUMvRSwrRUFBMEU7QUFDMUUsdUdBQWdHO0FBQ2hHLCtFQUEyRTtBQUMzRSx5RUFBcUU7QUFDckUscUVBQWlFO0FBQ2pFLGdEQUFrQztBQUVsQyw2REFJa0M7QUFDbEMsOENBQXdFO0FBQ3hFLDJEQUFxRTtBQUNyRSxnQ0FBNkM7QUFFN0M7O0dBRUc7QUFDSCxNQUFNLFNBQVMsR0FBZ0I7SUFDN0IsZUFBZSxFQUFFLG9CQUFvQjtDQUN0QyxDQUFDO0FBRUY7O0dBRUc7QUFDSCxNQUFhLEdBQUksU0FBUSxLQUFLLENBQUMsR0FBRztJQUtoQyxZQUFZLEtBQWdCLEVBQUUsRUFBVSxFQUFFLFFBQXdCLEVBQUU7UUFDbEUsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFKVCxhQUFRLEdBQTZCLEVBQUUsQ0FBQztRQUt2RCxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksV0FBVyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUU7WUFDdEMsVUFBVSxFQUFFLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztZQUMzQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFdBQVc7U0FDdkIsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLFVBQVUsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRTtZQUNqRSxLQUFLLEVBQUUsT0FBTyxJQUFJLENBQUMs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QixDQUFDO0NBeUJGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlSGFzaCB9IGZyb20gXCJjcnlwdG9cIjtcbmltcG9ydCB7IEZuLCBMYXp5IH0gZnJvbSBcImNka3RmXCI7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tIFwiY29uc3RydWN0c1wiO1xuaW1wb3J0IHsgQXBwIH0gZnJvbSBcIi4vYXBwXCI7XG5pbXBvcnQgeyBGdW5jdGlvbiB9IGZyb20gXCIuL2Z1bmN0aW9uXCI7XG5pbXBvcnQgeyBjb3JlIH0gZnJvbSBcIi4uXCI7XG5pbXBvcnQgeyBBcGlHYXRld2F5RGVwbG95bWVudCB9IGZyb20gXCIuLi8uZ2VuL3Byb3ZpZGVycy9hd3MvYXBpLWdhdGV3YXktZGVwbG95bWVudFwiO1xuaW1wb3J0IHsgQXBpR2F0ZXdheVJlc3RBcGkgfSBmcm9tIFwiLi4vLmdlbi9wcm92aWRlcnMvYXdzL2FwaS1nYXRld2F5LXJlc3QtYXBpXCI7XG5pbXBvcnQgeyBBcGlHYXRld2F5U3RhZ2UgfSBmcm9tIFwiLi4vLmdlbi9wcm92aWRlcnMvYXdzL2FwaS1nYXRld2F5LXN0YWdlXCI7XG5pbXBvcnQgeyBEYXRhQXdzVnBjRW5kcG9pbnRTZXJ2aWNlIH0gZnJvbSBcIi4uLy5nZW4vcHJvdmlkZXJzL2F3cy9kYXRhLWF3cy12cGMtZW5kcG9pbnQtc2VydmljZVwiO1xuaW1wb3J0IHsgTGFtYmRhUGVybWlzc2lvbiB9IGZyb20gXCIuLi8uZ2VuL3Byb3ZpZGVycy9hd3MvbGFtYmRhLXBlcm1pc3Npb25cIjtcbmltcG9ydCB7IFNlY3VyaXR5R3JvdXAgfSBmcm9tIFwiLi4vLmdlbi9wcm92aWRlcnMvYXdzL3NlY3VyaXR5LWdyb3VwXCI7XG5pbXBvcnQgeyBWcGNFbmRwb2ludCB9IGZyb20gXCIuLi8uZ2VuL3Byb3ZpZGVycy9hd3MvdnBjLWVuZHBvaW50XCI7XG5pbXBvcnQgKiBhcyBjbG91ZCBmcm9tIFwiLi4vY2xvdWRcIjtcbmltcG9ydCB7IE9wZW5BcGlTcGVjIH0gZnJvbSBcIi4uL2Nsb3VkXCI7XG5pbXBvcnQge1xuICBDYXNlQ29udmVudGlvbnMsXG4gIE5hbWVPcHRpb25zLFxuICBSZXNvdXJjZU5hbWVzLFxufSBmcm9tIFwiLi4vc2hhcmVkL3Jlc291cmNlLW5hbWVzXCI7XG5pbXBvcnQgeyBBcGlFbmRwb2ludEhhbmRsZXIsIElBd3NBcGksIFNUQUdFX05BTUUgfSBmcm9tIFwiLi4vc2hhcmVkLWF3c1wiO1xuaW1wb3J0IHsgY3JlYXRlQXBpRGVmYXVsdFJlc3BvbnNlIH0gZnJvbSBcIi4uL3NoYXJlZC1hd3MvYXBpLmRlZmF1bHRcIjtcbmltcG9ydCB7IElJbmZsaWdodEhvc3QsIE5vZGUgfSBmcm9tIFwiLi4vc3RkXCI7XG5cbi8qKlxuICogUmVzdEFwaSBuYW1lcyBhcmUgYWxwaGFudW1lcmljIGNoYXJhY3RlcnMsIGh5cGhlbnMgKC0pIGFuZCB1bmRlcnNjb3JlcyAoXykuXG4gKi9cbmNvbnN0IE5BTUVfT1BUUzogTmFtZU9wdGlvbnMgPSB7XG4gIGRpc2FsbG93ZWRSZWdleDogL1teYS16QS1aMC05XFxfXFwtXSsvZyxcbn07XG5cbi8qKlxuICogQVdTIEltcGxlbWVudGF0aW9uIG9mIGBjbG91ZC5BcGlgLlxuICovXG5leHBvcnQgY2xhc3MgQXBpIGV4dGVuZHMgY2xvdWQuQXBpIGltcGxlbWVudHMgSUF3c0FwaSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgYXBpOiBXaW5nUmVzdEFwaTtcbiAgcHJpdmF0ZSByZWFkb25seSBoYW5kbGVyczogUmVjb3JkPHN0cmluZywgRnVuY3Rpb24+ID0ge307XG4gIHByaXZhdGUgcmVhZG9ubHkgZW5kcG9pbnQ6IGNsb3VkLkVuZHBvaW50O1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBjbG91ZC5BcGlQcm9wcyA9IHt9KSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkLCBwcm9wcyk7XG4gICAgdGhpcy5hcGkgPSBuZXcgV2luZ1Jlc3RBcGkodGhpcywgXCJhcGlcIiwge1xuICAgICAgZ2V0QXBpU3BlYzogdGhpcy5fZ2V0T3BlbkFwaVNwZWMuYmluZCh0aGlzKSxcbiAgICAgIGNvcnM6IHRoaXMuY29yc09wdGlvbnMsXG4gICAgfSk7XG5cbiAgICB0aGlzLmVuZHBvaW50ID0gbmV3IGNsb3VkLkVuZHBvaW50KHRoaXMsIFwiRW5kcG9pbnRcIiwgdGhpcy5hcGkudXJsLCB7XG4gICAgICBsYWJlbDogYEFwaSAke3RoaXMubm9kZS5wYXRofWAsXG4gICAgfSk7XG5cbiAgICBOb2RlLm9mKHRoaXMuZW5kcG9pbnQpLmhpZGRlbiA9IHRydWU7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0IF9lbmRwb2ludCgpOiBjbG91ZC5FbmRwb2ludCB7XG4gICAgcmV0dXJuIHRoaXMuZW5kcG9pbnQ7XG4gIH1cblxuICAvKipcbiAgICogQnVpbGQgdGhlIGh0dHAgcmVxdWVzdHNcbiAgICpcbiAgICogQHBhcmFtIG1ldGhvZCBodHRwIG1ldGhvZFxuICAgKiBAcGFyYW0gcGF0aCBwYXRoIHRvIGFkZFxuICAgKiBAcGFyYW0gaW5mbGlnaHQgSW5mbGlnaHQgdG8gaGFuZGxlIHJlcXVlc3RcbiAgICogQHBhcmFtIHByb3BzIEFkZGl0aW9uYWwgcHJvcHNcbiAgICovXG4gIHByaXZhdGUgaHR0cFJlcXVlc3RzKFxuICAgIG1ldGhvZDogc3RyaW5nLFxuICAgIHBhdGg6IHN0cmluZyxcbiAgICBpbmZsaWdodDogY2xvdWQuSUFwaUVuZHBvaW50SGFuZGxlcixcbiAgICBwcm9wcz86IGNsb3VkLkFwaUVuZHBvaW50T3B0aW9uc1xuICApOiB2b2lkIHtcbiAgICBjb25zdCBsb3dlck1ldGhvZCA9IG1ldGhvZC50b0xvd2VyQ2FzZSgpO1xuICAgIGNvbnN0IHVwcGVyTWV0aG9kID0gbWV0aG9kLnRvVXBwZXJDYXNlKCk7XG5cbiAgICB0aGlzLl92YWxpZGF0ZVBhdGgocGF0aCk7XG5cbiAgICBjb25zdCBmbiA9IHRoaXMuYWRkSGFuZGxlcihpbmZsaWdodCwgbWV0aG9kLCBwYXRoLCBwcm9wcyk7XG4gICAgY29uc3QgYXBpU3BlY0VuZHBvaW50ID0gdGhpcy5hcGkuYWRkRW5kcG9pbnQocGF0aCwgdXBwZXJNZXRob2QsIGZuKTtcbiAgICB0aGlzLl9hZGRUb1NwZWMocGF0aCwgdXBwZXJNZXRob2QsIGFwaVNwZWNFbmRwb2ludCwgdGhpcy5jb3JzT3B0aW9ucyk7XG5cbiAgICBOb2RlLm9mKHRoaXMpLmFkZENvbm5lY3Rpb24oe1xuICAgICAgc291cmNlOiB0aGlzLFxuICAgICAgc291cmNlT3A6IGNsb3VkLkFwaUluZmxpZ2h0TWV0aG9kcy5SRVFVRVNULFxuICAgICAgdGFyZ2V0OiBmbixcbiAgICAgIHRhcmdldE9wOiBjbG91ZC5GdW5jdGlvbkluZmxpZ2h0TWV0aG9kcy5JTlZPS0UsXG4gICAgICBuYW1lOiBgJHtsb3dlck1ldGhvZH0oKWAsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGEgaW5mbGlnaHQgdG8gaGFuZGxlIEdFVCByZXF1ZXN0cyB0byBhIHBhdGguXG4gICAqIEBwYXJhbSBwYXRoIHBhdGggdG8gYWRkXG4gICAqIEBwYXJhbSBpbmZsaWdodCBJbmZsaWdodCB0byBoYW5kbGUgcmVxdWVzdFxuICAgKiBAcGFyYW0gcHJvcHMgQWRkaXRpb25hbCBwcm9wc1xuICAgKi9cbiAgcHVibGljIGdldChcbiAgICBwYXRoOiBzdHJpbmcsXG4gICAgaW5mbGlnaHQ6IGNsb3VkLklBcGlFbmRwb2ludEhhbmRsZXIsXG4gICAgcHJvcHM/OiBjbG91ZC5BcGlHZXRPcHRpb25zXG4gICk6IHZvaWQge1xuICAgIHRoaXMuaHR0cFJlcXVlc3RzKFwiR0VUXCIsIHBhdGgsIGluZmxpZ2h0LCBwcm9wcyk7XG4gIH1cbiAgLyoqXG4gICAqIEFkZCBhIGluZmxpZ2h0IHRvIGhhbmRsZSBQT1NUIHJlcXVlc3RzIHRvIGEgcGF0aC5cbiAgICogQHBhcmFtIHBhdGggcGF0aCB0byBhZGRcbiAgICogQHBhcmFtIGluZmxpZ2h0IEluZmxpZ2h0IHRvIGhhbmRsZSByZXF1ZXN0XG4gICAqIEBwYXJhbSBwcm9wcyBBZGRpdGlvbmFsIHByb3BzXG4gICAqL1xuICBwdWJsaWMgcG9zdChcbiAgICBwYXRoOiBzdHJpbmcsXG4gICAgaW5mbGlnaHQ6IGNsb3VkLklBcGlFbmRwb2ludEhhbmRsZXIsXG4gICAgcHJvcHM/OiBjbG91ZC5BcGlQb3N0T3B0aW9uc1xuICApOiB2b2lkIHtcbiAgICB0aGlzLmh0dHBSZXF1ZXN0cyhcIlBPU1RcIiwgcGF0aCwgaW5mbGlnaHQsIHByb3BzKTtcbiAgfVxuICAvKipcbiAgICogQWRkIGEgaW5mbGlnaHQgdG8gaGFuZGxlIFBVVCByZXF1ZXN0cyB0byBhIHBhdGguXG4gICAqIEBwYXJhbSBwYXRoIHBhdGggdG8gYWRkXG4gICAqIEBwYXJhbSBpbmZsaWdodCBJbmZsaWdodCB0byBoYW5kbGUgcmVxdWVzdFxuICAgKiBAcGFyYW0gcHJvcHMgQWRkaXRpb25hbCBwcm9wc1xuICAgKi9cbiAgcHVibGljIHB1dChcbiAgICBwYXRoOiBzdHJpbmcsXG4gICAgaW5mbGlnaHQ6IGNsb3VkLklBcGlFbmRwb2ludEhhbmRsZXIsXG4gICAgcHJvcHM/OiBjbG91ZC5BcGlQdXRPcHRpb25zXG4gICk6IHZvaWQge1xuICAgIHRoaXMuaHR0cFJlcXVlc3RzKFwiUFVUXCIsIHBhdGgsIGluZmxpZ2h0LCBwcm9wcyk7XG4gIH1cbiAgLyoqXG4gICAqIEFkZCBhIGluZmxpZ2h0IHRvIGhhbmRsZSBERUxFVEUgcmVxdWVzdHMgdG8gYSBwYXRoLlxuICAgKiBAcGFyYW0gcGF0aCBwYXRoIHRvIGFkZFxuICAgKiBAcGFyYW0gaW5mbGlnaHQgSW5mbGlnaHQgdG8gaGFuZGxlIHJlcXVlc3RcbiAgICogQHBhcmFtIHByb3BzIEFkZGl0aW9uYWwgcHJvcHNcbiAgICovXG4gIHB1YmxpYyBkZWxldGUoXG4gICAgcGF0aDogc3RyaW5nLFxuICAgIGluZmxpZ2h0OiBjbG91ZC5JQXBpRW5kcG9pbnRIYW5kbGVyLFxuICAgIHByb3BzPzogY2xvdWQuQXBpRGVsZXRlT3B0aW9uc1xuICApOiB2b2lkIHtcbiAgICB0aGlzLmh0dHBSZXF1ZXN0cyhcIkRFTEVURVwiLCBwYXRoLCBpbmZsaWdodCwgcHJvcHMpO1xuICB9XG4gIC8qKlxuICAgKiBBZGQgYSBpbmZsaWdodCB0byBoYW5kbGUgUEFUQ0ggcmVxdWVzdHMgdG8gYSBwYXRoLlxuICAgKiBAcGFyYW0gcGF0aCBwYXRoIHRvIGFkZFxuICAgKiBAcGFyYW0gaW5mbGlnaHQgSW5mbGlnaHQgdG8gaGFuZGxlIHJlcXVlc3RcbiAgICogQHBhcmFtIHByb3BzIEFkZGl0aW9uYWwgcHJvcHNcbiAgICovXG4gIHB1YmxpYyBwYXRjaChcbiAgICBwYXRoOiBzdHJpbmcsXG4gICAgaW5mbGlnaHQ6IGNsb3VkLklBcGlFbmRwb2ludEhhbmRsZXIsXG4gICAgcHJvcHM/OiBjbG91ZC5BcGlQYXRjaE9wdGlvbnNcbiAgKTogdm9pZCB7XG4gICAgdGhpcy5odHRwUmVxdWVzdHMoXCJQQVRDSFwiLCBwYXRoLCBpbmZsaWdodCwgcHJvcHMpO1xuICB9XG4gIC8qKlxuICAgKiBBZGQgYSBpbmZsaWdodCB0byBoYW5kbGUgT1BUSU9OUyByZXF1ZXN0cyB0byBhIHBhdGguXG4gICAqIEBwYXJhbSBwYXRoIHBhdGggdG8gYWRkXG4gICAqIEBwYXJhbSBpbmZsaWdodCBJbmZsaWdodCB0byBoYW5kbGUgcmVxdWVzdFxuICAgKiBAcGFyYW0gcHJvcHMgQWRkaXRpb25hbCBwcm9wc1xuICAgKi9cbiAgcHVibGljIG9wdGlvbnMoXG4gICAgcGF0aDogc3RyaW5nLFxuICAgIGluZmxpZ2h0OiBjbG91ZC5JQXBpRW5kcG9pbnRIYW5kbGVyLFxuICAgIHByb3BzPzogY2xvdWQuQXBpT3B0aW9uc09wdGlvbnNcbiAgKTogdm9pZCB7XG4gICAgdGhpcy5odHRwUmVxdWVzdHMoXCJPUFRJT05TXCIsIHBhdGgsIGluZmxpZ2h0LCBwcm9wcyk7XG4gIH1cbiAgLyoqXG4gICAqIEFkZCBhIGluZmxpZ2h0IHRvIGhhbmRsZSBIRUFEIHJlcXVlc3RzIHRvIGEgcGF0aC5cbiAgICogQHBhcmFtIHBhdGggcGF0aCB0byBhZGRcbiAgICogQHBhcmFtIGluZmxpZ2h0IEluZmxpZ2h0IHRvIGhhbmRsZSByZXF1ZXN0XG4gICAqIEBwYXJhbSBwcm9wcyBBZGRpdGlvbmFsIHByb3BzXG4gICAqL1xuICBwdWJsaWMgaGVhZChcbiAgICBwYXRoOiBzdHJpbmcsXG4gICAgaW5mbGlnaHQ6IGNsb3VkLklBcGlFbmRwb2ludEhhbmRsZXIsXG4gICAgcHJvcHM/OiBjbG91ZC5BcGlIZWFkT3B0aW9uc1xuICApOiB2b2lkIHtcbiAgICB0aGlzLmh0dHBSZXF1ZXN0cyhcIkhFQURcIiwgcGF0aCwgaW5mbGlnaHQsIHByb3BzKTtcbiAgfVxuICAvKipcbiAgICogQWRkIGEgaW5mbGlnaHQgdG8gaGFuZGxlIENPTk5FQ1QgcmVxdWVzdHMgdG8gYSBwYXRoLlxuICAgKiBAcGFyYW0gcGF0aCBwYXRoIHRvIGFkZFxuICAgKiBAcGFyYW0gaW5mbGlnaHQgSW5mbGlnaHQgdG8gaGFuZGxlIHJlcXVlc3RcbiAgICogQHBhcmFtIHByb3BzIEFkZGl0aW9uYWwgcHJvcHNcbiAgICovXG4gIHB1YmxpYyBjb25uZWN0KFxuICAgIHBhdGg6IHN0cmluZyxcbiAgICBpbmZsaWdodDogY2xvdWQuSUFwaUVuZHBvaW50SGFuZGxlcixcbiAgICBwcm9wcz86IGNsb3VkLkFwaUNvbm5lY3RPcHRpb25zXG4gICk6IHZvaWQge1xuICAgIHRoaXMuaHR0cFJlcXVlc3RzKFwiQ09OTkVDVFwiLCBwYXRoLCBpbmZsaWdodCwgcHJvcHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhIGluZmxpZ2h0IGhhbmRsZXIgdG8gdGhlIHN0YWNrXG4gICAqIEBwYXJhbSBpbmZsaWdodCBJbmZsaWdodCB0byBhZGQgdG8gdGhlIEFQSVxuICAgKiBAcGFyYW0gcHJvcHMgRW5kcG9pbnQgcHJvcHNcbiAgICogQHJldHVybnMgQVdTIExhbWJkYSBGdW5jdGlvblxuICAgKi9cbiAgcHJpdmF0ZSBhZGRIYW5kbGVyKFxuICAgIGluZmxpZ2h0OiBjbG91ZC5JQXBpRW5kcG9pbnRIYW5kbGVyLFxuICAgIG1ldGhvZDogc3RyaW5nLFxuICAgIHBhdGg6IHN0cmluZyxcbiAgICBwcm9wcz86IGNsb3VkLkFwaUVuZHBvaW50T3B0aW9uc1xuICApOiBGdW5jdGlvbiB7XG4gICAgbGV0IGZuID0gdGhpcy5hZGRJbmZsaWdodEhhbmRsZXIoaW5mbGlnaHQsIG1ldGhvZCwgcGF0aCwgcHJvcHMpO1xuICAgIGlmICghKGZuIGluc3RhbmNlb2YgRnVuY3Rpb24pKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBcGkgb25seSBzdXBwb3J0cyBjcmVhdGluZyB0ZmF3cy5GdW5jdGlvbiByaWdodCBub3dcIik7XG4gICAgfVxuICAgIHJldHVybiBmbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYW4gaW5mbGlnaHQgaGFuZGxlciB0byB0aGUgc3RhY2tcbiAgICogRW5zdXJlcyB0aGF0IHdlIGRvbid0IGNyZWF0ZSBkdXBsaWNhdGUgaW5mbGlnaHQgaGFuZGxlcnMuXG4gICAqIEBwYXJhbSBpbmZsaWdodCBJbmZsaWdodCB0byBhZGQgdG8gdGhlIEFQSVxuICAgKiBAcmV0dXJucyBJbmZsaWdodCBoYW5kbGVyIGFzIGEgQVdTIExhbWJkYSBGdW5jdGlvblxuICAgKi9cbiAgcHJpdmF0ZSBhZGRJbmZsaWdodEhhbmRsZXIoXG4gICAgaW5mbGlnaHQ6IGNsb3VkLklBcGlFbmRwb2ludEhhbmRsZXIsXG4gICAgbWV0aG9kOiBzdHJpbmcsXG4gICAgcGF0aDogc3RyaW5nLFxuICAgIHByb3BzPzogY2xvdWQuQXBpRW5kcG9pbnRPcHRpb25zXG4gICk6IEZ1bmN0aW9uIHtcbiAgICBsZXQgaGFuZGxlciA9IHRoaXMuaGFuZGxlcnNbaW5mbGlnaHQuX2lkXTtcbiAgICBpZiAoIWhhbmRsZXIpIHtcbiAgICAgIGNvbnN0IG5ld0luZmxpZ2h0ID0gQXBpRW5kcG9pbnRIYW5kbGVyLnRvRnVuY3Rpb25IYW5kbGVyKFxuICAgICAgICBpbmZsaWdodCxcbiAgICAgICAgY2xvdWQuQXBpLnJlbmRlckNvcnNIZWFkZXJzKHRoaXMuY29yc09wdGlvbnMpPy5kZWZhdWx0UmVzcG9uc2VcbiAgICAgICk7XG4gICAgICBjb25zdCBwcmVmaXggPSBgJHttZXRob2QudG9Mb3dlckNhc2UoKX0ke3BhdGgucmVwbGFjZSgvXFwvL2csIFwiX1wiKX1gO1xuICAgICAgaGFuZGxlciA9IG5ldyBGdW5jdGlvbihcbiAgICAgICAgdGhpcyxcbiAgICAgICAgQXBwLm9mKHRoaXMpLm1ha2VJZCh0aGlzLCBwcmVmaXgpLFxuICAgICAgICBuZXdJbmZsaWdodCxcbiAgICAgICAgcHJvcHNcbiAgICAgICk7XG4gICAgICBOb2RlLm9mKGhhbmRsZXIpLmhpZGRlbiA9IHRydWU7XG4gICAgICB0aGlzLmhhbmRsZXJzW2luZmxpZ2h0Ll9pZF0gPSBoYW5kbGVyO1xuICAgIH1cblxuICAgIHJldHVybiBoYW5kbGVyO1xuICB9XG5cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBwdWJsaWMgb25MaWZ0KGhvc3Q6IElJbmZsaWdodEhvc3QsIG9wczogc3RyaW5nW10pOiB2b2lkIHtcbiAgICBob3N0LmFkZEVudmlyb25tZW50KHRoaXMudXJsRW52TmFtZSgpLCB0aGlzLnVybCk7XG4gICAgc3VwZXIub25MaWZ0KGhvc3QsIG9wcyk7XG4gIH1cblxuICAvKiogQGludGVybmFsICovXG4gIHB1YmxpYyBfdG9JbmZsaWdodCgpOiBzdHJpbmcge1xuICAgIHJldHVybiBjb3JlLkluZmxpZ2h0Q2xpZW50LmZvcihcbiAgICAgIF9fZGlybmFtZS5yZXBsYWNlKFwidGFyZ2V0LXRmLWF3c1wiLCBcInNoYXJlZC1hd3NcIiksXG4gICAgICBfX2ZpbGVuYW1lLFxuICAgICAgXCJBcGlDbGllbnRcIixcbiAgICAgIFtgcHJvY2Vzcy5lbnZbXCIke3RoaXMudXJsRW52TmFtZSgpfVwiXWBdXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgdXJsRW52TmFtZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiBSZXNvdXJjZU5hbWVzLmdlbmVyYXRlTmFtZSh0aGlzLCB7XG4gICAgICBkaXNhbGxvd2VkUmVnZXg6IC9bXmEtekEtWjAtOV9dLyxcbiAgICAgIHNlcDogXCJfXCIsXG4gICAgICBjYXNlOiBDYXNlQ29udmVudGlvbnMuVVBQRVJDQVNFLFxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGdldCByZXN0QXBpQXJuKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuYXBpLmFwaS5leGVjdXRpb25Bcm47XG4gIH1cblxuICBwdWJsaWMgZ2V0IHJlc3RBcGlJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmFwaS5hcGkuaWQ7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHJlc3RBcGlOYW1lKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuYXBpLmFwaS5uYW1lO1xuICB9XG5cbiAgcHVibGljIGdldCBzdGFnZU5hbWUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5hcGkuc3RhZ2Uuc3RhZ2VOYW1lO1xuICB9XG5cbiAgcHVibGljIGdldCBpbnZva2VVcmwoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5hcGkuc3RhZ2UuaW52b2tlVXJsO1xuICB9XG5cbiAgcHVibGljIGdldCBkZXBsb3ltZW50SWQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5hcGkuZGVwbG95bWVudC5pZDtcbiAgfVxufVxuXG4vKipcbiAqIEVuY2Fwc3VsYXRlcyB0aGUgQVBJIEdhdGV3YXkgUkVTVCBBUEkgYXMgYW4gYWJzdHJhY3Rpb24gZm9yIFRlcnJhZm9ybS5cbiAqL1xuY2xhc3MgV2luZ1Jlc3RBcGkgZXh0ZW5kcyBDb25zdHJ1Y3Qge1xuICBwcml2YXRlIHJlYWRvbmx5IGlkOiBzdHJpbmc7XG4gIHByaXZhdGUgcmVhZG9ubHkgcmVnaW9uOiBzdHJpbmc7XG4gIHByaXZhdGUgcmVhZG9ubHkgYWNjb3VudElkOiBzdHJpbmc7XG4gIHB1YmxpYyByZWFkb25seSB1cmw6IHN0cmluZztcbiAgcHVibGljIHJlYWRvbmx5IGFwaTogQXBpR2F0ZXdheVJlc3RBcGk7XG4gIHB1YmxpYyByZWFkb25seSBzdGFnZTogQXBpR2F0ZXdheVN0YWdlO1xuICBwdWJsaWMgcmVhZG9ubHkgZGVwbG95bWVudDogQXBpR2F0ZXdheURlcGxveW1lbnQ7XG4gIHB1YmxpYyByZWFkb25seSBwcml2YXRlVnBjOiBib29sZWFuID0gZmFsc2U7XG4gIHB1YmxpYyByZWFkb25seSBzZWN1cml0eUdyb3VwPzogU2VjdXJpdHlHcm91cDtcbiAgcHVibGljIHJlYWRvbmx5IHZwY0VuZHBvaW50PzogVnBjRW5kcG9pbnQ7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgc2NvcGU6IENvbnN0cnVjdCxcbiAgICBpZDogc3RyaW5nLFxuICAgIHByb3BzOiB7XG4gICAgICBnZXRBcGlTcGVjOiAoKSA9PiBPcGVuQXBpU3BlYztcbiAgICAgIGNvcnM/OiBjbG91ZC5BcGlDb3JzT3B0aW9ucztcbiAgICB9XG4gICkge1xuICAgIHN1cGVyKHNjb3BlLCBpZCk7XG4gICAgY29uc3QgYXBwID0gQXBwLm9mKHRoaXMpIGFzIEFwcDtcbiAgICB0aGlzLmlkID0gaWQ7XG4gICAgdGhpcy5yZWdpb24gPSBhcHAucmVnaW9uO1xuICAgIHRoaXMuYWNjb3VudElkID0gYXBwLmFjY291bnRJZDtcblxuICAgIC8vIENoZWNrIGZvciBQUklWQVRFIEFQSSBHYXRld2F5IGNvbmZpZ3VyYXRpb25cbiAgICBsZXQgcHJpdmF0ZUFwaUdhdGV3YXkgPSBhcHAucGFyYW1ldGVycy52YWx1ZShcInRmLWF3cy92cGNfYXBpX2dhdGV3YXlcIik7XG4gICAgaWYgKHByaXZhdGVBcGlHYXRld2F5ID09PSB0cnVlKSB7XG4gICAgICB0aGlzLnByaXZhdGVWcGMgPSB0cnVlO1xuICAgICAgY29uc3QgdnBjUmVzb3VyY2VzID0gdGhpcy5faW5pdFZwY1Jlc291cmNlcyhhcHApO1xuICAgICAgdGhpcy5zZWN1cml0eUdyb3VwID0gdnBjUmVzb3VyY2VzLnNlY3VyaXR5R3JvdXA7XG4gICAgICB0aGlzLnZwY0VuZHBvaW50ID0gdnBjUmVzb3VyY2VzLnZwY0VuZHBvaW50O1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSB0aGUgQVBJIEdhdGV3YXkgYW5kIGNvbmZpZ3VyZSBpdFxuICAgIHRoaXMuYXBpID0gdGhpcy5faW5pdEFwaUdhdGV3YXlSZXN0QXBpKGlkLCBwcm9wcyk7XG4gICAgdGhpcy5kZXBsb3ltZW50ID0gdGhpcy5faW5pdEFwaUdhdGV3YXlEZXBsb3ltZW50KCk7XG4gICAgdGhpcy5zdGFnZSA9IHRoaXMuX2luaXRBcGlHYXRld2F5U3RhZ2UoKTtcblxuICAgIC8vIENvbnN0cnVjdCB0aGUgVVJMIGZvciB0aGUgZGVwbG95ZWQgQVBJIEdhdGV3YXkgc3RhZ2VcbiAgICB0aGlzLnVybCA9IHRoaXMuX2NvbnN0cnVjdEludm9rZVVybCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBfaW5pdFZwY1Jlc291cmNlcyhhcHA6IEFwcCk6IHtcbiAgICBzZWN1cml0eUdyb3VwOiBTZWN1cml0eUdyb3VwO1xuICAgIHZwY0VuZHBvaW50OiBWcGNFbmRwb2ludDtcbiAgfSB7XG4gICAgY29uc3QgdnBjSWQ6IHN0cmluZyA9IGFwcC52cGMuaWQ7XG4gICAgY29uc3Qgc3VibmV0SWRzOiBzdHJpbmdbXSA9IFsuLi5hcHAuc3VibmV0cy5wcml2YXRlLm1hcCgocykgPT4gcy5pZCldO1xuXG4gICAgY29uc3Qgc2VjdXJpdHlHcm91cCA9IG5ldyBTZWN1cml0eUdyb3VwKHRoaXMsIGAke3RoaXMuaWR9U2VjdXJpdHlHcm91cGAsIHtcbiAgICAgIHZwY0lkOiB2cGNJZCxcbiAgICAgIGluZ3Jlc3M6IFtcbiAgICAgICAge1xuICAgICAgICAgIGNpZHJCbG9ja3M6IFtcIjAuMC4wLjAvMFwiXSxcbiAgICAgICAgICBmcm9tUG9ydDogMCxcbiAgICAgICAgICB0b1BvcnQ6IDAsXG4gICAgICAgICAgcHJvdG9jb2w6IFwiLTFcIixcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBzZXJ2aWNlID0gbmV3IERhdGFBd3NWcGNFbmRwb2ludFNlcnZpY2UoXG4gICAgICB0aGlzLFxuICAgICAgYCR7dGhpcy5pZH1TZXJ2aWNlTG9va3VwYCxcbiAgICAgIHtcbiAgICAgICAgc2VydmljZTogXCJleGVjdXRlLWFwaVwiLFxuICAgICAgfVxuICAgICk7XG5cbiAgICBjb25zdCB2cGNFbmRwb2ludCA9IG5ldyBWcGNFbmRwb2ludCh0aGlzLCBgJHt0aGlzLmlkfS12cGMtZW5kcG9pbnRgLCB7XG4gICAgICB2cGNJZDogdnBjSWQsXG4gICAgICBzZXJ2aWNlTmFtZTogc2VydmljZS5zZXJ2aWNlTmFtZSxcbiAgICAgIHByaXZhdGVEbnNFbmFibGVkOiB0cnVlLFxuICAgICAgdnBjRW5kcG9pbnRUeXBlOiBcIkludGVyZmFjZVwiLFxuICAgICAgc3VibmV0SWRzOiBzdWJuZXRJZHMsXG4gICAgICBzZWN1cml0eUdyb3VwSWRzOiBbc2VjdXJpdHlHcm91cC5pZF0sXG4gICAgfSk7XG5cbiAgICByZXR1cm4geyBzZWN1cml0eUdyb3VwLCB2cGNFbmRwb2ludCB9O1xuICB9XG5cbiAgcHJpdmF0ZSBfaW5pdEFwaUdhdGV3YXlSZXN0QXBpKFxuICAgIGlkOiBzdHJpbmcsXG4gICAgcHJvcHM6IHtcbiAgICAgIGdldEFwaVNwZWM6ICgpID0+IE9wZW5BcGlTcGVjO1xuICAgICAgY29ycz86IGNsb3VkLkFwaUNvcnNPcHRpb25zO1xuICAgIH1cbiAgKTogQXBpR2F0ZXdheVJlc3RBcGkge1xuICAgIC8qKlxuICAgICAqIENvbmZpZ3VyZXMgdGhlIGRlZmF1bHQgcmVzcG9uc2UgZm9yIHJlcXVlc3RzIHRvIHVuZGVmaW5lZCByb3V0ZXMgKGAve3Byb3h5K31gKS5cbiAgICAgKiAtIElmIENPUlMgb3B0aW9ucyBhcmUgZGVmaW5lZCwgYGRlZmF1bHRSZXNwb25zZWAgc2V0cyB1cCBDT1JTLWNvbXBsaWFudCBtb2NrIHJlc3BvbnNlczpcbiAgICAgKiAgIC0gMjA0IChObyBDb250ZW50KSBmb3IgT1BUSU9OUyByZXF1ZXN0cy5cbiAgICAgKiAgIC0gNDA0IChOb3QgRm91bmQpIGZvciBvdGhlciBIVFRQIG1ldGhvZHMuXG4gICAgICogLSBJZiBDT1JTIG9wdGlvbnMgYXJlIHVuZGVmaW5lZCwgYGRlZmF1bHRSZXNwb25zZWAgc2V0IHVwIGEgbW9jayA0MDQgcmVzcG9uc2UgZm9yIGFueSBIVFRQIG1ldGhvZC5cbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIEJBU0lDIEFQSSBHYXRld2F5IHByb3BlcnRpZXNcbiAgICAgKi9cbiAgICBsZXQgYXBpUHJvcHM6IGFueSA9IHtcbiAgICAgIG5hbWU6IFJlc291cmNlTmFtZXMuZ2VuZXJhdGVOYW1lKHRoaXMsIE5BTUVfT1BUUyksXG4gICAgICBsaWZlY3ljbGU6IHsgY3JlYXRlQmVmb3JlRGVzdHJveTogdHJ1ZSB9LFxuXG4gICAgICAvLyBMYXp5IGdlbmVyYXRpb24gb2YgdGhlIGFwaSBzcGVjIGJlY2F1c2Ugcm91dGVzIGNhbiBiZSBhZGRlZCBhZnRlciB0aGUgQVBJIGlzIGNyZWF0ZWRcbiAgICAgIGJvZHk6IExhenkuc3RyaW5nVmFsdWUoe1xuICAgICAgICBwcm9kdWNlOiAoKSA9PiB7XG4gICAgICAgICAgLy8gUmV0cmlldmVzIHRoZSBBUEkgc3BlY2lmaWNhdGlvbi5cbiAgICAgICAgICBjb25zdCBhcGlTcGVjID0gcHJvcHMuZ2V0QXBpU3BlYygpO1xuICAgICAgICAgIGNvbnN0IGRlZmF1bHRSZXNwb25zZSA9IGNyZWF0ZUFwaURlZmF1bHRSZXNwb25zZShcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKGFwaVNwZWMucGF0aHMpLFxuICAgICAgICAgICAgcHJvcHMuY29yc1xuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyBNZXJnZXMgdGhlIHNwZWNpZmljYXRpb24gd2l0aCBgZGVmYXVsdFJlc3BvbnNlYCB0byBoYW5kbGUgcmVxdWVzdHMgdG8gdW5kZWZpbmVkIHJvdXRlcyAoYC97cHJveHkrfWApLlxuICAgICAgICAgIC8vIFRoaXMgaW50ZWdyYXRpb24gZW5zdXJlcyBjb21wcmVoZW5zaXZlIHJvdXRlIGhhbmRsaW5nOlxuICAgICAgICAgIC8vIC0gUHJlZGVmaW5lZCBwYXRocyBhcmUgbWFpbnRhaW5lZCBhcyBzcGVjaWZpZWQuXG4gICAgICAgICAgLy8gLSBSZXF1ZXN0cyB0byBwYXRocyBub3QgZXhwbGljaXRseSBkZWZpbmVkIGFyZSBtYW5hZ2VkIGJ5IGBkZWZhdWx0UmVzcG9uc2VgLlxuICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAuLi5hcGlTcGVjLFxuICAgICAgICAgICAgcGF0aHM6IHsgLi4uYXBpU3BlYy5wYXRocywgLi4uZGVmYXVsdFJlc3BvbnNlIH0sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICB9KSxcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogUFJJVkFURSBBUEkgR2F0ZXdheSBwcm9wZXJ0aWVzXG4gICAgICovXG4gICAgaWYgKHRoaXMucHJpdmF0ZVZwYyAmJiB0aGlzLnZwY0VuZHBvaW50KSB7XG4gICAgICBhcGlQcm9wcy5lbmRwb2ludENvbmZpZ3VyYXRpb24gPSB7XG4gICAgICAgIHR5cGVzOiBbXCJQUklWQVRFXCJdLFxuICAgICAgICB2cGNFbmRwb2ludElkczogW3RoaXMudnBjRW5kcG9pbnQuaWRdLFxuICAgICAgfTtcblxuICAgICAgLy8gVGhpcyBwb2xpY3kgd2lsbCBleHBsaWNpdGx5IGRlbnkgYWxsIHJlcXVlc3RzIHRoYXQgZG9uJ3QgY29tZSBmcm9tIHRoZSBWUEMgZW5kcG9pbnRcbiAgICAgIC8vIHdoaWNoIG1lYW5zIG9ubHkgcmVxdWVzdHMgdGhhdCBjb21lIGZyb20gdGhlIHNhbWUgdnBjIG9uIHRoZSBzYW1lIHByaXZhdGUgc3VibmV0IGFuZCBzZWN1cml0eSBncm91cFxuICAgICAgLy8gd2lsbCBiZSBhbGxvd2VkIHRvIGFjY2VzcyB0aGUgQVBJIEdhdGV3YXlcbiAgICAgIGFwaVByb3BzLnBvbGljeSA9IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgVmVyc2lvbjogXCIyMDEyLTEwLTE3XCIsXG4gICAgICAgIFN0YXRlbWVudDogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIEVmZmVjdDogXCJBbGxvd1wiLFxuICAgICAgICAgICAgUHJpbmNpcGFsOiBcIipcIixcbiAgICAgICAgICAgIEFjdGlvbjogXCJleGVjdXRlLWFwaTpJbnZva2VcIixcbiAgICAgICAgICAgIFJlc291cmNlOiBbXCIqXCJdLFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgRWZmZWN0OiBcIkRlbnlcIixcbiAgICAgICAgICAgIFByaW5jaXBhbDogXCIqXCIsXG4gICAgICAgICAgICBBY3Rpb246IFwiZXhlY3V0ZS1hcGk6SW52b2tlXCIsXG4gICAgICAgICAgICBSZXNvdXJjZTogW1wiKlwiXSxcbiAgICAgICAgICAgIENvbmRpdGlvbjoge1xuICAgICAgICAgICAgICBTdHJpbmdOb3RFcXVhbHM6IHtcbiAgICAgICAgICAgICAgICBcImF3czpzb3VyY2VWcGNlXCI6IHRoaXMudnBjRW5kcG9pbnQuaWQsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IEFwaUdhdGV3YXlSZXN0QXBpKHRoaXMsIGlkLCBhcGlQcm9wcyk7XG4gIH1cblxuICBwcml2YXRlIF9pbml0QXBpR2F0ZXdheURlcGxveW1lbnQoKTogQXBpR2F0ZXdheURlcGxveW1lbnQge1xuICAgIHJldHVybiBuZXcgQXBpR2F0ZXdheURlcGxveW1lbnQodGhpcywgXCJkZXBsb3ltZW50XCIsIHtcbiAgICAgIHJlc3RBcGlJZDogdGhpcy5hcGkuaWQsXG4gICAgICBsaWZlY3ljbGU6IHsgY3JlYXRlQmVmb3JlRGVzdHJveTogdHJ1ZSB9LFxuICAgICAgLy8gVHJpZ2dlciByZWRlcGxveW1lbnQgd2hlbiB0aGUgYXBpIHNwZWMgY2hhbmdlc1xuICAgICAgdHJpZ2dlcnM6IHsgcmVkZXBsb3ltZW50OiBGbi5zaGEyNTYodGhpcy5hcGkuYm9keSkgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgX2luaXRBcGlHYXRld2F5U3RhZ2UoKTogQXBpR2F0ZXdheVN0YWdlIHtcbiAgICByZXR1cm4gbmV3IEFwaUdhdGV3YXlTdGFnZSh0aGlzLCBcInN0YWdlXCIsIHtcbiAgICAgIHJlc3RBcGlJZDogdGhpcy5hcGkuaWQsXG4gICAgICBzdGFnZU5hbWU6IFNUQUdFX05BTUUsXG4gICAgICBkZXBsb3ltZW50SWQ6IHRoaXMuZGVwbG95bWVudC5pZCxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIEludGVudGlvbmFsbHkgbm90IHVzaW5nIGB0aGlzLnN0YWdlLmludm9rZVVybGAsIGl0IGxvb2tzIGxpa2UgaXQncyBzaGFyZWQgd2l0aFxuICAvLyB0aGUgYGludm9rZVVybGAgZnJvbSB0aGUgYXBpIGRlcGxveW1lbnQsIHdoaWNoIGdldHMgcmVjcmVhdGVkIG9uIGV2ZXJ5IGRlcGxveW1lbnQuXG4gIC8vIFdoZW4gdGhpcyBgaW52b2tlVXJsYCBpcyByZWZlcmVuY2VkIHNvbWV3aGVyZSBlbHNlIGluIHRoZSBzdGFjaywgaXQgY2FuIGNhdXNlIGN5Y2xpYyBkZXBlbmRlbmNpZXNcbiAgLy8gaW4gVGVycmFmb3JtLiBIZW5jZSwgd2UncmUgY3JlYXRpbmcgb3VyIG93biB1cmwgaGVyZS5cbiAgcHJpdmF0ZSBfY29uc3RydWN0SW52b2tlVXJsKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBodHRwczovLyR7dGhpcy5hcGkuaWR9LmV4ZWN1dGUtYXBpLiR7dGhpcy5yZWdpb259LmFtYXpvbmF3cy5jb20vJHt0aGlzLnN0YWdlLnN0YWdlTmFtZX1gO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhbiBlbmRwb2ludCB0byB0aGUgQVBJXG4gICAqIEBwYXJhbSBwYXRoIFBhdGggb2YgdGhlIGVuZHBvaW50XG4gICAqIEBwYXJhbSBtZXRob2QgTWV0aG9kIG9mIHRoZSBlbmRwb2ludFxuICAgKiBAcGFyYW0gaGFuZGxlciBMYW1iZGEgZnVuY3Rpb24gdG8gaGFuZGxlIHRoZSBlbmRwb2ludFxuICAgKiBAcmV0dXJucyBPcGVuQXBpIHNwZWMgZXh0ZW5zaW9uIGZvciB0aGUgZW5kcG9pbnRcbiAgICovXG4gIHB1YmxpYyBhZGRFbmRwb2ludChwYXRoOiBzdHJpbmcsIG1ldGhvZDogc3RyaW5nLCBoYW5kbGVyOiBGdW5jdGlvbikge1xuICAgIGNvbnN0IGVuZHBvaW50RXh0ZW5zaW9uID0gdGhpcy5fY3JlYXRlQXBpU3BlY0V4dGVuc2lvbihoYW5kbGVyKTtcbiAgICB0aGlzLl9hZGRIYW5kbGVyUGVybWlzc2lvbnMocGF0aCwgbWV0aG9kLCBoYW5kbGVyKTtcbiAgICByZXR1cm4gZW5kcG9pbnRFeHRlbnNpb247XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIE9wZW5BcGkgZXh0ZW5zaW9uIG9iamVjdCBmb3IgdGhlIGVuZHBvaW50IGFuZCBoYW5kbGVyXG4gICAqIEBwYXJhbSBoYW5kbGVyIExhbWJkYSBmdW5jdGlvbiB0byBoYW5kbGUgdGhlIGVuZHBvaW50XG4gICAqIEByZXR1cm5zIE9wZW5BcGkgZXh0ZW5zaW9uIG9iamVjdCBmb3IgdGhlIGVuZHBvaW50IGFuZCBoYW5kbGVyXG4gICAqL1xuICBwcml2YXRlIF9jcmVhdGVBcGlTcGVjRXh0ZW5zaW9uKGhhbmRsZXI6IEZ1bmN0aW9uKSB7XG4gICAgLy8gVGhlIEFSTiBvZiB0aGUgTGFtYmRhIGZ1bmN0aW9uIGlzIGNvbnN0cnVjdGVkIGJ5IGhhbmQgc28gdGhhdCBpdCBjYW4gYmUgY2FsY3VsYXRlZFxuICAgIC8vIGR1cmluZyBwcmVmbGlnaHQsIGluc3RlYWQgb2YgYmVpbmcgcmVzb2x2ZWQgYXQgZGVwbG95IHRpbWUuXG4gICAgLy9cbiAgICAvLyBCeSBkb2luZyB0aGlzLCB0aGUgQVBJIEdhdGV3YXkgZG9lcyBub3QgbmVlZCB0byB0YWtlIGEgZGVwZW5kZW5jeSBvbiBpdHMgTGFtYmRhIGZ1bmN0aW9ucyxcbiAgICAvLyBtYWtpbmcgaXQgcG9zc2libGUgdG8gd3JpdGUgTGFtYmRhIGZ1bmN0aW9ucyB0aGF0IHJlZmVyZW5jZSB0aGVcbiAgICAvLyBBUEkgR2F0ZXdheSdzIFVSTCBpbiB0aGVpciBpbmZsaWdodCBjb2RlLlxuICAgIGNvbnN0IGZ1bmN0aW9uQXJuID0gYGFybjphd3M6bGFtYmRhOiR7dGhpcy5yZWdpb259OiR7dGhpcy5hY2NvdW50SWR9OmZ1bmN0aW9uOiR7aGFuZGxlci5uYW1lfWA7XG5cbiAgICBjb25zdCBleHRlbnNpb24gPSB7XG4gICAgICBcIngtYW1hem9uLWFwaWdhdGV3YXktaW50ZWdyYXRpb25cIjoge1xuICAgICAgICB1cmk6IGBhcm46YXdzOmFwaWdhdGV3YXk6JHt0aGlzLnJlZ2lvbn06bGFtYmRhOnBhdGgvMjAxNS0wMy0zMS9mdW5jdGlvbnMvJHtmdW5jdGlvbkFybn0vaW52b2NhdGlvbnNgLFxuICAgICAgICB0eXBlOiBcImF3c19wcm94eVwiLFxuICAgICAgICBodHRwTWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICAgc3RhdHVzQ29kZTogXCIyMDBcIixcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBwYXNzdGhyb3VnaEJlaGF2aW9yOiBcIndoZW5fbm9fbWF0Y2hcIixcbiAgICAgICAgY29udGVudEhhbmRsaW5nOiBcIkNPTlZFUlRfVE9fVEVYVFwiLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgcmV0dXJuIGV4dGVuc2lvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgcGVybWlzc2lvbnMgdG8gdGhlIGhhbmRsZXIgdG8gYWxsb3cgaXQgdG8gYmUgY2FsbGVkIGJ5IHRoZSBBUElcbiAgICogQHBhcmFtIHBhdGggUGF0aCBvZiB0aGUgZW5kcG9pbnRcbiAgICogQHBhcmFtIG1ldGhvZCBNZXRob2Qgb2YgdGhlIGVuZHBvaW50XG4gICAqIEBwYXJhbSBoYW5kbGVyIExhbWJkYSBmdW5jdGlvbiB0byBoYW5kbGUgdGhlIGVuZHBvaW50XG4gICAqL1xuICBwcml2YXRlIF9hZGRIYW5kbGVyUGVybWlzc2lvbnMgPSAoXG4gICAgcGF0aDogc3RyaW5nLFxuICAgIG1ldGhvZDogc3RyaW5nLFxuICAgIGhhbmRsZXI6IEZ1bmN0aW9uXG4gICkgPT4ge1xuICAgIGNvbnN0IHBhdGhIYXNoID0gY3JlYXRlSGFzaChcInNoYTFcIikudXBkYXRlKHBhdGgpLmRpZ2VzdChcImhleFwiKS5zbGljZSgtOCk7XG4gICAgY29uc3QgcGVybWlzc2lvbklkID0gYCR7bWV0aG9kfS0ke3BhdGhIYXNofWA7XG4gICAgbmV3IExhbWJkYVBlcm1pc3Npb24odGhpcywgYHBlcm1pc3Npb24tJHtwZXJtaXNzaW9uSWR9YCwge1xuICAgICAgc3RhdGVtZW50SWQ6IGBBbGxvd0V4ZWN1dGlvbkZyb21BUElHYXRld2F5LSR7cGVybWlzc2lvbklkfWAsXG4gICAgICBhY3Rpb246IFwibGFtYmRhOkludm9rZUZ1bmN0aW9uXCIsXG4gICAgICBmdW5jdGlvbk5hbWU6IGhhbmRsZXIuZnVuY3Rpb25OYW1lLFxuICAgICAgcHJpbmNpcGFsOiBcImFwaWdhdGV3YXkuYW1hem9uYXdzLmNvbVwiLFxuICAgICAgc291cmNlQXJuOiBgJHt0aGlzLmFwaS5leGVjdXRpb25Bcm59LyovJHttZXRob2R9JHtBcGkucmVuZGVyT3BlbkFwaVBhdGgoXG4gICAgICAgIHBhdGhcbiAgICAgICl9YCxcbiAgICB9KTtcbiAgfTtcbn1cbiJdfQ==