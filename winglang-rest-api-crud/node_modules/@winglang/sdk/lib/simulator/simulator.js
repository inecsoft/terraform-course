"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.UpdatePlan = exports.Simulator = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const fs_1 = require("fs");
const promises_1 = require("fs/promises");
const path_1 = require("path");
const client_1 = require("./client");
const graph_1 = require("./graph");
const serialization_1 = require("./serialization");
const tokens_1 = require("./tokens");
const tree_1 = require("./tree");
const util_1 = require("./util");
const constants_1 = require("../constants");
const core_1 = require("../core");
const misc_1 = require("../shared/misc");
const std_1 = require("../std");
const target_sim_1 = require("../target-sim");
const LOCALHOST_ADDRESS = "127.0.0.1";
const HANDLE_ATTRIBUTE = "handle";
/**
 * If an API call is made to a resource with name as the caller, any permissions
 * checking will be skipped. Used by unit tests and the Wing Console.
 */
const ADMIN_PERMISSION = "admin";
/**
 * A simulator that can be used to test your application locally.
 */
class Simulator {
    constructor(props) {
        // keeps the actual resolved state (props and attrs) of all started resources. this state is
        // merged in when calling `getResourceConfig()`.
        this.state = {};
        const simdir = (0, path_1.resolve)(props.simfile);
        this.statedir = props.stateDir ?? (0, path_1.join)(simdir, ".state");
        this._model = this._loadApp(simdir);
        this._running = "stopped";
        this._handles = new HandleManager();
        this._policyRegistry = new PolicyRegistry();
        this._traces = new Array();
        this._traceSubscribers = new Array();
    }
    _loadApp(simdir) {
        const simJson = (0, path_1.join)(simdir, "simulator.json");
        if (!(0, fs_1.existsSync)(simJson)) {
            throw new Error(`Invalid Wing app (${simdir}) - simulator.json not found.`);
        }
        const schema = (0, misc_1.readJsonSync)(simJson);
        const foundVersion = schema.sdkVersion ?? "unknown";
        const expectedVersion = constants_1.SDK_VERSION;
        if (foundVersion !== expectedVersion) {
            console.error(`WARNING: The simulator directory (${simdir}) was generated with Wing SDK v${foundVersion} but it is being simulated with Wing SDK v${expectedVersion}.`);
        }
        if (schema.resources === undefined) {
            throw new Error(`Incompatible .wsim file. The simulator directory (${simdir}) was generated with Wing SDK v${foundVersion} but it is being simulated with Wing SDK v${expectedVersion}.`);
        }
        const treeJson = (0, path_1.join)(simdir, core_1.TREE_FILE_PATH);
        if (!(0, fs_1.existsSync)(treeJson)) {
            throw new Error(`Invalid Wing app (${simdir}) - ${core_1.TREE_FILE_PATH} not found.`);
        }
        const tree = new tree_1.Tree((0, misc_1.readJsonSync)(treeJson));
        const connectionJson = (0, path_1.join)(simdir, std_1.CONNECTIONS_FILE_PATH);
        if (!(0, fs_1.existsSync)(connectionJson)) {
            throw new Error(`Invalid Wing app (${simdir}) - ${std_1.CONNECTIONS_FILE_PATH} not found.`);
        }
        const connections = (0, misc_1.readJsonSync)(connectionJson).connections;
        const graph = new graph_1.Graph(Object.values(schema.resources));
        return { schema, tree, connections, simdir, graph };
    }
    /**
     * Start the simulator.
     */
    async start() {
        if (this._running !== "stopped") {
            throw new Error("A simulation is already running. Did you mean to call `await simulator.stop()` first?");
        }
        this._running = "starting";
        await this.startServer();
        try {
            await this.startResources();
        }
        catch (err) {
            this.stopServer();
            this._running = "stopped";
            throw err;
        }
    }
    async startResources() {
        const retries = {};
        const queue = this._model.graph.nodes.map((n) => n.path);
        const failed = [];
        while (queue.length > 0) {
            const top = queue.shift();
            try {
                await this.startResource(top);
            }
            catch (e) {
                if (e instanceof UnresolvedTokenError) {
                    retries[top] = (retries[top] ?? 0) + 1;
                    if (retries[top] < 10) {
                        queue.push(top);
                        continue;
                    }
                    else {
                        failed.push(top);
                    }
                }
                this.addSimulatorTrace(top, { message: e.message }, std_1.LogLevel.ERROR);
            }
        }
        // mark as "running" so that we can stop the simulation if needed
        this._running = "running";
        // since some resources failed to start, we are going to stop all resources that were started
        if (failed.length > 0) {
            await this.stop();
            throw new Error(`Failed to start resources: ${failed.map((r) => `"${r}"`).join(", ")}`);
        }
    }
    /**
     * Updates the running simulation with a new version of the app. This will create/update/delete
     * resources as necessary to get to the desired state.
     * @param simDir The path to the new version of the app
     */
    async update(simDir) {
        const newModel = this._loadApp(simDir);
        const plan = await this.planUpdate(this._model.schema.resources, newModel.schema.resources);
        this.addTrace({
            type: std_1.TraceType.SIMULATOR,
            data: {
                message: `Update: ${plan.added.length} added, ${plan.updated.length} updated, ${plan.deleted.length} deleted`,
                update: plan,
            },
            sourcePath: "root",
            sourceType: "Simulator",
            level: std_1.LogLevel.VERBOSE,
            timestamp: new Date().toISOString(),
        });
        // stop all *deleted* and *updated* resources
        for (const c of [...plan.deleted, ...plan.updated]) {
            await this.stopResource(c); // <-- this also stops all dependent resources if needed
        }
        // now update the internal model to the new version
        this._model = newModel;
        // start all *added* and *updated* resources (the updated model basically includes only these)
        // this will also start all dependencies as needed and not touch any resource that is already started
        await this.startResources();
    }
    /**
     * Stop the simulation and clean up all resources.
     */
    async stop() {
        if (this._running === "starting") {
            throw new Error("Cannot stop a simulation that is still starting.");
        }
        if (this._running === "stopping") {
            throw new Error("There is already a stop operation in progress.");
        }
        if (this._running === "stopped") {
            throw new Error("There is no running simulation to stop. Did you mean to call `await simulator.start()` first?");
        }
        this._running = "stopping";
        // just call "stopResource" for all resources. it will stop all dependents as well.
        for (const node of this._model.graph.nodes) {
            await this.stopResource(node.path);
        }
        this.stopServer();
        this._handles.reset();
        this._running = "stopped";
    }
    isStarted(path) {
        return path in this.state;
    }
    async stopResource(path) {
        if (!this.isStarted(path)) {
            return; // resource is already stopped
        }
        // first, stop all dependent resources
        for (const consumer of this._model.graph.tryFind(path)?.dependents ?? []) {
            await this.stopResource(consumer);
        }
        const handle = this.tryGetResourceHandle(path);
        if (!handle) {
            throw new Error(`Resource ${path} could not be cleaned up, no handle for it was found.`);
        }
        try {
            const resource = this._handles.find(handle);
            await this.ensureStateDirExists(path);
            await resource.save(this.getResourceStateDir(path));
            await resource.cleanup();
            this._handles.deallocate(handle);
        }
        catch (err) {
            console.warn(err);
        }
        // remove the resource's policy from the policy registry
        this._policyRegistry.deregister(path);
        this.addSimulatorTrace(path, { message: `${path} stopped` }, std_1.LogLevel.VERBOSE);
        delete this.state[path]; // delete the state of the resource
    }
    addSimulatorTrace(path, data, level) {
        const resourceConfig = this.getResourceConfig(path);
        this.addTrace({
            type: std_1.TraceType.SIMULATOR,
            level,
            data: data,
            sourcePath: resourceConfig.path,
            sourceType: resourceConfig.type,
            timestamp: new Date().toISOString(),
        });
    }
    /**
     * Stop the simulation, reload the simulation tree from the latest version of
     * the app file, and restart the simulation.
     */
    async reload(resetState) {
        await this.stop();
        if (resetState) {
            await (0, promises_1.rm)(this.statedir, { recursive: true });
            this._traces = [];
        }
        this._model = this._loadApp(this._model.simdir);
        await this.start();
    }
    /**
     * Get a list of all resource paths.
     */
    listResources() {
        return this._model.graph.nodes.map((x) => x.path).sort();
    }
    /**
     * Get a list of all traces from the most recent simulation run.
     */
    listTraces() {
        return [...this._traces];
    }
    /**
     * Get a resource client.
     * @returns the resource
     */
    getResource(path) {
        const client = this.tryGetResource(path);
        if (!client) {
            throw new Error(`Resource "${path}" not found.`);
        }
        return client;
    }
    /**
     * Get a resource client.
     * @returns The resource or undefined if not found
     */
    tryGetResource(path) {
        const handle = this.tryGetResourceHandle(path);
        if (handle) {
            return (0, client_1.makeSimulatorClient)(this.url, handle, ADMIN_PERMISSION);
        }
        // backwards compatibility trick: if a unit test requests a resource with a path like "foo/bar"
        // which is not found, but a resource "foo/bar/Resource" exists and its
        // type is @winglang/sdk.sim.Resource, then we will return that client instead
        const childPath = `${path}/Resource`;
        const childConfig = this.tryGetResourceConfig(childPath);
        if (childConfig?.type === "@winglang/sdk.sim.Resource") {
            const childHandle = this.tryGetResourceHandle(childPath);
            if (childHandle) {
                const client = (0, client_1.makeSimulatorClient)(this.url, childHandle, ADMIN_PERMISSION);
                const get = (_target, method, _receiver) => {
                    return async function (...args) {
                        return client.call(method, args);
                    };
                };
                return new Proxy({}, { get });
            }
        }
        return undefined;
    }
    tryGetResourceHandle(path) {
        return this.tryGetResourceConfig(path)?.attrs[HANDLE_ATTRIBUTE];
    }
    /**
     * Obtain a resource's configuration, including its type, props, and attrs.
     * @returns The resource configuration or undefined if not found
     */
    tryGetResourceConfig(path) {
        // shorthand - assume tree root is named "root" by default
        if (path.startsWith("/")) {
            path = `root${path}`;
        }
        const def = this._model.graph.tryFind(path)?.def;
        if (!def) {
            return undefined;
        }
        const state = this.state[path];
        return {
            ...def,
            // merge the actual state (props and attrs) over the desired state in `def`
            ...state,
        };
    }
    /**
     * Obtain a resource's configuration, including its type, props, and attrs.
     * @param path The resource path
     * @returns The resource configuration
     */
    getResourceConfig(path) {
        const config = this.tryGetResourceConfig(path);
        if (!config) {
            throw new Error(`Resource "${path}" not found.`);
        }
        return config;
    }
    /**
     * Obtain a resource's state directory path.
     * @param path The resource path
     * @returns The resource state directory path
     */
    getResourceStateDir(path) {
        const config = this.getResourceConfig(path);
        return (0, path_1.join)(this.statedir, config.addr);
    }
    async ensureStateDirExists(path) {
        const statedir = this.getResourceStateDir(path);
        const statedirExists = await (0, util_1.exists)(statedir);
        if (!statedirExists) {
            await (0, promises_1.mkdir)(statedir, { recursive: true });
        }
    }
    /**
     * Obtain a resource's visual interaction components.
     * @returns An array of UIComponent objects
     */
    getResourceUI(path) {
        let treeData = this.tree().rawDataForNode(path);
        if (!treeData) {
            throw new Error(`Resource "${path}" not found.`);
        }
        return treeData.display?.ui ?? [];
    }
    typeInfo(fqn) {
        const schema = this._model.schema.types[fqn];
        if (!schema) {
            throw new Error(`Unknown simulator type ${fqn}`);
        }
        return schema;
    }
    /**
     * Register a subscriber that will be notified when a trace is emitted by
     * the simulator.
     */
    onTrace(subscriber) {
        this._traceSubscribers.push(subscriber);
    }
    /**
     * Obtain information about the application's construct tree.
     */
    tree() {
        return this._model.tree;
    }
    /**
     * Obtain information about the application's connections.
     */
    connections() {
        return structuredClone(this._model.connections);
    }
    checkPermission(callerHandle, calleeHandle, method) {
        if (callerHandle === ADMIN_PERMISSION) {
            return { granted: true };
        }
        if (method === "then") {
            // Always grant permissions for the "then" method so that an error isn't thrown
            // if `await client` is called on a Proxy object. In JavaScript, `await x` will
            // implicitly call `x.then()`.
            return { granted: true };
        }
        const callerPath = this._handles.tryFindPath(callerHandle);
        if (!callerPath) {
            return {
                granted: false,
                reason: `(Permission checking) No caller resource with handle "${callerHandle}" found.`,
            };
        }
        const calleePath = this._handles.tryFindPath(calleeHandle);
        if (!calleePath) {
            return {
                granted: false,
                reason: `(Permission checking) No callee resource with handle "${calleeHandle}" found.`,
            };
        }
        if (this._policyRegistry.checkPermission(callerHandle, calleeHandle, method)) {
            return { granted: true };
        }
        return {
            granted: false,
            reason: `Resource "${callerPath}" does not have permission to perform operation "${method}" on resource "${calleePath}".`,
        };
    }
    /**
     * Start a server that allows any resource to be accessed via HTTP.
     */
    async startServer() {
        const requestListener = (req, res) => {
            if (!req.url?.startsWith("/v1/call")) {
                res.writeHead(404);
                res.end();
                return;
            }
            let body = "";
            req.on("data", (chunk) => {
                body += chunk;
            });
            req.on("end", () => {
                const request = (0, serialization_1.deserialize)(body);
                const { caller, handle, method, args } = request;
                const resource = this._handles.tryFind(handle);
                // Check if the caller has permission to call the method on the resource
                const grant = this.checkPermission(caller, handle, method);
                if (!grant.granted) {
                    res.writeHead(403, { "Content-Type": "application/json" });
                    res.end((0, serialization_1.serialize)({
                        error: {
                            message: grant.reason,
                        },
                    }), "utf-8");
                    return;
                }
                // If we weren't able to find a resource with the given handle, it could actually
                // be OK if the resource is still starting up or has already been cleaned up.
                // In that case, we return a 500 error with a message that explains what happened.
                if (!resource) {
                    res.writeHead(500, { "Content-Type": "application/json" });
                    if (this._running === "starting") {
                        res.end((0, serialization_1.serialize)({
                            error: {
                                message: `Resource ${handle} not found. It may not have been initialized yet.`,
                            },
                        }), "utf-8");
                        return;
                    }
                    else if (this._running === "stopping") {
                        res.end((0, serialization_1.serialize)({
                            error: {
                                message: `Resource ${handle} not found. It may have been cleaned up already.`,
                            },
                        }), "utf-8");
                        return;
                    }
                    else {
                        res.end((0, serialization_1.serialize)({
                            error: {
                                message: `Internal error - resource ${handle} not found.`,
                            },
                        }), "utf-8");
                        return;
                    }
                }
                const methodExists = resource[method] !== undefined;
                if (!methodExists) {
                    const resourcePath = this._handles.tryFindPath(handle);
                    res.writeHead(500, { "Content-Type": "application/json" });
                    res.end((0, serialization_1.serialize)({
                        error: {
                            message: `Method "${method}" not found on resource ${handle} (${resourcePath}).`,
                        },
                    }), "utf-8");
                    return;
                }
                resource[method](...args)
                    .then((result) => {
                    res.writeHead(200, { "Content-Type": "application/json" });
                    res.end((0, serialization_1.serialize)({ result }), "utf-8");
                })
                    .catch((err) => {
                    res.writeHead(500, { "Content-Type": "application/json" });
                    res.end((0, serialization_1.serialize)({
                        error: {
                            message: err?.message ?? `${err}`,
                            stack: err.stack,
                            name: err.name,
                        },
                    }), "utf-8");
                });
            });
        };
        // only import "http" when this method is called to reduce the time it takes to load Wing SDK
        const http = await Promise.resolve().then(() => __importStar(require("node:http")));
        // start the server, and wait for it to be listening
        const server = http.createServer(requestListener);
        await new Promise((ok) => {
            server.listen(0, LOCALHOST_ADDRESS, () => {
                const addr = server.address();
                if (addr && typeof addr === "object" && addr.port) {
                    this._serverUrl = `http://${addr.address}:${addr.port}`;
                }
                this._server = server;
                ok();
            });
        });
    }
    /**
     * Stop the simulator server.
     */
    stopServer() {
        this._server.close();
    }
    /**
     * The URL that the simulator server is listening on.
     */
    get url() {
        if (!this._serverUrl) {
            throw new Error("Simulator server is not running.");
        }
        return this._serverUrl;
    }
    async startResource(path) {
        if (this.isStarted(path)) {
            return; // already started
        }
        // first lets make sure all my dependencies have been started (depth-first)
        for (const d of this._model.graph.tryFind(path)?.dependencies ?? []) {
            await this.startResource(d);
        }
        const resourceConfig = this.getResourceConfig(path);
        const resolvedProps = this.resolveTokens(path, resourceConfig.props);
        const resolvedPolicy = this.resolveTokens(path, resourceConfig.policy) ?? [];
        // look up the location of the code for the type
        const typeInfo = this.typeInfo(resourceConfig.type);
        // set up a state directory for the resource
        await (0, promises_1.mkdir)(this.getResourceStateDir(resourceConfig.path), {
            recursive: true,
        });
        // initialize the resource state object without attrs for now
        this.state[path] = {
            props: resolvedProps,
            attrs: {},
            policy: resolvedPolicy,
        };
        // create the resource based on its type
        // eslint-disable-next-line @typescript-eslint/no-require-imports
        const ResourceType = require(typeInfo.sourcePath)[typeInfo.className];
        const resourceObject = new ResourceType(resolvedProps);
        // allocate a handle for the resource so others can find it
        const handle = this._handles.allocate(path, resourceObject);
        // if the resource is a policy, add it to the policy registry
        if (resourceConfig.type === target_sim_1.POLICY_FQN) {
            const policy = resolvedProps;
            this._policyRegistry.register(resourceConfig.path, policy);
        }
        else {
            // otherwise, add the resource's inline policy to the policy registry
            const policy = {
                statements: resolvedPolicy,
                principal: handle,
            };
            this._policyRegistry.register(resourceConfig.path, policy);
        }
        // initialize the resource with the simulator context
        const context = this.createContext(resourceConfig, handle);
        const attrs = await resourceObject.init(context);
        // save the current state
        await resourceObject.save();
        // merge the attributes
        this.state[path].attrs = {
            ...this.state[path].attrs,
            ...attrs,
            [HANDLE_ATTRIBUTE]: handle,
        };
        // trace the resource creation
        this.addSimulatorTrace(path, {
            message: `${resourceConfig.path} started`,
        }, std_1.LogLevel.VERBOSE);
    }
    createContext(resourceConfig, resourceHandle) {
        return {
            simdir: this._model.simdir,
            statedir: (0, path_1.join)(this.statedir, resourceConfig.addr),
            resourcePath: resourceConfig.path,
            resourceHandle: resourceHandle,
            serverUrl: this.url,
            getClient: (calleeHandle, asAdmin) => {
                const callerHandle = asAdmin ? ADMIN_PERMISSION : resourceHandle;
                return (0, client_1.makeSimulatorClient)(this.url, calleeHandle, callerHandle);
            },
            addTrace: (trace) => {
                this.addTrace(trace);
            },
            withTrace: async (props) => {
                // TODO: log start time and end time of activity?
                try {
                    let result = await props.activity();
                    this.addTrace({
                        data: {
                            message: props.message,
                            status: "success",
                            result: JSON.stringify(result),
                        },
                        type: std_1.TraceType.RESOURCE,
                        level: std_1.LogLevel.VERBOSE,
                        sourcePath: resourceConfig.path,
                        sourceType: resourceConfig.type,
                        timestamp: new Date().toISOString(),
                    });
                    return result;
                }
                catch (err) {
                    this.addTrace({
                        data: {
                            message: `Error: ${err.message} (${props.message})`,
                            error: err,
                            status: "failure",
                        },
                        type: std_1.TraceType.RESOURCE,
                        level: std_1.LogLevel.VERBOSE,
                        sourcePath: resourceConfig.path,
                        sourceType: resourceConfig.type,
                        timestamp: new Date().toISOString(),
                    });
                    throw err;
                }
            },
            listTraces: () => {
                return [...this._traces];
            },
            setResourceAttributes: (path, attrs) => {
                for (const [key, value] of Object.entries(attrs)) {
                    this.addSimulatorTrace(path, {
                        message: `${path}.${key} = ${value}`,
                    }, std_1.LogLevel.VERBOSE);
                }
                this.state[path].attrs = { ...this.state[path].attrs, ...attrs };
            },
            resourceAttributes: (path) => {
                return this.state[path].attrs;
            },
        };
    }
    addTrace(event) {
        event = Object.freeze(event);
        for (const sub of this._traceSubscribers) {
            sub.callback(event);
        }
        this._traces.push(event);
    }
    /**
     * Return an object with all tokens in it resolved to their appropriate values.
     *
     * A token can be a string like "${app/my_bucket#attrs.handle}". This token would be resolved to
     * the "handle" attribute of the resource at path "app/my_bucket". If that attribute does not
     * exist at the time of resolution (for example, if my_bucket is not being simulated yet), an
     * error will be thrown.
     *
     * Tokens can also be nested, like "${app/my_bucket#attrs.handle}/foo/bar".
     *
     * @param obj The object to resolve tokens in.
     * @returns `undefined` if the token could not be resolved (e.g. needs a dependency), otherwise
     * the resolved value.
     */
    resolveTokens(resolver, obj) {
        return (0, tokens_1.resolveTokens)(obj, (token) => {
            const target = this._model.graph.tryFind(token.path);
            if (!target) {
                throw new Error(`Could not resolve token "${token}" because the resource at path "${token.path}" does not exist.`);
            }
            const r = this.getResourceConfig(target.path);
            if (token.attr) {
                const value = r.attrs[token.attr];
                if (value === undefined) {
                    throw new UnresolvedTokenError(`Unable to resolve attribute '${token.attr}' for resource "${target.path}" referenced by "${resolver}"`);
                }
                return value;
            }
            if (token.prop) {
                return r.props[token.prop];
            }
            throw new Error(`Invalid token: ${token}`);
        });
    }
    /**
     * Given the "current" set of resources and a "next" set of resources, calculate the diff and
     * determine which resources need to be added, updated or deleted.
     *
     * Note that dependencies are not considered here but they are implicitly handled by the
     * `startResource` and `stopResource` methods. So, for example, when a resource is updated,
     * all of it's dependents will be stopped and started again.
     */
    async planUpdate(current, next) {
        // Make sure we're working on a copy of "current"
        current = { ...current };
        const added = [];
        const updated = [];
        const deleted = [];
        for (const [path, nextConfig] of Object.entries(next)) {
            const currConfig = current[path];
            // if the resource is not in "current", it means it was added
            if (!currConfig) {
                added.push(nextConfig.path);
                continue;
            }
            // the resource is already in "current", if it's different from "next", it means it was updated
            if (await this.shouldReplace(path, currConfig, nextConfig)) {
                updated.push(nextConfig.path);
            }
            // remove it from "current" so we know what's left to be deleted
            delete current[path];
        }
        // everything left in "current" is to be deleted
        for (const config of Object.values(current)) {
            deleted.push(config.path);
        }
        return { added, updated, deleted };
    }
    async shouldReplace(path, oldConfig, newConfig) {
        const state = (r) => JSON.stringify({
            props: r.props,
            type: r.type,
            policyStatements: r.policy,
        });
        const invalidated = state(oldConfig) !== state(newConfig);
        // consult the resource's "plan()" method if it has one
        const instance = this.tryGetResource(path);
        const plan = instance ? await instance.plan(invalidated) : UpdatePlan.AUTO;
        switch (plan) {
            case UpdatePlan.SKIP:
                return false;
            case UpdatePlan.REPLACE:
                return true;
            case UpdatePlan.AUTO:
                // Replace the resource if the new configuration is different from the current configuration
                //
                // Note: we're comparing the unresolved configurations, either of which may contain tokens.
                // So even if the configurations may look the same, it's possible that a replacement
                // is still necessary.
                return invalidated;
        }
    }
}
exports.Simulator = Simulator;
_a = JSII_RTTI_SYMBOL_1;
Simulator[_a] = { fqn: "@winglang/sdk.simulator.Simulator", version: "0.0.0" };
class UnresolvedTokenError extends Error {
}
class HandleManager {
    constructor() {
        this.handles = new Map();
        this.paths = new Map();
        this.nextHandle = 0;
    }
    allocate(path, resource) {
        const handle = `sim-${this.nextHandle++}`;
        this.handles.set(handle, resource);
        this.paths.set(handle, path);
        return handle;
    }
    find(handle) {
        const instance = this.tryFind(handle);
        if (!instance) {
            throw new Error(`No resource found with handle "${handle}".`);
        }
        return instance;
    }
    tryFind(handle) {
        return this.handles.get(handle);
    }
    tryFindPath(handle) {
        return this.paths.get(handle);
    }
    deallocate(handle) {
        const instance = this.handles.get(handle);
        if (!instance) {
            throw new Error(`No resource found with handle "${handle}".`);
        }
        this.handles.delete(handle);
        this.paths.delete(handle);
        return instance;
    }
    reset() {
        this.handles.clear();
        this.paths.clear();
        this.nextHandle = 0;
    }
}
/**
 * Determines how updates are performed on this resource.
 */
var UpdatePlan;
(function (UpdatePlan) {
    /**
     * Does nothing. This resource is already in the desired state.
     */
    UpdatePlan["SKIP"] = "SKIP";
    /**
     * Deletes the resource and creates a new instance with the new configuration.
     */
    UpdatePlan["REPLACE"] = "REPLACE";
    /**
     * Auto detect changes in new configuration and replace the resource.
     */
    UpdatePlan["AUTO"] = "AUTO";
})(UpdatePlan || (exports.UpdatePlan = UpdatePlan = {}));
class PolicyRegistry {
    constructor() {
        this.policies = {};
    }
    register(id, policy) {
        if (this.policies[id]) {
            throw new Error(`Policy with id ${id} already registered.`);
        }
        this.policies[id] = policy;
    }
    deregister(id) {
        delete this.policies[id];
    }
    checkPermission(caller, callee, method) {
        for (const policy of Object.values(this.policies)) {
            if (policy.principal === caller) {
                for (const statement of policy.statements) {
                    if (statement.resourceHandle === callee &&
                        statement.operation === method) {
                        return true;
                    }
                }
            }
        }
        return false;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2ltdWxhdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NpbXVsYXRvci9zaW11bGF0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDJCQUFnQztBQUNoQywwQ0FBd0M7QUFFeEMsK0JBQXFDO0FBQ3JDLHFDQUErQztBQUMvQyxtQ0FBZ0M7QUFDaEMsbURBQXlEO0FBQ3pELHFDQUF5QztBQUN6QyxpQ0FBOEI7QUFDOUIsaUNBQWdDO0FBQ2hDLDRDQUEyQztBQUMzQyxrQ0FBeUM7QUFDekMseUNBQThDO0FBQzlDLGdDQUEyRTtBQUMzRSw4Q0FBMkM7QUFHM0MsTUFBTSxpQkFBaUIsR0FBRyxXQUFXLENBQUM7QUFDdEMsTUFBTSxnQkFBZ0IsR0FBRyxRQUFRLENBQUM7QUFFbEM7OztHQUdHO0FBQ0gsTUFBTSxnQkFBZ0IsR0FBRyxPQUFPLENBQUM7QUFvS2pDOztHQUVHO0FBQ0gsTUFBYSxTQUFTO0lBa0JwQixZQUFZLEtBQXFCO1FBSmpDLDRGQUE0RjtRQUM1RixnREFBZ0Q7UUFDeEMsVUFBSyxHQUFrQyxFQUFFLENBQUM7UUFHaEQsTUFBTSxNQUFNLEdBQUcsSUFBQSxjQUFPLEVBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3RDLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDLFFBQVEsSUFBSSxJQUFBLFdBQUksRUFBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDekQsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRXBDLElBQUksQ0FBQyxRQUFRLEdBQUcsU0FBUyxDQUFDO1FBQzFCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxhQUFhLEVBQUUsQ0FBQztRQUNwQyxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksY0FBYyxFQUFFLENBQUM7UUFDNUMsSUFBSSxDQUFDLE9BQU8sR0FB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Y0FBYyxLQUFLLE1BQU07d0JBQ25DLFNBQVMsQ0FBQyxTQUFTLEtBQUssTUFBTSxFQUM5QixDQUFDO3dCQUNELE9BQU8sSUFBSSxDQUFDO29CQUNkLENBQUM7Z0JBQ0gsQ0FBQztZQUNILENBQUM7UUFDSCxDQUFDO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBleGlzdHNTeW5jIH0gZnJvbSBcImZzXCI7XG5pbXBvcnQgeyBta2Rpciwgcm0gfSBmcm9tIFwiZnMvcHJvbWlzZXNcIjtcbmltcG9ydCB0eXBlIHsgU2VydmVyLCBJbmNvbWluZ01lc3NhZ2UsIFNlcnZlclJlc3BvbnNlIH0gZnJvbSBcImh0dHBcIjtcbmltcG9ydCB7IGpvaW4sIHJlc29sdmUgfSBmcm9tIFwicGF0aFwiO1xuaW1wb3J0IHsgbWFrZVNpbXVsYXRvckNsaWVudCB9IGZyb20gXCIuL2NsaWVudFwiO1xuaW1wb3J0IHsgR3JhcGggfSBmcm9tIFwiLi9ncmFwaFwiO1xuaW1wb3J0IHsgZGVzZXJpYWxpemUsIHNlcmlhbGl6ZSB9IGZyb20gXCIuL3NlcmlhbGl6YXRpb25cIjtcbmltcG9ydCB7IHJlc29sdmVUb2tlbnMgfSBmcm9tIFwiLi90b2tlbnNcIjtcbmltcG9ydCB7IFRyZWUgfSBmcm9tIFwiLi90cmVlXCI7XG5pbXBvcnQgeyBleGlzdHMgfSBmcm9tIFwiLi91dGlsXCI7XG5pbXBvcnQgeyBTREtfVkVSU0lPTiB9IGZyb20gXCIuLi9jb25zdGFudHNcIjtcbmltcG9ydCB7IFRSRUVfRklMRV9QQVRIIH0gZnJvbSBcIi4uL2NvcmVcIjtcbmltcG9ydCB7IHJlYWRKc29uU3luYyB9IGZyb20gXCIuLi9zaGFyZWQvbWlzY1wiO1xuaW1wb3J0IHsgQ09OTkVDVElPTlNfRklMRV9QQVRILCBMb2dMZXZlbCwgVHJhY2UsIFRyYWNlVHlwZSB9IGZyb20gXCIuLi9zdGRcIjtcbmltcG9ydCB7IFBPTElDWV9GUU4gfSBmcm9tIFwiLi4vdGFyZ2V0LXNpbVwiO1xuaW1wb3J0IHsgUG9saWN5U2NoZW1hIH0gZnJvbSBcIi4uL3RhcmdldC1zaW0vc2NoZW1hLXJlc291cmNlc1wiO1xuXG5jb25zdCBMT0NBTEhPU1RfQUREUkVTUyA9IFwiMTI3LjAuMC4xXCI7XG5jb25zdCBIQU5ETEVfQVRUUklCVVRFID0gXCJoYW5kbGVcIjtcblxuLyoqXG4gKiBJZiBhbiBBUEkgY2FsbCBpcyBtYWRlIHRvIGEgcmVzb3VyY2Ugd2l0aCBuYW1lIGFzIHRoZSBjYWxsZXIsIGFueSBwZXJtaXNzaW9uc1xuICogY2hlY2tpbmcgd2lsbCBiZSBza2lwcGVkLiBVc2VkIGJ5IHVuaXQgdGVzdHMgYW5kIHRoZSBXaW5nIENvbnNvbGUuXG4gKi9cbmNvbnN0IEFETUlOX1BFUk1JU1NJT04gPSBcImFkbWluXCI7XG5cbi8qKlxuICogUHJvcHMgZm9yIGBTaW11bGF0b3JgLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFNpbXVsYXRvclByb3BzIHtcbiAgLyoqXG4gICAqIFBhdGggdG8gYSBXaW5nIHNpbXVsYXRvciBvdXRwdXQgZGlyZWN0b3J5ICgud3NpbSkuXG4gICAqL1xuICByZWFkb25seSBzaW1maWxlOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFBhdGggdG8gYSBzdGF0ZSBkaXJlY3Rvcnkgd2hlcmUgdGhlIHNpbXVsYXRvciBjYW4gc3RvcmUgc3RhdGUgYmV0d2VlblxuICAgKiBzaW11bGF0aW9uIHJ1bnMuXG4gICAqIEBkZWZhdWx0IC0gYSBkaXJlY3RvcnkgbmFtZWQgXCIuc3RhdGVcIiBpbnNpZGUgdGhlIHNpbXVsYXRvciBvdXRwdXQgZGlyZWN0b3J5XG4gICAqL1xuICByZWFkb25seSBzdGF0ZURpcj86IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIGZhY3RvcnkgdGhhdCBwcm9kdWNlcyByZXNvdXJjZSBzaW11bGF0aW9ucy5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBhIGZhY3RvcnkgdGhhdCBwcm9kdWNlcyBzaW11bGF0aW9ucyBmb3IgYnVpbHQtaW4gV2luZyBTREtcbiAgICogcmVzb3VyY2VzXG4gICAqL1xuICByZWFkb25seSBmYWN0b3J5PzogSVNpbXVsYXRvckZhY3Rvcnk7XG59XG5cbi8qKlxuICogQSBjb2xsZWN0aW9uIG9mIGNhbGxiYWNrcyB0aGF0IGFyZSBpbnZva2VkIGF0IGtleSBsaWZlY3ljbGUgZXZlbnRzIG9mIHRoZVxuICogc2ltdWxhdG9yLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIElTaW11bGF0b3JMaWZlY3ljbGVIb29rcyB7XG4gIC8qKlxuICAgKiBBIGZ1bmN0aW9uIHRvIHJ1biB3aGVuZXZlciBhIHRyYWNlIGlzIGVtaXR0ZWQuXG4gICAqL1xuICBvblRyYWNlPyhldmVudDogVHJhY2UpOiB2b2lkO1xufVxuXG4vLyBTaW5jZSB3ZSBhcmUgdXNpbmcgSlNJSSB3ZSBjYW5ub3QgdXNlIGdlbmVyaWNzIHRvIHR5cGUgdGhpcyByaWdodCBub3c6XG4vL1xuLy8gZXhwb3J0IGludGVyZmFjZSBXaXRoVHJhY2VQcm9wczxUPiB7XG4vLyAgIHJlYWRvbmx5IGFjdGl2aXR5OiAoKSA9PiBQcm9taXNlPFQ+O1xuLy8gfVxuLy8gLi4uXG4vLyB3aXRoVHJhY2UoZXZlbnQ6IFdpdGhUcmFjZVByb3BzPFQ+KTogUHJvbWlzZTxUPjtcblxuLyoqXG4gKiBQcm9wcyBmb3IgYElTaW11bGF0b3JDb250ZXh0LndpdGhUcmFjZWAuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSVdpdGhUcmFjZVByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSB0cmFjZSBtZXNzYWdlLlxuICAgKi9cbiAgcmVhZG9ubHkgbWVzc2FnZTogYW55O1xuXG4gIC8qKlxuICAgKiBBIGZ1bmN0aW9uIHRvIHJ1biBhcyBwYXJ0IG9mIHRoZSB0cmFjZS5cbiAgICovXG4gIGFjdGl2aXR5KCk6IFByb21pc2U8YW55Pjtcbn1cblxuLyoqXG4gKiBDb250ZXh0IHRoYXQgaXMgcGFzc2VkIHRvIGluZGl2aWR1YWwgcmVzb3VyY2Ugc2ltdWxhdGlvbnMuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSVNpbXVsYXRvckNvbnRleHQge1xuICAvKipcbiAgICogVGhlIGRpcmVjdG9yeSB3aGVyZSB0aGUgY29tcGlsYXRpb24gb3V0cHV0IGlzXG4gICAqL1xuICByZWFkb25seSBzaW1kaXI6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIGRpcmVjdG9yeSBmb3IgdGhlIHJlc291cmNlJ3Mgc3RhdGUuXG4gICAqL1xuICByZWFkb25seSBzdGF0ZWRpcjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgcGF0aCBvZiB0aGUgcmVzb3VyY2UgdGhhdCBpcyBiZWluZyBzaW11bGF0ZWQuXG4gICAqL1xuICByZWFkb25seSByZXNvdXJjZVBhdGg6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIGhhbmRsZSBvZiB0aGUgcmVzb3VyY2UgdGhhdCBpcyBiZWluZyBzaW11bGF0ZWQuXG4gICAqL1xuICByZWFkb25seSByZXNvdXJjZUhhbmRsZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgdXJsIHRoYXQgdGhlIHNpbXVsYXRvciBzZXJ2ZXIgaXMgbGlzdGVuaW5nIG9uLlxuICAgKi9cbiAgcmVhZG9ubHkgc2VydmVyVXJsOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIE9idGFpbiBhIGNsaWVudCBnaXZlbiBhIHJlc291cmNlJ3MgaGFuZGxlLlxuICAgKi9cbiAgZ2V0Q2xpZW50KGhhbmRsZTogc3RyaW5nLCBhc0FkbWluPzogYm9vbGVhbik6IHVua25vd247XG5cbiAgLyoqXG4gICAqIEFkZCBhIHRyYWNlLiBUcmFjZXMgYXJlIGJyZWFkY3J1bWJzIG9mIGluZm9ybWF0aW9uIGFib3V0IHJlc291cmNlXG4gICAqIG9wZXJhdGlvbnMgdGhhdCBvY2N1cnJlZCBkdXJpbmcgc2ltdWxhdGlvbiwgdXNlZnVsIGZvciB1bmRlcnN0YW5kaW5nIGhvd1xuICAgKiByZXNvdXJjZXMgaW50ZXJhY3Qgb3IgZGVidWdnaW5nIGFuIGFwcGxpY2F0aW9uLlxuICAgKi9cbiAgYWRkVHJhY2UodHJhY2U6IFRyYWNlKTogdm9pZDtcblxuICAvKipcbiAgICogUmVnaXN0ZXIgYSB0cmFjZSBhc3NvY2lhdGVkIHdpdGggYSByZXNvdXJjZSBhY3Rpdml0eS4gVGhlIGFjdGl2aXR5IHdpbGwgYmVcbiAgICogcnVuLCBhbmQgdGhlIHRyYWNlIHdpbGwgYmUgcG9wdWxhdGVkIHdpdGggdGhlIHJlc3VsdCdzIHN1Y2Nlc3Mgb3IgZmFpbHVyZS5cbiAgICovXG4gIHdpdGhUcmFjZSh0cmFjZTogSVdpdGhUcmFjZVByb3BzKTogUHJvbWlzZTxhbnk+O1xuXG4gIC8qKlxuICAgKiBHZXQgYSBsaXN0IG9mIGFsbCB0cmFjZXMgdW50aWwgdGhpcyBwb2ludC5cbiAgICovXG4gIGxpc3RUcmFjZXMoKTogVHJhY2VbXTtcblxuICAvKipcbiAgICogU2V0cyB0aGUgcnVudGltZSBhdHRyaWJ1dGVzIG9mIGEgcmVzb3VyY2UuXG4gICAqIEBwYXJhbSBwYXRoIFRoZSByZXNvdXJjZSBwYXRoXG4gICAqIEBwYXJhbSBhdHRycyBBdHRyaWJ1dGVzIHRvIHNldCAod2lsbCBiZSBtZXJnZWQgd2l0aCBleGlzdGluZyBhdHRyaWJ1dGVzKVxuICAgKi9cbiAgc2V0UmVzb3VyY2VBdHRyaWJ1dGVzKHBhdGg6IHN0cmluZywgYXR0cnM6IFJlY29yZDxzdHJpbmcsIGFueT4pOiB2b2lkO1xuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBydW50aW1lIGF0dHJpYnV0ZXMgb2YgYSByZXNvdXJjZS5cbiAgICogQHBhcmFtIHBhdGggVGhlIHJlc291cmNlIHBhdGhcbiAgICovXG4gIHJlc291cmNlQXR0cmlidXRlcyhwYXRoOiBzdHJpbmcpOiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xufVxuXG4vKipcbiAqIEEgc3Vic2NyaWJlciB0aGF0IGNhbiBsaXN0ZW4gZm9yIHRyYWNlcyBlbWl0dGVkIGJ5IHRoZSBzaW11bGF0b3IuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSVRyYWNlU3Vic2NyaWJlciB7XG4gIC8qKlxuICAgKiBDYWxsZWQgd2hlbiBhIHRyYWNlIGlzIGVtaXR0ZWQuXG4gICAqL1xuICBjYWxsYmFjayhldmVudDogVHJhY2UpOiB2b2lkO1xufVxuXG4vKipcbiAqIFRoZSBzaW11bGF0b3IgY2FuIHRyYW5zaXRpb24gYmV0d2VlbiB0aGVzZSBzdGF0ZXM6XG4gKiDilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilJAgICAg4pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSQXG4gKiDilIIgc3RvcHBlZCDilJzilIDilIDilIDilrrilIJzdGFydGluZyDilIJcbiAqIOKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUmCAgICDilJTilIDilIDilIDilIDilKzilIDilIDilIDilIDilJhcbiAqICAgICAg4payICAgICAgICAgICAgICDilIJcbiAqICAgICAg4pSCICAgICAgICAgICAgICDilrxcbiAqIOKUjOKUgOKUgOKUgOKUgOKUtOKUgOKUgOKUgOKUgOKUkCAgICDilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilJBcbiAqIOKUgnN0b3BwaW5nIOKUguKXhOKUgOKUgOKUgOKUpCBydW5uaW5nIOKUglxuICog4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYICAgIOKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUmFxuICovXG50eXBlIFJ1bm5pbmdTdGF0ZSA9IFwic3RhcnRpbmdcIiB8IFwicnVubmluZ1wiIHwgXCJzdG9wcGluZ1wiIHwgXCJzdG9wcGVkXCI7XG5cbmludGVyZmFjZSBNb2RlbCB7XG4gIHNpbWRpcjogc3RyaW5nO1xuICB0cmVlOiBUcmVlO1xuICBjb25uZWN0aW9uczogQ29ubmVjdGlvbkRhdGFbXTtcbiAgc2NoZW1hOiBXaW5nU2ltdWxhdG9yU2NoZW1hO1xuICBncmFwaDogR3JhcGg8QmFzZVJlc291cmNlU2NoZW1hPjtcbn1cblxuaW50ZXJmYWNlIFJlc291cmNlU3RhdGUge1xuICBwcm9wczogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgYXR0cnM6IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIHBvbGljeTogUG9saWN5U3RhdGVtZW50W107XG59XG5cbi8qKlxuICogQSBzaW11bGF0b3IgdGhhdCBjYW4gYmUgdXNlZCB0byB0ZXN0IHlvdXIgYXBwbGljYXRpb24gbG9jYWxseS5cbiAqL1xuZXhwb3J0IGNsYXNzIFNpbXVsYXRvciB7XG4gIC8vIGZpZWxkcyB0aGF0IGFyZSBzYW1lIGJldHdlZW4gc2ltdWxhdGlvbiBydW5zIC8gcmVsb2Fkc1xuICBwcml2YXRlIHJlYWRvbmx5IHN0YXRlZGlyOiBzdHJpbmc7XG5cbiAgLy8gZmllbGRzIHRoYXQgY2hhbmdlIGJldHdlZW4gc2ltdWxhdGlvbiBydW5zIC8gcmVsb2Fkc1xuICBwcml2YXRlIF9ydW5uaW5nOiBSdW5uaW5nU3RhdGU7XG4gIHByaXZhdGUgcmVhZG9ubHkgX2hhbmRsZXM6IEhhbmRsZU1hbmFnZXI7XG4gIHByaXZhdGUgX3RyYWNlczogQXJyYXk8VHJhY2U+O1xuICBwcml2YXRlIHJlYWRvbmx5IF90cmFjZVN1YnNjcmliZXJzOiBBcnJheTxJVHJhY2VTdWJzY3JpYmVyPjtcbiAgcHJpdmF0ZSBfc2VydmVyVXJsOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIHByaXZhdGUgX3NlcnZlcjogU2VydmVyIHwgdW5kZWZpbmVkO1xuICBwcml2YXRlIF9tb2RlbDogTW9kZWw7XG4gIHByaXZhdGUgX3BvbGljeVJlZ2lzdHJ5OiBQb2xpY3lSZWdpc3RyeTtcblxuICAvLyBrZWVwcyB0aGUgYWN0dWFsIHJlc29sdmVkIHN0YXRlIChwcm9wcyBhbmQgYXR0cnMpIG9mIGFsbCBzdGFydGVkIHJlc291cmNlcy4gdGhpcyBzdGF0ZSBpc1xuICAvLyBtZXJnZWQgaW4gd2hlbiBjYWxsaW5nIGBnZXRSZXNvdXJjZUNvbmZpZygpYC5cbiAgcHJpdmF0ZSBzdGF0ZTogUmVjb3JkPHN0cmluZywgUmVzb3VyY2VTdGF0ZT4gPSB7fTtcblxuICBjb25zdHJ1Y3Rvcihwcm9wczogU2ltdWxhdG9yUHJvcHMpIHtcbiAgICBjb25zdCBzaW1kaXIgPSByZXNvbHZlKHByb3BzLnNpbWZpbGUpO1xuICAgIHRoaXMuc3RhdGVkaXIgPSBwcm9wcy5zdGF0ZURpciA/PyBqb2luKHNpbWRpciwgXCIuc3RhdGVcIik7XG4gICAgdGhpcy5fbW9kZWwgPSB0aGlzLl9sb2FkQXBwKHNpbWRpcik7XG5cbiAgICB0aGlzLl9ydW5uaW5nID0gXCJzdG9wcGVkXCI7XG4gICAgdGhpcy5faGFuZGxlcyA9IG5ldyBIYW5kbGVNYW5hZ2VyKCk7XG4gICAgdGhpcy5fcG9saWN5UmVnaXN0cnkgPSBuZXcgUG9saWN5UmVnaXN0cnkoKTtcbiAgICB0aGlzLl90cmFjZXMgPSBuZXcgQXJyYXkoKTtcbiAgICB0aGlzLl90cmFjZVN1YnNjcmliZXJzID0gbmV3IEFycmF5KCk7XG4gIH1cblxuICBwcml2YXRlIF9sb2FkQXBwKHNpbWRpcjogc3RyaW5nKTogTW9kZWwge1xuICAgIGNvbnN0IHNpbUpzb24gPSBqb2luKHNpbWRpciwgXCJzaW11bGF0b3IuanNvblwiKTtcbiAgICBpZiAoIWV4aXN0c1N5bmMoc2ltSnNvbikpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEludmFsaWQgV2luZyBhcHAgKCR7c2ltZGlyfSkgLSBzaW11bGF0b3IuanNvbiBub3QgZm91bmQuYFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBzY2hlbWEgPSByZWFkSnNvblN5bmMoc2ltSnNvbikgYXMgV2luZ1NpbXVsYXRvclNjaGVtYTtcblxuICAgIGNvbnN0IGZvdW5kVmVyc2lvbiA9IHNjaGVtYS5zZGtWZXJzaW9uID8/IFwidW5rbm93blwiO1xuICAgIGNvbnN0IGV4cGVjdGVkVmVyc2lvbiA9IFNES19WRVJTSU9OO1xuICAgIGlmIChmb3VuZFZlcnNpb24gIT09IGV4cGVjdGVkVmVyc2lvbikge1xuICAgICAgY29uc29sZS5lcnJvcihcbiAgICAgICAgYFdBUk5JTkc6IFRoZSBzaW11bGF0b3IgZGlyZWN0b3J5ICgke3NpbWRpcn0pIHdhcyBnZW5lcmF0ZWQgd2l0aCBXaW5nIFNESyB2JHtmb3VuZFZlcnNpb259IGJ1dCBpdCBpcyBiZWluZyBzaW11bGF0ZWQgd2l0aCBXaW5nIFNESyB2JHtleHBlY3RlZFZlcnNpb259LmBcbiAgICAgICk7XG4gICAgfVxuICAgIGlmIChzY2hlbWEucmVzb3VyY2VzID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEluY29tcGF0aWJsZSAud3NpbSBmaWxlLiBUaGUgc2ltdWxhdG9yIGRpcmVjdG9yeSAoJHtzaW1kaXJ9KSB3YXMgZ2VuZXJhdGVkIHdpdGggV2luZyBTREsgdiR7Zm91bmRWZXJzaW9ufSBidXQgaXQgaXMgYmVpbmcgc2ltdWxhdGVkIHdpdGggV2luZyBTREsgdiR7ZXhwZWN0ZWRWZXJzaW9ufS5gXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHRyZWVKc29uID0gam9pbihzaW1kaXIsIFRSRUVfRklMRV9QQVRIKTtcbiAgICBpZiAoIWV4aXN0c1N5bmModHJlZUpzb24pKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBJbnZhbGlkIFdpbmcgYXBwICgke3NpbWRpcn0pIC0gJHtUUkVFX0ZJTEVfUEFUSH0gbm90IGZvdW5kLmBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgdHJlZSA9IG5ldyBUcmVlKHJlYWRKc29uU3luYyh0cmVlSnNvbikpO1xuXG4gICAgY29uc3QgY29ubmVjdGlvbkpzb24gPSBqb2luKHNpbWRpciwgQ09OTkVDVElPTlNfRklMRV9QQVRIKTtcbiAgICBpZiAoIWV4aXN0c1N5bmMoY29ubmVjdGlvbkpzb24pKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBJbnZhbGlkIFdpbmcgYXBwICgke3NpbWRpcn0pIC0gJHtDT05ORUNUSU9OU19GSUxFX1BBVEh9IG5vdCBmb3VuZC5gXG4gICAgICApO1xuICAgIH1cbiAgICBjb25zdCBjb25uZWN0aW9ucyA9IHJlYWRKc29uU3luYyhjb25uZWN0aW9uSnNvbikuY29ubmVjdGlvbnM7XG4gICAgY29uc3QgZ3JhcGggPSBuZXcgR3JhcGgoT2JqZWN0LnZhbHVlcyhzY2hlbWEucmVzb3VyY2VzKSk7XG5cbiAgICByZXR1cm4geyBzY2hlbWEsIHRyZWUsIGNvbm5lY3Rpb25zLCBzaW1kaXIsIGdyYXBoIH07XG4gIH1cblxuICAvKipcbiAgICogU3RhcnQgdGhlIHNpbXVsYXRvci5cbiAgICovXG4gIHB1YmxpYyBhc3luYyBzdGFydCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5fcnVubmluZyAhPT0gXCJzdG9wcGVkXCIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgXCJBIHNpbXVsYXRpb24gaXMgYWxyZWFkeSBydW5uaW5nLiBEaWQgeW91IG1lYW4gdG8gY2FsbCBgYXdhaXQgc2ltdWxhdG9yLnN0b3AoKWAgZmlyc3Q/XCJcbiAgICAgICk7XG4gICAgfVxuICAgIHRoaXMuX3J1bm5pbmcgPSBcInN0YXJ0aW5nXCI7XG5cbiAgICBhd2FpdCB0aGlzLnN0YXJ0U2VydmVyKCk7XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5zdGFydFJlc291cmNlcygpO1xuICAgIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgICB0aGlzLnN0b3BTZXJ2ZXIoKTtcbiAgICAgIHRoaXMuX3J1bm5pbmcgPSBcInN0b3BwZWRcIjtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHN0YXJ0UmVzb3VyY2VzKCkge1xuICAgIGNvbnN0IHJldHJpZXM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcbiAgICBjb25zdCBxdWV1ZSA9IHRoaXMuX21vZGVsLmdyYXBoLm5vZGVzLm1hcCgobikgPT4gbi5wYXRoKTtcbiAgICBjb25zdCBmYWlsZWQgPSBbXTtcbiAgICB3aGlsZSAocXVldWUubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgdG9wID0gcXVldWUuc2hpZnQoKSE7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLnN0YXJ0UmVzb3VyY2UodG9wKTtcbiAgICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIFVucmVzb2x2ZWRUb2tlbkVycm9yKSB7XG4gICAgICAgICAgcmV0cmllc1t0b3BdID0gKHJldHJpZXNbdG9wXSA/PyAwKSArIDE7XG5cbiAgICAgICAgICBpZiAocmV0cmllc1t0b3BdIDwgMTApIHtcbiAgICAgICAgICAgIHF1ZXVlLnB1c2godG9wKTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmYWlsZWQucHVzaCh0b3ApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYWRkU2ltdWxhdG9yVHJhY2UodG9wLCB7IG1lc3NhZ2U6IGUubWVzc2FnZSB9LCBMb2dMZXZlbC5FUlJPUik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gbWFyayBhcyBcInJ1bm5pbmdcIiBzbyB0aGF0IHdlIGNhbiBzdG9wIHRoZSBzaW11bGF0aW9uIGlmIG5lZWRlZFxuICAgIHRoaXMuX3J1bm5pbmcgPSBcInJ1bm5pbmdcIjtcblxuICAgIC8vIHNpbmNlIHNvbWUgcmVzb3VyY2VzIGZhaWxlZCB0byBzdGFydCwgd2UgYXJlIGdvaW5nIHRvIHN0b3AgYWxsIHJlc291cmNlcyB0aGF0IHdlcmUgc3RhcnRlZFxuICAgIGlmIChmYWlsZWQubGVuZ3RoID4gMCkge1xuICAgICAgYXdhaXQgdGhpcy5zdG9wKCk7XG5cbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEZhaWxlZCB0byBzdGFydCByZXNvdXJjZXM6ICR7ZmFpbGVkLm1hcCgocikgPT4gYFwiJHtyfVwiYCkuam9pbihcIiwgXCIpfWBcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgdGhlIHJ1bm5pbmcgc2ltdWxhdGlvbiB3aXRoIGEgbmV3IHZlcnNpb24gb2YgdGhlIGFwcC4gVGhpcyB3aWxsIGNyZWF0ZS91cGRhdGUvZGVsZXRlXG4gICAqIHJlc291cmNlcyBhcyBuZWNlc3NhcnkgdG8gZ2V0IHRvIHRoZSBkZXNpcmVkIHN0YXRlLlxuICAgKiBAcGFyYW0gc2ltRGlyIFRoZSBwYXRoIHRvIHRoZSBuZXcgdmVyc2lvbiBvZiB0aGUgYXBwXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgdXBkYXRlKHNpbURpcjogc3RyaW5nKSB7XG4gICAgY29uc3QgbmV3TW9kZWwgPSB0aGlzLl9sb2FkQXBwKHNpbURpcik7XG5cbiAgICBjb25zdCBwbGFuID0gYXdhaXQgdGhpcy5wbGFuVXBkYXRlKFxuICAgICAgdGhpcy5fbW9kZWwuc2NoZW1hLnJlc291cmNlcyxcbiAgICAgIG5ld01vZGVsLnNjaGVtYS5yZXNvdXJjZXNcbiAgICApO1xuXG4gICAgdGhpcy5hZGRUcmFjZSh7XG4gICAgICB0eXBlOiBUcmFjZVR5cGUuU0lNVUxBVE9SLFxuICAgICAgZGF0YToge1xuICAgICAgICBtZXNzYWdlOiBgVXBkYXRlOiAke3BsYW4uYWRkZWQubGVuZ3RofSBhZGRlZCwgJHtwbGFuLnVwZGF0ZWQubGVuZ3RofSB1cGRhdGVkLCAke3BsYW4uZGVsZXRlZC5sZW5ndGh9IGRlbGV0ZWRgLFxuICAgICAgICB1cGRhdGU6IHBsYW4sXG4gICAgICB9LFxuICAgICAgc291cmNlUGF0aDogXCJyb290XCIsXG4gICAgICBzb3VyY2VUeXBlOiBcIlNpbXVsYXRvclwiLFxuICAgICAgbGV2ZWw6IExvZ0xldmVsLlZFUkJPU0UsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB9KTtcblxuICAgIC8vIHN0b3AgYWxsICpkZWxldGVkKiBhbmQgKnVwZGF0ZWQqIHJlc291cmNlc1xuICAgIGZvciAoY29uc3QgYyBvZiBbLi4ucGxhbi5kZWxldGVkLCAuLi5wbGFuLnVwZGF0ZWRdKSB7XG4gICAgICBhd2FpdCB0aGlzLnN0b3BSZXNvdXJjZShjKTsgLy8gPC0tIHRoaXMgYWxzbyBzdG9wcyBhbGwgZGVwZW5kZW50IHJlc291cmNlcyBpZiBuZWVkZWRcbiAgICB9XG5cbiAgICAvLyBub3cgdXBkYXRlIHRoZSBpbnRlcm5hbCBtb2RlbCB0byB0aGUgbmV3IHZlcnNpb25cbiAgICB0aGlzLl9tb2RlbCA9IG5ld01vZGVsO1xuXG4gICAgLy8gc3RhcnQgYWxsICphZGRlZCogYW5kICp1cGRhdGVkKiByZXNvdXJjZXMgKHRoZSB1cGRhdGVkIG1vZGVsIGJhc2ljYWxseSBpbmNsdWRlcyBvbmx5IHRoZXNlKVxuICAgIC8vIHRoaXMgd2lsbCBhbHNvIHN0YXJ0IGFsbCBkZXBlbmRlbmNpZXMgYXMgbmVlZGVkIGFuZCBub3QgdG91Y2ggYW55IHJlc291cmNlIHRoYXQgaXMgYWxyZWFkeSBzdGFydGVkXG4gICAgYXdhaXQgdGhpcy5zdGFydFJlc291cmNlcygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0b3AgdGhlIHNpbXVsYXRpb24gYW5kIGNsZWFuIHVwIGFsbCByZXNvdXJjZXMuXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgc3RvcCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5fcnVubmluZyA9PT0gXCJzdGFydGluZ1wiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc3RvcCBhIHNpbXVsYXRpb24gdGhhdCBpcyBzdGlsbCBzdGFydGluZy5cIik7XG4gICAgfVxuICAgIGlmICh0aGlzLl9ydW5uaW5nID09PSBcInN0b3BwaW5nXCIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoZXJlIGlzIGFscmVhZHkgYSBzdG9wIG9wZXJhdGlvbiBpbiBwcm9ncmVzcy5cIik7XG4gICAgfVxuICAgIGlmICh0aGlzLl9ydW5uaW5nID09PSBcInN0b3BwZWRcIikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIlRoZXJlIGlzIG5vIHJ1bm5pbmcgc2ltdWxhdGlvbiB0byBzdG9wLiBEaWQgeW91IG1lYW4gdG8gY2FsbCBgYXdhaXQgc2ltdWxhdG9yLnN0YXJ0KClgIGZpcnN0P1wiXG4gICAgICApO1xuICAgIH1cbiAgICB0aGlzLl9ydW5uaW5nID0gXCJzdG9wcGluZ1wiO1xuXG4gICAgLy8ganVzdCBjYWxsIFwic3RvcFJlc291cmNlXCIgZm9yIGFsbCByZXNvdXJjZXMuIGl0IHdpbGwgc3RvcCBhbGwgZGVwZW5kZW50cyBhcyB3ZWxsLlxuICAgIGZvciAoY29uc3Qgbm9kZSBvZiB0aGlzLl9tb2RlbC5ncmFwaC5ub2Rlcykge1xuICAgICAgYXdhaXQgdGhpcy5zdG9wUmVzb3VyY2Uobm9kZS5wYXRoKTtcbiAgICB9XG5cbiAgICB0aGlzLnN0b3BTZXJ2ZXIoKTtcblxuICAgIHRoaXMuX2hhbmRsZXMucmVzZXQoKTtcbiAgICB0aGlzLl9ydW5uaW5nID0gXCJzdG9wcGVkXCI7XG4gIH1cblxuICBwcml2YXRlIGlzU3RhcnRlZChwYXRoOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gcGF0aCBpbiB0aGlzLnN0YXRlO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzdG9wUmVzb3VyY2UocGF0aDogc3RyaW5nKSB7XG4gICAgaWYgKCF0aGlzLmlzU3RhcnRlZChwYXRoKSkge1xuICAgICAgcmV0dXJuOyAvLyByZXNvdXJjZSBpcyBhbHJlYWR5IHN0b3BwZWRcbiAgICB9XG5cbiAgICAvLyBmaXJzdCwgc3RvcCBhbGwgZGVwZW5kZW50IHJlc291cmNlc1xuICAgIGZvciAoY29uc3QgY29uc3VtZXIgb2YgdGhpcy5fbW9kZWwuZ3JhcGgudHJ5RmluZChwYXRoKT8uZGVwZW5kZW50cyA/PyBbXSkge1xuICAgICAgYXdhaXQgdGhpcy5zdG9wUmVzb3VyY2UoY29uc3VtZXIpO1xuICAgIH1cblxuICAgIGNvbnN0IGhhbmRsZSA9IHRoaXMudHJ5R2V0UmVzb3VyY2VIYW5kbGUocGF0aCk7XG4gICAgaWYgKCFoYW5kbGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYFJlc291cmNlICR7cGF0aH0gY291bGQgbm90IGJlIGNsZWFuZWQgdXAsIG5vIGhhbmRsZSBmb3IgaXQgd2FzIGZvdW5kLmBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc291cmNlID0gdGhpcy5faGFuZGxlcy5maW5kKGhhbmRsZSk7XG4gICAgICBhd2FpdCB0aGlzLmVuc3VyZVN0YXRlRGlyRXhpc3RzKHBhdGgpO1xuICAgICAgYXdhaXQgcmVzb3VyY2Uuc2F2ZSh0aGlzLmdldFJlc291cmNlU3RhdGVEaXIocGF0aCkpO1xuICAgICAgYXdhaXQgcmVzb3VyY2UuY2xlYW51cCgpO1xuICAgICAgdGhpcy5faGFuZGxlcy5kZWFsbG9jYXRlKGhhbmRsZSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLndhcm4oZXJyKTtcbiAgICB9XG5cbiAgICAvLyByZW1vdmUgdGhlIHJlc291cmNlJ3MgcG9saWN5IGZyb20gdGhlIHBvbGljeSByZWdpc3RyeVxuICAgIHRoaXMuX3BvbGljeVJlZ2lzdHJ5LmRlcmVnaXN0ZXIocGF0aCk7XG5cbiAgICB0aGlzLmFkZFNpbXVsYXRvclRyYWNlKFxuICAgICAgcGF0aCxcbiAgICAgIHsgbWVzc2FnZTogYCR7cGF0aH0gc3RvcHBlZGAgfSxcbiAgICAgIExvZ0xldmVsLlZFUkJPU0VcbiAgICApO1xuXG4gICAgZGVsZXRlIHRoaXMuc3RhdGVbcGF0aF07IC8vIGRlbGV0ZSB0aGUgc3RhdGUgb2YgdGhlIHJlc291cmNlXG4gIH1cblxuICBwcml2YXRlIGFkZFNpbXVsYXRvclRyYWNlKHBhdGg6IHN0cmluZywgZGF0YTogYW55LCBsZXZlbDogTG9nTGV2ZWwpIHtcbiAgICBjb25zdCByZXNvdXJjZUNvbmZpZyA9IHRoaXMuZ2V0UmVzb3VyY2VDb25maWcocGF0aCk7XG4gICAgdGhpcy5hZGRUcmFjZSh7XG4gICAgICB0eXBlOiBUcmFjZVR5cGUuU0lNVUxBVE9SLFxuICAgICAgbGV2ZWwsXG4gICAgICBkYXRhOiBkYXRhLFxuICAgICAgc291cmNlUGF0aDogcmVzb3VyY2VDb25maWcucGF0aCxcbiAgICAgIHNvdXJjZVR5cGU6IHJlc291cmNlQ29uZmlnLnR5cGUsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9wIHRoZSBzaW11bGF0aW9uLCByZWxvYWQgdGhlIHNpbXVsYXRpb24gdHJlZSBmcm9tIHRoZSBsYXRlc3QgdmVyc2lvbiBvZlxuICAgKiB0aGUgYXBwIGZpbGUsIGFuZCByZXN0YXJ0IHRoZSBzaW11bGF0aW9uLlxuICAgKi9cbiAgcHVibGljIGFzeW5jIHJlbG9hZChyZXNldFN0YXRlOiBib29sZWFuKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5zdG9wKCk7XG5cbiAgICBpZiAocmVzZXRTdGF0ZSkge1xuICAgICAgYXdhaXQgcm0odGhpcy5zdGF0ZWRpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgICB0aGlzLl90cmFjZXMgPSBbXTtcbiAgICB9XG5cbiAgICB0aGlzLl9tb2RlbCA9IHRoaXMuX2xvYWRBcHAodGhpcy5fbW9kZWwuc2ltZGlyKTtcblxuICAgIGF3YWl0IHRoaXMuc3RhcnQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYSBsaXN0IG9mIGFsbCByZXNvdXJjZSBwYXRocy5cbiAgICovXG4gIHB1YmxpYyBsaXN0UmVzb3VyY2VzKCk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gdGhpcy5fbW9kZWwuZ3JhcGgubm9kZXMubWFwKCh4KSA9PiB4LnBhdGgpLnNvcnQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYSBsaXN0IG9mIGFsbCB0cmFjZXMgZnJvbSB0aGUgbW9zdCByZWNlbnQgc2ltdWxhdGlvbiBydW4uXG4gICAqL1xuICBwdWJsaWMgbGlzdFRyYWNlcygpOiBUcmFjZVtdIHtcbiAgICByZXR1cm4gWy4uLnRoaXMuX3RyYWNlc107XG4gIH1cblxuICAvKipcbiAgICogR2V0IGEgcmVzb3VyY2UgY2xpZW50LlxuICAgKiBAcmV0dXJucyB0aGUgcmVzb3VyY2VcbiAgICovXG4gIHB1YmxpYyBnZXRSZXNvdXJjZShwYXRoOiBzdHJpbmcpOiBhbnkge1xuICAgIGNvbnN0IGNsaWVudCA9IHRoaXMudHJ5R2V0UmVzb3VyY2UocGF0aCk7XG4gICAgaWYgKCFjbGllbnQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgUmVzb3VyY2UgXCIke3BhdGh9XCIgbm90IGZvdW5kLmApO1xuICAgIH1cbiAgICByZXR1cm4gY2xpZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhIHJlc291cmNlIGNsaWVudC5cbiAgICogQHJldHVybnMgVGhlIHJlc291cmNlIG9yIHVuZGVmaW5lZCBpZiBub3QgZm91bmRcbiAgICovXG4gIHB1YmxpYyB0cnlHZXRSZXNvdXJjZShwYXRoOiBzdHJpbmcpOiBhbnkgfCB1bmRlZmluZWQge1xuICAgIGNvbnN0IGhhbmRsZSA9IHRoaXMudHJ5R2V0UmVzb3VyY2VIYW5kbGUocGF0aCk7XG4gICAgaWYgKGhhbmRsZSkge1xuICAgICAgcmV0dXJuIG1ha2VTaW11bGF0b3JDbGllbnQodGhpcy51cmwsIGhhbmRsZSwgQURNSU5fUEVSTUlTU0lPTik7XG4gICAgfVxuXG4gICAgLy8gYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgdHJpY2s6IGlmIGEgdW5pdCB0ZXN0IHJlcXVlc3RzIGEgcmVzb3VyY2Ugd2l0aCBhIHBhdGggbGlrZSBcImZvby9iYXJcIlxuICAgIC8vIHdoaWNoIGlzIG5vdCBmb3VuZCwgYnV0IGEgcmVzb3VyY2UgXCJmb28vYmFyL1Jlc291cmNlXCIgZXhpc3RzIGFuZCBpdHNcbiAgICAvLyB0eXBlIGlzIEB3aW5nbGFuZy9zZGsuc2ltLlJlc291cmNlLCB0aGVuIHdlIHdpbGwgcmV0dXJuIHRoYXQgY2xpZW50IGluc3RlYWRcbiAgICBjb25zdCBjaGlsZFBhdGggPSBgJHtwYXRofS9SZXNvdXJjZWA7XG4gICAgY29uc3QgY2hpbGRDb25maWcgPSB0aGlzLnRyeUdldFJlc291cmNlQ29uZmlnKGNoaWxkUGF0aCk7XG4gICAgaWYgKGNoaWxkQ29uZmlnPy50eXBlID09PSBcIkB3aW5nbGFuZy9zZGsuc2ltLlJlc291cmNlXCIpIHtcbiAgICAgIGNvbnN0IGNoaWxkSGFuZGxlID0gdGhpcy50cnlHZXRSZXNvdXJjZUhhbmRsZShjaGlsZFBhdGgpO1xuICAgICAgaWYgKGNoaWxkSGFuZGxlKSB7XG4gICAgICAgIGNvbnN0IGNsaWVudCA9IG1ha2VTaW11bGF0b3JDbGllbnQoXG4gICAgICAgICAgdGhpcy51cmwsXG4gICAgICAgICAgY2hpbGRIYW5kbGUsXG4gICAgICAgICAgQURNSU5fUEVSTUlTU0lPTlxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IGdldCA9IChfdGFyZ2V0OiBhbnksIG1ldGhvZDogc3RyaW5nLCBfcmVjZWl2ZXI6IGFueSkgPT4ge1xuICAgICAgICAgIHJldHVybiBhc3luYyBmdW5jdGlvbiAoLi4uYXJnczogYW55W10pIHtcbiAgICAgICAgICAgIHJldHVybiBjbGllbnQuY2FsbChtZXRob2QsIGFyZ3MpO1xuICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm94eSh7fSwgeyBnZXQgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIHByaXZhdGUgdHJ5R2V0UmVzb3VyY2VIYW5kbGUocGF0aDogc3RyaW5nKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy50cnlHZXRSZXNvdXJjZUNvbmZpZyhwYXRoKT8uYXR0cnNbSEFORExFX0FUVFJJQlVURV07XG4gIH1cblxuICAvKipcbiAgICogT2J0YWluIGEgcmVzb3VyY2UncyBjb25maWd1cmF0aW9uLCBpbmNsdWRpbmcgaXRzIHR5cGUsIHByb3BzLCBhbmQgYXR0cnMuXG4gICAqIEByZXR1cm5zIFRoZSByZXNvdXJjZSBjb25maWd1cmF0aW9uIG9yIHVuZGVmaW5lZCBpZiBub3QgZm91bmRcbiAgICovXG4gIHB1YmxpYyB0cnlHZXRSZXNvdXJjZUNvbmZpZyhwYXRoOiBzdHJpbmcpOiBCYXNlUmVzb3VyY2VTY2hlbWEgfCB1bmRlZmluZWQge1xuICAgIC8vIHNob3J0aGFuZCAtIGFzc3VtZSB0cmVlIHJvb3QgaXMgbmFtZWQgXCJyb290XCIgYnkgZGVmYXVsdFxuICAgIGlmIChwYXRoLnN0YXJ0c1dpdGgoXCIvXCIpKSB7XG4gICAgICBwYXRoID0gYHJvb3Qke3BhdGh9YDtcbiAgICB9XG5cbiAgICBjb25zdCBkZWYgPSB0aGlzLl9tb2RlbC5ncmFwaC50cnlGaW5kKHBhdGgpPy5kZWY7XG4gICAgaWYgKCFkZWYpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgY29uc3Qgc3RhdGUgPSB0aGlzLnN0YXRlW3BhdGhdO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmRlZixcblxuICAgICAgLy8gbWVyZ2UgdGhlIGFjdHVhbCBzdGF0ZSAocHJvcHMgYW5kIGF0dHJzKSBvdmVyIHRoZSBkZXNpcmVkIHN0YXRlIGluIGBkZWZgXG4gICAgICAuLi5zdGF0ZSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIE9idGFpbiBhIHJlc291cmNlJ3MgY29uZmlndXJhdGlvbiwgaW5jbHVkaW5nIGl0cyB0eXBlLCBwcm9wcywgYW5kIGF0dHJzLlxuICAgKiBAcGFyYW0gcGF0aCBUaGUgcmVzb3VyY2UgcGF0aFxuICAgKiBAcmV0dXJucyBUaGUgcmVzb3VyY2UgY29uZmlndXJhdGlvblxuICAgKi9cbiAgcHVibGljIGdldFJlc291cmNlQ29uZmlnKHBhdGg6IHN0cmluZyk6IEJhc2VSZXNvdXJjZVNjaGVtYSB7XG4gICAgY29uc3QgY29uZmlnID0gdGhpcy50cnlHZXRSZXNvdXJjZUNvbmZpZyhwYXRoKTtcbiAgICBpZiAoIWNvbmZpZykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBSZXNvdXJjZSBcIiR7cGF0aH1cIiBub3QgZm91bmQuYCk7XG4gICAgfVxuICAgIHJldHVybiBjb25maWc7XG4gIH1cblxuICAvKipcbiAgICogT2J0YWluIGEgcmVzb3VyY2UncyBzdGF0ZSBkaXJlY3RvcnkgcGF0aC5cbiAgICogQHBhcmFtIHBhdGggVGhlIHJlc291cmNlIHBhdGhcbiAgICogQHJldHVybnMgVGhlIHJlc291cmNlIHN0YXRlIGRpcmVjdG9yeSBwYXRoXG4gICAqL1xuICBwdWJsaWMgZ2V0UmVzb3VyY2VTdGF0ZURpcihwYXRoOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMuZ2V0UmVzb3VyY2VDb25maWcocGF0aCk7XG4gICAgcmV0dXJuIGpvaW4odGhpcy5zdGF0ZWRpciwgY29uZmlnLmFkZHIpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBlbnN1cmVTdGF0ZURpckV4aXN0cyhwYXRoOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzdGF0ZWRpciA9IHRoaXMuZ2V0UmVzb3VyY2VTdGF0ZURpcihwYXRoKTtcbiAgICBjb25zdCBzdGF0ZWRpckV4aXN0cyA9IGF3YWl0IGV4aXN0cyhzdGF0ZWRpcik7XG4gICAgaWYgKCFzdGF0ZWRpckV4aXN0cykge1xuICAgICAgYXdhaXQgbWtkaXIoc3RhdGVkaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBPYnRhaW4gYSByZXNvdXJjZSdzIHZpc3VhbCBpbnRlcmFjdGlvbiBjb21wb25lbnRzLlxuICAgKiBAcmV0dXJucyBBbiBhcnJheSBvZiBVSUNvbXBvbmVudCBvYmplY3RzXG4gICAqL1xuICBwdWJsaWMgZ2V0UmVzb3VyY2VVSShwYXRoOiBzdHJpbmcpOiBhbnkge1xuICAgIGxldCB0cmVlRGF0YSA9IHRoaXMudHJlZSgpLnJhd0RhdGFGb3JOb2RlKHBhdGgpO1xuICAgIGlmICghdHJlZURhdGEpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgUmVzb3VyY2UgXCIke3BhdGh9XCIgbm90IGZvdW5kLmApO1xuICAgIH1cbiAgICByZXR1cm4gdHJlZURhdGEuZGlzcGxheT8udWkgPz8gW107XG4gIH1cblxuICBwcml2YXRlIHR5cGVJbmZvKGZxbjogc3RyaW5nKTogVHlwZVNjaGVtYSB7XG4gICAgY29uc3Qgc2NoZW1hID0gdGhpcy5fbW9kZWwuc2NoZW1hLnR5cGVzW2Zxbl07XG4gICAgaWYgKCFzY2hlbWEpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBzaW11bGF0b3IgdHlwZSAke2Zxbn1gKTtcbiAgICB9XG4gICAgcmV0dXJuIHNjaGVtYTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWdpc3RlciBhIHN1YnNjcmliZXIgdGhhdCB3aWxsIGJlIG5vdGlmaWVkIHdoZW4gYSB0cmFjZSBpcyBlbWl0dGVkIGJ5XG4gICAqIHRoZSBzaW11bGF0b3IuXG4gICAqL1xuICBwdWJsaWMgb25UcmFjZShzdWJzY3JpYmVyOiBJVHJhY2VTdWJzY3JpYmVyKSB7XG4gICAgdGhpcy5fdHJhY2VTdWJzY3JpYmVycy5wdXNoKHN1YnNjcmliZXIpO1xuICB9XG5cbiAgLyoqXG4gICAqIE9idGFpbiBpbmZvcm1hdGlvbiBhYm91dCB0aGUgYXBwbGljYXRpb24ncyBjb25zdHJ1Y3QgdHJlZS5cbiAgICovXG4gIHB1YmxpYyB0cmVlKCk6IFRyZWUge1xuICAgIHJldHVybiB0aGlzLl9tb2RlbC50cmVlO1xuICB9XG5cbiAgLyoqXG4gICAqIE9idGFpbiBpbmZvcm1hdGlvbiBhYm91dCB0aGUgYXBwbGljYXRpb24ncyBjb25uZWN0aW9ucy5cbiAgICovXG4gIHB1YmxpYyBjb25uZWN0aW9ucygpOiBDb25uZWN0aW9uRGF0YVtdIHtcbiAgICByZXR1cm4gc3RydWN0dXJlZENsb25lKHRoaXMuX21vZGVsLmNvbm5lY3Rpb25zKTtcbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tQZXJtaXNzaW9uKFxuICAgIGNhbGxlckhhbmRsZTogc3RyaW5nLFxuICAgIGNhbGxlZUhhbmRsZTogc3RyaW5nLFxuICAgIG1ldGhvZDogc3RyaW5nXG4gICk6IHsgZ3JhbnRlZDogYm9vbGVhbjsgcmVhc29uPzogc3RyaW5nIH0ge1xuICAgIGlmIChjYWxsZXJIYW5kbGUgPT09IEFETUlOX1BFUk1JU1NJT04pIHtcbiAgICAgIHJldHVybiB7IGdyYW50ZWQ6IHRydWUgfTtcbiAgICB9XG5cbiAgICBpZiAobWV0aG9kID09PSBcInRoZW5cIikge1xuICAgICAgLy8gQWx3YXlzIGdyYW50IHBlcm1pc3Npb25zIGZvciB0aGUgXCJ0aGVuXCIgbWV0aG9kIHNvIHRoYXQgYW4gZXJyb3IgaXNuJ3QgdGhyb3duXG4gICAgICAvLyBpZiBgYXdhaXQgY2xpZW50YCBpcyBjYWxsZWQgb24gYSBQcm94eSBvYmplY3QuIEluIEphdmFTY3JpcHQsIGBhd2FpdCB4YCB3aWxsXG4gICAgICAvLyBpbXBsaWNpdGx5IGNhbGwgYHgudGhlbigpYC5cbiAgICAgIHJldHVybiB7IGdyYW50ZWQ6IHRydWUgfTtcbiAgICB9XG5cbiAgICBjb25zdCBjYWxsZXJQYXRoID0gdGhpcy5faGFuZGxlcy50cnlGaW5kUGF0aChjYWxsZXJIYW5kbGUpO1xuICAgIGlmICghY2FsbGVyUGF0aCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZ3JhbnRlZDogZmFsc2UsXG4gICAgICAgIHJlYXNvbjogYChQZXJtaXNzaW9uIGNoZWNraW5nKSBObyBjYWxsZXIgcmVzb3VyY2Ugd2l0aCBoYW5kbGUgXCIke2NhbGxlckhhbmRsZX1cIiBmb3VuZC5gLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBjYWxsZWVQYXRoID0gdGhpcy5faGFuZGxlcy50cnlGaW5kUGF0aChjYWxsZWVIYW5kbGUpO1xuICAgIGlmICghY2FsbGVlUGF0aCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZ3JhbnRlZDogZmFsc2UsXG4gICAgICAgIHJlYXNvbjogYChQZXJtaXNzaW9uIGNoZWNraW5nKSBObyBjYWxsZWUgcmVzb3VyY2Ugd2l0aCBoYW5kbGUgXCIke2NhbGxlZUhhbmRsZX1cIiBmb3VuZC5gLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICB0aGlzLl9wb2xpY3lSZWdpc3RyeS5jaGVja1Blcm1pc3Npb24oY2FsbGVySGFuZGxlLCBjYWxsZWVIYW5kbGUsIG1ldGhvZClcbiAgICApIHtcbiAgICAgIHJldHVybiB7IGdyYW50ZWQ6IHRydWUgfTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgZ3JhbnRlZDogZmFsc2UsXG4gICAgICByZWFzb246IGBSZXNvdXJjZSBcIiR7Y2FsbGVyUGF0aH1cIiBkb2VzIG5vdCBoYXZlIHBlcm1pc3Npb24gdG8gcGVyZm9ybSBvcGVyYXRpb24gXCIke21ldGhvZH1cIiBvbiByZXNvdXJjZSBcIiR7Y2FsbGVlUGF0aH1cIi5gLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogU3RhcnQgYSBzZXJ2ZXIgdGhhdCBhbGxvd3MgYW55IHJlc291cmNlIHRvIGJlIGFjY2Vzc2VkIHZpYSBIVFRQLlxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBzdGFydFNlcnZlcigpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCByZXF1ZXN0TGlzdGVuZXIgPSAocmVxOiBJbmNvbWluZ01lc3NhZ2UsIHJlczogU2VydmVyUmVzcG9uc2UpID0+IHtcbiAgICAgIGlmICghcmVxLnVybD8uc3RhcnRzV2l0aChcIi92MS9jYWxsXCIpKSB7XG4gICAgICAgIHJlcy53cml0ZUhlYWQoNDA0KTtcbiAgICAgICAgcmVzLmVuZCgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGxldCBib2R5ID0gXCJcIjtcbiAgICAgIHJlcS5vbihcImRhdGFcIiwgKGNodW5rKSA9PiB7XG4gICAgICAgIGJvZHkgKz0gY2h1bms7XG4gICAgICB9KTtcbiAgICAgIHJlcS5vbihcImVuZFwiLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3Q6IFNpbXVsYXRvclNlcnZlclJlcXVlc3QgPSBkZXNlcmlhbGl6ZShib2R5KTtcbiAgICAgICAgY29uc3QgeyBjYWxsZXIsIGhhbmRsZSwgbWV0aG9kLCBhcmdzIH0gPSByZXF1ZXN0O1xuICAgICAgICBjb25zdCByZXNvdXJjZSA9IHRoaXMuX2hhbmRsZXMudHJ5RmluZChoYW5kbGUpO1xuXG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBjYWxsZXIgaGFzIHBlcm1pc3Npb24gdG8gY2FsbCB0aGUgbWV0aG9kIG9uIHRoZSByZXNvdXJjZVxuICAgICAgICBjb25zdCBncmFudCA9IHRoaXMuY2hlY2tQZXJtaXNzaW9uKGNhbGxlciwgaGFuZGxlLCBtZXRob2QpO1xuICAgICAgICBpZiAoIWdyYW50LmdyYW50ZWQpIHtcbiAgICAgICAgICByZXMud3JpdGVIZWFkKDQwMywgeyBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIiB9KTtcbiAgICAgICAgICByZXMuZW5kKFxuICAgICAgICAgICAgc2VyaWFsaXplKHtcbiAgICAgICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBncmFudC5yZWFzb24sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIFwidXRmLThcIlxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSWYgd2Ugd2VyZW4ndCBhYmxlIHRvIGZpbmQgYSByZXNvdXJjZSB3aXRoIHRoZSBnaXZlbiBoYW5kbGUsIGl0IGNvdWxkIGFjdHVhbGx5XG4gICAgICAgIC8vIGJlIE9LIGlmIHRoZSByZXNvdXJjZSBpcyBzdGlsbCBzdGFydGluZyB1cCBvciBoYXMgYWxyZWFkeSBiZWVuIGNsZWFuZWQgdXAuXG4gICAgICAgIC8vIEluIHRoYXQgY2FzZSwgd2UgcmV0dXJuIGEgNTAwIGVycm9yIHdpdGggYSBtZXNzYWdlIHRoYXQgZXhwbGFpbnMgd2hhdCBoYXBwZW5lZC5cbiAgICAgICAgaWYgKCFyZXNvdXJjZSkge1xuICAgICAgICAgIHJlcy53cml0ZUhlYWQoNTAwLCB7IFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiIH0pO1xuICAgICAgICAgIGlmICh0aGlzLl9ydW5uaW5nID09PSBcInN0YXJ0aW5nXCIpIHtcbiAgICAgICAgICAgIHJlcy5lbmQoXG4gICAgICAgICAgICAgIHNlcmlhbGl6ZSh7XG4gICAgICAgICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGBSZXNvdXJjZSAke2hhbmRsZX0gbm90IGZvdW5kLiBJdCBtYXkgbm90IGhhdmUgYmVlbiBpbml0aWFsaXplZCB5ZXQuYCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgXCJ1dGYtOFwiXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fcnVubmluZyA9PT0gXCJzdG9wcGluZ1wiKSB7XG4gICAgICAgICAgICByZXMuZW5kKFxuICAgICAgICAgICAgICBzZXJpYWxpemUoe1xuICAgICAgICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICAgICAgICBtZXNzYWdlOiBgUmVzb3VyY2UgJHtoYW5kbGV9IG5vdCBmb3VuZC4gSXQgbWF5IGhhdmUgYmVlbiBjbGVhbmVkIHVwIGFscmVhZHkuYCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgXCJ1dGYtOFwiXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXMuZW5kKFxuICAgICAgICAgICAgICBzZXJpYWxpemUoe1xuICAgICAgICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICAgICAgICBtZXNzYWdlOiBgSW50ZXJuYWwgZXJyb3IgLSByZXNvdXJjZSAke2hhbmRsZX0gbm90IGZvdW5kLmAsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIFwidXRmLThcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBtZXRob2RFeGlzdHMgPSAocmVzb3VyY2UgYXMgYW55KVttZXRob2RdICE9PSB1bmRlZmluZWQ7XG4gICAgICAgIGlmICghbWV0aG9kRXhpc3RzKSB7XG4gICAgICAgICAgY29uc3QgcmVzb3VyY2VQYXRoID0gdGhpcy5faGFuZGxlcy50cnlGaW5kUGF0aChoYW5kbGUpO1xuICAgICAgICAgIHJlcy53cml0ZUhlYWQoNTAwLCB7IFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiIH0pO1xuICAgICAgICAgIHJlcy5lbmQoXG4gICAgICAgICAgICBzZXJpYWxpemUoe1xuICAgICAgICAgICAgICBlcnJvcjoge1xuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGBNZXRob2QgXCIke21ldGhvZH1cIiBub3QgZm91bmQgb24gcmVzb3VyY2UgJHtoYW5kbGV9ICgke3Jlc291cmNlUGF0aH0pLmAsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIFwidXRmLThcIlxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgKHJlc291cmNlIGFzIGFueSlcbiAgICAgICAgICBbbWV0aG9kXSguLi5hcmdzKVxuICAgICAgICAgIC50aGVuKChyZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgcmVzLndyaXRlSGVhZCgyMDAsIHsgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIgfSk7XG4gICAgICAgICAgICByZXMuZW5kKHNlcmlhbGl6ZSh7IHJlc3VsdCB9KSwgXCJ1dGYtOFwiKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaCgoZXJyOiBhbnkpID0+IHtcbiAgICAgICAgICAgIHJlcy53cml0ZUhlYWQoNTAwLCB7IFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiIH0pO1xuICAgICAgICAgICAgcmVzLmVuZChcbiAgICAgICAgICAgICAgc2VyaWFsaXplKHtcbiAgICAgICAgICAgICAgICBlcnJvcjoge1xuICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXJyPy5tZXNzYWdlID8/IGAke2Vycn1gLFxuICAgICAgICAgICAgICAgICAgc3RhY2s6IGVyci5zdGFjayxcbiAgICAgICAgICAgICAgICAgIG5hbWU6IGVyci5uYW1lLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBcInV0Zi04XCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgLy8gb25seSBpbXBvcnQgXCJodHRwXCIgd2hlbiB0aGlzIG1ldGhvZCBpcyBjYWxsZWQgdG8gcmVkdWNlIHRoZSB0aW1lIGl0IHRha2VzIHRvIGxvYWQgV2luZyBTREtcbiAgICBjb25zdCBodHRwID0gYXdhaXQgaW1wb3J0KFwibm9kZTpodHRwXCIpO1xuXG4gICAgLy8gc3RhcnQgdGhlIHNlcnZlciwgYW5kIHdhaXQgZm9yIGl0IHRvIGJlIGxpc3RlbmluZ1xuICAgIGNvbnN0IHNlcnZlciA9IGh0dHAuY3JlYXRlU2VydmVyKHJlcXVlc3RMaXN0ZW5lcik7XG4gICAgYXdhaXQgbmV3IFByb21pc2U8dm9pZD4oKG9rKSA9PiB7XG4gICAgICBzZXJ2ZXIubGlzdGVuKDAsIExPQ0FMSE9TVF9BRERSRVNTLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGFkZHIgPSBzZXJ2ZXIuYWRkcmVzcygpO1xuICAgICAgICBpZiAoYWRkciAmJiB0eXBlb2YgYWRkciA9PT0gXCJvYmplY3RcIiAmJiAoYWRkciBhcyBhbnkpLnBvcnQpIHtcbiAgICAgICAgICB0aGlzLl9zZXJ2ZXJVcmwgPSBgaHR0cDovLyR7YWRkci5hZGRyZXNzfToke2FkZHIucG9ydH1gO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3NlcnZlciA9IHNlcnZlcjtcbiAgICAgICAgb2soKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0b3AgdGhlIHNpbXVsYXRvciBzZXJ2ZXIuXG4gICAqL1xuICBwcml2YXRlIHN0b3BTZXJ2ZXIoKSB7XG4gICAgdGhpcy5fc2VydmVyIS5jbG9zZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBVUkwgdGhhdCB0aGUgc2ltdWxhdG9yIHNlcnZlciBpcyBsaXN0ZW5pbmcgb24uXG4gICAqL1xuICBwdWJsaWMgZ2V0IHVybCgpOiBzdHJpbmcge1xuICAgIGlmICghdGhpcy5fc2VydmVyVXJsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTaW11bGF0b3Igc2VydmVyIGlzIG5vdCBydW5uaW5nLlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX3NlcnZlclVybDtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgc3RhcnRSZXNvdXJjZShwYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5pc1N0YXJ0ZWQocGF0aCkpIHtcbiAgICAgIHJldHVybjsgLy8gYWxyZWFkeSBzdGFydGVkXG4gICAgfVxuXG4gICAgLy8gZmlyc3QgbGV0cyBtYWtlIHN1cmUgYWxsIG15IGRlcGVuZGVuY2llcyBoYXZlIGJlZW4gc3RhcnRlZCAoZGVwdGgtZmlyc3QpXG4gICAgZm9yIChjb25zdCBkIG9mIHRoaXMuX21vZGVsLmdyYXBoLnRyeUZpbmQocGF0aCk/LmRlcGVuZGVuY2llcyA/PyBbXSkge1xuICAgICAgYXdhaXQgdGhpcy5zdGFydFJlc291cmNlKGQpO1xuICAgIH1cblxuICAgIGNvbnN0IHJlc291cmNlQ29uZmlnID0gdGhpcy5nZXRSZXNvdXJjZUNvbmZpZyhwYXRoKTtcblxuICAgIGNvbnN0IHJlc29sdmVkUHJvcHMgPSB0aGlzLnJlc29sdmVUb2tlbnMocGF0aCwgcmVzb3VyY2VDb25maWcucHJvcHMpO1xuICAgIGNvbnN0IHJlc29sdmVkUG9saWN5OiBQb2xpY3lTdGF0ZW1lbnRbXSA9XG4gICAgICB0aGlzLnJlc29sdmVUb2tlbnMocGF0aCwgcmVzb3VyY2VDb25maWcucG9saWN5KSA/PyBbXTtcblxuICAgIC8vIGxvb2sgdXAgdGhlIGxvY2F0aW9uIG9mIHRoZSBjb2RlIGZvciB0aGUgdHlwZVxuICAgIGNvbnN0IHR5cGVJbmZvID0gdGhpcy50eXBlSW5mbyhyZXNvdXJjZUNvbmZpZy50eXBlKTtcblxuICAgIC8vIHNldCB1cCBhIHN0YXRlIGRpcmVjdG9yeSBmb3IgdGhlIHJlc291cmNlXG4gICAgYXdhaXQgbWtkaXIodGhpcy5nZXRSZXNvdXJjZVN0YXRlRGlyKHJlc291cmNlQ29uZmlnLnBhdGgpLCB7XG4gICAgICByZWN1cnNpdmU6IHRydWUsXG4gICAgfSk7XG5cbiAgICAvLyBpbml0aWFsaXplIHRoZSByZXNvdXJjZSBzdGF0ZSBvYmplY3Qgd2l0aG91dCBhdHRycyBmb3Igbm93XG4gICAgdGhpcy5zdGF0ZVtwYXRoXSA9IHtcbiAgICAgIHByb3BzOiByZXNvbHZlZFByb3BzLFxuICAgICAgYXR0cnM6IHt9LFxuICAgICAgcG9saWN5OiByZXNvbHZlZFBvbGljeSxcbiAgICB9O1xuXG4gICAgLy8gY3JlYXRlIHRoZSByZXNvdXJjZSBiYXNlZCBvbiBpdHMgdHlwZVxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tcmVxdWlyZS1pbXBvcnRzXG4gICAgY29uc3QgUmVzb3VyY2VUeXBlID0gcmVxdWlyZSh0eXBlSW5mby5zb3VyY2VQYXRoKVt0eXBlSW5mby5jbGFzc05hbWVdO1xuICAgIGNvbnN0IHJlc291cmNlT2JqZWN0ID0gbmV3IFJlc291cmNlVHlwZShyZXNvbHZlZFByb3BzKTtcblxuICAgIC8vIGFsbG9jYXRlIGEgaGFuZGxlIGZvciB0aGUgcmVzb3VyY2Ugc28gb3RoZXJzIGNhbiBmaW5kIGl0XG4gICAgY29uc3QgaGFuZGxlID0gdGhpcy5faGFuZGxlcy5hbGxvY2F0ZShwYXRoLCByZXNvdXJjZU9iamVjdCk7XG5cbiAgICAvLyBpZiB0aGUgcmVzb3VyY2UgaXMgYSBwb2xpY3ksIGFkZCBpdCB0byB0aGUgcG9saWN5IHJlZ2lzdHJ5XG4gICAgaWYgKHJlc291cmNlQ29uZmlnLnR5cGUgPT09IFBPTElDWV9GUU4pIHtcbiAgICAgIGNvbnN0IHBvbGljeSA9IHJlc29sdmVkUHJvcHMgYXMgUG9saWN5U2NoZW1hO1xuICAgICAgdGhpcy5fcG9saWN5UmVnaXN0cnkucmVnaXN0ZXIocmVzb3VyY2VDb25maWcucGF0aCwgcG9saWN5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gb3RoZXJ3aXNlLCBhZGQgdGhlIHJlc291cmNlJ3MgaW5saW5lIHBvbGljeSB0byB0aGUgcG9saWN5IHJlZ2lzdHJ5XG4gICAgICBjb25zdCBwb2xpY3kgPSB7XG4gICAgICAgIHN0YXRlbWVudHM6IHJlc29sdmVkUG9saWN5LFxuICAgICAgICBwcmluY2lwYWw6IGhhbmRsZSxcbiAgICAgIH07XG4gICAgICB0aGlzLl9wb2xpY3lSZWdpc3RyeS5yZWdpc3RlcihyZXNvdXJjZUNvbmZpZy5wYXRoLCBwb2xpY3kpO1xuICAgIH1cblxuICAgIC8vIGluaXRpYWxpemUgdGhlIHJlc291cmNlIHdpdGggdGhlIHNpbXVsYXRvciBjb250ZXh0XG4gICAgY29uc3QgY29udGV4dCA9IHRoaXMuY3JlYXRlQ29udGV4dChyZXNvdXJjZUNvbmZpZywgaGFuZGxlKTtcbiAgICBjb25zdCBhdHRycyA9IGF3YWl0IHJlc291cmNlT2JqZWN0LmluaXQoY29udGV4dCk7XG5cbiAgICAvLyBzYXZlIHRoZSBjdXJyZW50IHN0YXRlXG4gICAgYXdhaXQgcmVzb3VyY2VPYmplY3Quc2F2ZSgpO1xuXG4gICAgLy8gbWVyZ2UgdGhlIGF0dHJpYnV0ZXNcbiAgICB0aGlzLnN0YXRlW3BhdGhdLmF0dHJzID0ge1xuICAgICAgLi4udGhpcy5zdGF0ZVtwYXRoXS5hdHRycyxcbiAgICAgIC4uLmF0dHJzLFxuICAgICAgW0hBTkRMRV9BVFRSSUJVVEVdOiBoYW5kbGUsXG4gICAgfTtcblxuICAgIC8vIHRyYWNlIHRoZSByZXNvdXJjZSBjcmVhdGlvblxuICAgIHRoaXMuYWRkU2ltdWxhdG9yVHJhY2UoXG4gICAgICBwYXRoLFxuICAgICAge1xuICAgICAgICBtZXNzYWdlOiBgJHtyZXNvdXJjZUNvbmZpZy5wYXRofSBzdGFydGVkYCxcbiAgICAgIH0sXG4gICAgICBMb2dMZXZlbC5WRVJCT1NFXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlQ29udGV4dChcbiAgICByZXNvdXJjZUNvbmZpZzogQmFzZVJlc291cmNlU2NoZW1hLFxuICAgIHJlc291cmNlSGFuZGxlOiBzdHJpbmdcbiAgKTogSVNpbXVsYXRvckNvbnRleHQge1xuICAgIHJldHVybiB7XG4gICAgICBzaW1kaXI6IHRoaXMuX21vZGVsLnNpbWRpcixcbiAgICAgIHN0YXRlZGlyOiBqb2luKHRoaXMuc3RhdGVkaXIsIHJlc291cmNlQ29uZmlnLmFkZHIpLFxuICAgICAgcmVzb3VyY2VQYXRoOiByZXNvdXJjZUNvbmZpZy5wYXRoLFxuICAgICAgcmVzb3VyY2VIYW5kbGU6IHJlc291cmNlSGFuZGxlLFxuICAgICAgc2VydmVyVXJsOiB0aGlzLnVybCxcbiAgICAgIGdldENsaWVudDogKGNhbGxlZUhhbmRsZTogc3RyaW5nLCBhc0FkbWluOiBib29sZWFuKSA9PiB7XG4gICAgICAgIGNvbnN0IGNhbGxlckhhbmRsZSA9IGFzQWRtaW4gPyBBRE1JTl9QRVJNSVNTSU9OIDogcmVzb3VyY2VIYW5kbGU7XG4gICAgICAgIHJldHVybiBtYWtlU2ltdWxhdG9yQ2xpZW50KHRoaXMudXJsLCBjYWxsZWVIYW5kbGUsIGNhbGxlckhhbmRsZSk7XG4gICAgICB9LFxuICAgICAgYWRkVHJhY2U6ICh0cmFjZTogVHJhY2UpID0+IHtcbiAgICAgICAgdGhpcy5hZGRUcmFjZSh0cmFjZSk7XG4gICAgICB9LFxuICAgICAgd2l0aFRyYWNlOiBhc3luYyAocHJvcHM6IElXaXRoVHJhY2VQcm9wcykgPT4ge1xuICAgICAgICAvLyBUT0RPOiBsb2cgc3RhcnQgdGltZSBhbmQgZW5kIHRpbWUgb2YgYWN0aXZpdHk/XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgbGV0IHJlc3VsdCA9IGF3YWl0IHByb3BzLmFjdGl2aXR5KCk7XG4gICAgICAgICAgdGhpcy5hZGRUcmFjZSh7XG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIG1lc3NhZ2U6IHByb3BzLm1lc3NhZ2UsXG4gICAgICAgICAgICAgIHN0YXR1czogXCJzdWNjZXNzXCIsXG4gICAgICAgICAgICAgIHJlc3VsdDogSlNPTi5zdHJpbmdpZnkocmVzdWx0KSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0eXBlOiBUcmFjZVR5cGUuUkVTT1VSQ0UsXG4gICAgICAgICAgICBsZXZlbDogTG9nTGV2ZWwuVkVSQk9TRSxcbiAgICAgICAgICAgIHNvdXJjZVBhdGg6IHJlc291cmNlQ29uZmlnLnBhdGgsXG4gICAgICAgICAgICBzb3VyY2VUeXBlOiByZXNvdXJjZUNvbmZpZy50eXBlLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcbiAgICAgICAgICB0aGlzLmFkZFRyYWNlKHtcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgbWVzc2FnZTogYEVycm9yOiAke2Vyci5tZXNzYWdlfSAoJHtwcm9wcy5tZXNzYWdlfSlgLFxuICAgICAgICAgICAgICBlcnJvcjogZXJyLFxuICAgICAgICAgICAgICBzdGF0dXM6IFwiZmFpbHVyZVwiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHR5cGU6IFRyYWNlVHlwZS5SRVNPVVJDRSxcbiAgICAgICAgICAgIGxldmVsOiBMb2dMZXZlbC5WRVJCT1NFLFxuICAgICAgICAgICAgc291cmNlUGF0aDogcmVzb3VyY2VDb25maWcucGF0aCxcbiAgICAgICAgICAgIHNvdXJjZVR5cGU6IHJlc291cmNlQ29uZmlnLnR5cGUsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBsaXN0VHJhY2VzOiAoKSA9PiB7XG4gICAgICAgIHJldHVybiBbLi4udGhpcy5fdHJhY2VzXTtcbiAgICAgIH0sXG4gICAgICBzZXRSZXNvdXJjZUF0dHJpYnV0ZXM6IChwYXRoOiBzdHJpbmcsIGF0dHJzOiBSZWNvcmQ8c3RyaW5nLCBhbnk+KSA9PiB7XG4gICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGF0dHJzKSkge1xuICAgICAgICAgIHRoaXMuYWRkU2ltdWxhdG9yVHJhY2UoXG4gICAgICAgICAgICBwYXRoLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBtZXNzYWdlOiBgJHtwYXRofS4ke2tleX0gPSAke3ZhbHVlfWAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgTG9nTGV2ZWwuVkVSQk9TRVxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnN0YXRlW3BhdGhdLmF0dHJzID0geyAuLi50aGlzLnN0YXRlW3BhdGhdLmF0dHJzLCAuLi5hdHRycyB9O1xuICAgICAgfSxcbiAgICAgIHJlc291cmNlQXR0cmlidXRlczogKHBhdGg6IHN0cmluZykgPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZVtwYXRoXS5hdHRycztcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgYWRkVHJhY2UoZXZlbnQ6IFRyYWNlKSB7XG4gICAgZXZlbnQgPSBPYmplY3QuZnJlZXplKGV2ZW50KTtcbiAgICBmb3IgKGNvbnN0IHN1YiBvZiB0aGlzLl90cmFjZVN1YnNjcmliZXJzKSB7XG4gICAgICBzdWIuY2FsbGJhY2soZXZlbnQpO1xuICAgIH1cbiAgICB0aGlzLl90cmFjZXMucHVzaChldmVudCk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIGFuIG9iamVjdCB3aXRoIGFsbCB0b2tlbnMgaW4gaXQgcmVzb2x2ZWQgdG8gdGhlaXIgYXBwcm9wcmlhdGUgdmFsdWVzLlxuICAgKlxuICAgKiBBIHRva2VuIGNhbiBiZSBhIHN0cmluZyBsaWtlIFwiJHthcHAvbXlfYnVja2V0I2F0dHJzLmhhbmRsZX1cIi4gVGhpcyB0b2tlbiB3b3VsZCBiZSByZXNvbHZlZCB0b1xuICAgKiB0aGUgXCJoYW5kbGVcIiBhdHRyaWJ1dGUgb2YgdGhlIHJlc291cmNlIGF0IHBhdGggXCJhcHAvbXlfYnVja2V0XCIuIElmIHRoYXQgYXR0cmlidXRlIGRvZXMgbm90XG4gICAqIGV4aXN0IGF0IHRoZSB0aW1lIG9mIHJlc29sdXRpb24gKGZvciBleGFtcGxlLCBpZiBteV9idWNrZXQgaXMgbm90IGJlaW5nIHNpbXVsYXRlZCB5ZXQpLCBhblxuICAgKiBlcnJvciB3aWxsIGJlIHRocm93bi5cbiAgICpcbiAgICogVG9rZW5zIGNhbiBhbHNvIGJlIG5lc3RlZCwgbGlrZSBcIiR7YXBwL215X2J1Y2tldCNhdHRycy5oYW5kbGV9L2Zvby9iYXJcIi5cbiAgICpcbiAgICogQHBhcmFtIG9iaiBUaGUgb2JqZWN0IHRvIHJlc29sdmUgdG9rZW5zIGluLlxuICAgKiBAcmV0dXJucyBgdW5kZWZpbmVkYCBpZiB0aGUgdG9rZW4gY291bGQgbm90IGJlIHJlc29sdmVkIChlLmcuIG5lZWRzIGEgZGVwZW5kZW5jeSksIG90aGVyd2lzZVxuICAgKiB0aGUgcmVzb2x2ZWQgdmFsdWUuXG4gICAqL1xuICBwcml2YXRlIHJlc29sdmVUb2tlbnMocmVzb2x2ZXI6IHN0cmluZywgb2JqOiBhbnkpOiBhbnkge1xuICAgIHJldHVybiByZXNvbHZlVG9rZW5zKG9iaiwgKHRva2VuKSA9PiB7XG4gICAgICBjb25zdCB0YXJnZXQgPSB0aGlzLl9tb2RlbC5ncmFwaC50cnlGaW5kKHRva2VuLnBhdGgpO1xuICAgICAgaWYgKCF0YXJnZXQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBDb3VsZCBub3QgcmVzb2x2ZSB0b2tlbiBcIiR7dG9rZW59XCIgYmVjYXVzZSB0aGUgcmVzb3VyY2UgYXQgcGF0aCBcIiR7dG9rZW4ucGF0aH1cIiBkb2VzIG5vdCBleGlzdC5gXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHIgPSB0aGlzLmdldFJlc291cmNlQ29uZmlnKHRhcmdldC5wYXRoKTtcblxuICAgICAgaWYgKHRva2VuLmF0dHIpIHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSByLmF0dHJzW3Rva2VuLmF0dHJdO1xuICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHRocm93IG5ldyBVbnJlc29sdmVkVG9rZW5FcnJvcihcbiAgICAgICAgICAgIGBVbmFibGUgdG8gcmVzb2x2ZSBhdHRyaWJ1dGUgJyR7dG9rZW4uYXR0cn0nIGZvciByZXNvdXJjZSBcIiR7dGFyZ2V0LnBhdGh9XCIgcmVmZXJlbmNlZCBieSBcIiR7cmVzb2x2ZXJ9XCJgXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9XG5cbiAgICAgIGlmICh0b2tlbi5wcm9wKSB7XG4gICAgICAgIHJldHVybiByLnByb3BzW3Rva2VuLnByb3BdO1xuICAgICAgfVxuXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgdG9rZW46ICR7dG9rZW59YCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2l2ZW4gdGhlIFwiY3VycmVudFwiIHNldCBvZiByZXNvdXJjZXMgYW5kIGEgXCJuZXh0XCIgc2V0IG9mIHJlc291cmNlcywgY2FsY3VsYXRlIHRoZSBkaWZmIGFuZFxuICAgKiBkZXRlcm1pbmUgd2hpY2ggcmVzb3VyY2VzIG5lZWQgdG8gYmUgYWRkZWQsIHVwZGF0ZWQgb3IgZGVsZXRlZC5cbiAgICpcbiAgICogTm90ZSB0aGF0IGRlcGVuZGVuY2llcyBhcmUgbm90IGNvbnNpZGVyZWQgaGVyZSBidXQgdGhleSBhcmUgaW1wbGljaXRseSBoYW5kbGVkIGJ5IHRoZVxuICAgKiBgc3RhcnRSZXNvdXJjZWAgYW5kIGBzdG9wUmVzb3VyY2VgIG1ldGhvZHMuIFNvLCBmb3IgZXhhbXBsZSwgd2hlbiBhIHJlc291cmNlIGlzIHVwZGF0ZWQsXG4gICAqIGFsbCBvZiBpdCdzIGRlcGVuZGVudHMgd2lsbCBiZSBzdG9wcGVkIGFuZCBzdGFydGVkIGFnYWluLlxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBwbGFuVXBkYXRlKFxuICAgIGN1cnJlbnQ6IFJlY29yZDxzdHJpbmcsIEJhc2VSZXNvdXJjZVNjaGVtYT4sXG4gICAgbmV4dDogUmVjb3JkPHN0cmluZywgQmFzZVJlc291cmNlU2NoZW1hPlxuICApIHtcbiAgICAvLyBNYWtlIHN1cmUgd2UncmUgd29ya2luZyBvbiBhIGNvcHkgb2YgXCJjdXJyZW50XCJcbiAgICBjdXJyZW50ID0geyAuLi5jdXJyZW50IH07XG5cbiAgICBjb25zdCBhZGRlZDogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCB1cGRhdGVkOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IGRlbGV0ZWQ6IHN0cmluZ1tdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IFtwYXRoLCBuZXh0Q29uZmlnXSBvZiBPYmplY3QuZW50cmllcyhuZXh0KSkge1xuICAgICAgY29uc3QgY3VyckNvbmZpZyA9IGN1cnJlbnRbcGF0aF07XG5cbiAgICAgIC8vIGlmIHRoZSByZXNvdXJjZSBpcyBub3QgaW4gXCJjdXJyZW50XCIsIGl0IG1lYW5zIGl0IHdhcyBhZGRlZFxuICAgICAgaWYgKCFjdXJyQ29uZmlnKSB7XG4gICAgICAgIGFkZGVkLnB1c2gobmV4dENvbmZpZy5wYXRoKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIC8vIHRoZSByZXNvdXJjZSBpcyBhbHJlYWR5IGluIFwiY3VycmVudFwiLCBpZiBpdCdzIGRpZmZlcmVudCBmcm9tIFwibmV4dFwiLCBpdCBtZWFucyBpdCB3YXMgdXBkYXRlZFxuICAgICAgaWYgKGF3YWl0IHRoaXMuc2hvdWxkUmVwbGFjZShwYXRoLCBjdXJyQ29uZmlnLCBuZXh0Q29uZmlnKSkge1xuICAgICAgICB1cGRhdGVkLnB1c2gobmV4dENvbmZpZy5wYXRoKTtcbiAgICAgIH1cblxuICAgICAgLy8gcmVtb3ZlIGl0IGZyb20gXCJjdXJyZW50XCIgc28gd2Uga25vdyB3aGF0J3MgbGVmdCB0byBiZSBkZWxldGVkXG4gICAgICBkZWxldGUgY3VycmVudFtwYXRoXTtcbiAgICB9XG5cbiAgICAvLyBldmVyeXRoaW5nIGxlZnQgaW4gXCJjdXJyZW50XCIgaXMgdG8gYmUgZGVsZXRlZFxuICAgIGZvciAoY29uc3QgY29uZmlnIG9mIE9iamVjdC52YWx1ZXMoY3VycmVudCkpIHtcbiAgICAgIGRlbGV0ZWQucHVzaChjb25maWcucGF0aCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgYWRkZWQsIHVwZGF0ZWQsIGRlbGV0ZWQgfTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgc2hvdWxkUmVwbGFjZShcbiAgICBwYXRoOiBzdHJpbmcsXG4gICAgb2xkQ29uZmlnOiBCYXNlUmVzb3VyY2VTY2hlbWEsXG4gICAgbmV3Q29uZmlnOiBCYXNlUmVzb3VyY2VTY2hlbWFcbiAgKSB7XG4gICAgY29uc3Qgc3RhdGUgPSAocjogQmFzZVJlc291cmNlU2NoZW1hKSA9PlxuICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBwcm9wczogci5wcm9wcyxcbiAgICAgICAgdHlwZTogci50eXBlLFxuICAgICAgICBwb2xpY3lTdGF0ZW1lbnRzOiByLnBvbGljeSxcbiAgICAgIH0pO1xuXG4gICAgY29uc3QgaW52YWxpZGF0ZWQgPSBzdGF0ZShvbGRDb25maWcpICE9PSBzdGF0ZShuZXdDb25maWcpO1xuXG4gICAgLy8gY29uc3VsdCB0aGUgcmVzb3VyY2UncyBcInBsYW4oKVwiIG1ldGhvZCBpZiBpdCBoYXMgb25lXG4gICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLnRyeUdldFJlc291cmNlKHBhdGgpIGFzIElTaW11bGF0b3JSZXNvdXJjZUluc3RhbmNlO1xuICAgIGNvbnN0IHBsYW4gPSBpbnN0YW5jZSA/IGF3YWl0IGluc3RhbmNlLnBsYW4oaW52YWxpZGF0ZWQpIDogVXBkYXRlUGxhbi5BVVRPO1xuXG4gICAgc3dpdGNoIChwbGFuKSB7XG4gICAgICBjYXNlIFVwZGF0ZVBsYW4uU0tJUDpcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICBjYXNlIFVwZGF0ZVBsYW4uUkVQTEFDRTpcbiAgICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICAgIGNhc2UgVXBkYXRlUGxhbi5BVVRPOlxuICAgICAgICAvLyBSZXBsYWNlIHRoZSByZXNvdXJjZSBpZiB0aGUgbmV3IGNvbmZpZ3VyYXRpb24gaXMgZGlmZmVyZW50IGZyb20gdGhlIGN1cnJlbnQgY29uZmlndXJhdGlvblxuICAgICAgICAvL1xuICAgICAgICAvLyBOb3RlOiB3ZSdyZSBjb21wYXJpbmcgdGhlIHVucmVzb2x2ZWQgY29uZmlndXJhdGlvbnMsIGVpdGhlciBvZiB3aGljaCBtYXkgY29udGFpbiB0b2tlbnMuXG4gICAgICAgIC8vIFNvIGV2ZW4gaWYgdGhlIGNvbmZpZ3VyYXRpb25zIG1heSBsb29rIHRoZSBzYW1lLCBpdCdzIHBvc3NpYmxlIHRoYXQgYSByZXBsYWNlbWVudFxuICAgICAgICAvLyBpcyBzdGlsbCBuZWNlc3NhcnkuXG4gICAgICAgIHJldHVybiBpbnZhbGlkYXRlZDtcbiAgICB9XG4gIH1cbn1cblxuY2xhc3MgVW5yZXNvbHZlZFRva2VuRXJyb3IgZXh0ZW5kcyBFcnJvciB7fVxuXG4vKipcbiAqIEEgZmFjdG9yeSB0aGF0IGNhbiB0dXJuIHJlc291cmNlIGRlc2NyaXB0aW9ucyBpbnRvIChpbmZsaWdodCkgcmVzb3VyY2Ugc2ltdWxhdGlvbnMuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSVNpbXVsYXRvckZhY3Rvcnkge1xuICAvKipcbiAgICogUmVzb2x2ZSB0aGUgcGFyYW1ldGVycyBuZWVkZWQgZm9yIGNyZWF0aW5nIGEgc3BlY2lmaWMgcmVzb3VyY2Ugc2ltdWxhdGlvbi5cbiAgICovXG4gIHJlc29sdmUoXG4gICAgdHlwZTogc3RyaW5nLFxuICAgIHByb3BzOiBhbnksXG4gICAgY29udGV4dDogSVNpbXVsYXRvckNvbnRleHRcbiAgKTogSVNpbXVsYXRvclJlc291cmNlSW5zdGFuY2U7XG59XG5cbmNsYXNzIEhhbmRsZU1hbmFnZXIge1xuICBwcml2YXRlIHJlYWRvbmx5IGhhbmRsZXM6IE1hcDxzdHJpbmcsIElTaW11bGF0b3JSZXNvdXJjZUluc3RhbmNlPjtcbiAgcHJpdmF0ZSByZWFkb25seSBwYXRoczogTWFwPHN0cmluZywgc3RyaW5nPjsgLy8gaGFuZGxlIC0+IHBhdGhcbiAgcHJpdmF0ZSBuZXh0SGFuZGxlOiBudW1iZXI7XG5cbiAgcHVibGljIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuaGFuZGxlcyA9IG5ldyBNYXAoKTtcbiAgICB0aGlzLnBhdGhzID0gbmV3IE1hcCgpO1xuICAgIHRoaXMubmV4dEhhbmRsZSA9IDA7XG4gIH1cblxuICBwdWJsaWMgYWxsb2NhdGUocGF0aDogc3RyaW5nLCByZXNvdXJjZTogSVNpbXVsYXRvclJlc291cmNlSW5zdGFuY2UpOiBzdHJpbmcge1xuICAgIGNvbnN0IGhhbmRsZSA9IGBzaW0tJHt0aGlzLm5leHRIYW5kbGUrK31gO1xuICAgIHRoaXMuaGFuZGxlcy5zZXQoaGFuZGxlLCByZXNvdXJjZSk7XG4gICAgdGhpcy5wYXRocy5zZXQoaGFuZGxlLCBwYXRoKTtcbiAgICByZXR1cm4gaGFuZGxlO1xuICB9XG5cbiAgcHVibGljIGZpbmQoaGFuZGxlOiBzdHJpbmcpOiBJU2ltdWxhdG9yUmVzb3VyY2VJbnN0YW5jZSB7XG4gICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLnRyeUZpbmQoaGFuZGxlKTtcbiAgICBpZiAoIWluc3RhbmNlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIHJlc291cmNlIGZvdW5kIHdpdGggaGFuZGxlIFwiJHtoYW5kbGV9XCIuYCk7XG4gICAgfVxuICAgIHJldHVybiBpbnN0YW5jZTtcbiAgfVxuXG4gIHB1YmxpYyB0cnlGaW5kKGhhbmRsZTogc3RyaW5nKTogSVNpbXVsYXRvclJlc291cmNlSW5zdGFuY2UgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmhhbmRsZXMuZ2V0KGhhbmRsZSk7XG4gIH1cblxuICBwdWJsaWMgdHJ5RmluZFBhdGgoaGFuZGxlOiBzdHJpbmcpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLnBhdGhzLmdldChoYW5kbGUpO1xuICB9XG5cbiAgcHVibGljIGRlYWxsb2NhdGUoaGFuZGxlOiBzdHJpbmcpOiBJU2ltdWxhdG9yUmVzb3VyY2VJbnN0YW5jZSB7XG4gICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLmhhbmRsZXMuZ2V0KGhhbmRsZSk7XG4gICAgaWYgKCFpbnN0YW5jZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyByZXNvdXJjZSBmb3VuZCB3aXRoIGhhbmRsZSBcIiR7aGFuZGxlfVwiLmApO1xuICAgIH1cbiAgICB0aGlzLmhhbmRsZXMuZGVsZXRlKGhhbmRsZSk7XG4gICAgdGhpcy5wYXRocy5kZWxldGUoaGFuZGxlKTtcbiAgICByZXR1cm4gaW5zdGFuY2U7XG4gIH1cblxuICBwdWJsaWMgcmVzZXQoKTogdm9pZCB7XG4gICAgdGhpcy5oYW5kbGVzLmNsZWFyKCk7XG4gICAgdGhpcy5wYXRocy5jbGVhcigpO1xuICAgIHRoaXMubmV4dEhhbmRsZSA9IDA7XG4gIH1cbn1cblxuLyoqXG4gKiBTaGFyZWQgaW50ZXJmYWNlIGZvciByZXNvdXJjZSBzaW11bGF0aW9ucy5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJU2ltdWxhdG9yUmVzb3VyY2VJbnN0YW5jZSB7XG4gIC8qKlxuICAgKiBQZXJmb3JtIGFueSBhc3luYyBpbml0aWFsaXphdGlvbiByZXF1aXJlZCBieSB0aGUgcmVzb3VyY2UuIFJldHVybiBhIG1hcCBvZlxuICAgKiB0aGUgcmVzb3VyY2UncyBydW50aW1lIGF0dHJpYnV0ZXMuXG4gICAqL1xuICBpbml0KGN0eDogSVNpbXVsYXRvckNvbnRleHQpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIGFueT4+O1xuXG4gIC8qKlxuICAgKiBTdG9wIHRoZSByZXNvdXJjZSBhbmQgY2xlYW4gdXAgYW55IHBoeXNpY2FsIHJlc291cmNlcyBpdCBtYXkgaGF2ZSBjcmVhdGVkXG4gICAqIChmaWxlcywgcG9ydHMsIGV0YykuXG4gICAqL1xuICBjbGVhbnVwKCk6IFByb21pc2U8dm9pZD47XG5cbiAgLyoqXG4gICAqIFNhdmUgdGhlIHJlc291cmNlJ3Mgc3RhdGUgaW50byB0aGUgc3RhdGUgZGlyZWN0b3J5LlxuICAgKi9cbiAgc2F2ZShzdGF0ZWRpcjogc3RyaW5nKTogUHJvbWlzZTx2b2lkPjtcblxuICAvKipcbiAgICogRGV0ZXJtaW5lcyB0aGUgdXBkYXRlIHBsYW4gZm9yIGFwcGx5aW5nIGEgbmV3IGNvbmZpZ3VyYXRpb24gZm9yIHRoaXMgcmVzb3VyY2UuXG4gICAqXG4gICAqIElmIHRoaXMgaXMgbm90IGltcGxlbWVudGVkLCB0aGUgZGVmYXVsdCBiZWhhdmlvciBpcyB0byBhdXRvbWF0aWNhbGx5IHJlcGxhY2UgdGhlIHJlc291cmNlIGlmXG4gICAqIHRoZSBuZXcgY29uZmlndXJhdGlvbiBpcyBkaWZmZXJlbnQgZnJvbSB0aGUgY3VycmVudCBjb25maWd1cmF0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0gaW52YWxpZGF0ZWQgV2hldGhlciB0aGUgbmV3IGNvbmZpZ3VyYXRpb24gaXMgZGlmZmVyZW50IGZyb20gdGhlIGN1cnJlbnQgY29uZmlndXJhdGlvbi5cbiAgICovXG4gIHBsYW4oaW52YWxpZGF0ZWQ6IGJvb2xlYW4pOiBQcm9taXNlPFVwZGF0ZVBsYW4+O1xufVxuXG4vKipcbiAqIERldGVybWluZXMgaG93IHVwZGF0ZXMgYXJlIHBlcmZvcm1lZCBvbiB0aGlzIHJlc291cmNlLlxuICovXG5leHBvcnQgZW51bSBVcGRhdGVQbGFuIHtcbiAgLyoqXG4gICAqIERvZXMgbm90aGluZy4gVGhpcyByZXNvdXJjZSBpcyBhbHJlYWR5IGluIHRoZSBkZXNpcmVkIHN0YXRlLlxuICAgKi9cbiAgU0tJUCA9IFwiU0tJUFwiLFxuXG4gIC8qKlxuICAgKiBEZWxldGVzIHRoZSByZXNvdXJjZSBhbmQgY3JlYXRlcyBhIG5ldyBpbnN0YW5jZSB3aXRoIHRoZSBuZXcgY29uZmlndXJhdGlvbi5cbiAgICovXG4gIFJFUExBQ0UgPSBcIlJFUExBQ0VcIixcblxuICAvKipcbiAgICogQXV0byBkZXRlY3QgY2hhbmdlcyBpbiBuZXcgY29uZmlndXJhdGlvbiBhbmQgcmVwbGFjZSB0aGUgcmVzb3VyY2UuXG4gICAqL1xuICBBVVRPID0gXCJBVVRPXCIsXG59XG5cbi8qKiBTY2hlbWEgZm9yIHNpbXVsYXRvci5qc29uICovXG5leHBvcnQgaW50ZXJmYWNlIFdpbmdTaW11bGF0b3JTY2hlbWEge1xuICAvKiogVGhlIHJlc291cmNlcywgaW5kZXhlZCBieSB0aGVpciBjb25zdHJ1Y3QgcGF0aC4gKi9cbiAgcmVhZG9ubHkgcmVzb3VyY2VzOiBSZWNvcmQ8c3RyaW5nLCBCYXNlUmVzb3VyY2VTY2hlbWE+O1xuICAvKiogVGhlIG1hcCBvZiB0eXBlcy4gKi9cbiAgcmVhZG9ubHkgdHlwZXM6IHsgW2Zxbjogc3RyaW5nXTogVHlwZVNjaGVtYSB9O1xuICAvKiogVGhlIHZlcnNpb24gb2YgdGhlIFdpbmcgU0RLIHVzZWQgdG8gc3ludGhlc2l6ZSB0aGUgLndzaW0gZmlsZS4gKi9cbiAgcmVhZG9ubHkgc2RrVmVyc2lvbjogc3RyaW5nO1xufVxuXG4vKiogU2NoZW1hIGZvciBpbmRpdmlkdWFsIHR5cGVzLiAqL1xuZXhwb3J0IGludGVyZmFjZSBUeXBlU2NoZW1hIHtcbiAgLyoqIExvY2F0aW9uIG9mIHRoZSBzb3VyY2UgZmlsZSB0aGF0IGV4cG9ydHMgYSBzaW11bGF0aW9uIEFQSS4gKi9cbiAgcmVhZG9ubHkgc291cmNlUGF0aDogc3RyaW5nO1xuICAvKiogTmFtZSBvZiB0aGUgY2xhc3MgdGhhdCBpcyBleHBvcnRlZCBieSB0aGUgYHNvdXJjZVBhdGhgLiAqL1xuICByZWFkb25seSBjbGFzc05hbWU6IHN0cmluZztcbn1cblxuLyoqXG4gKiBTY2hlbWEgZm9yIGluZGl2aWR1YWwgcmVzb3VyY2VzLlxuICogT25seSBjb250YWlucyBmaWVsZHMgdGhhdCBuZWVkIHRvIGJlIHJldHVybmVkIGJ5IGB0b1NpbXVsYXRvcigpYC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBUb1NpbXVsYXRvck91dHB1dCB7XG4gIC8qKiBUaGUgdHlwZSBvZiB0aGUgcmVzb3VyY2UuICovXG4gIHJlYWRvbmx5IHR5cGU6IHN0cmluZztcbiAgLyoqIFRoZSByZXNvdXJjZS1zcGVjaWZpYyBwcm9wZXJ0aWVzIG5lZWRlZCB0byBjcmVhdGUgdGhpcyByZXNvdXJjZS4gKi9cbiAgcmVhZG9ubHkgcHJvcHM6IHsgW2tleTogc3RyaW5nXTogYW55IH07XG4gIC8qKiBBIGxpc3Qgb2YgaW5saW5lIHBvbGljeSBzdGF0ZW1lbnRzIHRoYXQgZGVmaW5lIHBlcm1pc3Npb25zIGZvciB0aGlzIHJlc291cmNlLiAqL1xuICByZWFkb25seSBwb2xpY3k/OiBQb2xpY3lTdGF0ZW1lbnRbXTtcbn1cblxuLyoqIFNjaGVtYSBmb3IgaW5kaXZpZHVhbCByZXNvdXJjZXMgKi9cbmV4cG9ydCBpbnRlcmZhY2UgQmFzZVJlc291cmNlU2NoZW1hIGV4dGVuZHMgVG9TaW11bGF0b3JPdXRwdXQge1xuICAvKiogVGhlIHJlc291cmNlIHBhdGggZnJvbSB0aGUgYXBwJ3MgY29uc3RydWN0IHRyZWUuICovXG4gIHJlYWRvbmx5IHBhdGg6IHN0cmluZztcbiAgLyoqIEFuIG9wYXF1ZSB0cmVlLXVuaXF1ZSBhZGRyZXNzIG9mIHRoZSByZXNvdXJjZSwgY2FsY3VsYXRlZCBhcyBhIFNIQS0xIGhhc2ggb2YgdGhlIHJlc291cmNlIHBhdGguICovXG4gIHJlYWRvbmx5IGFkZHI6IHN0cmluZztcbiAgLyoqIFRoZSByZXNvdXJjZS1zcGVjaWZpYyBhdHRyaWJ1dGVzIHRoYXQgYXJlIHNldCBhZnRlciB0aGUgcmVzb3VyY2UgaXMgY3JlYXRlZC4gKi9cbiAgcmVhZG9ubHkgYXR0cnM6IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIC8qKiBSZXNvdXJjZXMgdGhhdCBzaG91bGQgYmUgZGVwbG95ZWQgYmVmb3JlIHRoaXMgcmVzb3VyY2UuICovXG4gIHJlYWRvbmx5IGRlcHM/OiBzdHJpbmdbXTtcbn1cblxuLyoqIFNjaGVtYSBmb3IgcmVzb3VyY2UgYXR0cmlidXRlcyAqL1xuZXhwb3J0IGludGVyZmFjZSBCYXNlUmVzb3VyY2VBdHRyaWJ1dGVzIHtcbiAgLyoqIFRoZSByZXNvdXJjZSdzIHNpbXVsYXRvci11bmlxdWUgaWQuICovXG4gIHJlYWRvbmx5IFtIQU5ETEVfQVRUUklCVVRFXTogc3RyaW5nO1xufVxuXG4vKiogQSBwb2xpY3kgc3RhdGVtZW50IHRoYXQgZGVmaW5lcyBhIHBlcm1pc3Npb24gZm9yIGEgcmVzb3VyY2UuICovXG5leHBvcnQgaW50ZXJmYWNlIFBvbGljeVN0YXRlbWVudCB7XG4gIC8qKiBUaGUgb3BlcmF0aW9uIHRoYXQgY2FuIGJlIHBlcmZvcm1lZC4gKi9cbiAgcmVhZG9ubHkgb3BlcmF0aW9uOiBzdHJpbmc7XG4gIC8qKiBUaGUgcmVzb3VyY2UgdGhlIG9wZXJhdGlvbiBjYW4gYmUgcGVyZm9ybWVkIG9uLiAqL1xuICByZWFkb25seSByZXNvdXJjZUhhbmRsZTogc3RyaW5nO1xufVxuXG4vKiogU2NoZW1hIGZvciBgLmNvbm5lY3Rpb25zYCBpbiBjb25uZWN0aW9ucy5qc29uICovXG5leHBvcnQgaW50ZXJmYWNlIENvbm5lY3Rpb25EYXRhIHtcbiAgLyoqIFRoZSBwYXRoIG9mIHRoZSBzb3VyY2UgY29uc3RydWN0LiAqL1xuICByZWFkb25seSBzb3VyY2U6IHN0cmluZztcbiAgLyoqXG4gICAqIEFuIG9wZXJhdGlvbiB0aGF0IHRoZSBzb3VyY2Ugb2JqZWN0IHN1cHBvcnRzLlxuICAgKiBAZGVmYXVsdCAtIG5vIG9wZXJhdGlvblxuICAgKi9cbiAgcmVhZG9ubHkgc291cmNlT3A/OiBzdHJpbmc7XG4gIC8qKiBUaGUgcGF0aCBvZiB0aGUgdGFyZ2V0IGNvbnN0cnVjdC4gKi9cbiAgcmVhZG9ubHkgdGFyZ2V0OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBBbiBvcGVyYXRpb24gdGhhdCB0aGUgdGFyZ2V0IG9iamVjdCBzdXBwb3J0cy5cbiAgICogQGRlZmF1bHQgLSBubyBvcGVyYXRpb25cbiAgICovXG4gIHJlYWRvbmx5IHRhcmdldE9wPzogc3RyaW5nO1xuICAvKiogQSBuYW1lIGZvciB0aGUgY29ubmVjdGlvbi4gKi9cbiAgcmVhZG9ubHkgbmFtZTogc3RyaW5nO1xufVxuXG4vKipcbiAqIEludGVybmFsIHNjaGVtYSBmb3IgcmVxdWVzdHMgdG8gdGhlIHNpbXVsYXRvciBzZXJ2ZXIncyAvdjEvY2FsbCBlbmRwb2ludC5cbiAqIFN1YmplY3QgdG8gYnJlYWtpbmcgY2hhbmdlcy5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTaW11bGF0b3JTZXJ2ZXJSZXF1ZXN0IHtcbiAgLyoqIFRoZSBoYW5kbGUgb2YgdGhlIHJlc291cmNlIG1ha2luZyB0aGUgcmVxdWVzdC4gKi9cbiAgcmVhZG9ubHkgY2FsbGVyOiBzdHJpbmc7XG4gIC8qKiBUaGUgdGFyZ2V0IHJlc291cmNlIGhhbmRsZSAoYW4gSUQgdW5pcXVlIGFtb25nIHJlc291cmNlcyBpbiB0aGUgc2ltdWxhdGlvbikuICovXG4gIHJlYWRvbmx5IGhhbmRsZTogc3RyaW5nO1xuICAvKiogVGhlIG1ldGhvZCB0byBjYWxsIG9uIHRoZSByZXNvdXJjZS4gKi9cbiAgcmVhZG9ubHkgbWV0aG9kOiBzdHJpbmc7XG4gIC8qKiBUaGUgYXJndW1lbnRzIHRvIHRoZSBtZXRob2QuICovXG4gIHJlYWRvbmx5IGFyZ3M6IGFueVtdO1xufVxuXG4vKipcbiAqIEludGVybmFsIHNjaGVtYSBmb3IgcmVzcG9uc2VzIGZyb20gdGhlIHNpbXVsYXRvciBzZXJ2ZXIncyAvdjEvY2FsbCBlbmRwb2ludC5cbiAqIFN1YmplY3QgdG8gYnJlYWtpbmcgY2hhbmdlcy5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTaW11bGF0b3JTZXJ2ZXJSZXNwb25zZSB7XG4gIC8qKiBUaGUgcmVzdWx0IG9mIHRoZSBtZXRob2QgY2FsbC4gKi9cbiAgcmVhZG9ubHkgcmVzdWx0PzogYW55O1xuICAvKiogVGhlIGVycm9yIHRoYXQgb2NjdXJyZWQgZHVyaW5nIHRoZSBtZXRob2QgY2FsbC4gKi9cbiAgcmVhZG9ubHkgZXJyb3I/OiBhbnk7XG59XG5cbmNsYXNzIFBvbGljeVJlZ2lzdHJ5IHtcbiAgcHJpdmF0ZSByZWFkb25seSBwb2xpY2llczogUmVjb3JkPHN0cmluZywgUG9saWN5U2NoZW1hPjtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnBvbGljaWVzID0ge307XG4gIH1cblxuICBwdWJsaWMgcmVnaXN0ZXIoaWQ6IHN0cmluZywgcG9saWN5OiBQb2xpY3lTY2hlbWEpIHtcbiAgICBpZiAodGhpcy5wb2xpY2llc1tpZF0pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgUG9saWN5IHdpdGggaWQgJHtpZH0gYWxyZWFkeSByZWdpc3RlcmVkLmApO1xuICAgIH1cbiAgICB0aGlzLnBvbGljaWVzW2lkXSA9IHBvbGljeTtcbiAgfVxuXG4gIHB1YmxpYyBkZXJlZ2lzdGVyKGlkOiBzdHJpbmcpIHtcbiAgICBkZWxldGUgdGhpcy5wb2xpY2llc1tpZF07XG4gIH1cblxuICBwdWJsaWMgY2hlY2tQZXJtaXNzaW9uKFxuICAgIGNhbGxlcjogc3RyaW5nLFxuICAgIGNhbGxlZTogc3RyaW5nLFxuICAgIG1ldGhvZDogc3RyaW5nXG4gICk6IGJvb2xlYW4ge1xuICAgIGZvciAoY29uc3QgcG9saWN5IG9mIE9iamVjdC52YWx1ZXModGhpcy5wb2xpY2llcykpIHtcbiAgICAgIGlmIChwb2xpY3kucHJpbmNpcGFsID09PSBjYWxsZXIpIHtcbiAgICAgICAgZm9yIChjb25zdCBzdGF0ZW1lbnQgb2YgcG9saWN5LnN0YXRlbWVudHMpIHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICBzdGF0ZW1lbnQucmVzb3VyY2VIYW5kbGUgPT09IGNhbGxlZSAmJlxuICAgICAgICAgICAgc3RhdGVtZW50Lm9wZXJhdGlvbiA9PT0gbWV0aG9kXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG4iXX0=