"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.ContainerInflightMethods = exports.Container = exports.HOST_PORT_ATTR = exports.SIM_CONTAINER_FQN = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const tokens_1 = require("./tokens");
const util_1 = require("./util");
const constants_1 = require("../constants");
const core_1 = require("../core");
const types_1 = require("../core/types");
const fs_1 = require("../fs");
const misc_1 = require("../shared/misc");
const std_1 = require("../std");
exports.SIM_CONTAINER_FQN = (0, constants_1.fqnForType)("sim.Container");
exports.HOST_PORT_ATTR = "host_port";
/**
 * Represents a container running in the Wing Simulator.
 *
 * @inflight `@winglang/sdk.sim.IContainerClient`
 */
class Container extends std_1.Resource {
    constructor(scope, id, props) {
        super(scope, id);
        this.props = props;
        // determine image tag - if the image is a path, we use a source hash (either explicitly
        // provided or calculated based on the source files). if the image is a name, we use the name
        if ((0, misc_1.isPath)(props.image)) {
            const hash = props.sourceHash ?? fs_1.Util.md5(props.image, props.sourcePattern);
            this.imageTag = `${props.name}:${hash}`;
        }
        else {
            this.imageTag = props.image;
        }
        if (props.containerPort) {
            this.hostPort = (0, tokens_1.simulatorAttrToken)(this, exports.HOST_PORT_ATTR);
        }
    }
    toSimulator() {
        const props = {
            image: this.props.image,
            imageTag: this.imageTag,
            containerPort: this.props.containerPort,
            env: this.props.env,
            volumes: this.props.volumes,
            args: this.props.args,
            cwd: core_1.App.of(this).entrypointDir,
        };
        return {
            type: exports.SIM_CONTAINER_FQN,
            props,
        };
    }
    onLift(host, ops) {
        (0, util_1.bindSimulatorResource)(__filename, this, host, ops);
        super.onLift(host, ops);
    }
    /** @internal */
    get _liftMap() {
        return {};
    }
    /** @internal */
    _toInflight() {
        return (0, util_1.makeSimulatorJsClient)(__filename, this);
    }
}
exports.Container = Container;
_a = JSII_RTTI_SYMBOL_1;
Container[_a] = { fqn: "@winglang/sdk.sim.Container", version: "0.0.0" };
/**
 * List of inflight operations available for `sim.Container`.
 * @internal
 */
var ContainerInflightMethods;
(function (ContainerInflightMethods) {
})(ContainerInflightMethods || (exports.ContainerInflightMethods = ContainerInflightMethods = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGFpbmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3RhcmdldC1zaW0vY29udGFpbmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBR0EscUNBQThDO0FBQzlDLGlDQUFzRTtBQUN0RSw0Q0FBMEM7QUFDMUMsa0NBQXVDO0FBQ3ZDLHlDQUFnRDtBQUNoRCw4QkFBbUM7QUFDbkMseUNBQXdDO0FBRXhDLGdDQUFpRDtBQUVwQyxRQUFBLGlCQUFpQixHQUFHLElBQUEsc0JBQVUsRUFBQyxlQUFlLENBQUMsQ0FBQztBQUNoRCxRQUFBLGNBQWMsR0FBRyxXQUFXLENBQUM7QUF5RDFDOzs7O0dBSUc7QUFDSCxNQUFhLFNBQVUsU0FBUSxjQUFRO0lBV3JDLFlBQ0UsS0FBZ0IsRUFDaEIsRUFBVSxFQUNPLEtBQXFCO1FBRXRDLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFGQSxVQUFLLEdBQUwsS0FBSyxDQUFnQjtRQUl0Qyx3RkFBd0Y7UUFDeEYsNkZBQTZGO1FBQzdGLElBQUksSUFBQSxhQUFNLEVBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFDeEIsTUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLFVBQVUsSUFBSSxTQUFFLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQzFFLElBQUksQ0FBQyxRQUFRLEdBQUcsR0FBRyxLQUFLLENBQUMsSUFBSSxJQUFJLElBQUksRUFBRSxDQUFDO1FBQzFDLENBQUM7YUFBTSxDQUFDO1lBQ04sSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDO1FBQzlCLENBQUM7UUFFRCxJQUFJLEtBQUssQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUN4QixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUEsMkJBQWtCLEVBQUMsSUFBSSxFQUFFLHNCQUFjLENBQUMsQ0FBQztRQUMzRCxDQUFDO0lBQ0gsQ0FBQztJQUVNLFdBQVc7UUFDaEIsTUFBTSxLQUFLLEdBQW9CO1lBQzdCLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUs7WUFDdkIsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRO1lBQ3ZCLGFBQWEsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWE7WUFDdkMsR0FBRyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRztZQUNuQixPQUFPLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPO1lBQzNCLElBQUksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUk7WUFDckIsR0FBRyxFQUFFLFVBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsYUFBYTtTQUNoQyxDQUFDO1FBQ0YsT0FBTztZQUNMLElBQUksRUFBRSx5QkFBaUI7WUFDdkIsS0FBSztTQUNOLENBQUM7SUFDSixDQUFDO0lBRU0sTUFBTSxDQUFDLElBQW1CLEVBQUUsR0FBYTtRQUM5QyxJQUFBLDRCQUFxQixFQUFDLFVBQVUsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ25ELEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQzFCLENBQUM7SUFFRCxnQkFBZ0I7SUFDaEIsSUFBVyxRQUFRO1FBQ2pCLE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQztJQUVELGdCQUFnQjtJQUNULFdBQVc7UUFDaEIsT0FBTyxJQUFBLDRCQUFxQixFQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUNqRCxDQUFDOztBQTdESCw4QkE4REM7OztBQUVEOzs7R0FHRztBQUNILElBQVksd0JBQTJCO0FBQXZDLFdBQVksd0JBQXdCO0FBQUUsQ0FBQyxFQUEzQix3QkFBd0Isd0NBQXhCLHdCQUF3QixRQUFHIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSBcImNvbnN0cnVjdHNcIjtcbmltcG9ydCB7IElTaW11bGF0b3JSZXNvdXJjZSB9IGZyb20gXCIuL3Jlc291cmNlXCI7XG5pbXBvcnQgeyBDb250YWluZXJTY2hlbWEgfSBmcm9tIFwiLi9zY2hlbWEtcmVzb3VyY2VzXCI7XG5pbXBvcnQgeyBzaW11bGF0b3JBdHRyVG9rZW4gfSBmcm9tIFwiLi90b2tlbnNcIjtcbmltcG9ydCB7IGJpbmRTaW11bGF0b3JSZXNvdXJjZSwgbWFrZVNpbXVsYXRvckpzQ2xpZW50IH0gZnJvbSBcIi4vdXRpbFwiO1xuaW1wb3J0IHsgZnFuRm9yVHlwZSB9IGZyb20gXCIuLi9jb25zdGFudHNcIjtcbmltcG9ydCB7IEFwcCwgTGlmdE1hcCB9IGZyb20gXCIuLi9jb3JlXCI7XG5pbXBvcnQgeyBJTkZMSUdIVF9TWU1CT0wgfSBmcm9tIFwiLi4vY29yZS90eXBlc1wiO1xuaW1wb3J0IHsgVXRpbCBhcyBmcyB9IGZyb20gXCIuLi9mc1wiO1xuaW1wb3J0IHsgaXNQYXRoIH0gZnJvbSBcIi4uL3NoYXJlZC9taXNjXCI7XG5pbXBvcnQgeyBUb1NpbXVsYXRvck91dHB1dCB9IGZyb20gXCIuLi9zaW11bGF0b3JcIjtcbmltcG9ydCB7IElJbmZsaWdodEhvc3QsIFJlc291cmNlIH0gZnJvbSBcIi4uL3N0ZFwiO1xuXG5leHBvcnQgY29uc3QgU0lNX0NPTlRBSU5FUl9GUU4gPSBmcW5Gb3JUeXBlKFwic2ltLkNvbnRhaW5lclwiKTtcbmV4cG9ydCBjb25zdCBIT1NUX1BPUlRfQVRUUiA9IFwiaG9zdF9wb3J0XCI7XG5cbi8qKlxuICogSW5pdGlhbGl6YXRpb24gcHJvcGVydGllcyBmb3IgYHNpbS5Db250YWluZXJgLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIENvbnRhaW5lclByb3BzIHtcbiAgLyoqXG4gICAqIEEgbmFtZSBmb3IgdGhlIGNvbnRhaW5lci5cbiAgICovXG4gIHJlYWRvbmx5IG5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogQSBuYW1lIG9mIGEgcHVibGljIERvY2tlciBpbWFnZSB0byBwdWxsIGFuZCBydW4gb3IgYSBwYXRoIHRvIGEgbG9jYWwgZGlyZWN0b3J5IHdpdGggYSBgRG9ja2VyZmlsZWAuXG4gICAqL1xuICByZWFkb25seSBpbWFnZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBJbnRlcm5hbCBjb250YWluZXIgcG9ydCB0byBleHBvc2UuXG4gICAqIEBkZWZhdWx0IC0gbm8gcG9ydCBleHBvc2VkXG4gICAqL1xuICByZWFkb25seSBjb250YWluZXJQb3J0PzogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBFbnZpcm9ubWVudCB2YXJpYWJsZXMgdG8gc2V0IGluIHRoZSBjb250YWluZXIuXG4gICAqIEBkZWZhdWx0IHt9XG4gICAqL1xuICByZWFkb25seSBlbnY/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xuXG4gIC8qKlxuICAgKiBWb2x1bWUgbW91bnQgcG9pbnRzLlxuICAgKiBAZGVmYXVsdCBbXVxuICAgKiBAZXhhbXBsZSBbJy9ob3N0Oi9jb250YWluZXInXVxuICAgKi9cbiAgcmVhZG9ubHkgdm9sdW1lcz86IHN0cmluZ1tdO1xuXG4gIC8qKlxuICAgKiBDb250YWluZXIgYXJndW1lbnRzXG4gICAqIEBkZWZhdWx0IFtdXG4gICAqL1xuICByZWFkb25seSBhcmdzPzogc3RyaW5nW107XG5cbiAgLyoqXG4gICAqIEEgZ2xvYiBvZiBsb2NhbCBmaWxlcyB0byBjb25zaWRlciBhcyBpbnB1dCBzb3VyY2VzIGZvciB0aGUgY29udGFpbmVyLCByZWxhdGl2ZSB0byB0aGUgYnVpbGRcbiAgICogY29udGV4dCBkaXJlY3RvcnkuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gYWxsIGZpbGVzXG4gICAqL1xuICByZWFkb25seSBzb3VyY2VQYXR0ZXJuPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBBbiBleHBsaWNpdCBzb3VyY2UgaGFzaCB0aGF0IHJlcHJlc2VudHMgdGhlIGNvbnRhaW5lciBzb3VyY2UuIGlmIG5vdCBzZXQsIGFuZCBgc291cmNlUGF0dGVybmBcbiAgICogaXMgc2V0LCB0aGUgaGFzaCB3aWxsIGJlIGNhbGN1bGF0ZWQgYmFzZWQgb24gdGhlIGNvbnRlbnQgb2YgdGhlIHNvdXJjZSBmaWxlcy5cbiAgICogQGRlZmF1bHQgLSBjYWxjdWxhdGVkIGJhc2VkIG9uIHRoZSBzb3VyY2UgZmlsZXNcbiAgICovXG4gIHJlYWRvbmx5IHNvdXJjZUhhc2g/OiBzdHJpbmc7XG59XG5cbi8qKlxuICogUmVwcmVzZW50cyBhIGNvbnRhaW5lciBydW5uaW5nIGluIHRoZSBXaW5nIFNpbXVsYXRvci5cbiAqXG4gKiBAaW5mbGlnaHQgYEB3aW5nbGFuZy9zZGsuc2ltLklDb250YWluZXJDbGllbnRgXG4gKi9cbmV4cG9ydCBjbGFzcyBDb250YWluZXIgZXh0ZW5kcyBSZXNvdXJjZSBpbXBsZW1lbnRzIElTaW11bGF0b3JSZXNvdXJjZSB7XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgcHVibGljIFtJTkZMSUdIVF9TWU1CT0xdPzogSUNvbnRhaW5lckNsaWVudDtcblxuICBwcml2YXRlIHJlYWRvbmx5IGltYWdlVGFnOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEEgdG9rZW4gdGhhdCByZXNvbHZlcyB0byB0aGUgaG9zdCBwb3J0IG9mIHRoaXMgY29udGFpbmVyLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGhvc3RQb3J0Pzogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHNjb3BlOiBDb25zdHJ1Y3QsXG4gICAgaWQ6IHN0cmluZyxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHByb3BzOiBDb250YWluZXJQcm9wc1xuICApIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuXG4gICAgLy8gZGV0ZXJtaW5lIGltYWdlIHRhZyAtIGlmIHRoZSBpbWFnZSBpcyBhIHBhdGgsIHdlIHVzZSBhIHNvdXJjZSBoYXNoIChlaXRoZXIgZXhwbGljaXRseVxuICAgIC8vIHByb3ZpZGVkIG9yIGNhbGN1bGF0ZWQgYmFzZWQgb24gdGhlIHNvdXJjZSBmaWxlcykuIGlmIHRoZSBpbWFnZSBpcyBhIG5hbWUsIHdlIHVzZSB0aGUgbmFtZVxuICAgIGlmIChpc1BhdGgocHJvcHMuaW1hZ2UpKSB7XG4gICAgICBjb25zdCBoYXNoID0gcHJvcHMuc291cmNlSGFzaCA/PyBmcy5tZDUocHJvcHMuaW1hZ2UsIHByb3BzLnNvdXJjZVBhdHRlcm4pO1xuICAgICAgdGhpcy5pbWFnZVRhZyA9IGAke3Byb3BzLm5hbWV9OiR7aGFzaH1gO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmltYWdlVGFnID0gcHJvcHMuaW1hZ2U7XG4gICAgfVxuXG4gICAgaWYgKHByb3BzLmNvbnRhaW5lclBvcnQpIHtcbiAgICAgIHRoaXMuaG9zdFBvcnQgPSBzaW11bGF0b3JBdHRyVG9rZW4odGhpcywgSE9TVF9QT1JUX0FUVFIpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyB0b1NpbXVsYXRvcigpOiBUb1NpbXVsYXRvck91dHB1dCB7XG4gICAgY29uc3QgcHJvcHM6IENvbnRhaW5lclNjaGVtYSA9IHtcbiAgICAgIGltYWdlOiB0aGlzLnByb3BzLmltYWdlLFxuICAgICAgaW1hZ2VUYWc6IHRoaXMuaW1hZ2VUYWcsXG4gICAgICBjb250YWluZXJQb3J0OiB0aGlzLnByb3BzLmNvbnRhaW5lclBvcnQsXG4gICAgICBlbnY6IHRoaXMucHJvcHMuZW52LFxuICAgICAgdm9sdW1lczogdGhpcy5wcm9wcy52b2x1bWVzLFxuICAgICAgYXJnczogdGhpcy5wcm9wcy5hcmdzLFxuICAgICAgY3dkOiBBcHAub2YodGhpcykuZW50cnlwb2ludERpcixcbiAgICB9O1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBTSU1fQ09OVEFJTkVSX0ZRTixcbiAgICAgIHByb3BzLFxuICAgIH07XG4gIH1cblxuICBwdWJsaWMgb25MaWZ0KGhvc3Q6IElJbmZsaWdodEhvc3QsIG9wczogc3RyaW5nW10pOiB2b2lkIHtcbiAgICBiaW5kU2ltdWxhdG9yUmVzb3VyY2UoX19maWxlbmFtZSwgdGhpcywgaG9zdCwgb3BzKTtcbiAgICBzdXBlci5vbkxpZnQoaG9zdCwgb3BzKTtcbiAgfVxuXG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgcHVibGljIGdldCBfbGlmdE1hcCgpOiBMaWZ0TWFwIHtcbiAgICByZXR1cm4ge307XG4gIH1cblxuICAvKiogQGludGVybmFsICovXG4gIHB1YmxpYyBfdG9JbmZsaWdodCgpOiBzdHJpbmcge1xuICAgIHJldHVybiBtYWtlU2ltdWxhdG9ySnNDbGllbnQoX19maWxlbmFtZSwgdGhpcyk7XG4gIH1cbn1cblxuLyoqXG4gKiBMaXN0IG9mIGluZmxpZ2h0IG9wZXJhdGlvbnMgYXZhaWxhYmxlIGZvciBgc2ltLkNvbnRhaW5lcmAuXG4gKiBAaW50ZXJuYWxcbiAqL1xuZXhwb3J0IGVudW0gQ29udGFpbmVySW5mbGlnaHRNZXRob2RzIHt9XG5cbi8qKlxuICogSW5mbGlnaHQgaW50ZXJmYWNlIGZvciBgUmVkaXNgLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIElDb250YWluZXJDbGllbnQge31cbiJdfQ==