"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.TopicOnMessageHandler = exports.Topic = void 0;
const app_1 = require("./app");
const event_mapping_1 = require("./event-mapping");
const policy_1 = require("./policy");
const util_1 = require("./util");
const cloud_1 = require("../cloud");
const cloud = __importStar(require("../cloud"));
const core_1 = require("../core");
const std_1 = require("../std");
/**
 * Simulator implementation of `cloud.Topic`
 *
 * @inflight `@winglang/sdk.cloud.ITopicClient`
 */
class Topic extends cloud.Topic {
    constructor(scope, id, props = {}) {
        super(scope, id, props);
        this.policy = new policy_1.Policy(this, "Policy", { principal: this });
    }
    onMessage(inflight, props = {}) {
        const functionHandler = TopicOnMessageHandler.toFunctionHandler(inflight);
        const fn = new cloud_1.Function(this, app_1.App.of(this).makeId(this, "OnMessage"), functionHandler, props);
        std_1.Node.of(fn).sourceModule = std_1.SDK_SOURCE_MODULE;
        std_1.Node.of(fn).title = "onMessage()";
        new event_mapping_1.EventMapping(this, app_1.App.of(this).makeId(this, "TopicEventMapping"), {
            subscriber: fn,
            publisher: this,
            subscriptionProps: {},
        });
        std_1.Node.of(this).addConnection({
            source: this,
            sourceOp: cloud.TopicInflightMethods.PUBLISH,
            target: fn,
            targetOp: cloud.FunctionInflightMethods.INVOKE,
            name: "onMessage()",
        });
        this.policy.addStatement(fn, cloud.FunctionInflightMethods.INVOKE_ASYNC);
        return fn;
    }
    subscribeQueue(queue) {
        const fn = new cloud_1.Function(this, app_1.App.of(this).makeId(this, "subscribeQueue"), (0, core_1.lift)({ queue })
            .grant({ queue: ["push"] })
            .inflight(async (ctx, event) => {
            await ctx.queue.push(event);
            return undefined;
        }), {});
        std_1.Node.of(fn).sourceModule = std_1.SDK_SOURCE_MODULE;
        std_1.Node.of(fn).title = "subscribeQueue()";
        new event_mapping_1.EventMapping(this, app_1.App.of(this).makeId(this, "TopicEventMapping"), {
            subscriber: fn,
            publisher: this,
            subscriptionProps: {},
        });
        std_1.Node.of(this).addConnection({
            source: this,
            sourceOp: cloud.TopicInflightMethods.PUBLISH,
            target: fn,
            targetOp: cloud.FunctionInflightMethods.INVOKE_ASYNC,
            name: "subscribeQueue()",
        });
        this.policy.addStatement(fn, cloud.FunctionInflightMethods.INVOKE_ASYNC);
    }
    onLift(host, ops) {
        (0, util_1.bindSimulatorResource)(__filename, this, host, ops);
        super.onLift(host, ops);
    }
    /** @internal */
    _toInflight() {
        return (0, util_1.makeSimulatorJsClient)(__filename, this);
    }
    /** @internal */
    get _liftMap() {
        return {
            [cloud.QueueInflightMethods.PUSH]: [],
            [cloud.TopicInflightMethods.PUBLISH]: [],
        };
    }
    toSimulator() {
        const props = {};
        return {
            type: cloud.TOPIC_FQN,
            props,
        };
    }
}
exports.Topic = Topic;
/**
 * Utility class to work with topic message handlers.
 */
class TopicOnMessageHandler {
    /**
     * Converts a `cloud.ITopicOnMessageHandler` to a `cloud.IFunctionHandler`
     * @param handler the handler to convert
     * @returns the function handler
     */
    static toFunctionHandler(handler) {
        return (0, core_1.lift)({ handler }).inflight(async (ctx, event) => {
            await ctx.handler(event);
            return undefined;
        });
    }
}
exports.TopicOnMessageHandler = TopicOnMessageHandler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9waWMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdGFyZ2V0LXNpbS90b3BpYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUNBLCtCQUE0QjtBQUM1QixtREFBK0M7QUFDL0MscUNBQWtDO0FBR2xDLGlDQUFzRTtBQUN0RSxvQ0FBb0M7QUFDcEMsZ0RBQWtDO0FBQ2xDLGtDQUF3QztBQUV4QyxnQ0FBZ0U7QUFFaEU7Ozs7R0FJRztBQUNILE1BQWEsS0FBTSxTQUFRLEtBQUssQ0FBQyxLQUFLO0lBRXBDLFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsUUFBMEIsRUFBRTtRQUNwRSxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN4QixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksZUFBTSxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUNoRSxDQUFDO0lBRU0sU0FBUyxDQUNkLFFBQXNDLEVBQ3RDLFFBQXFDLEVBQUU7UUFFdkMsTUFBTSxlQUFlLEdBQUcscUJBQXFCLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDMUUsTUFBTSxFQUFFLEdBQUcsSUFBSSxnQkFBUSxDQUNyQixJQUFJLEVBQ0osU0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLFdBQVcsQ0FBQyxFQUN0QyxlQUFlLEVBQ2YsS0FBSyxDQUNOLENBQUM7UUFDRixVQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFlBQVksR0FBRyx1QkFBaUIsQ0FBQztRQUM3QyxVQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssR0FBRyxhQUFhLENBQUM7UUFFbEMsSUFBSSw0QkFBWSxDQUFDLElBQUksRUFBRSxTQUFHLENBQUMs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SSxDQUFDLEVBQUUsRUFBRTtZQUNyQyxDQUFDLEtBQUssQ0FBQyxvQkFBb0IsQ0FBQyxPQUFPLENBQUMsRUFBRSxFQUFFO1NBQ3pDLENBQUM7SUFDSixDQUFDO0lBRU0sV0FBVztRQUNoQixNQUFNLEtBQUssR0FBZ0IsRUFBRSxDQUFDO1FBQzlCLE9BQU87WUFDTCxJQUFJLEVBQUUsS0FBSyxDQUFDLFNBQVM7WUFDckIsS0FBSztTQUNOLENBQUM7SUFDSixDQUFDO0NBQ0Y7QUFqR0Qsc0JBaUdDO0FBRUQ7O0dBRUc7QUFDSCxNQUFhLHFCQUFxQjtJQUNoQzs7OztPQUlHO0lBQ0ksTUFBTSxDQUFDLGlCQUFpQixDQUM3QixPQUFxQztRQUVyQyxPQUFPLElBQUEsV0FBSSxFQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsRUFBRTtZQUNyRCxNQUFNLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBZSxDQUFDLENBQUM7WUFDbkMsT0FBTyxTQUFTLENBQUM7UUFDbkIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0Y7QUFkRCxzREFjQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gXCJjb25zdHJ1Y3RzXCI7XG5pbXBvcnQgeyBBcHAgfSBmcm9tIFwiLi9hcHBcIjtcbmltcG9ydCB7IEV2ZW50TWFwcGluZyB9IGZyb20gXCIuL2V2ZW50LW1hcHBpbmdcIjtcbmltcG9ydCB7IFBvbGljeSB9IGZyb20gXCIuL3BvbGljeVwiO1xuaW1wb3J0IHsgSVNpbXVsYXRvclJlc291cmNlIH0gZnJvbSBcIi4vcmVzb3VyY2VcIjtcbmltcG9ydCB7IFRvcGljU2NoZW1hIH0gZnJvbSBcIi4vc2NoZW1hLXJlc291cmNlc1wiO1xuaW1wb3J0IHsgYmluZFNpbXVsYXRvclJlc291cmNlLCBtYWtlU2ltdWxhdG9ySnNDbGllbnQgfSBmcm9tIFwiLi91dGlsXCI7XG5pbXBvcnQgeyBGdW5jdGlvbiB9IGZyb20gXCIuLi9jbG91ZFwiO1xuaW1wb3J0ICogYXMgY2xvdWQgZnJvbSBcIi4uL2Nsb3VkXCI7XG5pbXBvcnQgeyBsaWZ0LCBMaWZ0TWFwIH0gZnJvbSBcIi4uL2NvcmVcIjtcbmltcG9ydCB7IFRvU2ltdWxhdG9yT3V0cHV0IH0gZnJvbSBcIi4uL3NpbXVsYXRvclwiO1xuaW1wb3J0IHsgSUluZmxpZ2h0SG9zdCwgTm9kZSwgU0RLX1NPVVJDRV9NT0RVTEUgfSBmcm9tIFwiLi4vc3RkXCI7XG5cbi8qKlxuICogU2ltdWxhdG9yIGltcGxlbWVudGF0aW9uIG9mIGBjbG91ZC5Ub3BpY2BcbiAqXG4gKiBAaW5mbGlnaHQgYEB3aW5nbGFuZy9zZGsuY2xvdWQuSVRvcGljQ2xpZW50YFxuICovXG5leHBvcnQgY2xhc3MgVG9waWMgZXh0ZW5kcyBjbG91ZC5Ub3BpYyBpbXBsZW1lbnRzIElTaW11bGF0b3JSZXNvdXJjZSB7XG4gIHB1YmxpYyByZWFkb25seSBwb2xpY3k6IFBvbGljeTtcbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IGNsb3VkLlRvcGljUHJvcHMgPSB7fSkge1xuICAgIHN1cGVyKHNjb3BlLCBpZCwgcHJvcHMpO1xuICAgIHRoaXMucG9saWN5ID0gbmV3IFBvbGljeSh0aGlzLCBcIlBvbGljeVwiLCB7IHByaW5jaXBhbDogdGhpcyB9KTtcbiAgfVxuXG4gIHB1YmxpYyBvbk1lc3NhZ2UoXG4gICAgaW5mbGlnaHQ6IGNsb3VkLklUb3BpY09uTWVzc2FnZUhhbmRsZXIsXG4gICAgcHJvcHM6IGNsb3VkLlRvcGljT25NZXNzYWdlT3B0aW9ucyA9IHt9XG4gICk6IGNsb3VkLkZ1bmN0aW9uIHtcbiAgICBjb25zdCBmdW5jdGlvbkhhbmRsZXIgPSBUb3BpY09uTWVzc2FnZUhhbmRsZXIudG9GdW5jdGlvbkhhbmRsZXIoaW5mbGlnaHQpO1xuICAgIGNvbnN0IGZuID0gbmV3IEZ1bmN0aW9uKFxuICAgICAgdGhpcyxcbiAgICAgIEFwcC5vZih0aGlzKS5tYWtlSWQodGhpcywgXCJPbk1lc3NhZ2VcIiksXG4gICAgICBmdW5jdGlvbkhhbmRsZXIsXG4gICAgICBwcm9wc1xuICAgICk7XG4gICAgTm9kZS5vZihmbikuc291cmNlTW9kdWxlID0gU0RLX1NPVVJDRV9NT0RVTEU7XG4gICAgTm9kZS5vZihmbikudGl0bGUgPSBcIm9uTWVzc2FnZSgpXCI7XG5cbiAgICBuZXcgRXZlbnRNYXBwaW5nKHRoaXMsIEFwcC5vZih0aGlzKS5tYWtlSWQodGhpcywgXCJUb3BpY0V2ZW50TWFwcGluZ1wiKSwge1xuICAgICAgc3Vic2NyaWJlcjogZm4sXG4gICAgICBwdWJsaXNoZXI6IHRoaXMsXG4gICAgICBzdWJzY3JpcHRpb25Qcm9wczoge30sXG4gICAgfSk7XG5cbiAgICBOb2RlLm9mKHRoaXMpLmFkZENvbm5lY3Rpb24oe1xuICAgICAgc291cmNlOiB0aGlzLFxuICAgICAgc291cmNlT3A6IGNsb3VkLlRvcGljSW5mbGlnaHRNZXRob2RzLlBVQkxJU0gsXG4gICAgICB0YXJnZXQ6IGZuLFxuICAgICAgdGFyZ2V0T3A6IGNsb3VkLkZ1bmN0aW9uSW5mbGlnaHRNZXRob2RzLklOVk9LRSxcbiAgICAgIG5hbWU6IFwib25NZXNzYWdlKClcIixcbiAgICB9KTtcblxuICAgIHRoaXMucG9saWN5LmFkZFN0YXRlbWVudChmbiwgY2xvdWQuRnVuY3Rpb25JbmZsaWdodE1ldGhvZHMuSU5WT0tFX0FTWU5DKTtcblxuICAgIHJldHVybiBmbjtcbiAgfVxuXG4gIHB1YmxpYyBzdWJzY3JpYmVRdWV1ZShxdWV1ZTogY2xvdWQuUXVldWUpOiB2b2lkIHtcbiAgICBjb25zdCBmbiA9IG5ldyBGdW5jdGlvbihcbiAgICAgIHRoaXMsXG4gICAgICBBcHAub2YodGhpcykubWFrZUlkKHRoaXMsIFwic3Vic2NyaWJlUXVldWVcIiksXG4gICAgICBsaWZ0KHsgcXVldWUgfSlcbiAgICAgICAgLmdyYW50KHsgcXVldWU6IFtcInB1c2hcIl0gfSlcbiAgICAgICAgLmluZmxpZ2h0KGFzeW5jIChjdHgsIGV2ZW50KSA9PiB7XG4gICAgICAgICAgYXdhaXQgY3R4LnF1ZXVlLnB1c2goZXZlbnQgYXMgc3RyaW5nKTtcbiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9KSxcbiAgICAgIHt9XG4gICAgKTtcbiAgICBOb2RlLm9mKGZuKS5zb3VyY2VNb2R1bGUgPSBTREtfU09VUkNFX01PRFVMRTtcbiAgICBOb2RlLm9mKGZuKS50aXRsZSA9IFwic3Vic2NyaWJlUXVldWUoKVwiO1xuXG4gICAgbmV3IEV2ZW50TWFwcGluZyh0aGlzLCBBcHAub2YodGhpcykubWFrZUlkKHRoaXMsIFwiVG9waWNFdmVudE1hcHBpbmdcIiksIHtcbiAgICAgIHN1YnNjcmliZXI6IGZuLFxuICAgICAgcHVibGlzaGVyOiB0aGlzLFxuICAgICAgc3Vic2NyaXB0aW9uUHJvcHM6IHt9LFxuICAgIH0pO1xuXG4gICAgTm9kZS5vZih0aGlzKS5hZGRDb25uZWN0aW9uKHtcbiAgICAgIHNvdXJjZTogdGhpcyxcbiAgICAgIHNvdXJjZU9wOiBjbG91ZC5Ub3BpY0luZmxpZ2h0TWV0aG9kcy5QVUJMSVNILFxuICAgICAgdGFyZ2V0OiBmbixcbiAgICAgIHRhcmdldE9wOiBjbG91ZC5GdW5jdGlvbkluZmxpZ2h0TWV0aG9kcy5JTlZPS0VfQVNZTkMsXG4gICAgICBuYW1lOiBcInN1YnNjcmliZVF1ZXVlKClcIixcbiAgICB9KTtcblxuICAgIHRoaXMucG9saWN5LmFkZFN0YXRlbWVudChmbiwgY2xvdWQuRnVuY3Rpb25JbmZsaWdodE1ldGhvZHMuSU5WT0tFX0FTWU5DKTtcbiAgfVxuXG4gIHB1YmxpYyBvbkxpZnQoaG9zdDogSUluZmxpZ2h0SG9zdCwgb3BzOiBzdHJpbmdbXSk6IHZvaWQge1xuICAgIGJpbmRTaW11bGF0b3JSZXNvdXJjZShfX2ZpbGVuYW1lLCB0aGlzLCBob3N0LCBvcHMpO1xuICAgIHN1cGVyLm9uTGlmdChob3N0LCBvcHMpO1xuICB9XG5cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBwdWJsaWMgX3RvSW5mbGlnaHQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gbWFrZVNpbXVsYXRvckpzQ2xpZW50KF9fZmlsZW5hbWUsIHRoaXMpO1xuICB9XG5cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBwdWJsaWMgZ2V0IF9saWZ0TWFwKCk6IExpZnRNYXAge1xuICAgIHJldHVybiB7XG4gICAgICBbY2xvdWQuUXVldWVJbmZsaWdodE1ldGhvZHMuUFVTSF06IFtdLFxuICAgICAgW2Nsb3VkLlRvcGljSW5mbGlnaHRNZXRob2RzLlBVQkxJU0hdOiBbXSxcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIHRvU2ltdWxhdG9yKCk6IFRvU2ltdWxhdG9yT3V0cHV0IHtcbiAgICBjb25zdCBwcm9wczogVG9waWNTY2hlbWEgPSB7fTtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogY2xvdWQuVE9QSUNfRlFOLFxuICAgICAgcHJvcHMsXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIFV0aWxpdHkgY2xhc3MgdG8gd29yayB3aXRoIHRvcGljIG1lc3NhZ2UgaGFuZGxlcnMuXG4gKi9cbmV4cG9ydCBjbGFzcyBUb3BpY09uTWVzc2FnZUhhbmRsZXIge1xuICAvKipcbiAgICogQ29udmVydHMgYSBgY2xvdWQuSVRvcGljT25NZXNzYWdlSGFuZGxlcmAgdG8gYSBgY2xvdWQuSUZ1bmN0aW9uSGFuZGxlcmBcbiAgICogQHBhcmFtIGhhbmRsZXIgdGhlIGhhbmRsZXIgdG8gY29udmVydFxuICAgKiBAcmV0dXJucyB0aGUgZnVuY3Rpb24gaGFuZGxlclxuICAgKi9cbiAgcHVibGljIHN0YXRpYyB0b0Z1bmN0aW9uSGFuZGxlcihcbiAgICBoYW5kbGVyOiBjbG91ZC5JVG9waWNPbk1lc3NhZ2VIYW5kbGVyXG4gICk6IGNsb3VkLklGdW5jdGlvbkhhbmRsZXIge1xuICAgIHJldHVybiBsaWZ0KHsgaGFuZGxlciB9KS5pbmZsaWdodChhc3luYyAoY3R4LCBldmVudCkgPT4ge1xuICAgICAgYXdhaXQgY3R4LmhhbmRsZXIoZXZlbnQgYXMgc3RyaW5nKTtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==