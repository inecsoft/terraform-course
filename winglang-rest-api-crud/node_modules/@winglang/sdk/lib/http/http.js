"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.Util = exports.HttpMethod = exports.RequestRedirect = exports.RequestCache = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const url_1 = require("url");
const core_1 = require("../core");
/**
 * The cache mode of the request.
 * It controls how a request will interact with the system's HTTP cache.
 */
var RequestCache;
(function (RequestCache) {
    /**
     * The runtime environment looks for a matching request in its HTTP cache.
     * * If there is a match and it is fresh, it will be returned from the cache.
     * * If there is a match but it is stale, the runtime environment will make a conditional request to the remote server.
     * * If the server indicates that the resource has not changed, it will be returned from the cache.
     * * Otherwise the resource will be downloaded from the server and the cache will be updated.
     * * If there is no match, the runtime environment will make a normal request, and will update the cache with the downloaded resource.
     */
    RequestCache["DEFAULT"] = "default";
    /**
     * The runtime environment fetches the resource from the remote server without first looking in the cache,
     * and will not update the cache with the downloaded resource.
     */
    RequestCache["NO_STORE"] = "no-store";
    /**
     * The runtime environment fetches the resource from the remote server without first looking in the cache,
     * but then will update the cache with the downloaded resource.
     */
    RequestCache["RELOAD"] = "reload";
    /**
     * The runtime environment looks for a matching request in its HTTP cache.
     * * If there is a match, fresh or stale, the runtime environment will make a conditional request to the remote server.
     * * If the server indicates that the resource has not changed, it will be returned from the cache. Otherwise the resource will be downloaded from the server and the cache will be updated.
     * * If there is no match, the runtime environment will make a normal request, and will update the cache with the downloaded resource.
     */
    RequestCache["NO_CACHE"] = "no-cache";
    /**
     * The runtime environment looks for a matching request in its HTTP cache.
     * * If there is a match, fresh or stale, it will be returned from the cache.
     * * If there is no match, the runtime environment will make a normal request, and will update the cache with the downloaded resource.
     */
    RequestCache["FORCE_CACHE"] = "force-cache";
})(RequestCache || (exports.RequestCache = RequestCache = {}));
/**
 * The redirect read-only property that contains the mode for how redirects are handled.
 */
var RequestRedirect;
(function (RequestRedirect) {
    /**
     * Do not follow redirects automatically. The `Location` response header includes the redirect
     * target.
     */
    RequestRedirect["MANUAL"] = "manual";
    /**
     * Follow all redirects incurred when fetching a resource.
     */
    RequestRedirect["FOLLOW"] = "follow";
    /**
     * Return a network error when a request is met with a redirect.
     */
    RequestRedirect["ERROR"] = "error";
})(RequestRedirect || (exports.RequestRedirect = RequestRedirect = {}));
/**
 * The request's method
 */
var HttpMethod;
(function (HttpMethod) {
    /**
     * GET
     */
    HttpMethod["GET"] = "GET";
    /**
     * PUT
     */
    HttpMethod["PUT"] = "PUT";
    /**
     * DELETE
     */
    HttpMethod["DELETE"] = "DELETE";
    /**
     * PATCH
     */
    HttpMethod["PATCH"] = "PATCH";
    /**
     * POST
     */
    HttpMethod["POST"] = "POST";
    /**
     * OPTIONS
     */
    HttpMethod["OPTIONS"] = "OPTIONS";
    /**
     * HEAD
     */
    HttpMethod["HEAD"] = "HEAD";
})(HttpMethod || (exports.HttpMethod = HttpMethod = {}));
/**
 * Default options to attach to any request
 */
const defaultOptions = {
    method: HttpMethod.GET,
    headers: {},
    cache: RequestCache.DEFAULT,
    redirect: RequestRedirect.FOLLOW,
};
/**
 * The Http class is used for calling different HTTP methods and requesting and sending information online,
 *  as well as testing public accessible resources
 * @inflight
 */
class Util {
    /**
     * @internal
     */
    static _toInflightType() {
        return core_1.InflightClient.forType(__filename, this.name);
    }
    /**
     * Executes a HTTP request to a specified URL and provides a formatted response.
     * This method allows various HTTP methods based on the provided options.
     * @throws Only throws if there is a networking error
     * @param url The target URL for the request.
     * @param options Optional parameters for customizing the HTTP request.
     * @inflight
     * @returns the formatted response of the call
     */
    static async fetch(url, options) {
        const res = await fetch(url, { ...defaultOptions, ...options });
        return this._formatResponse(res);
    }
    /**
     * Executes a GET request to a specified URL and provides a formatted response.
     * @param url The target URL for the GET request.
     * @param options Optional parameters for customizing the GET request.
     * @inflight
     * @returns the formatted response of the call
     */
    static async get(url, options) {
        return this.fetch(url, {
            ...options,
            method: HttpMethod.GET,
        });
    }
    /**
     * Executes a POST request to a specified URL and provides a formatted response.
     * @param url The target URL for the POST request.
     * @param options Optional parameters for customizing the POST request.
     * @inflight
     * @returns the formatted response of the call
     */
    static async post(url, options) {
        return this.fetch(url, {
            ...options,
            method: HttpMethod.POST,
        });
    }
    /**
     * Executes a PUT request to a specified URL and provides a formatted response.
     * @param url The target URL for the PUT request.
     * @param options ptional parameters for customizing the PUT request.
     * @inflight
     * @returns the formatted response of the call
     */
    static async put(url, options) {
        return this.fetch(url, {
            ...options,
            method: HttpMethod.PUT,
        });
    }
    /**
     * Executes a PATCH request to a specified URL and provides a formatted response.
     * @param url The target URL for the PATCH request.
     * @param options Optional parameters for customizing the PATCH request.
     * @inflight
     * @returns the formatted response of the call
     */
    static async patch(url, options) {
        return this.fetch(url, {
            ...options,
            method: HttpMethod.PATCH,
        });
    }
    /**
     * Executes a DELETE request to a specified URL and provides a formatted response.
     * @param url The target URL for the DELETE request.
     * @param options  Optional parameters for customizing the DELETE request.
     * @inflight
     * @returns the formatted response of the call
     */
    static async delete(url, options) {
        return this.fetch(url, {
            ...options,
            method: HttpMethod.DELETE,
        });
    }
    /**
     * Parses the input URL String using WHATWG URL API and returns an URL Struct.
     * @param urlString The URL String to be parsed.
     * @throws Will throw an error if the input String is not a valid URL.
     * @inflight
     * @returns An URL Struct.
     */
    static parseUrl(urlString) {
        try {
            const nodeUrl = new url_1.URL(urlString);
            return {
                href: nodeUrl.href,
                protocol: nodeUrl.protocol,
                host: nodeUrl.host,
                hostname: nodeUrl.hostname,
                port: nodeUrl.port,
                pathname: nodeUrl.pathname,
                search: nodeUrl.search,
                hash: nodeUrl.hash,
                origin: nodeUrl.origin,
                username: nodeUrl.username,
                password: nodeUrl.password,
            };
        }
        catch (error) {
            throw new Error(`Invalid URL: ${urlString}`);
        }
    }
    /**
     * Serializes an URL Struct to a String.
     * @param url The URL Struct to be formatted.
     * @throws Will throw an error if the input URL has invalid fields.
     * @inflight
     * @returns A formatted URL String.
     */
    static formatUrl(url, options) {
        try {
            const nodeUrl = new url_1.URL(url.href);
            return (0, url_1.format)(nodeUrl, options);
        }
        catch (error) {
            if (error instanceof Error) {
                throw new Error(`Unable to format URL Struct: ${error.message}`);
            }
            else {
                throw new Error("Unable to format URL Struct: An unknown error occurred");
            }
        }
    }
    static async _formatResponse(response) {
        // convert Headers object into a plain JS object
        const headers = {};
        response.headers?.forEach((val, key) => {
            headers[key] = val;
        });
        return {
            status: response.status,
            url: response.url,
            ok: response.ok,
            headers: headers,
            body: await response.text(),
        };
    }
    constructor() { }
}
exports.Util = Util;
_a = JSII_RTTI_SYMBOL_1;
Util[_a] = { fqn: "@winglang/sdk.http.Util", version: "0.0.0" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHR0cC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9odHRwL2h0dHAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSw2QkFBNkM7QUFDN0Msa0NBQXlDO0FBRXpDOzs7R0FHRztBQUNILElBQVksWUFpQ1g7QUFqQ0QsV0FBWSxZQUFZO0lBQ3RCOzs7Ozs7O09BT0c7SUFDSCxtQ0FBbUIsQ0FBQTtJQUNuQjs7O09BR0c7SUFDSCxxQ0FBcUIsQ0FBQTtJQUNyQjs7O09BR0c7SUFDSCxpQ0FBaUIsQ0FBQTtJQUNqQjs7Ozs7T0FLRztJQUNILHFDQUFxQixDQUFBO0lBQ3JCOzs7O09BSUc7SUFDSCwyQ0FBMkIsQ0FBQTtBQUM3QixDQUFDLEVBakNXLFlBQVksNEJBQVosWUFBWSxRQWlDdkI7QUFFRDs7R0FFRztBQUNILElBQVksZUFjWDtBQWRELFdBQVksZUFBZTtJQUN6Qjs7O09BR0c7SUFDSCxvQ0FBaUIsQ0FBQTtJQUNqQjs7T0FFRztJQUNILG9DQUFpQixDQUFBO0lBQ2pCOztPQUVHO0lBQ0gsa0NBQWUsQ0FBQTtBQUNqQixDQUFDLEVBZFcsZUFBZSwrQkFBZixlQUFlLFFBYzFCO0FBRUQ7O0dBRUc7QUFDSCxJQUFZLFVBNkJYO0FBN0JELFdBQVksVUFBVTtJQUNwQjs7T0FFRztJQUNILHlCQUFXLENBQUE7SUFDWDs7T0FFRztJQUNILHlCQUFXLENBQUE7SUFDWDs7T0FFRztJQUNILCtCQUFpQixDQUFBO0lBQ2pCOztPQUVHO0lBQ0gsNkJBQWUsQ0FBQTtJQUNmOztPQUVHO0lBQ0gsMkJBQWEsQ0FBQTtJQUNiOztPQUVHO0lBQ0gsaUNBQW1CLENBQUE7SUFDbkI7O09BRUc7SUFDSCwyQkFBYSxDQUFBO0FBQ2YsQ0FBQyxFQTdCVyxVQUFVLDBCQUFWLFVBQVUsUUE2QnJCO0FBcUhEOztHQUVHO0FBQ0gsTUFBTSxjQUFjLEdBQW1CO0lBQ3JDLE1BQU0sRUFBRSxVQUFVLENBQUMsR0FBRztJQUN0QixPQUFPLEVBQUUs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LENBQUMsSUFBSSxFQUFFO1NBQzVCLENBQUM7SUFDSixDQUFDO0lBQ0QsZ0JBQXVCLENBQUM7O0FBNUsxQixvQkE2S0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBVUkwgYXMgTm9kZVVybCwgZm9ybWF0IH0gZnJvbSBcInVybFwiO1xuaW1wb3J0IHsgSW5mbGlnaHRDbGllbnQgfSBmcm9tIFwiLi4vY29yZVwiO1xuXG4vKipcbiAqIFRoZSBjYWNoZSBtb2RlIG9mIHRoZSByZXF1ZXN0LlxuICogSXQgY29udHJvbHMgaG93IGEgcmVxdWVzdCB3aWxsIGludGVyYWN0IHdpdGggdGhlIHN5c3RlbSdzIEhUVFAgY2FjaGUuXG4gKi9cbmV4cG9ydCBlbnVtIFJlcXVlc3RDYWNoZSB7XG4gIC8qKlxuICAgKiBUaGUgcnVudGltZSBlbnZpcm9ubWVudCBsb29rcyBmb3IgYSBtYXRjaGluZyByZXF1ZXN0IGluIGl0cyBIVFRQIGNhY2hlLlxuICAgKiAqIElmIHRoZXJlIGlzIGEgbWF0Y2ggYW5kIGl0IGlzIGZyZXNoLCBpdCB3aWxsIGJlIHJldHVybmVkIGZyb20gdGhlIGNhY2hlLlxuICAgKiAqIElmIHRoZXJlIGlzIGEgbWF0Y2ggYnV0IGl0IGlzIHN0YWxlLCB0aGUgcnVudGltZSBlbnZpcm9ubWVudCB3aWxsIG1ha2UgYSBjb25kaXRpb25hbCByZXF1ZXN0IHRvIHRoZSByZW1vdGUgc2VydmVyLlxuICAgKiAqIElmIHRoZSBzZXJ2ZXIgaW5kaWNhdGVzIHRoYXQgdGhlIHJlc291cmNlIGhhcyBub3QgY2hhbmdlZCwgaXQgd2lsbCBiZSByZXR1cm5lZCBmcm9tIHRoZSBjYWNoZS5cbiAgICogKiBPdGhlcndpc2UgdGhlIHJlc291cmNlIHdpbGwgYmUgZG93bmxvYWRlZCBmcm9tIHRoZSBzZXJ2ZXIgYW5kIHRoZSBjYWNoZSB3aWxsIGJlIHVwZGF0ZWQuXG4gICAqICogSWYgdGhlcmUgaXMgbm8gbWF0Y2gsIHRoZSBydW50aW1lIGVudmlyb25tZW50IHdpbGwgbWFrZSBhIG5vcm1hbCByZXF1ZXN0LCBhbmQgd2lsbCB1cGRhdGUgdGhlIGNhY2hlIHdpdGggdGhlIGRvd25sb2FkZWQgcmVzb3VyY2UuXG4gICAqL1xuICBERUZBVUxUID0gXCJkZWZhdWx0XCIsXG4gIC8qKlxuICAgKiBUaGUgcnVudGltZSBlbnZpcm9ubWVudCBmZXRjaGVzIHRoZSByZXNvdXJjZSBmcm9tIHRoZSByZW1vdGUgc2VydmVyIHdpdGhvdXQgZmlyc3QgbG9va2luZyBpbiB0aGUgY2FjaGUsXG4gICAqIGFuZCB3aWxsIG5vdCB1cGRhdGUgdGhlIGNhY2hlIHdpdGggdGhlIGRvd25sb2FkZWQgcmVzb3VyY2UuXG4gICAqL1xuICBOT19TVE9SRSA9IFwibm8tc3RvcmVcIixcbiAgLyoqXG4gICAqIFRoZSBydW50aW1lIGVudmlyb25tZW50IGZldGNoZXMgdGhlIHJlc291cmNlIGZyb20gdGhlIHJlbW90ZSBzZXJ2ZXIgd2l0aG91dCBmaXJzdCBsb29raW5nIGluIHRoZSBjYWNoZSxcbiAgICogYnV0IHRoZW4gd2lsbCB1cGRhdGUgdGhlIGNhY2hlIHdpdGggdGhlIGRvd25sb2FkZWQgcmVzb3VyY2UuXG4gICAqL1xuICBSRUxPQUQgPSBcInJlbG9hZFwiLFxuICAvKipcbiAgICogVGhlIHJ1bnRpbWUgZW52aXJvbm1lbnQgbG9va3MgZm9yIGEgbWF0Y2hpbmcgcmVxdWVzdCBpbiBpdHMgSFRUUCBjYWNoZS5cbiAgICogKiBJZiB0aGVyZSBpcyBhIG1hdGNoLCBmcmVzaCBvciBzdGFsZSwgdGhlIHJ1bnRpbWUgZW52aXJvbm1lbnQgd2lsbCBtYWtlIGEgY29uZGl0aW9uYWwgcmVxdWVzdCB0byB0aGUgcmVtb3RlIHNlcnZlci5cbiAgICogKiBJZiB0aGUgc2VydmVyIGluZGljYXRlcyB0aGF0IHRoZSByZXNvdXJjZSBoYXMgbm90IGNoYW5nZWQsIGl0IHdpbGwgYmUgcmV0dXJuZWQgZnJvbSB0aGUgY2FjaGUuIE90aGVyd2lzZSB0aGUgcmVzb3VyY2Ugd2lsbCBiZSBkb3dubG9hZGVkIGZyb20gdGhlIHNlcnZlciBhbmQgdGhlIGNhY2hlIHdpbGwgYmUgdXBkYXRlZC5cbiAgICogKiBJZiB0aGVyZSBpcyBubyBtYXRjaCwgdGhlIHJ1bnRpbWUgZW52aXJvbm1lbnQgd2lsbCBtYWtlIGEgbm9ybWFsIHJlcXVlc3QsIGFuZCB3aWxsIHVwZGF0ZSB0aGUgY2FjaGUgd2l0aCB0aGUgZG93bmxvYWRlZCByZXNvdXJjZS5cbiAgICovXG4gIE5PX0NBQ0hFID0gXCJuby1jYWNoZVwiLFxuICAvKipcbiAgICogVGhlIHJ1bnRpbWUgZW52aXJvbm1lbnQgbG9va3MgZm9yIGEgbWF0Y2hpbmcgcmVxdWVzdCBpbiBpdHMgSFRUUCBjYWNoZS5cbiAgICogKiBJZiB0aGVyZSBpcyBhIG1hdGNoLCBmcmVzaCBvciBzdGFsZSwgaXQgd2lsbCBiZSByZXR1cm5lZCBmcm9tIHRoZSBjYWNoZS5cbiAgICogKiBJZiB0aGVyZSBpcyBubyBtYXRjaCwgdGhlIHJ1bnRpbWUgZW52aXJvbm1lbnQgd2lsbCBtYWtlIGEgbm9ybWFsIHJlcXVlc3QsIGFuZCB3aWxsIHVwZGF0ZSB0aGUgY2FjaGUgd2l0aCB0aGUgZG93bmxvYWRlZCByZXNvdXJjZS5cbiAgICovXG4gIEZPUkNFX0NBQ0hFID0gXCJmb3JjZS1jYWNoZVwiLFxufVxuXG4vKipcbiAqIFRoZSByZWRpcmVjdCByZWFkLW9ubHkgcHJvcGVydHkgdGhhdCBjb250YWlucyB0aGUgbW9kZSBmb3IgaG93IHJlZGlyZWN0cyBhcmUgaGFuZGxlZC5cbiAqL1xuZXhwb3J0IGVudW0gUmVxdWVzdFJlZGlyZWN0IHtcbiAgLyoqXG4gICAqIERvIG5vdCBmb2xsb3cgcmVkaXJlY3RzIGF1dG9tYXRpY2FsbHkuIFRoZSBgTG9jYXRpb25gIHJlc3BvbnNlIGhlYWRlciBpbmNsdWRlcyB0aGUgcmVkaXJlY3RcbiAgICogdGFyZ2V0LlxuICAgKi9cbiAgTUFOVUFMID0gXCJtYW51YWxcIixcbiAgLyoqXG4gICAqIEZvbGxvdyBhbGwgcmVkaXJlY3RzIGluY3VycmVkIHdoZW4gZmV0Y2hpbmcgYSByZXNvdXJjZS5cbiAgICovXG4gIEZPTExPVyA9IFwiZm9sbG93XCIsXG4gIC8qKlxuICAgKiBSZXR1cm4gYSBuZXR3b3JrIGVycm9yIHdoZW4gYSByZXF1ZXN0IGlzIG1ldCB3aXRoIGEgcmVkaXJlY3QuXG4gICAqL1xuICBFUlJPUiA9IFwiZXJyb3JcIixcbn1cblxuLyoqXG4gKiBUaGUgcmVxdWVzdCdzIG1ldGhvZFxuICovXG5leHBvcnQgZW51bSBIdHRwTWV0aG9kIHtcbiAgLyoqXG4gICAqIEdFVFxuICAgKi9cbiAgR0VUID0gXCJHRVRcIixcbiAgLyoqXG4gICAqIFBVVFxuICAgKi9cbiAgUFVUID0gXCJQVVRcIixcbiAgLyoqXG4gICAqIERFTEVURVxuICAgKi9cbiAgREVMRVRFID0gXCJERUxFVEVcIixcbiAgLyoqXG4gICAqIFBBVENIXG4gICAqL1xuICBQQVRDSCA9IFwiUEFUQ0hcIixcbiAgLyoqXG4gICAqIFBPU1RcbiAgICovXG4gIFBPU1QgPSBcIlBPU1RcIixcbiAgLyoqXG4gICAqIE9QVElPTlNcbiAgICovXG4gIE9QVElPTlMgPSBcIk9QVElPTlNcIixcbiAgLyoqXG4gICAqIEhFQURcbiAgICovXG4gIEhFQUQgPSBcIkhFQURcIixcbn1cblxuLyoqXG4gKiBBbiBvYmplY3QgY29udGFpbmluZyBhbnkgY3VzdG9tIHNldHRpbmdzIHRoYXQgeW91IHdhbnQgdG8gYXBwbHkgdG8gdGhlIHJlcXVlc3QuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUmVxdWVzdE9wdGlvbnMge1xuICAvKipcbiAgICogVGhlIHJlcXVlc3QgbWV0aG9kLCBlLmcuLCBHRVQsIFBPU1QuIFRoZSBkZWZhdWx0IGlzIEdFVC5cbiAgICogQGRlZmF1bHQgR0VUXG4gICAqL1xuICByZWFkb25seSBtZXRob2Q/OiBIdHRwTWV0aG9kO1xuICAvKipcbiAgICogQW55IGhlYWRlcnMgeW91IHdhbnQgdG8gYWRkIHRvIHlvdXIgcmVxdWVzdC5cbiAgICovXG4gIHJlYWRvbmx5IGhlYWRlcnM/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xuICAvKipcbiAgICogQW55IGJvZHkgdGhhdCB5b3Ugd2FudCB0byBhZGQgdG8geW91ciByZXF1ZXN0LlxuICAgKiBOb3RlIHRoYXQgYSByZXF1ZXN0IHVzaW5nIHRoZSBHRVQgb3IgSEVBRCBtZXRob2QgY2Fubm90IGhhdmUgYSBib2R5LlxuICAgKi9cbiAgcmVhZG9ubHkgYm9keT86IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBjYWNoZSBtb2RlIHlvdSB3YW50IHRvIHVzZSBmb3IgdGhlIHJlcXVlc3QuXG4gICAqIEBkZWZhdWx0IFJlcXVlc3RDYWNoZS5ERUZBVUxUXG4gICAqL1xuICByZWFkb25seSBjYWNoZT86IFJlcXVlc3RDYWNoZTtcbiAgLyoqXG4gICAqIEFuIGVudW0gc3BlY2lmeWluZyB0aGUgcmVkaXJlY3QgbW9kZSB0byB1c2U6IGZvbGxvdywgZXJyb3Igb3IgbWFudWFsLiBUaGUgZGVmYXVsdCBpcyBmb2xsb3cuXG4gICAqIEBkZWZhdWx0IFJlcXVlc3RSZWRpcmVjdC5GT0xMT1dcbiAgICovXG4gIHJlYWRvbmx5IHJlZGlyZWN0PzogUmVxdWVzdFJlZGlyZWN0O1xuICAvKipcbiAgICogQSBzdHJpbmcgc3BlY2lmeWluZyBcIm5vLXJlZmVycmVyXCIsIGNsaWVudCwgb3IgYSBVUkwuIFRoZSBkZWZhdWx0IGlzIFwiYWJvdXQ6Y2xpZW50XCIuXG4gICAqIEBkZWZhdWx0IGFib3V0OmNsaWVudFxuICAgKi9cbiAgcmVhZG9ubHkgcmVmZXJyZXI/OiBzdHJpbmc7XG59XG4vKipcbiAqIFRoZSByZXNwb25zZSB0byBhIEhUVFAgcmVxdWVzdC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBSZXNwb25zZSB7XG4gIC8qKlxuICAgKiBUaGUgc3RhdHVzIGNvZGUgb2YgdGhlIHJlc3BvbnNlLiAoVGhpcyB3aWxsIGJlIDIwMCBmb3IgYSBzdWNjZXNzKS5cbiAgICovXG4gIHJlYWRvbmx5IHN0YXR1czogbnVtYmVyO1xuICAvKipcbiAgICogVGhlIFVSTCBvZiB0aGUgcmVzcG9uc2UuXG4gICAqL1xuICByZWFkb25seSB1cmw6IHN0cmluZztcbiAgLyoqXG4gICAqIEEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgdGhlIHJlc3BvbnNlIHdhcyBzdWNjZXNzZnVsIChzdGF0dXMgaW4gdGhlIHJhbmdlIDIwMCDigJMgMjk5KSBvciBub3QuXG4gICAqL1xuICByZWFkb25seSBvazogYm9vbGVhbjtcbiAgLyoqXG4gICAqIFRoZSBtYXAgb2YgaGVhZGVyIGluZm9ybWF0aW9uIGFzc29jaWF0ZWQgd2l0aCB0aGUgcmVzcG9uc2UuXG4gICAqL1xuICByZWFkb25seSBoZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xuICAvKipcbiAgICogQSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGJvZHkgY29udGVudHMuXG4gICAqL1xuICByZWFkb25seSBib2R5OiBzdHJpbmc7XG59XG5cbi8qKlxuICogQW4gVVJMIGZvbGxvd2luZyBXSEFUV0cgVVJMIFN0YW5kYXJkLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFVybCB7XG4gIC8qKiBUaGUgZW50aXJlIFVSTC4gKi9cbiAgcmVhZG9ubHkgaHJlZjogc3RyaW5nO1xuXG4gIC8qKiBUaGUgVVJMJ3MgcHJvdG9jb2wuICovXG4gIHJlYWRvbmx5IHByb3RvY29sOiBzdHJpbmc7XG5cbiAgLyoqIFRoZSBVUkwncyBob3N0LiAqL1xuICByZWFkb25seSBob3N0OiBzdHJpbmc7XG5cbiAgLyoqIFRoZSBVUkwncyBob3N0bmFtZS4gKi9cbiAgcmVhZG9ubHkgaG9zdG5hbWU6IHN0cmluZztcblxuICAvKiogVGhlIFVSTCdzIHBvcnQuICovXG4gIHJlYWRvbmx5IHBvcnQ6IHN0cmluZztcblxuICAvKiogVGhlIFVSTCdzIHBhdGhuYW1lLiAqL1xuICByZWFkb25seSBwYXRobmFtZTogc3RyaW5nO1xuXG4gIC8qKiBUaGUgVVJMJ3Mgc2VhcmNoLiAqL1xuICByZWFkb25seSBzZWFyY2g6IHN0cmluZztcblxuICAvKiogVGhlIFVSTCdzIGZyYWdtZW50LiAqL1xuICByZWFkb25seSBoYXNoOiBzdHJpbmc7XG5cbiAgLyoqIFRoZSBVUkwncyBvcmlnaW4uICovXG4gIHJlYWRvbmx5IG9yaWdpbjogc3RyaW5nO1xuXG4gIC8qKiBUaGUgVVJMJ3MgdXNlcm5hbWUuICovXG4gIHJlYWRvbmx5IHVzZXJuYW1lOiBzdHJpbmc7XG5cbiAgLyoqIFRoZSBVUkzigJlzIHBhc3N3b3JkLiAqL1xuICByZWFkb25seSBwYXNzd29yZDogc3RyaW5nO1xufVxuXG4vKipcbiAqIE9wdGlvbnMgZm9yIHNlcmlhbGl6aW5nIGEgV0hBVFdHIFVSTCB0byBhIFN0cmluZy5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBGb3JtYXRVcmxPcHRpb25zIHtcbiAgLyoqIFdoZXRoZXIgdGhlIGZvcm1hdHRlZCBVUkwgc2hvdWxkIGluY2x1ZGUgdGhlIHVzZXJuYW1lIGFuZCBwYXNzd29yZC4gKi9cbiAgcmVhZG9ubHkgYXV0aD86IGJvb2xlYW47XG5cbiAgLyoqIFdoZXRoZXIgdGhlIGZvcm1hdHRlZCBVUkwgc2hvdWxkIGluY2x1ZGUgdGhlIGZyYWdtZW50IGlkZW50aWZpZXIuICovXG4gIHJlYWRvbmx5IGZyYWdtZW50PzogYm9vbGVhbjtcblxuICAvKiogV2hldGhlciB0aGUgZm9ybWF0dGVkIFVSTCBzaG91bGQgaW5jbHVkZSB0aGUgc2VhcmNoIHF1ZXJ5LiAqL1xuICByZWFkb25seSBzZWFyY2g/OiBib29sZWFuO1xuXG4gIC8qKiBXaGV0aGVyIHRoZSBmb3JtYXR0ZWQgVVJMIHNob3VsZCByZXByZXNlbnQgVW5pY29kZSBjaGFyYWN0ZXJzIGZvciB0aGUgaG9zdCBjb21wb25lbnQuICovXG4gIHJlYWRvbmx5IHVuaWNvZGU/OiBib29sZWFuO1xufVxuXG4vKipcbiAqIERlZmF1bHQgb3B0aW9ucyB0byBhdHRhY2ggdG8gYW55IHJlcXVlc3RcbiAqL1xuY29uc3QgZGVmYXVsdE9wdGlvbnM6IFJlcXVlc3RPcHRpb25zID0ge1xuICBtZXRob2Q6IEh0dHBNZXRob2QuR0VULFxuICBoZWFkZXJzOiB7fSxcbiAgY2FjaGU6IFJlcXVlc3RDYWNoZS5ERUZBVUxULFxuICByZWRpcmVjdDogUmVxdWVzdFJlZGlyZWN0LkZPTExPVyxcbn07XG5cbi8qKlxuICogVGhlIEh0dHAgY2xhc3MgaXMgdXNlZCBmb3IgY2FsbGluZyBkaWZmZXJlbnQgSFRUUCBtZXRob2RzIGFuZCByZXF1ZXN0aW5nIGFuZCBzZW5kaW5nIGluZm9ybWF0aW9uIG9ubGluZSxcbiAqICBhcyB3ZWxsIGFzIHRlc3RpbmcgcHVibGljIGFjY2Vzc2libGUgcmVzb3VyY2VzXG4gKiBAaW5mbGlnaHRcbiAqL1xuZXhwb3J0IGNsYXNzIFV0aWwge1xuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIF90b0luZmxpZ2h0VHlwZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiBJbmZsaWdodENsaWVudC5mb3JUeXBlKF9fZmlsZW5hbWUsIHRoaXMubmFtZSk7XG4gIH1cbiAgLyoqXG4gICAqIEV4ZWN1dGVzIGEgSFRUUCByZXF1ZXN0IHRvIGEgc3BlY2lmaWVkIFVSTCBhbmQgcHJvdmlkZXMgYSBmb3JtYXR0ZWQgcmVzcG9uc2UuXG4gICAqIFRoaXMgbWV0aG9kIGFsbG93cyB2YXJpb3VzIEhUVFAgbWV0aG9kcyBiYXNlZCBvbiB0aGUgcHJvdmlkZWQgb3B0aW9ucy5cbiAgICogQHRocm93cyBPbmx5IHRocm93cyBpZiB0aGVyZSBpcyBhIG5ldHdvcmtpbmcgZXJyb3JcbiAgICogQHBhcmFtIHVybCBUaGUgdGFyZ2V0IFVSTCBmb3IgdGhlIHJlcXVlc3QuXG4gICAqIEBwYXJhbSBvcHRpb25zIE9wdGlvbmFsIHBhcmFtZXRlcnMgZm9yIGN1c3RvbWl6aW5nIHRoZSBIVFRQIHJlcXVlc3QuXG4gICAqIEBpbmZsaWdodFxuICAgKiBAcmV0dXJucyB0aGUgZm9ybWF0dGVkIHJlc3BvbnNlIG9mIHRoZSBjYWxsXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGFzeW5jIGZldGNoKFxuICAgIHVybDogc3RyaW5nLFxuICAgIG9wdGlvbnM/OiBSZXF1ZXN0T3B0aW9uc1xuICApOiBQcm9taXNlPFJlc3BvbnNlPiB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2godXJsLCB7IC4uLmRlZmF1bHRPcHRpb25zLCAuLi5vcHRpb25zIH0pO1xuICAgIHJldHVybiB0aGlzLl9mb3JtYXRSZXNwb25zZShyZXMpO1xuICB9XG4gIC8qKlxuICAgKiBFeGVjdXRlcyBhIEdFVCByZXF1ZXN0IHRvIGEgc3BlY2lmaWVkIFVSTCBhbmQgcHJvdmlkZXMgYSBmb3JtYXR0ZWQgcmVzcG9uc2UuXG4gICAqIEBwYXJhbSB1cmwgVGhlIHRhcmdldCBVUkwgZm9yIHRoZSBHRVQgcmVxdWVzdC5cbiAgICogQHBhcmFtIG9wdGlvbnMgT3B0aW9uYWwgcGFyYW1ldGVycyBmb3IgY3VzdG9taXppbmcgdGhlIEdFVCByZXF1ZXN0LlxuICAgKiBAaW5mbGlnaHRcbiAgICogQHJldHVybnMgdGhlIGZvcm1hdHRlZCByZXNwb25zZSBvZiB0aGUgY2FsbFxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBhc3luYyBnZXQoXG4gICAgdXJsOiBzdHJpbmcsXG4gICAgb3B0aW9ucz86IFJlcXVlc3RPcHRpb25zXG4gICk6IFByb21pc2U8UmVzcG9uc2U+IHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaCh1cmwsIHtcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgICBtZXRob2Q6IEh0dHBNZXRob2QuR0VULFxuICAgIH0pO1xuICB9XG4gIC8qKlxuICAgKiBFeGVjdXRlcyBhIFBPU1QgcmVxdWVzdCB0byBhIHNwZWNpZmllZCBVUkwgYW5kIHByb3ZpZGVzIGEgZm9ybWF0dGVkIHJlc3BvbnNlLlxuICAgKiBAcGFyYW0gdXJsIFRoZSB0YXJnZXQgVVJMIGZvciB0aGUgUE9TVCByZXF1ZXN0LlxuICAgKiBAcGFyYW0gb3B0aW9ucyBPcHRpb25hbCBwYXJhbWV0ZXJzIGZvciBjdXN0b21pemluZyB0aGUgUE9TVCByZXF1ZXN0LlxuICAgKiBAaW5mbGlnaHRcbiAgICogQHJldHVybnMgdGhlIGZvcm1hdHRlZCByZXNwb25zZSBvZiB0aGUgY2FsbFxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBhc3luYyBwb3N0KFxuICAgIHVybDogc3RyaW5nLFxuICAgIG9wdGlvbnM/OiBSZXF1ZXN0T3B0aW9uc1xuICApOiBQcm9taXNlPFJlc3BvbnNlPiB7XG4gICAgcmV0dXJuIHRoaXMuZmV0Y2godXJsLCB7XG4gICAgICAuLi5vcHRpb25zLFxuICAgICAgbWV0aG9kOiBIdHRwTWV0aG9kLlBPU1QsXG4gICAgfSk7XG4gIH1cbiAgLyoqXG4gICAqIEV4ZWN1dGVzIGEgUFVUIHJlcXVlc3QgdG8gYSBzcGVjaWZpZWQgVVJMIGFuZCBwcm92aWRlcyBhIGZvcm1hdHRlZCByZXNwb25zZS5cbiAgICogQHBhcmFtIHVybCBUaGUgdGFyZ2V0IFVSTCBmb3IgdGhlIFBVVCByZXF1ZXN0LlxuICAgKiBAcGFyYW0gb3B0aW9ucyBwdGlvbmFsIHBhcmFtZXRlcnMgZm9yIGN1c3RvbWl6aW5nIHRoZSBQVVQgcmVxdWVzdC5cbiAgICogQGluZmxpZ2h0XG4gICAqIEByZXR1cm5zIHRoZSBmb3JtYXR0ZWQgcmVzcG9uc2Ugb2YgdGhlIGNhbGxcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgYXN5bmMgcHV0KFxuICAgIHVybDogc3RyaW5nLFxuICAgIG9wdGlvbnM/OiBSZXF1ZXN0T3B0aW9uc1xuICApOiBQcm9taXNlPFJlc3BvbnNlPiB7XG4gICAgcmV0dXJuIHRoaXMuZmV0Y2godXJsLCB7XG4gICAgICAuLi5vcHRpb25zLFxuICAgICAgbWV0aG9kOiBIdHRwTWV0aG9kLlBVVCxcbiAgICB9KTtcbiAgfVxuICAvKipcbiAgICogRXhlY3V0ZXMgYSBQQVRDSCByZXF1ZXN0IHRvIGEgc3BlY2lmaWVkIFVSTCBhbmQgcHJvdmlkZXMgYSBmb3JtYXR0ZWQgcmVzcG9uc2UuXG4gICAqIEBwYXJhbSB1cmwgVGhlIHRhcmdldCBVUkwgZm9yIHRoZSBQQVRDSCByZXF1ZXN0LlxuICAgKiBAcGFyYW0gb3B0aW9ucyBPcHRpb25hbCBwYXJhbWV0ZXJzIGZvciBjdXN0b21pemluZyB0aGUgUEFUQ0ggcmVxdWVzdC5cbiAgICogQGluZmxpZ2h0XG4gICAqIEByZXR1cm5zIHRoZSBmb3JtYXR0ZWQgcmVzcG9uc2Ugb2YgdGhlIGNhbGxcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgYXN5bmMgcGF0Y2goXG4gICAgdXJsOiBzdHJpbmcsXG4gICAgb3B0aW9ucz86IFJlcXVlc3RPcHRpb25zXG4gICk6IFByb21pc2U8UmVzcG9uc2U+IHtcbiAgICByZXR1cm4gdGhpcy5mZXRjaCh1cmwsIHtcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgICBtZXRob2Q6IEh0dHBNZXRob2QuUEFUQ0gsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZXMgYSBERUxFVEUgcmVxdWVzdCB0byBhIHNwZWNpZmllZCBVUkwgYW5kIHByb3ZpZGVzIGEgZm9ybWF0dGVkIHJlc3BvbnNlLlxuICAgKiBAcGFyYW0gdXJsIFRoZSB0YXJnZXQgVVJMIGZvciB0aGUgREVMRVRFIHJlcXVlc3QuXG4gICAqIEBwYXJhbSBvcHRpb25zICBPcHRpb25hbCBwYXJhbWV0ZXJzIGZvciBjdXN0b21pemluZyB0aGUgREVMRVRFIHJlcXVlc3QuXG4gICAqIEBpbmZsaWdodFxuICAgKiBAcmV0dXJucyB0aGUgZm9ybWF0dGVkIHJlc3BvbnNlIG9mIHRoZSBjYWxsXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGFzeW5jIGRlbGV0ZShcbiAgICB1cmw6IHN0cmluZyxcbiAgICBvcHRpb25zPzogUmVxdWVzdE9wdGlvbnNcbiAgKTogUHJvbWlzZTxSZXNwb25zZT4ge1xuICAgIHJldHVybiB0aGlzLmZldGNoKHVybCwge1xuICAgICAgLi4ub3B0aW9ucyxcbiAgICAgIG1ldGhvZDogSHR0cE1ldGhvZC5ERUxFVEUsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUGFyc2VzIHRoZSBpbnB1dCBVUkwgU3RyaW5nIHVzaW5nIFdIQVRXRyBVUkwgQVBJIGFuZCByZXR1cm5zIGFuIFVSTCBTdHJ1Y3QuXG4gICAqIEBwYXJhbSB1cmxTdHJpbmcgVGhlIFVSTCBTdHJpbmcgdG8gYmUgcGFyc2VkLlxuICAgKiBAdGhyb3dzIFdpbGwgdGhyb3cgYW4gZXJyb3IgaWYgdGhlIGlucHV0IFN0cmluZyBpcyBub3QgYSB2YWxpZCBVUkwuXG4gICAqIEBpbmZsaWdodFxuICAgKiBAcmV0dXJucyBBbiBVUkwgU3RydWN0LlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBwYXJzZVVybCh1cmxTdHJpbmc6IHN0cmluZyk6IFVybCB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG5vZGVVcmwgPSBuZXcgTm9kZVVybCh1cmxTdHJpbmcpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaHJlZjogbm9kZVVybC5ocmVmLFxuICAgICAgICBwcm90b2NvbDogbm9kZVVybC5wcm90b2NvbCxcbiAgICAgICAgaG9zdDogbm9kZVVybC5ob3N0LFxuICAgICAgICBob3N0bmFtZTogbm9kZVVybC5ob3N0bmFtZSxcbiAgICAgICAgcG9ydDogbm9kZVVybC5wb3J0LFxuICAgICAgICBwYXRobmFtZTogbm9kZVVybC5wYXRobmFtZSxcbiAgICAgICAgc2VhcmNoOiBub2RlVXJsLnNlYXJjaCxcbiAgICAgICAgaGFzaDogbm9kZVVybC5oYXNoLFxuICAgICAgICBvcmlnaW46IG5vZGVVcmwub3JpZ2luLFxuICAgICAgICB1c2VybmFtZTogbm9kZVVybC51c2VybmFtZSxcbiAgICAgICAgcGFzc3dvcmQ6IG5vZGVVcmwucGFzc3dvcmQsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgVVJMOiAke3VybFN0cmluZ31gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2VyaWFsaXplcyBhbiBVUkwgU3RydWN0IHRvIGEgU3RyaW5nLlxuICAgKiBAcGFyYW0gdXJsIFRoZSBVUkwgU3RydWN0IHRvIGJlIGZvcm1hdHRlZC5cbiAgICogQHRocm93cyBXaWxsIHRocm93IGFuIGVycm9yIGlmIHRoZSBpbnB1dCBVUkwgaGFzIGludmFsaWQgZmllbGRzLlxuICAgKiBAaW5mbGlnaHRcbiAgICogQHJldHVybnMgQSBmb3JtYXR0ZWQgVVJMIFN0cmluZy5cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgZm9ybWF0VXJsKHVybDogVXJsLCBvcHRpb25zPzogRm9ybWF0VXJsT3B0aW9ucyk6IHN0cmluZyB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG5vZGVVcmwgPSBuZXcgTm9kZVVybCh1cmwuaHJlZik7XG4gICAgICByZXR1cm4gZm9ybWF0KG5vZGVVcmwsIG9wdGlvbnMpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuYWJsZSB0byBmb3JtYXQgVVJMIFN0cnVjdDogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiVW5hYmxlIHRvIGZvcm1hdCBVUkwgU3RydWN0OiBBbiB1bmtub3duIGVycm9yIG9jY3VycmVkXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBhc3luYyBfZm9ybWF0UmVzcG9uc2UoXG4gICAgcmVzcG9uc2U6IGdsb2JhbFRoaXMuUmVzcG9uc2VcbiAgKTogUHJvbWlzZTxSZXNwb25zZT4ge1xuICAgIC8vIGNvbnZlcnQgSGVhZGVycyBvYmplY3QgaW50byBhIHBsYWluIEpTIG9iamVjdFxuICAgIGNvbnN0IGhlYWRlcnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTtcbiAgICByZXNwb25zZS5oZWFkZXJzPy5mb3JFYWNoKCh2YWw6IHN0cmluZywga2V5OiBzdHJpbmcpID0+IHtcbiAgICAgIGhlYWRlcnNba2V5XSA9IHZhbDtcbiAgICB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgIHVybDogcmVzcG9uc2UudXJsLFxuICAgICAgb2s6IHJlc3BvbnNlLm9rLFxuICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgIGJvZHk6IGF3YWl0IHJlc3BvbnNlLnRleHQoKSxcbiAgICB9O1xuICB9XG4gIHByaXZhdGUgY29uc3RydWN0b3IoKSB7fVxufVxuIl19