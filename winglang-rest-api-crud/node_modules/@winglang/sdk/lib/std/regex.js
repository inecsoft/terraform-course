"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.Regex = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const core_1 = require("../core");
const misc_1 = require("../shared/misc");
/**
 * Represents a compiled regular expression pattern.
 * @wingType regex
 */
class Regex {
    /**
     * @internal
     */
    static _toInflightType() {
        return core_1.InflightClient.forType(__filename, this.name);
    }
    /**
     * Compiles the provided regex pattern into a `Regex` object.
     * @param pattern The regex pattern to compile.
     * @returns A new `Regex` object representing the compiled pattern.
     */
    static compile(pattern) {
        return new Regex(pattern);
    }
    /**
     * Constructs a new `Regex` object with the specified pattern.
     * @param pattern The regular expression pattern.
     */
    constructor(pattern) {
        this._regex = new RegExp(pattern);
    }
    /** @internal */
    _toInflight() {
        return `(new (require("${(0, misc_1.normalPath)(__filename)}").Regex)(${this._regex}))`;
    }
    /**
     * Checks if the regular expression matches the provided text.
     * @param text The text to check against.
     * @returns `true` if there is a match, otherwise `false`.
     */
    test(text) {
        return this._regex.test(text);
    }
    /**
     * Finds the first occurrence of the pattern within the text.
     * @param text The text to search within.
     * @returns The first match if found, otherwise `undefined`.
     */
    find(text) {
        const result = text.match(this._regex);
        return result ? result[0] : undefined;
    }
    /**
     * Finds the start and end index of the first match within the text.
     * @param text The text to search within.
     * @returns An array containing the start and end index of the match if found, otherwise `undefined`.
     */
    findIndex(text) {
        const result = this._regex.exec(text);
        return result ? [result.index, result.index + result[0].length] : undefined;
    }
    /**
     * Finds the first match and its submatches.
     * @param text The text to search within.
     * @returns An array containing the match and all submatches.
     */
    findSubmatch(text) {
        const result = text.match(this._regex);
        if (result) {
            return [result[0], ...result.slice(1)];
        }
        return undefined;
    }
    /**
     * Finds the start and end index of the match and all submatches.
     * @param text The text to search within.
     * @returns An array containing arrays of start and end indices for the match and all submatches.
     */
    findSubmatchIndex(text) {
        const result = this._regex.exec(text);
        if (!result) {
            return undefined;
        }
        // Initialize the array with the match's start and end indices
        const indices = [[result.index, result.index + result[0].length]];
        // Add submatch indices
        result.slice(1).forEach((submatch) => {
            const start = text.indexOf(submatch, indices[indices.length - 1][0]);
            const end = start + submatch.length;
            indices.push([start, end]);
        });
        return indices;
    }
    /**
     * Finds all non-overlapping occurrences of the pattern within the text.
     * Returns an empty array if no matches are found.
     * @param text The text to search within.
     * @returns An array containing all matches found.
     */
    findAll(text) {
        const globalRegex = this.getGlobalRegex();
        return [...text.matchAll(globalRegex)].map((match) => match[0]);
    }
    /**
     * Finds the start and end index of all matches within the text.
     * Indices are zero-based.
     * @param text The text to search within.
     * @returns An array containing arrays of start and end indices for each match found.
     */
    findAllIndex(text) {
        const matches = [];
        const globalRegex = this.getGlobalRegex();
        for (const match of text.matchAll(globalRegex)) {
            if (match.index !== undefined) {
                matches.push([match.index, match.index + match[0].length]);
            }
        }
        return matches;
    }
    /**
     * Replaces all occurrences of the match with a replacement string.
     * @param text The text to search and replace within.
     * @param replacement The replacement string.
     * @returns The resulting text after all replacements.
     */
    replaceAll(text, replacement) {
        const globalRegex = this.getGlobalRegex();
        return text.replace(globalRegex, replacement);
    }
    /**
     * Helper method to get the global version of a regex.
     * @returns The current regex if it's already global, otherwise a new global regex.
     */
    getGlobalRegex() {
        return this._regex.global ? this._regex : new RegExp(this._regex, "g");
    }
}
exports.Regex = Regex;
_a = JSII_RTTI_SYMBOL_1;
Regex[_a] = { fqn: "@winglang/sdk.std.Regex", version: "0.0.0" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVnZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc3RkL3JlZ2V4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0Esa0NBQXlDO0FBQ3pDLHlDQUE0QztBQUU1Qzs7O0dBR0c7QUFDSCxNQUFhLEtBQUs7SUFDaEI7O09BRUc7SUFDSSxNQUFNLENBQUMsZUFBZTtRQUMzQixPQUFPLHFCQUFjLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDdkQsQ0FBQztJQUVEOzs7O09BSUc7SUFDSSxNQUFNLENBQUMsT0FBTyxDQUFDLE9BQWU7UUFDbkMsT0FBTyxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBS0Q7OztPQUdHO0lBQ0gsWUFBb0IsT0FBZTtRQUNqQyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFFRCxnQkFBZ0I7SUFDVCxXQUFXO1FBQ2hCLE9BQU8sa0JBQWtCLElBQUEsaUJBQVUsRUFBQyxVQUFVLENBQUMsYUFBYSxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUM7SUFDOUUsQ0FBQztJQUVEOzs7O09BSUc7SUFDSSxJQUFJLENBQUMsSUFBWTtRQUN0QixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2hDLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksSUFBSSxDQUFDLElBQVk7UUFDdEIsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDdkMsT0FBTyxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO0lBQ3hDLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksU0FBUyxDQUFDLElBQVk7UUFDM0IsTUFB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LEVBQUUsQ0FBQztRQUMxQyxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFFRDs7O09BR0c7SUFDSyxjQUFjO1FBQ3BCLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDekUsQ0FBQzs7QUFsSkgsc0JBbUpDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSUxpZnRhYmxlIH0gZnJvbSBcIi4vcmVzb3VyY2VcIjtcbmltcG9ydCB7IEluZmxpZ2h0Q2xpZW50IH0gZnJvbSBcIi4uL2NvcmVcIjtcbmltcG9ydCB7IG5vcm1hbFBhdGggfSBmcm9tIFwiLi4vc2hhcmVkL21pc2NcIjtcblxuLyoqXG4gKiBSZXByZXNlbnRzIGEgY29tcGlsZWQgcmVndWxhciBleHByZXNzaW9uIHBhdHRlcm4uXG4gKiBAd2luZ1R5cGUgcmVnZXhcbiAqL1xuZXhwb3J0IGNsYXNzIFJlZ2V4IGltcGxlbWVudHMgSUxpZnRhYmxlIHtcbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBfdG9JbmZsaWdodFR5cGUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gSW5mbGlnaHRDbGllbnQuZm9yVHlwZShfX2ZpbGVuYW1lLCB0aGlzLm5hbWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbXBpbGVzIHRoZSBwcm92aWRlZCByZWdleCBwYXR0ZXJuIGludG8gYSBgUmVnZXhgIG9iamVjdC5cbiAgICogQHBhcmFtIHBhdHRlcm4gVGhlIHJlZ2V4IHBhdHRlcm4gdG8gY29tcGlsZS5cbiAgICogQHJldHVybnMgQSBuZXcgYFJlZ2V4YCBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBjb21waWxlZCBwYXR0ZXJuLlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBjb21waWxlKHBhdHRlcm46IHN0cmluZyk6IFJlZ2V4IHtcbiAgICByZXR1cm4gbmV3IFJlZ2V4KHBhdHRlcm4pO1xuICB9XG5cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBwcml2YXRlIHJlYWRvbmx5IF9yZWdleDogUmVnRXhwO1xuXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3RzIGEgbmV3IGBSZWdleGAgb2JqZWN0IHdpdGggdGhlIHNwZWNpZmllZCBwYXR0ZXJuLlxuICAgKiBAcGFyYW0gcGF0dGVybiBUaGUgcmVndWxhciBleHByZXNzaW9uIHBhdHRlcm4uXG4gICAqL1xuICBwcml2YXRlIGNvbnN0cnVjdG9yKHBhdHRlcm46IHN0cmluZykge1xuICAgIHRoaXMuX3JlZ2V4ID0gbmV3IFJlZ0V4cChwYXR0ZXJuKTtcbiAgfVxuXG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgcHVibGljIF90b0luZmxpZ2h0KCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGAobmV3IChyZXF1aXJlKFwiJHtub3JtYWxQYXRoKF9fZmlsZW5hbWUpfVwiKS5SZWdleCkoJHt0aGlzLl9yZWdleH0pKWA7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIGlmIHRoZSByZWd1bGFyIGV4cHJlc3Npb24gbWF0Y2hlcyB0aGUgcHJvdmlkZWQgdGV4dC5cbiAgICogQHBhcmFtIHRleHQgVGhlIHRleHQgdG8gY2hlY2sgYWdhaW5zdC5cbiAgICogQHJldHVybnMgYHRydWVgIGlmIHRoZXJlIGlzIGEgbWF0Y2gsIG90aGVyd2lzZSBgZmFsc2VgLlxuICAgKi9cbiAgcHVibGljIHRlc3QodGV4dDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX3JlZ2V4LnRlc3QodGV4dCk7XG4gIH1cblxuICAvKipcbiAgICogRmluZHMgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgdGhlIHBhdHRlcm4gd2l0aGluIHRoZSB0ZXh0LlxuICAgKiBAcGFyYW0gdGV4dCBUaGUgdGV4dCB0byBzZWFyY2ggd2l0aGluLlxuICAgKiBAcmV0dXJucyBUaGUgZmlyc3QgbWF0Y2ggaWYgZm91bmQsIG90aGVyd2lzZSBgdW5kZWZpbmVkYC5cbiAgICovXG4gIHB1YmxpYyBmaW5kKHRleHQ6IHN0cmluZyk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgY29uc3QgcmVzdWx0ID0gdGV4dC5tYXRjaCh0aGlzLl9yZWdleCk7XG4gICAgcmV0dXJuIHJlc3VsdCA/IHJlc3VsdFswXSA6IHVuZGVmaW5lZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5kcyB0aGUgc3RhcnQgYW5kIGVuZCBpbmRleCBvZiB0aGUgZmlyc3QgbWF0Y2ggd2l0aGluIHRoZSB0ZXh0LlxuICAgKiBAcGFyYW0gdGV4dCBUaGUgdGV4dCB0byBzZWFyY2ggd2l0aGluLlxuICAgKiBAcmV0dXJucyBBbiBhcnJheSBjb250YWluaW5nIHRoZSBzdGFydCBhbmQgZW5kIGluZGV4IG9mIHRoZSBtYXRjaCBpZiBmb3VuZCwgb3RoZXJ3aXNlIGB1bmRlZmluZWRgLlxuICAgKi9cbiAgcHVibGljIGZpbmRJbmRleCh0ZXh0OiBzdHJpbmcpOiBudW1iZXJbXSB8IHVuZGVmaW5lZCB7XG4gICAgY29uc3QgcmVzdWx0ID0gdGhpcy5fcmVnZXguZXhlYyh0ZXh0KTtcbiAgICByZXR1cm4gcmVzdWx0ID8gW3Jlc3VsdC5pbmRleCwgcmVzdWx0LmluZGV4ICsgcmVzdWx0WzBdLmxlbmd0aF0gOiB1bmRlZmluZWQ7XG4gIH1cblxuICAvKipcbiAgICogRmluZHMgdGhlIGZpcnN0IG1hdGNoIGFuZCBpdHMgc3VibWF0Y2hlcy5cbiAgICogQHBhcmFtIHRleHQgVGhlIHRleHQgdG8gc2VhcmNoIHdpdGhpbi5cbiAgICogQHJldHVybnMgQW4gYXJyYXkgY29udGFpbmluZyB0aGUgbWF0Y2ggYW5kIGFsbCBzdWJtYXRjaGVzLlxuICAgKi9cbiAgcHVibGljIGZpbmRTdWJtYXRjaCh0ZXh0OiBzdHJpbmcpOiBzdHJpbmdbXSB8IHVuZGVmaW5lZCB7XG4gICAgY29uc3QgcmVzdWx0ID0gdGV4dC5tYXRjaCh0aGlzLl9yZWdleCk7XG4gICAgaWYgKHJlc3VsdCkge1xuICAgICAgcmV0dXJuIFtyZXN1bHRbMF0sIC4uLnJlc3VsdC5zbGljZSgxKV07XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICAvKipcbiAgICogRmluZHMgdGhlIHN0YXJ0IGFuZCBlbmQgaW5kZXggb2YgdGhlIG1hdGNoIGFuZCBhbGwgc3VibWF0Y2hlcy5cbiAgICogQHBhcmFtIHRleHQgVGhlIHRleHQgdG8gc2VhcmNoIHdpdGhpbi5cbiAgICogQHJldHVybnMgQW4gYXJyYXkgY29udGFpbmluZyBhcnJheXMgb2Ygc3RhcnQgYW5kIGVuZCBpbmRpY2VzIGZvciB0aGUgbWF0Y2ggYW5kIGFsbCBzdWJtYXRjaGVzLlxuICAgKi9cbiAgcHVibGljIGZpbmRTdWJtYXRjaEluZGV4KHRleHQ6IHN0cmluZyk6IG51bWJlcltdW10gfCB1bmRlZmluZWQge1xuICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuX3JlZ2V4LmV4ZWModGV4dCk7XG4gICAgaWYgKCFyZXN1bHQpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgLy8gSW5pdGlhbGl6ZSB0aGUgYXJyYXkgd2l0aCB0aGUgbWF0Y2gncyBzdGFydCBhbmQgZW5kIGluZGljZXNcbiAgICBjb25zdCBpbmRpY2VzID0gW1tyZXN1bHQuaW5kZXgsIHJlc3VsdC5pbmRleCArIHJlc3VsdFswXS5sZW5ndGhdXTtcblxuICAgIC8vIEFkZCBzdWJtYXRjaCBpbmRpY2VzXG4gICAgcmVzdWx0LnNsaWNlKDEpLmZvckVhY2goKHN1Ym1hdGNoKSA9PiB7XG4gICAgICBjb25zdCBzdGFydCA9IHRleHQuaW5kZXhPZihzdWJtYXRjaCwgaW5kaWNlc1tpbmRpY2VzLmxlbmd0aCAtIDFdWzBdKTtcbiAgICAgIGNvbnN0IGVuZCA9IHN0YXJ0ICsgc3VibWF0Y2gubGVuZ3RoO1xuICAgICAgaW5kaWNlcy5wdXNoKFtzdGFydCwgZW5kXSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gaW5kaWNlcztcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5kcyBhbGwgbm9uLW92ZXJsYXBwaW5nIG9jY3VycmVuY2VzIG9mIHRoZSBwYXR0ZXJuIHdpdGhpbiB0aGUgdGV4dC5cbiAgICogUmV0dXJucyBhbiBlbXB0eSBhcnJheSBpZiBubyBtYXRjaGVzIGFyZSBmb3VuZC5cbiAgICogQHBhcmFtIHRleHQgVGhlIHRleHQgdG8gc2VhcmNoIHdpdGhpbi5cbiAgICogQHJldHVybnMgQW4gYXJyYXkgY29udGFpbmluZyBhbGwgbWF0Y2hlcyBmb3VuZC5cbiAgICovXG4gIHB1YmxpYyBmaW5kQWxsKHRleHQ6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBnbG9iYWxSZWdleCA9IHRoaXMuZ2V0R2xvYmFsUmVnZXgoKTtcbiAgICByZXR1cm4gWy4uLnRleHQubWF0Y2hBbGwoZ2xvYmFsUmVnZXgpXS5tYXAoKG1hdGNoKSA9PiBtYXRjaFswXSk7XG4gIH1cblxuICAvKipcbiAgICogRmluZHMgdGhlIHN0YXJ0IGFuZCBlbmQgaW5kZXggb2YgYWxsIG1hdGNoZXMgd2l0aGluIHRoZSB0ZXh0LlxuICAgKiBJbmRpY2VzIGFyZSB6ZXJvLWJhc2VkLlxuICAgKiBAcGFyYW0gdGV4dCBUaGUgdGV4dCB0byBzZWFyY2ggd2l0aGluLlxuICAgKiBAcmV0dXJucyBBbiBhcnJheSBjb250YWluaW5nIGFycmF5cyBvZiBzdGFydCBhbmQgZW5kIGluZGljZXMgZm9yIGVhY2ggbWF0Y2ggZm91bmQuXG4gICAqL1xuICBwdWJsaWMgZmluZEFsbEluZGV4KHRleHQ6IHN0cmluZyk6IG51bWJlcltdW10ge1xuICAgIGNvbnN0IG1hdGNoZXM6IG51bWJlcltdW10gPSBbXTtcbiAgICBjb25zdCBnbG9iYWxSZWdleCA9IHRoaXMuZ2V0R2xvYmFsUmVnZXgoKTtcblxuICAgIGZvciAoY29uc3QgbWF0Y2ggb2YgdGV4dC5tYXRjaEFsbChnbG9iYWxSZWdleCkpIHtcbiAgICAgIGlmIChtYXRjaC5pbmRleCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIG1hdGNoZXMucHVzaChbbWF0Y2guaW5kZXgsIG1hdGNoLmluZGV4ICsgbWF0Y2hbMF0ubGVuZ3RoXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG1hdGNoZXM7XG4gIH1cblxuICAvKipcbiAgICogUmVwbGFjZXMgYWxsIG9jY3VycmVuY2VzIG9mIHRoZSBtYXRjaCB3aXRoIGEgcmVwbGFjZW1lbnQgc3RyaW5nLlxuICAgKiBAcGFyYW0gdGV4dCBUaGUgdGV4dCB0byBzZWFyY2ggYW5kIHJlcGxhY2Ugd2l0aGluLlxuICAgKiBAcGFyYW0gcmVwbGFjZW1lbnQgVGhlIHJlcGxhY2VtZW50IHN0cmluZy5cbiAgICogQHJldHVybnMgVGhlIHJlc3VsdGluZyB0ZXh0IGFmdGVyIGFsbCByZXBsYWNlbWVudHMuXG4gICAqL1xuICBwdWJsaWMgcmVwbGFjZUFsbCh0ZXh0OiBzdHJpbmcsIHJlcGxhY2VtZW50OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IGdsb2JhbFJlZ2V4ID0gdGhpcy5nZXRHbG9iYWxSZWdleCgpO1xuICAgIHJldHVybiB0ZXh0LnJlcGxhY2UoZ2xvYmFsUmVnZXgsIHJlcGxhY2VtZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIZWxwZXIgbWV0aG9kIHRvIGdldCB0aGUgZ2xvYmFsIHZlcnNpb24gb2YgYSByZWdleC5cbiAgICogQHJldHVybnMgVGhlIGN1cnJlbnQgcmVnZXggaWYgaXQncyBhbHJlYWR5IGdsb2JhbCwgb3RoZXJ3aXNlIGEgbmV3IGdsb2JhbCByZWdleC5cbiAgICovXG4gIHByaXZhdGUgZ2V0R2xvYmFsUmVnZXgoKTogUmVnRXhwIHtcbiAgICByZXR1cm4gdGhpcy5fcmVnZXguZ2xvYmFsID8gdGhpcy5fcmVnZXggOiBuZXcgUmVnRXhwKHRoaXMuX3JlZ2V4LCBcImdcIik7XG4gIH1cbn1cbiJdfQ==